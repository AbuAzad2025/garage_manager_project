# 🔍 تحليل شامل لأنظمة الحذف في جميع الوحدات

## ✅ الوحدات التي لها حذف قوي كامل

### 1. العملاء (Customers)
- ✅ زر الحذف القوي: موجود (💣)
- ✅ الخدمة: `HardDeleteService.delete_customer()`
- ✅ العمليات العكسية:
  - إرجاع المخزون من المبيعات
  - حذف القيود المحاسبية (GLBatch)
  - حذف المبيعات والدفعات
  - حذف طلبات الصيانة
  - حذف الحجوزات المسبقة
  - حذف النفقات

### 2. الموردين (Suppliers)
- ✅ زر الحذف القوي: موجود
- ✅ الخدمة: `HardDeleteService.delete_supplier()`
- ✅ العمليات العكسية: موجودة

### 3. الشركاء (Partners)
- ✅ زر الحذف القوي: موجود
- ✅ الخدمة: `HardDeleteService.delete_partner()`
- ✅ العمليات العكسية: موجودة

### 4. المبيعات (Sales)
- ✅ زر الحذف القوي: موجود
- ✅ الخدمة: `HardDeleteService.delete_sale()`
- ✅ العمليات العكسية:
  - إرجاع المخزون
  - حذف القيود المحاسبية
  - حذف المرتجعات
  - حذف الدفعات

### 5. الدفعات (Payments)
- ✅ زر الحذف القوي: موجود
- ✅ الخدمة: `HardDeleteService.delete_payment()`
- ✅ العمليات العكسية:
  - حذف القيود المحاسبية

### 6. المصاريف (Expenses)
- ✅ زر الحذف القوي: موجود
- ✅ الخدمة: `HardDeleteService.delete_expense()`
- ✅ العمليات العكسية: موجودة

### 7. الصيانة (Service Requests)
- ✅ زر الحذف القوي: موجود
- ✅ الخدمة: `HardDeleteService.delete_service()`
- ✅ العمليات العكسية: موجودة

---

## ⚠️ الوحدات التي لها حذف عادي فقط

### 1. الشيكات (Checks)
- ✅ زر الحذف عادي: موجود
- ❌ زر الحذف القوي: **مفقود**
- 📍 الملف: `routes/checks.py`
- 🔧 يحتاج: إضافة حذف قوي مع عكس العمليات المحاسبية

### 2. الشحنات (Shipments)
- ✅ زر الحذف عادي: موجود
- ✅ يرجع المخزون إذا الشحنة وصلت
- ❌ زر الحذف القوي: **مفقود**
- 📍 الملف: `routes/shipments.py`
- 💡 الحذف العادي يعمل بشكل جيد (يرجع المخزون)
- ⚠️ يحتاج: إضافة حذف قوي للتسجيل والاستعادة

### 3. الحجوزات المسبقة (Preorders)
- ✅ زر إلغاء: موجود (cancel)
- ✅ يرجع reserved_quantity
- ✅ يسترد العربون
- ❌ زر الحذف القوي: **مفقود**
- 📍 الملف: `routes/warehouses.py`
- 💡 الإلغاء يعمل بشكل جيد
- ⚠️ يحتاج: إضافة حذف قوي للحذف النهائي

### 4. الفواتير (Invoices)
- ❓ يحتاج فحص
- 🔧 قد تحتاج حذف قوي

---

## 📋 الخطة المطلوبة

### مرحلة 1: فحص العمليات العكسية الموجودة
- [x] التحقق من صحة إرجاع المخزون (StockLevel.quantity)
- [x] التحقق من عكس القيود المحاسبية
- [ ] التحقق من حذف الموردين
- [ ] التحقق من حذف الشركاء
- [ ] التحقق من حذف الصيانة

### مرحلة 2: إضافة حذف قوي للشيكات
- [ ] إضافة `delete_check()` في HardDeleteService
- [ ] إضافة route في hard_delete.py
- [ ] إضافة template للتأكيد
- [ ] إضافة زر في templates/checks
- [ ] العمليات العكسية:
  - عكس القيود المحاسبية
  - عكس الرصيد

### مرحلة 3: إضافة حذف قوي للشحنات
- [ ] إضافة `delete_shipment()` في HardDeleteService
- [ ] إضافة route في hard_delete.py
- [ ] إضافة template للتأكيد
- [ ] إضافة زر في templates/warehouses
- [ ] العمليات العكسية:
  - إرجاع المخزون (إذا وصلت)
  - عكس رصيد الموردين
  - عكس حصص الشركاء

### مرحلة 4: إضافة حذف قوي للحجوزات المسبقة
- [ ] إضافة `delete_preorder()` في HardDeleteService
- [ ] إضافة route في hard_delete.py
- [ ] إضافة template للتأكيد
- [ ] إضافة زر في templates
- [ ] العمليات العكسية:
  - إلغاء الحجز (reserved_quantity)
  - استرداد العربون
  - حذف المدفوعات

---

## 🎯 الأولوية

1. **عالية**: الشيكات (Checks) - تؤثر على المحاسبة
2. **متوسطة**: الشحنات (Shipments) - تؤثر على المخزون
3. **منخفضة**: الحجوزات المسبقة - الإلغاء يعمل بشكل جيد

---

## ⚠️ ملاحظات مهمة

- الشحنات لها حذف عادي جيد يرجع المخزون
- الحجوزات لها إلغاء يعمل بشكل صحيح
- الأولوية للشيكات لأنها تؤثر على المحاسبة

