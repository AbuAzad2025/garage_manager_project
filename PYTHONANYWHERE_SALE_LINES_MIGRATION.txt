═══════════════════════════════════════════════════════════════
   تهجير PythonAnywhere - Sale Lines Enhancement
═══════════════════════════════════════════════════════════════

📅 التاريخ: 2025-10-24
🎯 الهدف: إضافة line_receiver إلى جدول sale_lines

═══════════════════════════════════════════════════════════════
   الخطوات (نفذها بالترتيب):
═══════════════════════════════════════════════════════════════

1️⃣ سحب آخر التحديثات:
────────────────────────────────────────────────────────────────
cd ~/garage_manager_project
git pull origin main


2️⃣ تنفيذ التهجير (SQLite):
────────────────────────────────────────────────────────────────
python3.10 << 'EOF'
from app import create_app, db
from sqlalchemy import text

app = create_app()
with app.app_context():
    try:
        # فحص إذا كان الحقل موجود
        result = db.session.execute(text("PRAGMA table_info(sale_lines)")).fetchall()
        columns = [row[1] for row in result]
        
        if 'line_receiver' not in columns:
            # إضافة الحقل الجديد
            db.session.execute(text(
                "ALTER TABLE sale_lines ADD COLUMN line_receiver VARCHAR(200)"
            ))
            db.session.commit()
            print('✅ تمت إضافة line_receiver بنجاح!')
        else:
            print('✅ line_receiver موجود بالفعل')
            
    except Exception as e:
        print(f'❌ خطأ: {e}')
        db.session.rollback()
EOF


3️⃣ إعادة تحميل التطبيق:
────────────────────────────────────────────────────────────────
touch /var/www/palkaraj-azad_pythonanywhere_com_wsgi.py


4️⃣ التحقق من النجاح:
────────────────────────────────────────────────────────────────
python3.10 << 'EOF'
from app import create_app, db
from sqlalchemy import text

app = create_app()
with app.app_context():
    result = db.session.execute(text("PRAGMA table_info(sale_lines)")).fetchall()
    print("\n📋 أعمدة جدول sale_lines:")
    print("=" * 50)
    for row in result:
        print(f"  • {row[1]:20} {row[2]:15}")
    print("=" * 50)
EOF


═══════════════════════════════════════════════════════════════
   ملاحظات مهمة:
═══════════════════════════════════════════════════════════════

✅ الحقل الجديد: line_receiver VARCHAR(200)
✅ النوع: اختياري (nullable)
✅ الغرض: حفظ اسم مستلم البضاعة لكل بند في الفاتورة

⚠️ تحذير: لا تحذف هذا الملف قبل تنفيذ التهجير على PythonAnywhere!

═══════════════════════════════════════════════════════════════
   التحديثات المرتبطة:
═══════════════════════════════════════════════════════════════

📝 models.py       → line_receiver added
📝 forms.py        → line_receiver field
📝 routes/sales.py → saving line_receiver
📝 form.html       → new grid + warehouse #ID + fields
📝 sales.js        → warehouse #ID display
📝 receipt_simple  → date only header

═══════════════════════════════════════════════════════════════

