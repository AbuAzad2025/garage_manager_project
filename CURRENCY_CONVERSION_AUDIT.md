# ๐ ูุญุต ุชุญููู ุงูุนููุงุช ูู ูุธุงู ุชุณููุฉ ุงูุดุฑูุงุก

**ุงูุชุงุฑูุฎ:** 2025-10-17  
**ุงูุญุงูุฉ:** ๐ **ููุฏ ุงููุญุต**

---

## โ ูุง ูุนูู ุจุดูู ุตุญูุญ

### 1. ุงููุจูุนุงุช (_get_partner_sales_share) โ
```python
# ููู ุนูููุฉ ุจูุน:
partner_share_ils = _convert_to_ils(partner_share, item.currency, item.date)
total_ils += partner_share_ils
```
**ุงูุญุงูุฉ:** โ ูุญูู ูู ุนูููุฉ ุฅูู ILS ูุจู ุงูุฌูุน

### 2. ุงูุฏูุนุงุช ููุดุฑูู (_get_payments_to_partner) โ
```python
# ููู ุฏูุนุฉ:
amount_ils = _convert_to_ils(payment.total_amount, payment.currency, payment.payment_date)
total_ils += amount_ils
```
**ุงูุญุงูุฉ:** โ ูุญูู ูู ุฏูุนุฉ ุฅูู ILS ูุจู ุงูุฌูุน

### 3. ุงูุฏูุนุงุช ูู ุงูุดุฑูู (_get_partner_payments_received) โ
```python
# ููู ุฏูุนุฉ:
amount_ils = _convert_to_ils(payment.total_amount, payment.currency, payment.payment_date)
total_ils += amount_ils
```
**ุงูุญุงูุฉ:** โ ูุญูู ูู ุฏูุนุฉ ุฅูู ILS ูุจู ุงูุฌูุน

### 4. ูุจูุนุงุช ููุดุฑูู (_get_partner_sales_as_customer) โ
```python
# ููู ูุงุชูุฑุฉ:
amount_ils = _convert_to_ils(sale.total_amount, sale.currency, sale.sale_date)
total_ils += amount_ils
```
**ุงูุญุงูุฉ:** โ ูุญูู ูู ูุงุชูุฑุฉ ุฅูู ILS ูุจู ุงูุฌูุน

### 5. ุฑุณูู ุงูุตูุงูุฉ (_get_partner_service_fees) โ
```python
# ููู ุตูุงูุฉ:
amount_ils = _convert_to_ils(service.total_amount, service.currency, service.received_at)
total_ils += amount_ils
```
**ุงูุญุงูุฉ:** โ ูุญูู ูู ุตูุงูุฉ ุฅูู ILS ูุจู ุงูุฌูุน

### 6. ุงููุตุฑููุงุช (_get_partner_expenses) โ
```python
# ููู ูุตุฑูู:
amount_ils = _convert_to_ils(amount, currency, expense_date)
total_ils += amount_ils
```
**ุงูุญุงูุฉ:** โ ูุญูู ูู ูุตุฑูู ุฅูู ILS ูุจู ุงูุฌูุน

---

## โ๏ธ ูุญุชูู ุงููุดููุฉ

### 1. ุงููุฎุฒูู (_get_partner_inventory) โ๏ธ
```python
# ุงูููุฏ ุงูุญุงูู:
cost = item.purchase_price  # ูู Product.purchase_price
partner_share = qty * cost * share_pct / 100
total += partner_share  # โ ุฌูุน ูุจุงุดุฑ ุจุฏูู ุชุญููู!
```

**ุงููุดููุฉ ุงููุญุชููุฉ:**
- ุฅุฐุง ูุงู `Product.purchase_price` ุจุนููุงุช ูุฎุชููุฉ
- ูุชู ุงูุฌูุน ูุจุงุดุฑุฉ ุจุฏูู ุชุญููู!

**ุงูุญู ุงููุทููุจ:**
- ุงูุชุญูู ูู ุนููุฉ ุงูููุชุฌ (ุฅู ูุฌุฏุช)
- ุชุญููู ูู ูุทุนุฉ ุฅูู ILS ูุจู ุงูุฌูุน
- ุฃู ุงูุชุฑุงุถ ุฃู ุฌููุน ุงูุชูุงููู ุจุงูุนููุฉ ุงูุฃุณุงุณูุฉ

### 2. ุงููุทุน ุงูุชุงููุฉ (_get_partner_damaged_items) โ๏ธ
```python
# ุงูููุฏ ุงูุญุงูู:
partner_loss = qty * unit_cost * share_pct / 100
total_ils += partner_loss  # โ ุฌูุน ูุจุงุดุฑ ุจุฏูู ุชุญููู!
```

**ุงููุดููุฉ ุงููุญุชููุฉ:**
- `unit_cost` ูู `StockAdjustmentItem` ูุฏ ูููู ุจุนููุฉ ูุฎุชููุฉ
- ูุชู ุงูุฌูุน ูุจุงุดุฑุฉ ุจุฏูู ุชุญููู!

---

## ๐ ุงูุชุญููู

### ุงูุณููุงุฑูู ุงููุดูู:

```
ุงููุฎุฒูู:
- ูุทุนุฉ A: ุชูููุฉ 100 USD
- ูุทุนุฉ B: ุชูููุฉ 200 ILS
- ูุทุนุฉ C: ุชูููุฉ 50 EUR

ุงูููุฏ ุงูุญุงูู:
total = 100 + 200 + 50 = 350 โ (ุฎููุท ูู ุงูุนููุงุช!)

ุงูุตุญูุญ:
100 USD ร 3.6 = 360 ILS
200 ILS ร 1.0 = 200 ILS
50 EUR ร 4.0 = 200 ILS
total = 360 + 200 + 200 = 760 ILS โ
```

---

## โ ุงูุญู ุงููุทููุจ

### 1. ุฅุถุงูุฉ ุชุญููู ุงูุนููุงุช ูููุฎุฒูู

```python
def _get_partner_inventory(partner_id, date_from, date_to):
    # ... ุงูููุฏ ุงูุญุงูู ...
    
    for inv_item in inventory_items:
        # ... ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ...
        
        # ุญุณุงุจ ูุตูุจ ุงูุดุฑูู
        partner_share = Decimal(str(qty)) * Decimal(str(cost or 0)) * Decimal(str(share_pct)) / Decimal("100")
        
        # ๐ฅ ุงูุชุญููู ุฅูู ILS ูุจู ุงูุฌูุน
        # ุงูุชุญูู ูู ุนููุฉ ุงูููุชุฌ
        product_currency = getattr(Product.query.get(prod_id), 'currency', 'ILS') or 'ILS'
        partner_share_ils = _convert_to_ils(partner_share, product_currency, datetime.utcnow())
        
        total += partner_share_ils  # โ ุฌูุน ุจุนุฏ ุงูุชุญููู
```

### 2. ุฅุถุงูุฉ ุชุญููู ุงูุนููุงุช ูููุทุน ุงูุชุงููุฉ

```python
def _get_partner_damaged_items(partner_id, date_from, date_to):
    # ... ุงูููุฏ ุงูุญุงูู ...
    
    for damaged in damaged_items:
        # ... ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ...
        
        # ุญุณุงุจ ูุตูุจ ุงูุฎุณุงุฑุฉ
        partner_loss = Decimal(str(quantity)) * Decimal(str(unit_cost or 0)) * Decimal(str(share_pct)) / Decimal("100")
        
        # ๐ฅ ุงูุชุญููู ุฅูู ILS ูุจู ุงูุฌูุน
        # ุงูุชุญูู ูู ุนููุฉ ุงูุชุนุฏูู
        adjustment_currency = 'ILS'  # ุงูุชุฑุงุถู - ูููู ุฌูุจูุง ูู StockAdjustment
        partner_loss_ils = _convert_to_ils(partner_loss, adjustment_currency, damaged.date)
        
        total_ils += partner_loss_ils  # โ ุฌูุน ุจุนุฏ ุงูุชุญููู
```

---

## ๐ฏ ุงูุฎุทุฉ

### ุงููุฑุญูุฉ 1: ุงูุชุญูู ูู ุนููุงุช ุงูููุชุฌุงุช
- [ ] ุงูุชุญูู ูู ูุฌูุฏ ุญูู `currency` ูู ุฌุฏูู `Product`
- [ ] ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ุงูุชุฑุงุถ ILS ูุฌููุน ุงูุชูุงููู

### ุงููุฑุญูุฉ 2: ุชุตุญูุญ ุฏุงูุฉ ุงููุฎุฒูู
- [ ] ุฅุถุงูุฉ ุชุญููู ุงูุนููุงุช ููู ูุทุนุฉ
- [ ] ุงุฎุชุจุงุฑ ูุน ููุชุฌุงุช ุจุนููุงุช ูุฎุชููุฉ

### ุงููุฑุญูุฉ 3: ุชุตุญูุญ ุฏุงูุฉ ุงููุทุน ุงูุชุงููุฉ
- [ ] ุฅุถุงูุฉ ุชุญููู ุงูุนููุงุช ููู ูุทุนุฉ ุชุงููุฉ
- [ ] ุงุฎุชุจุงุฑ ูุน ุชุนุฏููุงุช ุจุนููุงุช ูุฎุชููุฉ

### ุงููุฑุญูุฉ 4: ุงูุงุฎุชุจุงุฑ ุงูุดุงูู
- [ ] ุฅูุดุงุก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ุจุนููุงุช ูุฎุชููุฉ
- [ ] ุงูุชุฃูุฏ ูู ุตุญุฉ ุงููุฌุงููุน
- [ ] ููุงุฑูุฉ ูุน ุงูุญุณุงุจ ุงููุฏูู

---

## ๐ ุชูููู ุงูุฎุทูุฑุฉ

### ุงููุฎุฒูู:
- **ุงูุฎุทูุฑุฉ:** ๐ ูุชูุณุทุฉ
- **ุงูุณุจุจ:** ูู ูุนุธู ุงูุฃูุธูุฉุ ุงูุชูุงููู ุจุนููุฉ ูุงุญุฏุฉ
- **ุงูุญู:** ุงูุชุฑุงุถ ILS ุฅู ูู ุชูู ููุงู ุนููุฉ ูุญุฏุฏุฉ

### ุงููุทุน ุงูุชุงููุฉ:
- **ุงูุฎุทูุฑุฉ:** ๐ก ููุฎูุถุฉ
- **ุงูุณุจุจ:** ุนุงุฏุฉ ุชููู ุจููุณ ุนููุฉ ุงูููุชุฌ
- **ุงูุญู:** ููุณ ุงูููุทู ุฃุนูุงู

---

## โ ุงูุชูุตูุฉ

### ุงูุฃููููุฉ 1 (ุนุงุฌู):
1. ุงูุชุญูู ูู ูุฌูุฏ ุนููุงุช ูุฎุชููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
2. ุฅุฐุง ูุงูุช ุฌููุน ุงูููุชุฌุงุช ุจู ILS โ ูุง ูุดููุฉ ุญุงููุงู
3. ุฅุฐุง ูุงูุช ููุงู ุนููุงุช ูุฎุชููุฉ โ ุชุตุญูุญ ููุฑู

### ุงูุฃููููุฉ 2 (ุงุญุชูุงุทู):
1. ุฅุถุงูุฉ ุชุญููู ุงูุนููุงุช ูููุฎุฒูู ูุงูุชุงูู
2. ุญุชู ูู ูุงูุช ุฌููุน ุงูููุชุฌุงุช ุจู ILS ุญุงููุงู
3. ููุญูุงูุฉ ุงููุณุชูุจููุฉ

---

**ุงูุฎูุงุตุฉ:** ุงููุธุงู ูุญูู ุงูุนููุงุช ุจุดูู ุตุญูุญ ูู ูุนุธู ุงูุฏูุงูุ ููู ุงููุฎุฒูู ูุงููุทุน ุงูุชุงููุฉ ูุฏ ุชุญุชุงุฌ ุชุญุณูู!

