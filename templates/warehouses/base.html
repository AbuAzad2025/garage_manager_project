{# templates/warehouses/base.html #}
{% extends 'base.html' %}

{% block title %}
  {% block page_title %}المستودعات{% endblock %} — نظام إدارة الكراج
{% endblock %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/warehouses.css') }}">
{% endblock %}

{# نستخدمه لتفعيل الزر الحالي في مسار التنقل #}
{% set ep = request.endpoint or '' %}
{% macro is_active(prefix) -%}{% if ep.startswith(prefix) %}active{% endif %}{%- endmacro %}

{% block breadcrumb %}
  <li class="breadcrumb-item {{ is_active('warehouse_bp.list') }}">
    <a class="btn btn-sm btn-primary" href="{{ url_for('warehouse_bp.list') }}">
      <i class="fas fa-warehouse me-1"></i> قائمة المستودعات
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.create') }}">
    <a class="btn btn-sm btn-success" href="{{ url_for('warehouse_bp.create') }}">
      <i class="fas fa-plus me-1"></i> مستودع جديد
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.inventory_summary') }}">
    <a class="btn btn-sm btn-dark" href="{{ url_for('warehouse_bp.inventory_summary') }}">
      <i class="fas fa-table me-1"></i> كشف المخزون
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.preorders_list') }}">
    <a class="btn btn-sm btn-info text-white" href="{{ url_for('warehouse_bp.preorders_list') }}">
      <i class="fas fa-clipboard-list me-1"></i> الحجوزات
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.preorder_create') }}">
    <a class="btn btn-sm btn-outline-info" href="{{ url_for('warehouse_bp.preorder_create') }}">
      <i class="fas fa-file-signature me-1"></i> إنشاء حجز
    </a>
  </li>

  {# ===== روابط عادية بدون جافاسكربت ===== #}

  {# فتح صفحة منتجات مستودع عبر ID (GET → redirect إلى /warehouses/<id>/products) #}
  <li class="breadcrumb-item">
    <form class="input-group input-group-sm" method="get"
          action="{{ url_for('warehouse_bp.goto_warehouse_products') }}"
          style="max-width: 280px;">
      <span class="input-group-text"><i class="fas fa-boxes"></i></span>
      <input name="id" type="number" min="1" class="form-control" placeholder="ID مستودع">
      <button class="btn btn-outline-secondary" type="submit">المنتجات</button>
    </form>
  </li>

  {# فتح بطاقة صنف عبر ID (GET → redirect إلى /warehouses/parts/<product_id>) #}
  <li class="breadcrumb-item">
    <form class="input-group input-group-sm" method="get"
          action="{{ url_for('warehouse_bp.goto_product_card') }}"
          style="max-width: 280px;">
      <span class="input-group-text"><i class="fas fa-id-card"></i></span>
      <input name="id" type="number" min="1" class="form-control" placeholder="ID القطعة">
      <button class="btn btn-outline-dark" type="submit">بطاقة صنف</button>
    </form>
  </li>
{% endblock %}

{# مساحة المحتوى الخاصة بكل صفحة #}
{% block content %}
  {% block w_content %}{% endblock %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  {# إبقائه مفيد لباقي صفحات المستودعات، الروابط أعلاه لا تتطلب أي JS #}
  <script src="{{ url_for('static', filename='js/warehouses.js') }}"></script>
{% endblock %}
