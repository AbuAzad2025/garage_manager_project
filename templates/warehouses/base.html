{% extends 'base.html' %}

{% block title %}
  {% block page_title %}المستودعات{% endblock %} — شركة ازاد
{% endblock %}

{% block body_class %}warehouses-page{% endblock %}

{% block styles %}
  {{ super() }}
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/warehouses.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='adminlte/plugins/select2/css/select2.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='adminlte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css') }}">
  <style>
    /* إصلاح ألوان أزرار navbar المستودعات - إلغاء تأثير style.css */
    .warehouse-nav-buttons .btn {
      font-weight: 600 !important;
      border: 1px solid rgba(0,0,0,0.1) !important;
      background-image: none !important; /* إلغاء التدرجات من style.css */
      box-shadow: none !important;
      transform: none !important;
    }
    
    /* تطبيق الألوان الصحيحة */
    .warehouse-nav-buttons .btn-primary,
    .warehouse-nav-buttons a.btn-primary {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
      color: #fff !important;
      border-color: #007bff !important;
    }
    
    .warehouse-nav-buttons .btn-info,
    .warehouse-nav-buttons a.btn-info {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;
      color: #fff !important;
      border-color: #17a2b8 !important;
    }
    
    .warehouse-nav-buttons .btn-dark,
    .warehouse-nav-buttons a.btn-dark {
      background: linear-gradient(135deg, #343a40 0%, #23272b 100%) !important;
      color: #fff !important;
      border-color: #343a40 !important;
    }
    
    .warehouse-nav-buttons .btn-success,
    .warehouse-nav-buttons a.btn-success {
      background: linear-gradient(135deg, #28a745 0%, #218838 100%) !important;
      color: #fff !important;
      border-color: #28a745 !important;
    }
    
    .warehouse-nav-buttons .btn-warning,
    .warehouse-nav-buttons a.btn-warning {
      background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
      color: #212529 !important;
      border-color: #ffc107 !important;
    }
    
    .warehouse-nav-buttons .btn-outline-success,
    .warehouse-nav-buttons a.btn-outline-success {
      background: #fff !important;
      color: #28a745 !important;
      border: 2px solid #28a745 !important;
    }
    
    .warehouse-nav-buttons .btn-outline-success:hover,
    .warehouse-nav-buttons a.btn-outline-success:hover {
      background: linear-gradient(135deg, #28a745 0%, #218838 100%) !important;
      color: #fff !important;
    }
    
    .warehouse-nav-buttons .btn-outline-warning,
    .warehouse-nav-buttons a.btn-outline-warning {
      background: #fff !important;
      color: #ffc107 !important;
      border: 2px solid #ffc107 !important;
    }
    
    .warehouse-nav-buttons .btn-outline-warning:hover,
    .warehouse-nav-buttons a.btn-outline-warning:hover {
      background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
      color: #212529 !important;
    }
    
    /* تأثير hover */
    .warehouse-nav-buttons .btn:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    }
  </style>
  {% block dt_styles %}{% endblock %}
{% endblock %}

{% set ep = request.endpoint or '' %}
{% macro is_active(prefix) -%}{% if ep.startswith(prefix) %}active{% endif %}{%- endmacro %}

{% block breadcrumb %}
  {% set DEFAULT_WID = 1 %}
  {% set wid =
    (warehouse.id if warehouse is defined else
     active_warehouse_id if active_warehouse_id is defined else
     (request.view_args.get('id') if request.view_args and request.view_args.get('id') is not none else
      (request.view_args.get('warehouse_id') if request.view_args and request.view_args.get('warehouse_id') is not none else none)))
  %}

  <!-- أزرار التنقل محسّنة -->
  <div class="warehouse-nav-buttons d-flex flex-wrap align-items-center gap-2 mb-3">
    <a class="btn btn-sm btn-primary shadow-sm fw-bold" 
       href="{{ url_for('warehouse_bp.list') }}"
       title="عرض قائمة جميع المستودعات">
      <i class="fas fa-warehouse me-1"></i> قائمة المستودعات
    </a>

    <a class="btn btn-sm btn-info text-white shadow-sm fw-bold" 
       href="{{ url_for('warehouse_bp.products', id=(wid or DEFAULT_WID)) }}"
       title="عرض جميع منتجات المستودع">
      <i class="fas fa-box-open me-1"></i> منتجاتي
    </a>

    <a class="btn btn-sm btn-dark shadow-sm fw-bold" 
       href="{{ url_for('warehouse_bp.inventory_summary') }}"
       title="كشف شامل لجميع المخزون عبر المستودعات">
      <i class="fas fa-table me-1"></i> كشف المخزون
    </a>

    <span class="text-muted mx-2">|</span>

    <a class="btn btn-sm btn-success shadow-sm fw-bold" 
       href="{{ url_for('warehouse_bp.add_product', id=(wid or DEFAULT_WID)) }}"
       title="إضافة منتج جديد للمستودع">
      <i class="fas fa-plus-circle me-1"></i> إضافة منتج
    </a>

    <a class="btn btn-sm btn-outline-success shadow-sm" 
       href="{{ url_for('warehouse_bp.create') }}"
       title="إضافة مستودع جديد">
      <i class="fas fa-plus me-1"></i> مستودع جديد
    </a>

    <a class="btn btn-sm btn-warning text-dark shadow-sm" 
       href="{{ url_for('warehouse_bp.preorders_list') }}"
       title="عرض جميع حجوزات العملاء">
      <i class="fas fa-clipboard-list me-1"></i> الحجوزات
    </a>

    <a class="btn btn-sm btn-outline-warning shadow-sm" 
       href="{{ url_for('warehouse_bp.preorder_create') }}"
       title="إنشاء حجز جديد لعميل">
      <i class="fas fa-file-signature me-1"></i> إنشاء حجز
    </a>
  </div>
{% endblock %}

{% block content %}
  <div id="notification-container"></div>
  {% block w_content %}{% endblock %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='adminlte/plugins/select2/js/select2.full.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/warehouses.js') }}"></script>
  {% block dt_scripts %}{% endblock %}
{% endblock %}
