{% extends 'warehouses/base.html' %}
{% block title %}الشحنات{% if warehouse %} – {{ warehouse.name }}{% endif %}{% endblock %}
{% block page_title %}الشحنات{% if warehouse %} – {{ warehouse.name }}{% endif %}{% endblock %}

{% block head_extra %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/shipments.css') }}">
{% endblock %}

{% block content %}
<div class="mb-3 d-flex justify-content-between align-items-center">
  <h3 class="mb-0">الشحنات{% if warehouse %} في {{ warehouse.name }}{% endif %}</h3>

  <a id="addShipmentBtn"
     href="{{ url_for('shipments_bp.create_shipment', destination_id=warehouse.id) if warehouse else url_for('shipments_bp.create_shipment') }}"
     class="btn btn-success btn-sm">
    <i class="fa fa-plus"></i> إضافة شحنة
  </a>
</div>

<div class="table-responsive">
  <table id="shipmentsTable" class="table table-striped table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>رقم الشحنة</th>
        <th>الوجهة</th>
        <th>تاريخ الوصول المتوقع</th>
        <th>الحالة</th>
        <th class="text-end">الإجمالي</th>
        <th class="text-center">إجراءات</th>
      </tr>
    </thead>
    <tbody>
      {% for sh in shipments %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ sh.shipment_number }}</td>
          <td>
            {% if sh.destination_warehouse %}
              {{ sh.destination_warehouse.name }}
            {% else %}
              {{ sh.destination or '-' }}
            {% endif %}
          </td>
          <td>{{ sh.expected_arrival.strftime('%Y-%m-%d') if sh.expected_arrival else '-' }}</td>
          <td>
            <span class="badge bg-info">{{ sh.status or '-' }}</span>
          </td>
          <td class="text-end">{{ format_currency(sh.total_value or 0) }}</td>
          <td class="text-center">
            <a href="{{ url_for('shipments_bp.shipment_detail', id=sh.id) }}" class="btn btn-sm btn-outline-info" title="عرض">
              <i class="fa fa-eye"></i>
            </a>
            <a href="{{ url_for('shipments_bp.edit_shipment', id=sh.id) }}" class="btn btn-sm btn-outline-secondary" title="تعديل">
              <i class="fa fa-pencil-alt"></i>
            </a>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="7" class="text-center text-muted">لا توجد شحنات</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/shipments.js') }}"></script>
{% endblock %}
