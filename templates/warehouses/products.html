{% extends 'warehouses/base.html' %}
{% block page_title %}Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¹Ø¨Ø± Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ù…Ø­Ø¯Ø¯Ø©{% endblock %}

{% block breadcrumb %}
  {{ super() }}
{% endblock %}

{% block head_extra %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/warehouses.css') }}">
  <style>
    .inline-input{width:100%;min-width:90px;max-width:140px}
    .w-qty{min-width:90px;max-width:110px}
    .w-price{min-width:100px;max-width:130px}
    #notification-container{position:fixed;top:20px;right:20px;z-index:2000}
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    .sticky-column {
      position: sticky;
      left: 0;
      background: #f8f9fa;
      z-index: 10;
      border-right: 2px solid #dee2e6;
    }
    
    .table th {
      white-space: nowrap;
      font-weight: 600;
      font-size: 0.9rem;
    }
    
    .table td {
      vertical-align: middle;
      font-size: 0.9rem;
    }
    
    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
    .btn-group .btn {
      border-radius: 0.375rem;
      margin: 0 2px;
    }
    
    .btn-group .btn.active {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      .btn-group {
        flex-wrap: wrap;
        gap: 0.25rem;
      }
      
      .btn-group .btn {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
      }
      
      .card-header .d-flex {
        flex-direction: column;
        align-items: flex-start !important;
        gap: 1rem;
      }
      
      .card-header .btn-group {
        width: 100%;
        justify-content: center;
      }
      
      .table-responsive {
        font-size: 0.8rem;
      }
      
      .inline-input {
        min-width: 60px;
        max-width: 100px;
      }
    }
    
    @media (max-width: 576px) {
      .btn-group .btn {
        font-size: 0.7rem;
        padding: 0.2rem 0.4rem;
      }
      
      .table th, .table td {
        padding: 0.3rem;
      }
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© */
    .column-hidden {
      display: none !important;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† */
    .partners-list, .suppliers-list {
      max-width: 200px;
      font-size: 0.85rem;
    }
    
    .partner-item, .supplier-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.25rem 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .partner-item:last-child, .supplier-item:last-child {
      border-bottom: none;
    }
    
    .partner-item .badge, .supplier-item .badge {
      font-size: 0.7rem;
      padding: 0.2rem 0.4rem;
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn-group .btn {
      transition: all 0.2s ease;
    }
    
    .btn-group .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* ØªØ­Ø³ÙŠÙ† Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    .btn-success {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      border: none;
      box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
    }
    
    .btn-success:hover {
      background: linear-gradient(135deg, #218838 0%, #1ea085 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
    }
    
    .border-left-primary {
      border-left: 4px solid #007bff !important;
    }
    
    .border-left-success {
      border-left: 4px solid #28a745 !important;
    }
    
    .border-left-warning {
      border-left: 4px solid #ffc107 !important;
    }
    
    .border-left-danger {
      border-left: 4px solid #dc3545 !important;
    }
    
    .text-xs {
      font-size: 0.7rem;
      letter-spacing: 0.5px;
    }
    
    .text-gray-800 {
      color: #5a5c69 !important;
    }
    
    .card.shadow {
      box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15) !important;
    }
    
    .card.shadow:hover {
      box-shadow: 0 0.25rem 2rem 0 rgba(58, 59, 69, 0.25) !important;
      transform: translateY(-2px);
      transition: all 0.3s ease;
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }
    
    .pulse {
      animation: pulse 2s ease-in-out infinite;
    }
  </style>
{% endblock %}

{% block content %}
<div id="notification-container"></div>

<div class="row mb-4">
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card border-left-primary shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800" id="stat-total-products">0</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-boxes fa-2x text-primary"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card border-left-success shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800" id="stat-total-quantity">0</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-cubes fa-2x text-success"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card border-left-warning shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© (ILS)</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800" id="stat-total-value">0.00</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-dollar-sign fa-2x text-warning"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-lg-3 col-md-6 mb-3">
    <div class="card border-left-danger shadow h-100 py-2">
      <div class="card-body">
        <div class="row no-gutters align-items-center">
          <div class="col mr-2">
            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Ù…Ù†ØªØ¬Ø§Øª Ù†ÙØ¯Øª</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800" id="stat-out-of-stock">0</div>
          </div>
          <div class="col-auto">
            <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="card mb-4 shadow-sm">
  <div class="card-body">
    <form id="filter-form" class="row g-3 align-items-end" method="get">
      <div class="col-lg-6">
        <label for="warehouse_ids" class="form-label">
          <i class="fas fa-warehouse me-1"></i>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
        </label>
        <select id="warehouse_ids" class="form-select" name="warehouse_ids" multiple size="4">
          {% for w in warehouses %}
            <option value="{{ w.id }}" {% if w.id in selected_ids %}selected{% endif %}>{{ w.name }}</option>
          {% endfor %}
        </select>
        <div class="form-text">
          <i class="fas fa-info-circle me-1"></i>Ø§Ø³ØªØ®Ø¯Ù… Ctrl Ø£Ùˆ âŒ˜ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯
        </div>
      </div>
      <div class="col-lg-4">
        <label for="q" class="form-label">
          <i class="fas fa-search me-1"></i>Ø¨Ø­Ø«
        </label>
        <input id="q" name="q" type="search" class="form-control" value="{{ request.args.get('q','') }}" placeholder="Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ SKU Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø£Ùˆ Ø§Ù„Ù…Ø§Ø±ÙƒØ©">
      </div>
      <div class="col-lg-2 d-flex gap-2">
        <button class="btn btn-primary flex-fill" type="submit">
          <i class="fas fa-filter me-1"></i>ØªØ·Ø¨ÙŠÙ‚
        </button>
        <a class="btn btn-secondary flex-fill" href="{{ url_for('warehouse_bp.detail', warehouse_id=active_warehouse_id) }}">
          <i class="fas fa-arrow-right me-1"></i>Ø±Ø¬ÙˆØ¹
        </a>
      </div>
    </form>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-header bg-light">
    <div class="d-flex justify-content-between align-items-center">
      <h6 class="mb-0">
        <i class="fas fa-boxes me-2"></i>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        <span class="badge bg-primary ms-2" id="products-count">0</span>
      </h6>
      
      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© -->
      <div class="btn-group btn-group-sm" role="group">
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('sku')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ SKU">
          <i class="fas fa-tag"></i> SKU
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('part_number')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©">
          <i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('brand')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø§Ø±ÙƒØ©">
          <i class="fas fa-star"></i> Ø§Ù„Ù…Ø§Ø±ÙƒØ©
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('purchase_price')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
          <i class="fas fa-shopping-cart"></i> Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('online_price')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†">
          <i class="fas fa-globe"></i> Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('partners')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡">
          <i class="fas fa-handshake"></i> Ø§Ù„Ø´Ø±ÙƒØ§Ø¡
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('suppliers')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†">
          <i class="fas fa-truck"></i> Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('created_at')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©">
          <i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        </button>
        <button type="button" class="btn btn-outline-secondary" onclick="toggleColumn('status')" title="Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø©">
          <i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©
        </button>
      </div>
      
      <!-- Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
      <div class="ms-3">
        <button type="button" class="btn btn-success btn-sm" onclick="printTable()" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„">
          <i class="fas fa-print me-1"></i>Ø·Ø¨Ø§Ø¹Ø©
        </button>
      </div>
    </div>
  </div>
  
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped mb-0" id="products-table" data-active-warehouse-id="{{ active_warehouse_id }}">
        <thead class="table-light">
          <tr>
            <th class="sticky-column">
              <i class="fas fa-box me-1"></i>Ø§Ù„Ù‚Ø·Ø¹Ø©
            </th>
            <th class="column-sku column-hidden">
              <i class="fas fa-tag me-1"></i>SKU
            </th>
            <th class="column-part_number column-hidden">
              <i class="fas fa-hashtag me-1"></i>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©
            </th>
            <th class="column-brand column-hidden">
              <i class="fas fa-star me-1"></i>Ø§Ù„Ù…Ø§Ø±ÙƒØ©
            </th>
            <th class="text-end column-purchase_price column-hidden">
              <i class="fas fa-shopping-cart me-1"></i>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡
            </th>
            <th class="text-end">
              <i class="fas fa-dollar-sign me-1"></i>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹
            </th>
            <th class="text-end">
              <i class="fas fa-tag me-1"></i>Ø§Ù„Ø³Ø¹Ø±
            </th>
            <th class="text-end column-online_price column-hidden">
              <i class="fas fa-globe me-1"></i>Ø³Ø¹Ø± Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†
            </th>
            <th class="text-end">
              <i class="fas fa-cubes me-1"></i>Ø§Ù„ÙƒÙ…ÙŠØ©
            </th>
            <th class="text-end">
              <i class="fas fa-calculator me-1"></i>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            </th>
            <th class="column-partners column-hidden">
              <i class="fas fa-handshake me-1"></i>Ø§Ù„Ø´Ø±ÙƒØ§Ø¡
            </th>
            <th class="column-suppliers column-hidden">
              <i class="fas fa-truck me-1"></i>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
            </th>
            <th class="column-created_at column-hidden">
              <i class="fas fa-calendar me-1"></i>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            </th>
            <th class="column-status column-hidden">
              <i class="fas fa-info-circle me-1"></i>Ø§Ù„Ø­Ø§Ù„Ø©
            </th>
          </tr>
        </thead>
        <tbody id="products-body"></tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    (function(){
      var DT=null;
      
      // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
      function notify(message, type) {
        type = type || 'info';
        var container = document.getElementById('notification-container');
        if (!container) {
          container = document.createElement('div');
          container.id = 'notification-container';
          document.body.appendChild(container);
        }
        
        var alert = document.createElement('div');
        alert.className = 'alert alert-' + type + ' alert-dismissible fade show';
        alert.innerHTML = '<strong>' + message + '</strong><button type="button" class="btn-close" data-bs-dismiss="alert"></button>';
        container.appendChild(alert);
        
        setTimeout(function() {
          alert.remove();
        }, 5000);
      }
      
      // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù…
      window.notify = notify;
      
      // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
      function toggleColumn(columnName) {
        const header = document.querySelector(`.column-${columnName}`);
        const button = document.querySelector(`[onclick="toggleColumn('${columnName}')"]`);
        
        if (header.classList.contains('column-hidden')) {
          // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ù…ÙˆØ¯
          header.classList.remove('column-hidden');
          button.classList.add('active');
          
          // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
          const cells = document.querySelectorAll(`td.column-${columnName}`);
          cells.forEach(cell => {
            cell.classList.remove('column-hidden');
          });
          
          // Ø¥Ø°Ø§ ÙƒØ§Ù† DataTable Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
          if (DT) {
            DT.columns.adjust();
          }
        } else {
          // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù…ÙˆØ¯
          header.classList.add('column-hidden');
          button.classList.remove('active');
          
          // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
          const cells = document.querySelectorAll(`td.column-${columnName}`);
          cells.forEach(cell => {
            cell.classList.add('column-hidden');
          });
          
          // Ø¥Ø°Ø§ ÙƒØ§Ù† DataTable Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„
          if (DT) {
            DT.columns.adjust();
          }
        }
      }
      
      // Ø¯ÙˆØ§Ù„ Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
      function showColumn(columnName) {
        const header = document.querySelector(`.column-${columnName}`);
        const button = document.querySelector(`[onclick="toggleColumn('${columnName}')"]`);
        
        if (header) {
          header.classList.remove('column-hidden');
          const cells = document.querySelectorAll(`td.column-${columnName}`);
          cells.forEach(cell => {
            cell.classList.remove('column-hidden');
          });
        }
        
        if (button) {
          button.classList.add('active');
        }
        
        if (DT) {
          DT.columns.adjust();
        }
        window.dispatchEvent(new Event('resize'));
      }
      
      function hideColumn(columnName) {
        const header = document.querySelector(`.column-${columnName}`);
        const button = document.querySelector(`[onclick="toggleColumn('${columnName}')"]`);
        
        if (header) {
          header.classList.add('column-hidden');
          const cells = document.querySelectorAll(`td.column-${columnName}`);
          cells.forEach(cell => {
            cell.classList.add('column-hidden');
          });
        }
        
        if (button) {
          button.classList.remove('active');
        }
        
        if (DT) {
          DT.columns.adjust();
        }
        window.dispatchEvent(new Event('resize'));
      }
      
      // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
      window.toggleColumn = toggleColumn;
      window.showColumn = showColumn;
      window.hideColumn = hideColumn;
      
      // Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      function printTable() {
        var table = document.getElementById('products-table');
        var rows = table.querySelectorAll('tbody tr:not([style*="display: none"])');
        if (rows.length === 0) {
          alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
          return;
        }
        
        var rowsPerPage = 25;
        var estimatedPages = Math.ceil(rows.length / rowsPerPage);
        
        var msg = 'Ø³ÙŠØªÙ… Ø·Ø¨Ø§Ø¹Ø© ' + rows.length + ' Ù…Ù†ØªØ¬';
        if (estimatedPages > 1) {
          msg += ' ÙÙŠ Ø­ÙˆØ§Ù„ÙŠ ' + estimatedPages + ' ØµÙØ­Ø©';
        }
        
        if (estimatedPages > 10) {
          msg = 'ØªØ­Ø°ÙŠØ±: ' + msg + '\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ';
          if (!confirm(msg)) return;
        } else if (estimatedPages > 1) {
          msg += '\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ';
          if (!confirm(msg)) return;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø©
        var printWindow = window.open('', '_blank');
        var printContent = generatePrintContent();
        
        printWindow.document.write(printContent);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        printWindow.close();
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      function generatePrintContent() {
        var table = document.getElementById('products-table');
        var visibleColumns = getVisibleColumns();
        var rows = table.querySelectorAll('tbody tr');
        
        var content = `
          <!DOCTYPE html>
          <html dir="rtl" lang="ar">
          <head>
            <meta charset="UTF-8">
            <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - ${new Date().toLocaleDateString('ar-SA')}</title>
            <style>
              body { font-family: 'Arial', sans-serif; font-size: 12px; margin: 20px; }
              .header { text-align: center; margin-bottom: 30px; }
              .header h1 { color: #333; margin-bottom: 10px; }
              .header .date { color: #666; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
              th { background-color: #f5f5f5; font-weight: bold; }
              .partners-list, .suppliers-list { font-size: 10px; }
              .badge { padding: 2px 6px; border-radius: 3px; font-size: 10px; }
              .bg-info { background-color: #17a2b8; color: white; }
              .bg-warning { background-color: #ffc107; color: black; }
              .bg-success { background-color: #28a745; color: white; }
              .bg-danger { background-color: #dc3545; color: white; }
              .bg-secondary { background-color: #6c757d; color: white; }
              @media print {
                body { margin: 0; }
                .no-print { display: none; }
              }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
              <div class="date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-SA')}</div>
              <div class="date">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${rows.length}</div>
            </div>
            
            <table>
              <thead>
                <tr>
                  ${generatePrintHeaders(visibleColumns)}
                </tr>
              </thead>
              <tbody>
                ${generatePrintRows(rows, visibleColumns)}
              </tbody>
            </table>
          </body>
          </html>
        `;
        
        return content;
      }
      
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
      function getVisibleColumns() {
        var headers = document.querySelectorAll('#products-table thead th');
        var visible = [];
        
        headers.forEach(function(header, index) {
          if (header.style.display !== 'none' && !header.classList.contains('column-hidden')) {
            visible.push({
              index: index,
              text: header.textContent.trim(),
              class: header.className
            });
          }
        });
        
        return visible;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø¤ÙˆØ³ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      function generatePrintHeaders(visibleColumns) {
        return visibleColumns.map(col => `<th>${col.text}</th>`).join('');
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ ØµÙÙˆÙ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      function generatePrintRows(rows, visibleColumns) {
        var html = '';
        
        rows.forEach(function(row) {
          var cells = row.querySelectorAll('td');
          var rowHtml = '<tr>';
          
          visibleColumns.forEach(function(col) {
            var cell = cells[col.index];
            if (cell) {
              var cellContent = cell.innerHTML;
              // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
              cellContent = cellContent.replace(/<input[^>]*>/g, function(match) {
                var input = document.createElement('div');
                input.innerHTML = match;
                var inputEl = input.querySelector('input');
                return inputEl ? inputEl.value : '';
              });
              rowHtml += '<td>' + cellContent + '</td>';
            }
          });
          
          rowHtml += '</tr>';
          html += rowHtml;
        });
        
        return html;
      }
      
      // Ø¬Ø¹Ù„ Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
      window.printTable = printTable;

      function csrfToken(){
        var m=document.querySelector('meta[name="csrf-token"]');if(m&&m.content)return m.content;
        var i=document.querySelector('input[name="csrf_token"]');if(i&&i.value)return i.value;
        var c=document.cookie.match(/(?:^|;\s*)csrf_token=([^;]+)/);return c?decodeURIComponent(c[1]):null;
      }
      
      // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¯Ø§Ù„Ø© Ù„Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ø§Ù…
      window.csrfToken = csrfToken;

      // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¯Ø§Ù„Ø© notify ØªÙ… ØªØ¹Ø±ÙŠÙÙ‡Ø§ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª ÙˆØªØµØ¯ÙŠØ±Ù‡Ø§ Ù„Ù€ window.notify

      function toStr(v){return v==null?'':String(v)}
      function fmt(n){if(n==null||n==='')return '';var x=Number(n);if(!isFinite(x))return String(n);return x.toLocaleString('ar-EG',{minimumFractionDigits:0,maximumFractionDigits:2})}

      function buildQuery(){
        var q=document.getElementById('q').value||'';
        var sel=document.getElementById('warehouse_ids');
        var params=['format=json'];
        if(q)params.push('q='+encodeURIComponent(q));
        if(sel){
          for(var i=0;i<sel.options.length;i++){
            var o=sel.options[i];
            if(o.selected)params.push('warehouse_ids='+encodeURIComponent(o.value));
          }
        }
        return params.join('&');
      }

function productsURL(){
  var aw = document.getElementById('products-table').dataset.activeWarehouseId;
  // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªÙˆØ¯Ø¹ ÙˆØ§Ø­Ø¯ Ù…Ø­Ø¯Ø¯ ÙÙŠ Ø§Ù„ÙÙ„ØªØ±ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙƒÙ€ wid Ù„Ù„Ù€ API
  var selected = (function(){
    var ids=[];
    var sel=document.querySelector('#filter-form select[name="warehouse_ids"]');
    if(sel){
      var opts=sel.options;
      for(var i=0;i<opts.length;i++){
        var o=opts[i];
        if(o.selected){ ids.push(o.value); }
      }
    }
    return ids;
  })();
  var wid = (selected && selected.length===1) ? selected[0] : aw;
  return '/api/warehouses/' + wid + '/products';
}

      function renderRow(p){
        var tr=document.createElement('tr');
        tr.dataset.id=p.id;
        
        tr.innerHTML=
          // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ - Ø§Ù„Ù‚Ø·Ø¹Ø© (Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù…Ø±Ø¦ÙŠ)
          '<td class="align-middle sticky-column"><a href="/warehouses/parts/'+p.id+'" class="fw-bold text-decoration-none">'+toStr(p.name||p.text)+'</a></td>'+
          
          // Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
          '<td class="align-middle column-sku column-hidden"><input class="form-control form-control-sm inline-input" data-field="sku" value="'+toStr(p.sku||'')+'"></td>'+ 
          '<td class="align-middle column-part_number column-hidden"><input class="form-control form-control-sm inline-input" data-field="part_number" value="'+toStr(p.part_number||'')+'"></td>'+ 
          '<td class="align-middle column-brand column-hidden"><input class="form-control form-control-sm inline-input" data-field="brand" value="'+toStr(p.brand||'')+'"></td>'+ 
          '<td class="align-middle text-end w-price column-purchase_price column-hidden"><input type="number" step="0.01" class="form-control form-control-sm inline-input text-end" data-field="purchase_price" value="'+toStr(p.purchase_price!=null?p.purchase_price:'')+'"></td>'+ 
          
          // Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø±Ø¦ÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
          '<td class="align-middle text-end w-price"><input type="number" step="0.01" class="form-control form-control-sm inline-input text-end" data-field="selling_price" value="'+toStr(p.selling_price!=null?p.selling_price:'')+'"></td>'+
          '<td class="align-middle text-end w-price"><input type="number" step="0.01" class="form-control form-control-sm inline-input text-end" data-field="price" value="'+toStr(p.price!=null?p.price:'')+'"></td>'+
          '<td class="align-middle text-end w-price column-online_price column-hidden"><input type="number" step="0.01" class="form-control form-control-sm inline-input text-end" data-field="online_price" value="'+toStr(p.online_price!=null?p.online_price:'')+'"></td>'+ 
          '<td class="align-middle text-end w-qty"><input type="number" step="1" class="form-control form-control-sm inline-input text-end" data-field="quantity" value="'+toStr(p.quantity!=null?p.quantity:'0')+'"></td>'+
          '<td class="align-middle text-end fw-bold" data-role="total_quantity">'+fmt(p.total_quantity||0)+'</td>'+
          
          // Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
          '<td class="align-middle column-partners column-hidden">'+
            '<div class="partners-list">'+formatPartners(p.partners||[])+'</div>'+
            '<button class="btn btn-sm btn-outline-primary mt-1" onclick="openPartnersModal('+p.id+', \''+toStr(p.name||p.text).replace(/'/g, "\\'")+'\')" title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡">'+
              '<i class="fas fa-edit"></i>'+
            '</button>'+
          '</td>'+
          '<td class="align-middle column-suppliers column-hidden">'+
            '<div class="suppliers-list">'+formatSuppliers(p.suppliers||[])+'</div>'+
            '<button class="btn btn-sm btn-outline-info mt-1" onclick="openSuppliersModal('+p.id+', \''+toStr(p.name||p.text).replace(/'/g, "\\'")+'\')" title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†">'+
              '<i class="fas fa-edit"></i>'+
            '</button>'+
          '</td>'+
          
          // Ø£Ø¹Ù…Ø¯Ø© Ø¥Ø¶Ø§ÙÙŠØ©
          '<td class="align-middle column-created_at column-hidden"><small class="text-muted">'+formatDate(p.created_at)+'</small></td>'+ 
          '<td class="align-middle column-status column-hidden"><span class="badge '+getStatusBadgeClass(p.status)+'">'+getStatusText(p.status)+'</span></td>'; 
        return tr;
      }
      
      // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      var cachedWarehouseType = null;
      var warehouseTypePromise = null;
      
      function getWarehouseType() {
        console.log('ğŸ¢ [getWarehouseType-1] Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹');
        console.log('ğŸ¢ [getWarehouseType-2] cachedWarehouseType:', cachedWarehouseType);
        console.log('ğŸ¢ [getWarehouseType-3] warehouseTypePromise:', !!warehouseTypePromise);
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ†Ø§ Ù†ÙˆØ¹ Ù…Ø­ÙÙˆØ¸ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡
        if (cachedWarehouseType && !warehouseTypePromise) {
          console.log('âœ… [getWarehouseType-4] Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸:', cachedWarehouseType);
          updateColumnsByWarehouseType();
          return Promise.resolve(cachedWarehouseType);
        }
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù†ØªØ¸Ø±Ù‡
        if (warehouseTypePromise) {
          console.log('â³ [getWarehouseType-5] Ø§Ù†ØªØ¸Ø§Ø± Ø·Ù„Ø¨ Ø³Ø§Ø¨Ù‚...');
          return warehouseTypePromise;
        }
        
        var activeWarehouseId = document.getElementById('products-table').dataset.activeWarehouseId;
        console.log('ğŸ¢ [getWarehouseType-6] activeWarehouseId Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:', activeWarehouseId);
        
        // Ø¥Ù† ÙˆÙØ¬Ø¯ Ù…Ø³ØªÙˆØ¯Ø¹ ÙˆØ§Ø­Ø¯ Ù…Ø­Ø¯Ø¯ ÙÙŠ Ø§Ù„ÙÙ„ØªØ±ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        var sel=document.querySelector('#filter-form select[name="warehouse_ids"]');
        if(sel){
          var chosen=[]; var opts=sel.options;
          for(var i=0;i<opts.length;i++){ if(opts[i].selected){ chosen.push(opts[i].value); } }
          console.log('ğŸ¢ [getWarehouseType-7] Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:', chosen);
          if(chosen.length===1){ 
            activeWarehouseId = chosen[0]; 
            console.log('ğŸ¢ [getWarehouseType-8] Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³ØªÙˆØ¯Ø¹ ÙˆØ§Ø­Ø¯:', activeWarehouseId);
          }
        }
        
        if (activeWarehouseId) {
          console.log('ğŸ“¡ [getWarehouseType-9] Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù…Ù† API...');
          warehouseTypePromise = fetch('/warehouses/api/warehouse-info?id=' + activeWarehouseId, {
            headers: {'X-Requested-With': 'XMLHttpRequest'},
            credentials: 'same-origin'
          })
          .then(r => {
            console.log('ğŸ“¥ [getWarehouseType-10] Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø¯ APIØŒ Ø§Ù„Ø­Ø§Ù„Ø©:', r.status);
            if (!r.ok) {
              throw new Error('HTTP ' + r.status + ': ' + r.statusText);
            }
            return r.json();
          })
          .then(data => {
            console.log('ğŸ“¦ [getWarehouseType-11] Ø¨ÙŠØ§Ù†Ø§Øª API:', data);
            cachedWarehouseType = data.type || 'MAIN';
            warehouseTypePromise = null;
            console.log('âœ… [getWarehouseType-12] ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù†ÙˆØ¹:', cachedWarehouseType);
            updateColumnsByWarehouseType();
            return cachedWarehouseType;
          })
          .catch(e => {
            console.error('âŒ [getWarehouseType-13] ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:', e);
            cachedWarehouseType = 'MAIN';
            warehouseTypePromise = null;
            console.log('âš ï¸ [getWarehouseType-14] Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: MAIN');
            updateColumnsByWarehouseType();
            return 'MAIN';
          });
          return warehouseTypePromise;
        } else {
          console.warn('âš ï¸ [getWarehouseType-15] Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø±Ù Ù…Ø³ØªÙˆØ¯Ø¹ Ù†Ø´Ø·');
          cachedWarehouseType = 'MAIN';
          updateColumnsByWarehouseType();
          return Promise.resolve('MAIN');
        }
      }
      
      
      
      function updateColumnsByWarehouseType() {
        var warehouseType = cachedWarehouseType || 'MAIN';
        console.log('ğŸ”„ [updateColumns-1] ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:', warehouseType);
        console.log('ğŸ”„ [updateColumns-2] cachedWarehouseType:', cachedWarehouseType);
        
        var partnersBtn = document.querySelector('[onclick="toggleColumn(\'partners\')"]');
        var suppliersBtn = document.querySelector('[onclick="toggleColumn(\'suppliers\')"]');
        
        console.log('ğŸ” [updateColumns-3] ÙˆØ¬ÙˆØ¯ Ø²Ø± Ø§Ù„Ø´Ø±ÙƒØ§Ø¡:', !!partnersBtn);
        console.log('ğŸ” [updateColumns-4] ÙˆØ¬ÙˆØ¯ Ø²Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†:', !!suppliersBtn);
        
        if (!partnersBtn || !suppliersBtn) {
          console.warn('âš ï¸ [updateColumns-5] Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ§Ø¡/Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©');
          return;
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹
        console.log('ğŸ”§ [updateColumns-6] Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø£ÙˆÙ„Ø§Ù‹...');
        hideColumn('partners');
        hideColumn('suppliers');
        console.log('âœ… [updateColumns-7] ØªÙ… Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©');
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        if (warehouseType === 'PARTNER') {
          // Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ ÙÙ‚Ø·
          console.log('ğŸ”§ [updateColumns-8] Ù…Ø³ØªÙˆØ¯Ø¹ PARTNER - Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ§Ø¡...');
          showColumn('partners');
          console.log('âœ… [updateColumns-9] ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡');
        } 
        else if (warehouseType === 'EXCHANGE') {
          // Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„ØªØ¨Ø§Ø¯Ù„: Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙÙ‚Ø·
          console.log('ğŸ”§ [updateColumns-8] Ù…Ø³ØªÙˆØ¯Ø¹ EXCHANGE - Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†...');
          showColumn('suppliers');
          console.log('âœ… [updateColumns-9] ØªÙ… Ø¥Ø¸Ù‡Ø§Ø± Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†');
        } 
        else {
          // Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰: Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ÙŠÙ‡Ù…Ø§
          console.log('âœ… [updateColumns-8] Ù…Ø³ØªÙˆØ¯Ø¹ ' + warehouseType + ' - Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ÙŠÙ‡Ù…Ø§');
        }
        console.log('ğŸ¯ [updateColumns-10] Ø§Ù†ØªÙ‡Ù‰ updateColumnsByWarehouseType()');
      }
      
      function formatPartners(partners) {
        if (!Array.isArray(partners) || partners.length === 0) {
          return '<span class="text-muted small" title="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Ø¡ Ù…ÙØ­Ø¯Ø¯ÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬">-</span>';
        }
        return partners.map(p => 
          '<div class="partner-item">' +
            '<span class="fw-bold small">' + toStr(p.name) + '</span>' +
            '<span class="badge bg-info ms-1 small">' + (p.share_percent || 0) + '%</span>' +
          '</div>'
        ).join('');
      }
      
      function formatSuppliers(suppliers) {
        if (!Array.isArray(suppliers) || suppliers.length === 0) {
          return '<span class="text-muted small" title="Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ±Ø¯ÙŠÙ† Ù…ÙØ­Ø¯Ø¯ÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬">-</span>';
        }
        return suppliers.map(s => 
          '<div class="supplier-item">' +
            '<span class="fw-bold small">' + toStr(s.name) + '</span>' +
            (s.quantity ? '<span class="badge bg-warning text-dark ms-1 small">' + s.quantity + ' Ù‚Ø·Ø¹Ø©</span>' : '') +
          '</div>'
        ).join('');
      }
      
      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
      function formatDate(dateStr) {
        if (!dateStr) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        try {
          var date = new Date(dateStr);
          return date.toLocaleDateString('ar-SA');
        } catch (e) {
          return 'ØºÙŠØ± ØµØ­ÙŠØ­';
        }
      }
      
      // ÙØ¦Ø© Ø§Ù„Ø­Ø§Ù„Ø©
      function getStatusBadgeClass(status) {
        switch(status) {
          case 'active': return 'bg-success';
          case 'inactive': return 'bg-secondary';
          case 'out_of_stock': return 'bg-danger';
          default: return 'bg-info';
        }
      }
      
      // Ù†Øµ Ø§Ù„Ø­Ø§Ù„Ø©
      function getStatusText(status) {
        switch(status) {
          case 'active': return 'Ù†Ø´Ø·';
          case 'inactive': return 'ØºÙŠØ± Ù†Ø´Ø·';
          case 'out_of_stock': return 'Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†';
          default: return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        }
      }

      function initDT(){
        if(!(window.jQuery&&jQuery.fn.DataTable))return;
        if(DT) return; // ØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹
        
        var $table = window.jQuery('#products-table');
        if (!$table.length) return;
        
        // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
        var dataRows = $table.find('tbody tr');
        if (dataRows.length === 0) return; // Ù„Ø§ Ù†Ù‡ÙŠØ¦ Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±Øº
        
        try {
          DT = $table.DataTable({
            pageLength: 25,
            order: [],
            responsive: true,
            autoWidth: false,
            language: { 
              url: "{{ url_for('static', filename='datatables/Arabic.json') }}",
              emptyTable: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª",
              info: "Ø¹Ø±Ø¶ _START_ Ø¥Ù„Ù‰ _END_ Ù…Ù† Ø£ØµÙ„ _TOTAL_",
              search: "Ø¨Ø­Ø«:",
              paginate: { first: "Ø§Ù„Ø£ÙˆÙ„", last: "Ø§Ù„Ø£Ø®ÙŠØ±", next: "Ø§Ù„ØªØ§Ù„ÙŠ", previous: "Ø§Ù„Ø³Ø§Ø¨Ù‚" }
            }
          });
        } catch (e) {
          console.error('Products DataTable failed:', e);
        }
      }

      var isLoading = false;
      
      function updateStatistics(products) {
        var totalProducts = products.length;
        var totalQuantity = 0;
        var totalValue = 0;
        var outOfStock = 0;
        
        products.forEach(function(p) {
          var qty = parseInt(p.total_quantity || p.quantity || 0);
          var price = parseFloat(p.price || p.selling_price || 0);
          
          totalQuantity += qty;
          totalValue += qty * price;
          
          if (qty === 0) {
            outOfStock++;
          }
        });
        
        document.getElementById('stat-total-products').textContent = totalProducts.toLocaleString('en-US');
        document.getElementById('stat-total-quantity').textContent = totalQuantity.toLocaleString('en-US');
        document.getElementById('stat-total-value').textContent = totalValue.toLocaleString('en-US', {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
        document.getElementById('stat-out-of-stock').textContent = outOfStock.toLocaleString('en-US');
        
        var outOfStockCard = document.getElementById('stat-out-of-stock').closest('.card');
        if (outOfStock > 0) {
          outOfStockCard.classList.add('pulse');
        } else {
          outOfStockCard.classList.remove('pulse');
        }
      }
      
      function loadProducts(){
        console.log('ğŸš€ [STEP 1] Ø¨Ø¯Ø¡ loadProducts()');
        
        if (isLoading) {
          console.warn('âš ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...');
          return;
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† cachedWarehouseType Ø¹Ù†Ø¯ ÙƒÙ„ ØªØ­Ù…ÙŠÙ„ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«
        cachedWarehouseType = null;
        console.log('ğŸ”„ [STEP 2] ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† cachedWarehouseType');
        
        isLoading = true;
        var url=productsURL()+'?'+buildQuery();
        console.log('ğŸ”— [STEP 3] URL:', url);
        
        var tbody=document.getElementById('products-body');
        var submitBtn = document.querySelector('#filter-form button[type="submit"]');
        
        console.log('ğŸ”˜ [STEP 4] Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…ÙˆØ¬ÙˆØ¯ØŸ', !!submitBtn);
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
          console.log('â¸ï¸ [STEP 5] ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
        }
        
        tbody.innerHTML = '<tr><td colspan="16" class="text-center"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
        
        var controller = new AbortController();
        var timeoutId = setTimeout(function() {
          controller.abort();
        }, 30000);
        
        console.log('ğŸ“¡ [STEP 6] Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...');
        fetch(url,{
          headers:{'X-Requested-With':'XMLHttpRequest'},
          credentials:'same-origin',
          signal: controller.signal
        })
          .then(function(r){
            console.log('ğŸ“¥ [STEP 7] Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ø§Ù„Ø­Ø§Ù„Ø©:', r.status);
            if (!r.ok) {
              throw new Error('HTTP ' + r.status + ': ' + r.statusText);
            }
            return r.json();
          })
          .then(function(res){
            console.log('ğŸ“¦ [STEP 8] ØªØ­ÙˆÙŠÙ„ JSONØŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', res);
            var arr = [];
            if (res && res.results) {
              arr = res.results;
            } else if (res && res.data) {
              arr = res.data;
            } else if (Array.isArray(res)) {
              arr = res;
            }
            
            console.log('ğŸ“Š [STEP 9] Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', arr.length);
            
            if (res && res.error) {
              throw new Error(res.error);
            }
            
            document.getElementById('products-count').textContent = arr.length;
            
            if (arr.length === 0) {
              console.log('ğŸ“­ [STEP 10] Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª');
              tbody.innerHTML = '<tr><td colspan="16" class="text-center text-muted py-4"><i class="fas fa-inbox fa-2x mb-2 d-block"></i>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</td></tr>';
              // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… return Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ finally
            } else {
            console.log('ğŸ“‹ [STEP 10] Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...');
            
            if (arr.length > 200) {
              notify('ØªØ­Ø°ÙŠØ±: ÙŠØªÙ… Ø¹Ø±Ø¶ ' + arr.length + ' Ù…Ù†ØªØ¬. Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ø·ÙŠØ¦Ø§Ù‹.', 'warning');
            }
            
            console.log('ğŸ“ˆ [STEP 11] ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
            updateStatistics(arr);
            
            // ØªØ­Ø¯ÙŠØ« Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø«Ù… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
            console.log('ğŸ¢ [STEP 12] Ø¬Ù„Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹...');
            getWarehouseType().then(function(warehouseType) {
              console.log('âœ… [STEP 13] ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:', warehouseType);
              console.log('ğŸ”§ [STEP 14] ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹...');
              updateColumnsByWarehouseType();
            }).catch(function(error) {
              console.warn('âš ï¸ [STEP 13-ERROR] ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:', error);
              updateColumnsByWarehouseType(); // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø­ØªÙ‰ Ù„Ùˆ ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†ÙˆØ¹
            });
            
            console.log('ğŸ“Š [STEP 15] Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„...');
            if(window.jQuery&&jQuery.fn.DataTable&&DT){
              console.log('ğŸ“Š [STEP 16] Ø§Ø³ØªØ®Ø¯Ø§Ù… DataTable Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯...');
              DT.clear();
              for(var i=0;i<arr.length;i++){ 
                DT.row.add( renderRow(arr[i]) ); 
              }
              DT.draw(false);
              console.log('âœ… [STEP 17] ØªÙ… Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            }else{
              console.log('ğŸ“Š [STEP 16] Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯...');
              var frag=document.createDocumentFragment();
              for(var j=0;j<arr.length;j++){ 
                frag.appendChild(renderRow(arr[j])); 
              }
              tbody.innerHTML='';
              tbody.appendChild(frag);
              initDT();
              console.log('âœ… [STEP 17] ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
            }
            } // Ø¥ØºÙ„Ø§Ù‚ else block
          })
          .catch(function(err){
            console.error('âŒ [ERROR] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:', err);
            if (err.name === 'AbortError') {
              tbody.innerHTML = '<tr><td colspan="16" class="text-center text-danger"><i class="fas fa-clock"></i> Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</td></tr>';
              notify('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø·Ù„Ø¨', 'warning');
            } else if (err.message && err.message.includes('Failed to fetch')) {
              tbody.innerHTML = '<tr><td colspan="16" class="text-center text-danger"><i class="fas fa-exclamation-triangle"></i> ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</td></tr>';
              notify('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±', 'danger');
            } else {
              tbody.innerHTML = '<tr><td colspan="16" class="text-center text-danger"><i class="fas fa-exclamation-circle"></i> ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + (err.message || err) + '</td></tr>';
              notify('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + (err.message || err),'danger');
            }
          })
          .finally(function(){
            clearTimeout(timeoutId);
            isLoading = false;
            console.log('ğŸ [STEP 18-FINALLY] Ø§Ù†ØªÙ‡Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±');
            console.log('ğŸ” [STEP 19] Ø­Ø§Ù„Ø© isLoading:', isLoading);
            console.log('ğŸ” [STEP 20] ÙˆØ¬ÙˆØ¯ submitBtn:', !!submitBtn);
            
            if (submitBtn) {
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<i class="fas fa-filter me-1"></i>ØªØ·Ø¨ÙŠÙ‚';
              console.log('âœ… [STEP 21] ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± - disabled:', submitBtn.disabled);
              console.log('âœ… [STEP 22] Ù†Øµ Ø§Ù„Ø²Ø±:', submitBtn.innerHTML);
            } else {
              console.warn('âš ï¸ [STEP 21-ERROR] Ø²Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!');
            }
            console.log('ğŸ‰ [STEP 23-END] Ø§Ù†ØªÙ‡Øª Ø¹Ù…Ù„ÙŠØ© loadProducts() Ø¨Ø§Ù„ÙƒØ§Ù…Ù„');
          });
      }

      function saveInline(productId, field, value){
        var aw=document.getElementById('products-table').dataset.activeWarehouseId;
        var url='/warehouses/'+aw+'/products/'+productId;
        var payload={};payload[field]=value;
        return fetch(url,{
          method:'POST',
          headers:{
            'Content-Type':'application/json',
            'X-Requested-With':'XMLHttpRequest',
            'X-CSRFToken':csrfToken()||''
          },
          credentials:'same-origin',
          body:JSON.stringify(payload)
        }).then(function(res){
          return res.json().catch(function(){return{}}).then(function(data){
            if(!res.ok || data.ok===false){
              var msg=(data&&(data.error||data.message))||'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸';
              throw new Error(msg);
            }
            return data;
          });
        });
      }

      function onEditCommit(e){
        var input=e.target;
        if(!input.classList.contains('inline-input'))return;
        var tr=input.closest('tr');if(!tr)return;
        var id=tr.dataset.id;
        var field=input.dataset.field;
        var val=input.value;
        var old=input.dataset.oldValue;if(old==null){old=''+val}
        if(input.dataset.saving==='1')return;
        input.dataset.saving='1';
        saveInline(id,field,val).then(function(data){
          if(field==='quantity'){
            var tq=tr.querySelector('[data-role="total_quantity"]');
            if(tq&&typeof data.total_quantity!=='undefined'){tq.textContent=fmt(data.total_quantity)}
            if(typeof data.quantity!=='undefined'&&data.quantity!==null){
              var qInput=tr.querySelector('input[data-field="quantity"]');
              if(qInput)qInput.value=data.quantity;
            }
          }
          if(data&&data.product){
            var p=data.product;
            if(typeof p.purchase_price!=='undefined'){tr.querySelector('input[data-field="purchase_price"]').value=p.purchase_price!=null?p.purchase_price:''}
            if(typeof p.selling_price!=='undefined'){tr.querySelector('input[data-field="selling_price"]').value=p.selling_price!=null?p.selling_price:''}
            if(typeof p.price!=='undefined'){tr.querySelector('input[data-field="price"]').value=p.price!=null?p.price:''}
            if(typeof p.online_price!=='undefined'){tr.querySelector('input[data-field="online_price"]').value=p.online_price!=null?p.online_price:''}
            if(typeof p.sku!=='undefined'){tr.querySelector('input[data-field="sku"]').value=p.sku||''}
            if(typeof p.part_number!=='undefined'){tr.querySelector('input[data-field="part_number"]').value=p.part_number||''}
            if(typeof p.brand!=='undefined'){tr.querySelector('input[data-field="brand"]').value=p.brand||''}
          }
          input.dataset.oldValue=''+val;
          notify('ØªÙ… Ø§Ù„Ø­ÙØ¸','success');
        }).catch(function(err){
          if(old!=null)input.value=old;
          notify(err&&err.message?err.message:'ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸','danger');
        }).finally(function(){delete input.dataset.saving});
      }

      function onInputFocus(e){
        var input=e.target;
        if(!input.classList.contains('inline-input'))return;
        input.dataset.oldValue=input.value;
      }

      function onInputKey(e){
        if(!e.target.classList.contains('inline-input'))return;
        if(e.key==='Enter'){e.preventDefault();e.target.blur();}
        if(e.key==='Escape'){if(e.target.dataset.oldValue!=null)e.target.value=e.target.dataset.oldValue;e.target.blur();}
      }

      // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© event listeners
      var filterForm = document.getElementById('filter-form');
      var productsTable = document.getElementById('products-table');
      
      if (filterForm) {
        filterForm.addEventListener('submit',function(e){e.preventDefault();loadProducts();});
      }
      
      if (productsTable) {
        productsTable.addEventListener('change',onEditCommit);
        productsTable.addEventListener('focusin',onInputFocus);
        productsTable.addEventListener('keydown',onInputKey);
      }

      // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
      getWarehouseType();
      loadProducts();
    })();
    
    // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ DOM Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    document.addEventListener('DOMContentLoaded', function() {
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ DOM
      if (typeof loadProducts === 'function') {
        loadProducts();
      }
    });
    
    // ==============================================================
    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
    // ==============================================================
    var currentProductId = null;
    var currentProductName = '';
    
    function openPartnersModal(productId, productName) {
      console.log('ğŸ”“ [openPartnersModal] ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ù„Ù„Ù…Ù†ØªØ¬:', productId);
      currentProductId = productId;
      currentProductName = productName;
      document.getElementById('partnersModalLabel').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ø´Ø±ÙƒØ§Ø¡: ' + productName;
      
      // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹
      loadAvailablePartners();
      // Ø«Ù… ØªØ­Ù…ÙŠÙ„ Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
      loadPartners(productId);
      
      var modal = new bootstrap.Modal(document.getElementById('partnersModal'));
      modal.show();
    }
    
    function openSuppliersModal(productId, productName) {
      console.log('ğŸ”“ [openSuppliersModal] ÙØªØ­ Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ù„Ù„Ù…Ù†ØªØ¬:', productId);
      currentProductId = productId;
      currentProductName = productName;
      document.getElementById('suppliersModalLabel').textContent = 'Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ±Ø¯ÙŠÙ†: ' + productName;
      
      // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ø§Ù„Ù…ØªØ§Ø­ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹
      loadAvailableSuppliers();
      // Ø«Ù… ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ±Ø¯ÙŠ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†
      loadSuppliers(productId);
      
      var modal = new bootstrap.Modal(document.getElementById('suppliersModal'));
      modal.show();
    }
    
    function loadPartners(productId) {
      console.log('ğŸ”„ [loadPartners] Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬:', productId);
      var tbody = document.getElementById('partnersListBody');
      tbody.innerHTML = '<tr><td colspan="3" class="text-center"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>';
      
      fetch('/warehouses/api/products/' + productId + '/partners', {
        headers: {'X-Requested-With': 'XMLHttpRequest'},
        credentials: 'same-origin'
      })
      .then(r => {
        console.log('ğŸ“¥ [loadPartners] Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø¯ØŒ Ø§Ù„Ø­Ø§Ù„Ø©:', r.status);
        if (!r.ok) {
          throw new Error('HTTP ' + r.status + ': ' + r.statusText);
        }
        return r.json();
      })
      .then(data => {
        console.log('ğŸ“¦ [loadPartners] Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', data);
        if (data.success && data.partners) {
          renderPartnersList(data.partners);
          console.log('âœ… [loadPartners] ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + data.partners.length + ' Ø´Ø±ÙŠÙƒ Ù„Ù„Ù…Ù†ØªØ¬');
        } else {
          tbody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Ø¡ Ù…Ø±ØªØ¨Ø·ÙŠÙ†</td></tr>';
          console.warn('âš ï¸ [loadPartners] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
        }
      })
      .catch(err => {
        console.error('âŒ [loadPartners] Ø®Ø·Ø£:', err);
        tbody.innerHTML = '<tr><td colspan="3" class="text-center text-danger">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ' + err.message + '</td></tr>';
        notify('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡: ' + err.message, 'danger');
      });
    }
    
    function renderPartnersList(partners) {
      var tbody = document.getElementById('partnersListBody');
      tbody.innerHTML = '';
      
      if (partners.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Ø¡ Ù…Ø±ØªØ¨Ø·ÙŠÙ†</td></tr>';
        return;
      }
      
      partners.forEach(function(p) {
        var tr = document.createElement('tr');
        tr.innerHTML = 
          '<td>' + p.partner_name + '</td>' +
          '<td class="text-center">' +
            '<input type="number" step="0.01" min="0" max="100" value="' + p.share_percentage + '" ' +
            'class="form-control form-control-sm d-inline-block" style="width: 80px;" ' +
            'id="share-' + p.id + '">' +
          '</td>' +
          '<td class="text-center">' +
            '<button class="btn btn-sm btn-success me-1" onclick="updatePartnerShare(' + p.id + ', ' + p.partner_id + ')" title="Ø­ÙØ¸">' +
              '<i class="fas fa-save"></i>' +
            '</button>' +
            '<button class="btn btn-sm btn-danger" onclick="deletePartner(' + p.id + ')" title="Ø­Ø°Ù">' +
              '<i class="fas fa-trash"></i>' +
            '</button>' +
          '</td>';
        tbody.appendChild(tr);
      });
    }
    
    function updatePartnerShare(shareId, partnerId) {
      var shareInput = document.getElementById('share-' + shareId);
      var shareValue = parseFloat(shareInput.value);
      
      if (isNaN(shareValue) || shareValue < 0 || shareValue > 100) {
        notify('Ø§Ù„Ù†Ø³Ø¨Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 100', 'danger');
        return;
      }
      
      fetch('/warehouses/api/products/' + currentProductId + '/partners/' + shareId, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': csrfToken() || ''
        },
        credentials: 'same-origin',
        body: JSON.stringify({ share_percentage: shareValue })
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          notify('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
          loadPartners(currentProductId);
          loadProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        } else {
          notify(data.message || 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'danger');
        }
      })
      .catch(err => {
        console.error('Error updating partner:', err);
        notify('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'danger');
      });
    }
    
    function deletePartner(shareId) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±ÙŠÙƒØŸ')) return;
      
      fetch('/warehouses/api/products/' + currentProductId + '/partners/' + shareId, {
        method: 'DELETE',
        headers: {
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': csrfToken() || ''
        },
        credentials: 'same-origin'
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          notify('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙŠÙƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          loadPartners(currentProductId);
          loadProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        } else {
          notify(data.message || 'ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'danger');
        }
      })
      .catch(err => {
        console.error('Error deleting partner:', err);
        notify('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù', 'danger');
      });
    }
    
    function loadAvailablePartners() {
      console.log('ğŸ”„ [loadAvailablePartners] Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡...');
      var select = document.getElementById('newPartnerSelect');
      
      fetch('/warehouses/api/partners/list', {
        headers: {'X-Requested-With': 'XMLHttpRequest'},
        credentials: 'same-origin'
      })
      .then(r => {
        console.log('ğŸ“¥ [loadAvailablePartners] Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø¯ØŒ Ø§Ù„Ø­Ø§Ù„Ø©:', r.status);
        if (!r.ok) {
          throw new Error('HTTP ' + r.status);
        }
        return r.json();
      })
      .then(data => {
        console.log('ğŸ“¦ [loadAvailablePartners] Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', data);
        if (data.success && data.partners) {
          select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø´Ø±ÙŠÙƒ...</option>';
          data.partners.forEach(function(p) {
            var option = document.createElement('option');
            option.value = p.id;
            option.textContent = p.name;
            select.appendChild(option);
          });
          console.log('âœ… [loadAvailablePartners] ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + data.partners.length + ' Ø´Ø±ÙŠÙƒ');
        } else {
          select.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Ø¡</option>';
          console.warn('âš ï¸ [loadAvailablePartners] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
        }
      })
      .catch(err => {
        console.error('âŒ [loadAvailablePartners] Ø®Ø·Ø£:', err);
        select.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
        notify('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡: ' + err.message, 'danger');
      });
    }
    
    function addNewPartner() {
      var partnerId = document.getElementById('newPartnerSelect').value;
      var sharePercentage = document.getElementById('newPartnerShare').value;
      
      if (!partnerId) {
        notify('ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø±ÙŠÙƒ', 'warning');
        return;
      }
      
      var shareValue = parseFloat(sharePercentage);
      if (isNaN(shareValue) || shareValue < 0 || shareValue > 100) {
        notify('Ø§Ù„Ù†Ø³Ø¨Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 100', 'danger');
        return;
      }
      
      fetch('/warehouses/api/products/' + currentProductId + '/partners', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': csrfToken() || ''
        },
        credentials: 'same-origin',
        body: JSON.stringify({
          partner_id: partnerId,
          share_percentage: shareValue
        })
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          notify('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙŠÙƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          document.getElementById('newPartnerSelect').value = '';
          document.getElementById('newPartnerShare').value = '';
          loadPartners(currentProductId);
          loadProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        } else {
          notify(data.message || 'ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'danger');
        }
      })
      .catch(err => {
        console.error('Error adding partner:', err);
        notify('ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'danger');
      });
    }
    
    function loadSuppliers(productId) {
      fetch('/warehouses/api/products/' + productId + '/suppliers', {
        headers: {'X-Requested-With': 'XMLHttpRequest'},
        credentials: 'same-origin'
      })
      .then(r => {
        if (!r.ok) {
          throw new Error('HTTP ' + r.status + ': ' + r.statusText);
        }
        return r.json();
      })
      .then(data => {
        if (data.success && data.suppliers) {
          renderSuppliersList(data.suppliers);
        }
      })
      .catch(err => {
        console.error('Error loading suppliers:', err);
        notify('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: ' + err.message, 'danger');
      });
    }
    
    function renderSuppliersList(suppliers) {
      var div = document.getElementById('suppliersInfo');
      
      if (suppliers.length === 0) {
        div.innerHTML = '<p class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ±Ø¯ Ù…Ø±ØªØ¨Ø·</p>';
        return;
      }
      
      var supplier = suppliers[0]; // Ù…ÙˆØ±Ø¯ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
      div.innerHTML = 
        '<div class="alert alert-info">' +
          '<strong>Ø§Ù„Ù…ÙˆØ±Ø¯:</strong> ' + supplier.supplier_name + '<br>' +
          '<strong>Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ©:</strong> ' + supplier.purchase_price + ' ILS' +
        '</div>';
    }
    
    function loadAvailableSuppliers() {
      console.log('ğŸ”„ [loadAvailableSuppliers] Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†...');
      var select = document.getElementById('newSupplierSelect');
      
      fetch('/warehouses/api/suppliers/list', {
        headers: {'X-Requested-With': 'XMLHttpRequest'},
        credentials: 'same-origin'
      })
      .then(r => {
        console.log('ğŸ“¥ [loadAvailableSuppliers] Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø¯ØŒ Ø§Ù„Ø­Ø§Ù„Ø©:', r.status);
        if (!r.ok) {
          throw new Error('HTTP ' + r.status);
        }
        return r.json();
      })
      .then(data => {
        console.log('ğŸ“¦ [loadAvailableSuppliers] Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', data);
        if (data.success && data.suppliers) {
          if (select) {
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…ÙˆØ±Ø¯...</option>';
            data.suppliers.forEach(function(s) {
              var option = document.createElement('option');
              option.value = s.id;
              option.textContent = s.name;
              select.appendChild(option);
            });
            console.log('âœ… [loadAvailableSuppliers] ØªÙ… ØªØ­Ù…ÙŠÙ„ ' + data.suppliers.length + ' Ù…ÙˆØ±Ø¯');
          }
        } else {
          if (select) select.innerHTML = '<option value="">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ±Ø¯ÙŠÙ†</option>';
          console.warn('âš ï¸ [loadAvailableSuppliers] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
        }
      })
      .catch(err => {
        console.error('âŒ [loadAvailableSuppliers] Ø®Ø·Ø£:', err);
        if (select) select.innerHTML = '<option value="">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</option>';
        notify('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†: ' + err.message, 'danger');
      });
    }
    
    function updateSupplier() {
      var supplierId = document.getElementById('newSupplierSelect').value;
      var purchasePrice = document.getElementById('newSupplierPrice').value;
      
      if (!supplierId && !purchasePrice) {
        notify('ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆØ±Ø¯ Ø£Ùˆ Ø³Ø¹Ø± ØªÙƒÙ„ÙØ©', 'warning');
        return;
      }
      
      var payload = {};
      if (supplierId) payload.supplier_id = supplierId;
      if (purchasePrice) payload.purchase_price = parseFloat(purchasePrice);
      
      fetch('/warehouses/api/products/' + currentProductId + '/suppliers', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-Requested-With': 'XMLHttpRequest',
          'X-CSRFToken': csrfToken() || ''
        },
        credentials: 'same-origin',
        body: JSON.stringify(payload)
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          notify('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
          document.getElementById('newSupplierSelect').value = '';
          document.getElementById('newSupplierPrice').value = '';
          loadSuppliers(currentProductId);
          loadProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        } else {
          notify(data.message || 'ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'danger');
        }
      })
      .catch(err => {
        console.error('Error updating supplier:', err);
        notify('ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'danger');
      });
    }
    
    // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªÙ… Ù†Ù‚Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ loadAvailablePartners Ùˆ loadAvailableSuppliers
    // Ø¥Ù„Ù‰ Ø¯ÙˆØ§Ù„ openPartnersModal Ùˆ openSuppliersModal Ù…Ø¨Ø§Ø´Ø±Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡
  </script>
  
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ -->
  <div class="modal fade" id="partnersModal" tabindex="-1" aria-labelledby="partnersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="partnersModalLabel">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
        </div>
        <div class="modal-body">
          <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ† -->
          <h6 class="mb-3"><i class="fas fa-list me-2"></i>Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠÙŠÙ†</h6>
          <div class="table-responsive mb-4">
            <table class="table table-bordered table-sm">
              <thead class="table-light">
                <tr>
                  <th>Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
                  <th class="text-center">Ø§Ù„Ù†Ø³Ø¨Ø© (%)</th>
                  <th class="text-center" style="width: 120px;">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="partnersListBody">
                <tr><td colspan="3" class="text-center"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</td></tr>
              </tbody>
            </table>
          </div>
          
          <hr>
          
          <!-- Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠÙƒ Ø¬Ø¯ÙŠØ¯ -->
          <h6 class="mb-3"><i class="fas fa-plus me-2"></i>Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠÙƒ Ø¬Ø¯ÙŠØ¯</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="newPartnerSelect" class="form-label">Ø§Ù„Ø´Ø±ÙŠÙƒ</label>
              <select id="newPartnerSelect" class="form-select">
                <option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>
              </select>
              <small class="text-muted">
                <a href="/vendors/partners/new" target="_blank"><i class="fas fa-external-link-alt me-1"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙŠÙƒ Ø¬Ø¯ÙŠØ¯</a>
              </small>
            </div>
            <div class="col-md-4">
              <label for="newPartnerShare" class="form-label">Ø§Ù„Ù†Ø³Ø¨Ø© (%)</label>
              <input type="number" step="0.01" min="0" max="100" id="newPartnerShare" class="form-control" placeholder="0.00">
            </div>
            <div class="col-md-2 d-flex align-items-end">
              <button class="btn btn-primary w-100" onclick="addNewPartner()">
                <i class="fas fa-plus me-1"></i>Ø¥Ø¶Ø§ÙØ©
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
  <div class="modal fade" id="suppliersModal" tabindex="-1" aria-labelledby="suppliersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title" id="suppliersModalLabel">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
        </div>
        <div class="modal-body">
          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ -->
          <h6 class="mb-3"><i class="fas fa-info-circle me-2"></i>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</h6>
          <div id="suppliersInfo" class="mb-4">
            <p class="text-center text-muted"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
          </div>
          
          <hr>
          
          <!-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ±Ø¯ -->
          <h6 class="mb-3"><i class="fas fa-edit me-2"></i>ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ±Ø¯</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label for="newSupplierSelect" class="form-label">Ø§Ù„Ù…ÙˆØ±Ø¯</label>
              <select id="newSupplierSelect" class="form-select">
                <option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option>
              </select>
              <small class="text-muted">
                <a href="/vendors/suppliers/new" target="_blank"><i class="fas fa-external-link-alt me-1"></i>Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</a>
              </small>
            </div>
            <div class="col-md-4">
              <label for="newSupplierPrice" class="form-label">Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙØ© (ILS)</label>
              <input type="number" step="0.01" min="0" id="newSupplierPrice" class="form-control" placeholder="0.00">
            </div>
            <div class="col-md-2 d-flex align-items-end">
              <button class="btn btn-info w-100" onclick="updateSupplier()">
                <i class="fas fa-save me-1"></i>ØªØ­Ø¯ÙŠØ«
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
