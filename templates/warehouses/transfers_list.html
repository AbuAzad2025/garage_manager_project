{% extends 'warehouses/base.html' %}
{% block title %}الحجوزات المسبقة{% endblock %}
{% block page_title %}الحجوزات المسبقة{% endblock %}

{% block content %}
<div class="mb-2 text-end">
  <a href="{{ url_for('warehouse_bp.preorder_create') }}" class="btn btn-primary">إنشاء حجز</a>
</div>

<table class="table table-striped" id="preorders-table">
  <thead>
    <tr>
      <th>الكود</th>
      <th>الجهة</th>
      <th>الصنف</th>
      <th>المستودع</th>
      <th>الكمية</th>
      <th>العربون</th>
      <th>الحالة</th>
      <th>تاريخ</th>
    </tr>
  </thead>
  <tbody>
    {% for p in preorders %}
    <tr>
      <td>
        <a href="{{ url_for('warehouse_bp.preorder_detail', preorder_id=p.id) }}">
          {{ p.reference or ('PR-' ~ p.id) }}
        </a>
      </td>
      <td>
        {% if p.customer %}عميل: {{ p.customer.name }}
        {% elif p.supplier %}مورد: {{ p.supplier.name }}
        {% elif p.partner %}شريك: {{ p.partner.name }}
        {% else %}غير محدد{% endif %}
      </td>
      <td>{{ p.product.name if p.product else '—' }}</td>
      <td>{{ p.warehouse.name if p.warehouse else '—' }}</td>
      <td>{{ p.quantity or 0 }}</td>
      <td>{{ '%.2f'|format(p.prepaid_amount or 0) }}</td>
      <td>{{ p.status }}</td>
      <td>{{ p.created_at.strftime('%Y-%m-%d') if p.created_at else '' }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    $(function(){ $('#preorders-table').DataTable({pageLength:25, language:{url:'//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json'}}); });
  </script>
{% endblock %}
