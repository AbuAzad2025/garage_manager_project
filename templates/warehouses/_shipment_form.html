{# File: templates/warehouses/_shipment_form.html #}
<div class="modal-header">
  <h5 class="modal-title">{{ 'تعديل' if action=='edit' else 'إنشاء' }} شحنة</h5>
  <button type="button" class="close" data-dismiss="modal">&times;</button>
</div>
<form id="shipmentForm" method="post" novalidate>
  {{ form.hidden_tag() }}
  <div class="modal-body">

    <!-- معلومات أساسية -->
    <div class="form-row">
      {% for f in [form.origin, form.destination, form.carrier, form.tracking_number] %}
        <div class="form-group col-md-6">
          {{ f.label(class="control-label") }}
          {{ f(class="form-control") }}
          {% if f.errors %}<small class="text-danger">{{ f.errors[0] }}</small>{% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- التواريخ والحالة -->
    <div class="form-row">
      {% for f in [form.shipment_date, form.expected_arrival, form.actual_arrival] %}
        <div class="form-group col-md-4">
          {{ f.label(class="control-label") }}
          {{ f(class="form-control datepicker") }}
          {% if f.errors %}<small class="text-danger">{{ f.errors[0] }}</small>{% endif %}
        </div>
      {% endfor %}
      <div class="form-group col-md-4">
        {{ form.status.label(class="control-label") }}
        {{ form.status(class="form-control") }}
        {% if form.status.errors %}<small class="text-danger">{{ form.status.errors[0] }}</small>{% endif %}
      </div>
    </div>

    <hr>
    <h6>الشركاء</h6>
    <div id="partnersContainer">
      {% for e in form.partner_links.entries %}
        <div class="form-row partner-entry mb-2">
          <div class="form-group col-md-5">
            {{ e.partner_id(class="form-control") }}
            {% if e.partner_id.errors %}<small class="text-danger">{{ e.partner_id.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-3">
            {{ e.share_percentage(class="form-control", placeholder="٪") }}
            {% if e.share_percentage.errors %}<small class="text-danger">{{ e.share_percentage.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-3">
            {{ e.share_amount(class="form-control", placeholder="المبلغ") }}
            {% if e.share_amount.errors %}<small class="text-danger">{{ e.share_amount.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-1">
            <button type="button" class="btn btn-danger remove-partner">&times;</button>
          </div>
        </div>
      {% endfor %}
    </div>
    <button id="addPartner" type="button" class="btn btn-outline-secondary btn-sm mb-3">
      + إضافة شريك
    </button>

    <hr>
    <h6>العناصر</h6>
    <div id="itemsContainer">
      {% for e in form.items.entries %}
        <div class="form-row item-entry mb-2">
          <div class="form-group col-md-4">
            {{ e.product_id(class="form-control") }}
            {% if e.product_id.errors %}<small class="text-danger">{{ e.product_id.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-3">
            {{ e.warehouse_id(class="form-control") }}
            {% if e.warehouse_id.errors %}<small class="text-danger">{{ e.warehouse_id.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-2">
            {{ e.quantity(class="form-control") }}
            {% if e.quantity.errors %}<small class="text-danger">{{ e.quantity.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-2">
            {{ e.unit_cost(class="form-control") }}
            {% if e.unit_cost.errors %}<small class="text-danger">{{ e.unit_cost.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-1">
            {{ e.declared_value(class="form-control") }}
            {% if e.declared_value.errors %}<small class="text-danger">{{ e.declared_value.errors[0] }}</small>{% endif %}
          </div>
          <div class="form-group col-md-1">
            <button type="button" class="btn btn-danger remove-item">&times;</button>
          </div>
        </div>
      {% endfor %}
    </div>
    <button id="addItem" type="button" class="btn btn-outline-secondary btn-sm">
      + إضافة عنصر
    </button>

    <hr>
    <div class="form-row">
      {% for f in [form.value_before, form.shipping_cost, form.customs, form.vat, form.insurance, form.total_value] %}
        <div class="form-group col-md-4">
          {{ f.label(class="control-label") }}
          {{ f(class="form-control") }}
          {% if f.errors %}<small class="text-danger">{{ f.errors[0] }}</small>{% endif %}
        </div>
      {% endfor %}
    </div>

    <div class="form-group">
      {{ form.notes.label(class="control-label") }}
      {{ form.notes(class="form-control", rows=3) }}
      {% if form.notes.errors %}<small class="text-danger">{{ form.notes.errors[0] }}</small>{% endif %}
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">إغلاق</button>
    <button type="submit" class="btn btn-primary">حفظ</button>
  </div>
</form>
