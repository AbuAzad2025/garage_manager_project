{% extends "base.html" %}
{% block title %}Ø¥ÙŠØµØ§Ù„ ØµÙŠØ§Ù†Ø©{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/service.css') }}">

<div class="container my-4">
  <h3 class="text-center mb-4">Ø³Ù†Ø¯ Ù‚Ø¨Ø¶ / Ø·Ù„Ø¨ ØµÙŠØ§Ù†Ø© Ø±Ù‚Ù… {{ service.id }}</h3>

  <div class="row">
    <div class="col-md-6">
      <table class="table table-sm">
        <tr>
          <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <td>{{ service.name or (service.customer.name if service.customer else 'â€”') }}</td>
        </tr>
        <tr>
          <th>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</th>
          <td>{{ service.phone or (service.customer.phone if service.customer else 'â€”') }}</td>
        </tr>
        <tr>
          <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
          <td>{{ service.email or (service.customer.email if service.customer else 'â€”') }}</td>
        </tr>
        <tr><th>Ø§Ù„Ù…Ø¹Ø¯Ø©</th><td>{{ service.vehicle_type }} â€“ {{ service.vehicle_model }}</td></tr>
        <tr><th>Ø§Ù„Ù„ÙˆØ­Ø©</th><td>{{ service.vehicle_vrn }}</td></tr>
        <tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><td>{{ service.status_label }}</td></tr>
      </table>
    </div>
    <div class="col-md-6">
      <strong>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
      <div class="border p-2 mb-2">{{ service.problem_description }}</div>
      <strong>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³:</strong>
      <div class="border p-2 mb-2">{{ service.engineer_notes }}</div>
    </div>
  </div>

  <hr>

  <!-- ØªÙØ§ØµÙŠÙ„ -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>Ø§Ù„ÙˆØµÙ</th>
        <th>Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
        <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        <th>ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
      </tr>
    </thead>
    <tbody>
      {% for part in service.parts %}
      <tr>
        <td>Ù‚Ø·Ø¹Ø©</td>
        <td>{{ part.part.name }}</td>
        <td>{{ part.partner.name if part.partner else 'â€”' }}</td>
        <td>{{ part.share_percentage|default(0) }}%</td>
        <td>{{ part.quantity }}</td>
        <td>{{ '%.2f'|format(part.unit_price or 0) }}</td>
        <td>{{ '%.2f'|format(part.line_total or 0) }}</td>
        <td>{{ '%.2f'|format(part.line_total * (1 - (part.share_percentage or 0)/100)) }}</td>
      </tr>
      {% endfor %}
      {% for task in service.tasks %}
      <tr>
        <td>Ù…Ù‡Ù…Ø©</td>
        <td>{{ task.description }}</td>
        <td>â€”</td>
        <td>â€”</td>
        <td>{{ task.quantity }}</td>
        <td>{{ '%.2f'|format(task.unit_price or 0) }}</td>
        <td>{{ '%.2f'|format(task.line_total or 0) }}</td>
        <td>{{ '%.2f'|format(task.line_total or 0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª -->
  <div class="d-flex justify-content-end flex-column align-items-end">
    <div class="me-4"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚Ø¨Ù„ Ø®ØµÙ… Ø§Ù„Ø´Ø±ÙŠÙƒ:</strong> {{ '%.2f'|format(subtotal or 0) }} â‚ª</div>
    <div class="me-4 text-primary"><strong>Ø§Ù„ØµØ§ÙÙŠ Ø¨Ø¹Ø¯ Ø®ØµÙ… Ø§Ù„Ø´Ø±ÙŠÙƒ:</strong> {{ '%.2f'|format(net_subtotal or 0) }} â‚ª</div>
    <div class="me-4"><strong>Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</strong> {{ '%.2f'|format(tax_amount or 0) }} â‚ª</div>
    <div class="fs-5"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong> <span class="text-success">{{ '%.2f'|format(total_amount or 0) }} â‚ª</span></div>
  </div>

  <div class="text-center mt-4 actions">
    <button class="btn btn-dark" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</button>
  </div>
</div>
{% endblock %}
