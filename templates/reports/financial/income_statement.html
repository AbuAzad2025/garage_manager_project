{% extends 'base.html' %}

{% block title %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-gradient-primary text-white">
            <h3 class="mb-0">
                <i class="fas fa-chart-line"></i>
                Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ (Income Statement / P&L)
            </h3>
            <p class="mb-0 small">Ù…Ù† {{ from_date.strftime('%Y-%m-%d') }} Ø¥Ù„Ù‰ {{ to_date.strftime('%Y-%m-%d') }}</p>
        </div>
        
        <div class="card-body">
            

            <div class="row mb-4">
                <div class="col-md-4">
                    <label>Ù…Ù† ØªØ§Ø±ÙŠØ®:</label>
                    <input type="date" id="from_date" class="form-control" value="{{ from_date.strftime('%Y-%m-%d') }}">
                </div>
                <div class="col-md-4">
                    <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®:</label>
                    <input type="date" id="to_date" class="form-control" value="{{ to_date.strftime('%Y-%m-%d') }}">
                </div>
                <div class="col-md-4">
                    <label>&nbsp;</label>
                    <button class="btn btn-primary d-block w-100" onclick="updateReport()">
                        <i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ«
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-bordered">
                        

                        <thead class="table-success">
                            <tr>
                                <th colspan="2"><h5 class="mb-0">ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h5></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for rev in revenues %}
                            <tr>
                                <td>{{ rev.name }} <small class="text-muted">({{ rev.account }})</small></td>
                                <td class="text-end fw-bold">{{ "{:,.2f}".format(rev.amount) }} â‚ª</td>
                            </tr>
                            {% endfor %}
                            {% if not revenues %}
                            <tr>
                                <td colspan="2" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</td>
                            </tr>
                            {% endif %}
                        </tbody>
                        <tfoot class="table-success fw-bold">
                            <tr>
                                <td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</td>
                                <td class="text-end">{{ "{:,.2f}".format(total_revenue) }} â‚ª</td>
                            </tr>
                        </tfoot>
                        
                        

                        <thead class="table-danger mt-3">
                            <tr>
                                <th colspan="2"><h5 class="mb-0">ğŸ“‰ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h5></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for exp in expenses %}
                            <tr>
                                <td>{{ exp.name }} <small class="text-muted">({{ exp.account }})</small></td>
                                <td class="text-end fw-bold">{{ "{:,.2f}".format(exp.amount) }} â‚ª</td>
                            </tr>
                            {% endfor %}
                            {% if not expenses %}
                            <tr>
                                <td colspan="2" class="text-center text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</td>
                            </tr>
                            {% endif %}
                        </tbody>
                        <tfoot class="table-danger fw-bold">
                            <tr>
                                <td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</td>
                                <td class="text-end">{{ "{:,.2f}".format(operating_expenses) }} â‚ª</td>
                            </tr>
                        </tfoot>
                        
                        

                        <tfoot class="{% if is_profit %}table-primary{% else %}table-warning{% endif %} fw-bold fs-5">
                            <tr>
                                <td>
                                    {% if is_profit %}
                                    ğŸ‰ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­
                                    {% else %}
                                    âš ï¸ ØµØ§ÙÙŠ Ø§Ù„Ø®Ø³Ø§Ø±Ø©
                                    {% endif %}
                                </td>
                                <td class="text-end {% if is_profit %}text-success{% else %}text-danger{% endif %}">
                                    {{ "{:,.2f}".format(net_profit|abs) }} â‚ª
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                    
                    

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <button class="btn btn-outline-success w-100" onclick="exportToExcel()">
                                <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                            </button>
                        </div>
                        <div class="col-md-6">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
</style>

<script>
function updateReport() {
    const fromDate = document.getElementById('from_date').value;
    const toDate = document.getElementById('to_date').value;
    window.location.href = `/reports/financial/income-statement?start_date=${fromDate}&end_date=${toDate}`;
}

function exportToExcel() {
    alert('Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØµØ¯ÙŠØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹');
}
</script>
{% endblock %}
