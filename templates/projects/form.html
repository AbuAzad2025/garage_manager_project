{% extends 'base.html' %}
{% block title %}{% if project %}تعديل{% else %}إضافة{% endif %} مشروع{% endblock %}

{% block content %}
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">
                    <i class="fas fa-tasks text-primary"></i> 
                    {% if project %}تعديل مشروع{% else %}إضافة مشروع جديد{% endif %}
                </h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-left">
                    <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}"><i class="fas fa-home"></i> الرئيسية</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('advanced.accounting_control') }}"><i class="fas fa-sliders-h"></i> المحاسبة المتقدمة</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('projects.index') }}">المشاريع</a></li>
                    <li class="breadcrumb-item active">{% if project %}تعديل{% else %}إضافة{% endif %}</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<section class="content">
<div class="container-fluid">
  
  <div class="row mb-3 no-print">
    <div class="col-12">
      <a href="{{ url_for('projects.index') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> العودة للمشاريع
      </a>
    </div>
  </div>

  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="form-label">رمز المشروع *</label>
            <input type="text" name="code" class="form-control" required placeholder="مثال: PRJ-001" 
                   {% if project %}value="{{ project.code }}" readonly{% endif %}>
            <small class="text-muted">رمز فريد للمشروع</small>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">اسم المشروع *</label>
            <input type="text" name="name" class="form-control" required
                   {% if project %}value="{{ project.name }}"{% endif %}>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">العميل</label>
            <select name="customer_id" class="custom-select">
              <option value="">بدون</option>
              {% for customer in customers %}
              <option value="{{ customer.id }}" {% if project and project.client_id == customer.id %}selected{% endif %}>
                {{ customer.name }}
              </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">مركز التكلفة</label>
            <select name="cost_center_id" class="custom-select">
              <option value="">بدون</option>
              {% for cc in cost_centers %}
              <option value="{{ cc.id }}" {% if project and project.cost_center_id == cc.id %}selected{% endif %}>
                {{ cc.name }} ({{ cc.code }})
              </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">تاريخ البدء *</label>
            <input type="date" name="start_date" class="form-control" required
                   {% if project %}value="{{ project.start_date.strftime('%Y-%m-%d') }}"{% endif %}>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">تاريخ الانتهاء المتوقع</label>
            <input type="date" name="end_date" class="form-control"
                   {% if project and project.end_date %}value="{{ project.end_date.strftime('%Y-%m-%d') }}"{% endif %}>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">الميزانية (₪) *</label>
            <input type="number" name="estimated_cost" class="form-control" step="0.01" min="0" required
                   value="{% if project %}{{ project.budget_amount }}{% else %}0{% endif %}">
            <small class="text-muted">الميزانية المخططة للمشروع</small>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">الإيراد المتوقع (₪)</label>
            <input type="number" name="estimated_revenue" class="form-control" step="0.01" min="0"
                   value="{% if project %}{{ project.estimated_revenue }}{% else %}0{% endif %}">
            <small class="text-muted">الإيراد المتوقع من المشروع</small>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">مدير المشروع *</label>
            <select name="manager_id" class="custom-select" required>
              <option value="">اختر المدير</option>
              {% for user in users %}
              <option value="{{ user.id }}" {% if project and project.manager_id == user.id %}selected{% endif %}>
                {{ user.username }}
              </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="col-md-6 mb-3">
            <label class="form-label">الفرع</label>
            <select name="branch_id" class="custom-select">
              <option value="">عام</option>
              {% for branch in branches %}
              <option value="{{ branch.id }}" {% if project and project.branch_id == branch.id %}selected{% endif %}>
                {{ branch.name }}
              </option>
              {% endfor %}
            </select>
          </div>
          
          <div class="col-md-12 mb-3">
            <label class="form-label">الوصف</label>
            <textarea name="description" class="form-control" rows="3"></textarea>
          </div>
          
          <div class="col-md-12 mb-3">
            <label class="form-label">ملاحظات</label>
            <textarea name="notes" class="form-control" rows="2"></textarea>
          </div>
        </div>
        
        <div class="text-end">
          <a href="{{ url_for('projects.index') }}" class="btn btn-secondary">
            <i class="fas fa-times"></i> إلغاء
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> حفظ
          </button>
        </div>
      </form>
    </div>
  </div>

</div>
</section>
{% endblock %}

