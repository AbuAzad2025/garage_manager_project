{% extends "base.html" %}

{% block title %}Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª{% endblock %}

{% block extra_head %}
<style>
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø´Ø§Ù…Ù„Ø© */
.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    font-size: 2.5rem;
    opacity: 0.8;
}

.card-modern {
    border: none;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.card-modern:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.card-header-modern {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px 15px 0 0 !important;
    border: none;
    padding: 20px;
}

.card-header-modern h3 {
    margin: 0;
    font-weight: 600;
}

.btn-modern {
    border-radius: 10px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
}

.btn-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.form-control-modern {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 12px 16px;
    transition: all 0.3s ease;
}

.form-control-modern:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.warehouse-type-badge {
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: 600;
}

.partner-fields, .supplier-fields {
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    padding: 15px;
    margin-top: 10px;
}

.stock-info {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
}

.warning-info {
    background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
}

.alert-modern {
    border: none;
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
}

.product-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin: 10px 0;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    border-left: 5px solid #667eea;
}

.barcode-preview {
    text-align: center;
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
.table-modern {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.table-modern th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    font-weight: 600;
    padding: 15px;
}

.table-modern td {
    padding: 12px 15px;
    border-color: #f1f3f4;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-primary-modern {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
}

.btn-success-modern {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    border: none;
    color: white;
}

.btn-warning-modern {
    background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);
    border: none;
    color: white;
}

.btn-danger-modern {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    border: none;
    color: white;
}

.btn-info-modern {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    border: none;
    color: white;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ loading */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ notifications */
.notification-success {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    border: none;
}

.notification-error {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    border: none;
}

.notification-warning {
    background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    border: none;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ responsive */
@media (max-width: 768px) {
    .stat-card {
        margin-bottom: 15px;
    }
    
    .card-modern {
        margin-bottom: 20px;
    }
    
    .btn-modern {
        width: 100%;
        margin: 5px 0;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ animations */
.fade-in {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.slide-in {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ focus states */
.form-control-modern:focus,
.select2-container--default .select2-selection--single:focus,
.select2-container--default .select2-selection--multiple:focus {
    outline: none;
    border-color: #667eea !important;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ select2 */
.select2-container--default .select2-selection--single,
.select2-container--default .select2-selection--multiple {
    border: 2px solid #e9ecef !important;
    border-radius: 10px !important;
    padding: 8px 12px !important;
    min-height: 45px !important;
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    line-height: 30px !important;
    padding-left: 0 !important;
}

.select2-container--default .solid .select2-selection--single .select2-selection__arrow {
    height: 30px !important;
    right: 8px !important;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ */
.bulk-scan-container {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
    padding: 20px 0;
}

.scan-step {
    background: white;
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.scan-step:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.step-number {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    margin-bottom: 20px;
}

.upload-area {
    border: 3px dashed #dee2e6;
    border-radius: 15px;
    padding: 40px;
    text-align: center;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

.upload-area:hover {
    border-color: #667eea;
    background: #f0f2f5;
}

.upload-area.dragover {
    border-color: #667eea;
    background: #e3f2fd;
    transform: scale(1.02);
}

.product-item {
    background: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
}

.product-item:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
}

.product-item.selected {
    border-left-color: #28a745;
    background: #f8fff9;
}

.progress-modern {
    height: 8px;
    border-radius: 10px;
    background: #e9ecef;
    overflow: hidden;
}

.progress-bar-modern {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    height: 100%;
    transition: width 0.3s ease;
    border-radius: 10px;
}

/* ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© */
.form-group.required label {
    color: #dc3545 !important;
    font-weight: bold !important;
}

.form-group.optional label {
    color: #28a745 !important;
    font-weight: bold !important;
}

.form-group.disabled {
    opacity: 0.6 !important;
}

/* ØªØ­Ø³ÙŠÙ† Modal */
.modal-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    border-bottom: none !important;
}

.modal-title {
    color: white !important;
}

.modal-body {
    background-color: #f8f9fa !important;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
.table {
    background-color: white !important;
    border-radius: 8px !important;
    overflow: hidden !important;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
}

.table thead th {
    background-color: #f8f9fa !important;
    color: #495057 !important;
    font-weight: 600 !important;
    border-bottom: 2px solid #dee2e6 !important;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
.card-body h3 {
    color: #495057 !important;
    font-weight: bold !important;
}

.card-body p {
    color: #6c757d !important;
}
</style>
{% endblock %}

{% block content %}
    <!-- Content Header -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('barcode_scanner.index') }}">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</a></li>
                        <li class="breadcrumb-item active">Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù…Ø­Ø³Ù†Ø© -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="scanned-count">0</h2>
                                <p class="mb-0" style="opacity: 0.9;">Ù…Ù†ØªØ¬Ø§Øª Ù…Ù…Ø³ÙˆØ­Ø©</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-barcode"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in" style="background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="new-products">0</h2>
                                <p class="mb-0" style="opacity: 0.9;">Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in" style="background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="updated-products">0</h2>
                                <p class="mb-0" style="opacity: 0.9;">Ù…Ù†ØªØ¬Ø§Øª Ù…Ø­Ø¯Ø«Ø©</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-edit"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in" style="background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="errors-count">0</h2>
                                <p class="mb-0" style="opacity: 0.9;">Ø£Ø®Ø·Ø§Ø¡</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø­ -->
                <div class="col-lg-4 col-md-12 mb-4">
                    <div class="card card-modern">
                        <div class="card-header-modern">
                            <h3>
                                <i class="fas fa-cog ml-2"></i>
                                Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³Ø­
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <!-- ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ -->
                            <div class="alert alert-success mb-4" style="border-right: 4px solid #56ab2f;">
                                <h6 class="mb-2"><i class="fas fa-lightbulb ml-2"></i><strong>ğŸ’¡ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© (Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ©):</strong></h6>
                                <p class="mb-2" style="font-size: 0.9rem;">
                                    Ø§Ø³ØªØ®Ø¯Ù… <a href="{{ url_for('barcode_scanner.index') }}" target="_blank" class="text-white"><strong>ØµÙØ­Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</strong></a> Ù„Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ© Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø³Ø±Ø¹Ø©
                                </p>
                            </div>
                            <div class="alert alert-info mb-4" style="border-right: 4px solid #4facfe;">
                                <h6 class="mb-2"><i class="fas fa-info-circle ml-2"></i><strong>Ø¹Ù† Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ (Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©):</strong></h6>
                                <ul class="mb-0" style="font-size: 0.9rem; line-height: 1.8;">
                                    <li>Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø© (Ø§Ø³Ù…ØŒ Ù…Ø§Ø±ÙƒØ©ØŒ Ø³Ø¹Ø±ØŒ Ø¥Ù„Ø®)</li>
                                    <li>Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±</li>
                                    <li><strong>Ù…Ø³ØªÙˆØ¯Ø¹ Ø´Ø±ÙŠÙƒ:</strong> ÙŠØªØ·Ù„Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´Ø±ÙŠÙƒ ÙˆÙ†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©</li>
                                    <li><strong>Ù…Ø³ØªÙˆØ¯Ø¹ ØªØ¨Ø§Ø¯Ù„:</strong> ÙŠØªØ·Ù„Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ù…Ø­Ù„ÙŠ</li>
                                </ul>
                            </div>
                            
                            <div class="form-group mb-4">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-warehouse ml-1 text-primary"></i>
                                    Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:
                                </label>
                                <select class="form-control form-control-modern" id="warehouse-select" onchange="loadWarehouseFields()">
                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹...</option>
                                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                                </select>
                                <small class="form-text text-muted mt-2">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø±
                                </small>
                            </div>
                            
                            <div id="warehouse-info" class="alert-modern notification-success" style="display: none;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-info-circle fa-2x ml-3"></i>
                                    <div>
                                        <h6 class="mb-1">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</h6>
                                        <p class="mb-0" id="warehouse-type-info"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø­Ù‚ÙˆÙ„ Ø®Ø§ØµØ© Ø¨Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ -->
                            <div id="partner-fields" class="partner-fields" style="display: none;">
                                <h6 class="mb-3">
                                    <i class="fas fa-handshake ml-2"></i>
                                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ
                                </h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">
                                                Ø§Ù„Ø´Ø±ÙŠÙƒ <span class="text-danger">*</span>:
                                            </label>
                                            <select class="form-control form-control-modern" id="partner-select" onchange="updatePartnerInfo()">
                                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙŠÙƒ...</option>
                                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                                            </select>
                                            <small class="form-text text-muted mt-2">
                                                <i class="fas fa-info-circle ml-1"></i>
                                                Ø³ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±ÙŠÙƒ
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">
                                                Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©:
                                            </label>
                                            <div class="input-group">
                                                <input type="number" class="form-control form-control-modern" id="partner-share" 
                                                       value="0" min="0" max="100" step="0.01" readonly 
                                                       style="background-color: #f8f9fa;">
                                                <div class="input-group-append">
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </div>
                                            <small class="form-text text-muted mt-2">
                                                <i class="fas fa-percentage ml-1"></i>
                                                Ù†Ø³Ø¨Ø© Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ø´Ø±ÙŠÙƒ -->
                                <div id="partner-info-display" class="alert alert-info mt-3" style="display: none;">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-info-circle fa-2x ml-3"></i>
                                        <div id="partner-details"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø­Ù‚ÙˆÙ„ Ø®Ø§ØµØ© Ø¨Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ -->
                            <div id="supplier-fields" class="supplier-fields" style="display: none;">
                                <h6 class="mb-3">
                                    <i class="fas fa-truck ml-2"></i>
                                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„ØªØ§Ø¬Ø±
                                </h6>
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„ØªØ§Ø¬Ø± <span class="text-danger">*</span>:
                                    </label>
                                    <select class="form-control form-control-modern" id="supplier-select">
                                        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯...</option>
                                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                                    </select>
                                    <small class="form-text text-muted mt-2">
                                        <i class="fas fa-info-circle ml-1"></i>
                                        Ø³ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ±Ø¯
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Ø­Ù‚ÙˆÙ„ Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
                            <div id="online-fields" class="card mb-3" style="display: none; border: 2px solid #28a745; background-color: #f1f9f4;">
                                <div class="card-header" style="background-color: #28a745; color: white;">
                                    <i class="fas fa-shopping-cart"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                                </div>
                                <div class="card-body">
                                    <div class="form-group">
                                        <label style="color: #343a40 !important; font-weight: bold;">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                        <input type="text" class="form-control" id="default-online-name" placeholder="Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±">
                                    </div>
                                    <div class="form-group">
                                        <label style="color: #343a40 !important; font-weight: bold;">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                        <input type="number" class="form-control" id="default-online-price" placeholder="0.00" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label style="color: #343a40 !important;">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©:</label>
                                        <input type="text" class="form-control" id="default-online-image" placeholder="https://...">
                                    </div>
                                </div>
                            </div>
                            
                            <hr class="my-4">
                            <h6 class="mb-3">
                                <i class="fas fa-cog ml-2"></i>
                                Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
                            </h6>
                            
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-dollar-sign ml-1 text-success"></i>
                                    Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:
                                </label>
                                <input type="number" class="form-control form-control-modern" id="default-price" value="0" step="0.01">
                                <small class="form-text text-muted mt-1">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¹Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                                </small>
                            </div>
                            
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-calculator ml-1 text-success"></i>
                                    Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:
                                </label>
                                <input type="number" class="form-control form-control-modern" id="default-quantity" value="1" min="1">
                                <small class="form-text text-muted mt-1">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    Ø³ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ…ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                                </small>
                            </div>
                            
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-tag ml-1 text-success"></i>
                                    Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:
                                </label>
                                <input type="text" class="form-control form-control-modern" id="default-brand" placeholder="Ù…Ø«Ø§Ù„: Toyota">
                            </div>
                            
                            <div class="form-group mb-3">
                                <label class="form-label fw-bold">
                                    <i class="fas fa-hashtag ml-1 text-success"></i>
                                    Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:
                                </label>
                                <input type="text" class="form-control form-control-modern" id="default-part-number" placeholder="Ù…Ø«Ø§Ù„: 12345">
                            </div>
                            
                            <div class="form-group">
                                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:</label>
                                <input type="text" class="form-control" id="default-commercial-name" placeholder="Ù…Ø«Ø§Ù„: ÙÙ„ØªØ± Ø²ÙŠØª">
                            </div>
                            
                            <div class="form-group">
                                <label>Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ:</label>
                                <input type="text" class="form-control" id="default-origin" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙŠØ§Ø¨Ø§Ù†">
                            </div>
                            
                            <div class="form-group">
                                <label>Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:</label>
                                <input type="text" class="form-control" id="default-unit" placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø·Ø¹Ø©">
                            </div>
                            
                            <div class="form-group">
                                <label>Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (Ø´Ù‡ÙˆØ±):</label>
                                <input type="number" class="form-control" id="default-warranty" placeholder="12" value="12">
                            </div>
                            
                            <div class="form-group">
                                <label>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³Ø­:</label>
                                <select class="form-control" id="scan-mode">
                                    <option value="add">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·</option>
                                    <option value="update">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©</option>
                                    <option value="both" selected>Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø¯ÙŠØ«</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:</label>
                                <select class="form-control" id="existing-product-action">
                                    <option value="add_quantity" selected>Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ© (ØªØ±Ø§ÙƒÙ…ÙŠ)</option>
                                    <option value="replace_quantity">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©</option>
                                    <option value="update_info_only">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙ‚Ø· (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©)</option>
                                </select>
                                <small class="form-text" style="color: #6c757d !important; background-color: #f8f9fa; padding: 8px; border-radius: 4px; border-left: 3px solid #007bff;">
                                    <strong style="color: #007bff !important;">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ©:</strong> <span style="color: #495057 !important;">Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©</span><br>
                                    <strong style="color: #007bff !important;">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©:</strong> <span style="color: #495057 !important;">Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</span><br>
                                    <strong style="color: #007bff !important;">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª:</strong> <span style="color: #495057 !important;">Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©</span>
                                </small>
                            </div>
                            
                            <button class="btn btn-primary btn-block" id="start-scan-btn">
                                <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­
                            </button>
                            
                            <button class="btn btn-success btn-block mt-2" id="save-all-btn" disabled>
                                <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„ÙƒÙ„
                            </button>
                            
                            <button class="btn btn-warning btn-block mt-2" id="clear-all-btn">
                                <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø³Ø­ -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-barcode"></i> Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø³Ø­
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù‡Ù†Ø§:</label>
                                <input type="text" class="form-control form-control-lg" id="barcode-input" 
                                       placeholder="Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø§ÙƒØªØ¨Ù‡ Ù‡Ù†Ø§..." autofocus>
                                <small class="form-text text-muted">
                                    Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙˆØ³ØªØ¸Ù‡Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                                </small>
                            </div>
                            
                            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…Ø³ÙˆØ­Ø© -->
                            <div class="table-responsive">
                                <table class="table table-striped" id="scanned-products-table">
                                    <thead>
                                        <tr>
                                            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</th>
                                            <th>Ø§Ù„Ù…Ø§Ø±ÙƒØ©</th>
                                            <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</th>
                                            <th>Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£</th>
                                            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                                            <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                            <th>Ø§Ù„Ø¶Ù…Ø§Ù†</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="scanned-products-body">
                                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="no-products-message" class="text-center text-muted py-4" style="display: none;">
                                <i class="fas fa-barcode fa-3x mb-3"></i>
                                <p>Ù„Ù… ÙŠØªÙ… Ù…Ø³Ø­ Ø£ÙŠ Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯</p>
                                <p>Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù„Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
let scannedProducts = [];
let isScanning = false;

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('barcode-input').focus();
    
    // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­
    document.getElementById('start-scan-btn').addEventListener('click', function() {
        isScanning = true;
        this.disabled = true;
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­...';
        document.getElementById('barcode-input').focus();
    });
    
    // Ø­ÙØ¸ Ø§Ù„ÙƒÙ„
    document.getElementById('save-all-btn').addEventListener('click', function() {
        saveAllProducts();
    });
    
    // Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
    document.getElementById('clear-all-btn').addEventListener('click', function() {
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ù…Ø³ÙˆØ­Ø©ØŸ')) {
            clearAllProducts();
        }
    });
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    document.getElementById('barcode-input').addEventListener('input', function() {
        const barcode = this.value.trim();
        if (barcode.length >= 8) { // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø·ÙˆÙ„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
            processBarcode(barcode);
            this.value = ''; // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚Ù„
        }
    });
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Enter
    document.getElementById('barcode-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const barcode = this.value.trim();
            if (barcode.length >= 8) {
                processBarcode(barcode);
                this.value = '';
            }
        }
    });
});

function processBarcode(barcode) {
    if (!isScanning) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­" Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    if (scannedProducts.find(p => p.barcode === barcode)) {
        alert('Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ù…Ø³ÙˆØ­ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
        return;
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
    const product = {
        barcode: barcode,
        name: `Ù…Ù†ØªØ¬ ${barcode}`,
        part_number: document.getElementById('default-part-number').value || '',
        brand: document.getElementById('default-brand').value || '',
        commercial_name: document.getElementById('default-commercial-name').value || '',
        origin_country: document.getElementById('default-origin').value || '',
        unit: document.getElementById('default-unit').value || 'Ù‚Ø·Ø¹Ø©',
        warranty_period: parseInt(document.getElementById('default-warranty').value) || 12,
        price: parseFloat(document.getElementById('default-price').value) || 0,
        quantity: parseInt(document.getElementById('default-quantity').value) || 1,
        status: 'Ø¬Ø¯ÙŠØ¯',
        isNew: true
    };
    
    scannedProducts.push(product);
    updateProductsTable();
    updateStats();
}

function updateProductsTable() {
    const tbody = document.getElementById('scanned-products-body');
    const noProductsMsg = document.getElementById('no-products-message');
    
    if (scannedProducts.length === 0) {
        tbody.innerHTML = '';
        noProductsMsg.style.display = 'block';
        return;
    }
    
    noProductsMsg.style.display = 'none';
    tbody.innerHTML = '';
    
    scannedProducts.forEach((product, index) => {
        const row = `
            <tr>
                <td>${product.barcode}</td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${product.name}" 
                           onchange="updateProduct(${index}, 'name', this.value)">
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${product.part_number || ''}" 
                           onchange="updateProduct(${index}, 'part_number', this.value)">
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${product.brand || ''}" 
                           onchange="updateProduct(${index}, 'brand', this.value)">
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${product.commercial_name || ''}" 
                           onchange="updateProduct(${index}, 'commercial_name', this.value)">
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${product.origin_country || ''}" 
                           onchange="updateProduct(${index}, 'origin_country', this.value)">
                </td>
                <td>
                    <input type="text" class="form-control form-control-sm" 
                           value="${product.unit || ''}" 
                           onchange="updateProduct(${index}, 'unit', this.value)">
                </td>
                <td>
                    <input type="number" class="form-control form-control-sm" 
                           value="${product.price}" step="0.01"
                           onchange="updateProduct(${index}, 'price', this.value)">
                </td>
                <td>
                    <input type="number" class="form-control form-control-sm" 
                           value="${product.quantity}"
                           onchange="updateProduct(${index}, 'quantity', this.value)">
                </td>
                <td>
                    <input type="number" class="form-control form-control-sm" 
                           value="${product.warranty_period || 12}"
                           onchange="updateProduct(${index}, 'warranty_period', this.value)">
                </td>
                <td>
                    <span class="badge badge-${product.isNew ? 'success' : 'warning'}">
                        ${product.status}
                    </span>
                </td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="removeProduct(${index})">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

function updateProduct(index, field, value) {
    scannedProducts[index][field] = value;
    updateStats();
}

function removeProduct(index) {
    scannedProducts.splice(index, 1);
    updateProductsTable();
    updateStats();
}

function updateStats() {
    document.getElementById('scanned-count').textContent = scannedProducts.length;
    document.getElementById('new-products').textContent = scannedProducts.filter(p => p.isNew).length;
    document.getElementById('updated-products').textContent = scannedProducts.filter(p => !p.isNew).length;
    document.getElementById('errors-count').textContent = 0;
    
    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­ÙØ¸ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù†ØªØ¬Ø§Øª
    document.getElementById('save-all-btn').disabled = scannedProducts.length === 0;
}

function clearAllProducts() {
    scannedProducts = [];
    updateProductsTable();
    updateStats();
    const startBtn = document.getElementById('start-scan-btn');
    startBtn.disabled = false;
    startBtn.innerHTML = '<i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­';
    isScanning = false;
}

function saveAllProducts() {
    if (scannedProducts.length === 0) {
        alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø­ÙØ¸');
        return;
    }
    
    const warehouseId = document.getElementById('warehouse-select').value;
    
    // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const productsData = scannedProducts.map(product => ({
        barcode: product.barcode,
        name: product.name,
        part_number: product.part_number || '',
        brand: product.brand || '',
        commercial_name: product.commercial_name || '',
        origin_country: product.origin_country || '',
        unit: product.unit || 'Ù‚Ø·Ø¹Ø©',
        warranty_period: parseInt(product.warranty_period) || 12,
        price: parseFloat(product.price),
        quantity: parseInt(product.quantity)
    }));
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const existingProductAction = document.getElementById('existing-product-action').value;
    
    fetch('/barcode/bulk-import', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            products: productsData,
            warehouse_id: parseInt(warehouseId),
            existing_product_action: existingProductAction
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(`ØªÙ… Ø­ÙØ¸ ${data.imported_count} Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ùˆ ${data.updated_count} Ù…Ù†ØªØ¬ Ù…Ø­Ø¯Ø«`);
            clearAllProducts();
        } else {
            alert('Ø®Ø·Ø£: ' + data.error);
        }
    })
    .catch(error => {
        alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
    });
}

// Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø°ÙƒÙŠØ©
let currentProductData = null;
let currentBarcode = null;

// ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬
async function checkProductExists(barcode) {
    const warehouseId = document.getElementById('warehouse-select').value;
    
    try {
        const response = await fetch(`/barcode/check-product?barcode=${encodeURIComponent(barcode)}&warehouse_id=${warehouseId}`);
        const data = await response.json();
        
        if (data.exists) {
            currentProductData = data.product;
            currentBarcode = barcode;
            showProductFiltersModal(data.product);
            return true;
        }
        return false;
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ÙØ­Øµ Ø§Ù„Ù…Ù†ØªØ¬:', error);
        return false;
    }
}

// Ø¹Ø±Ø¶ modal Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø°ÙƒÙŠØ©
function showProductFiltersModal(product) {
    // Ù…Ù„Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠ
    const currentInfo = document.getElementById('current-product-info');
    currentInfo.innerHTML = `
        <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${product.name}<br>
        <strong>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</strong> ${product.barcode}<br>
        <strong>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©:</strong> ${product.part_number || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø§Ù„Ù…Ø§Ø±ÙƒØ©:</strong> ${product.brand || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ:</strong> ${product.commercial_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£:</strong> ${product.origin_country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø§Ù„ÙˆØ­Ø¯Ø©:</strong> ${product.unit || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù†:</strong> ${product.warranty_period || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} Ø´Ù‡Ø±<br>
        <strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${product.price} Ø´ÙŠÙƒÙ„<br>
        <strong>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> ${product.current_quantity} ${product.unit || 'Ù‚Ø·Ø¹Ø©'}
    `;
    
    // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const newInfo = document.getElementById('new-product-info');
    newInfo.innerHTML = `
        <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${document.getElementById('default-brand').value} ${document.getElementById('default-commercial-name').value || 'Ù…Ù†ØªØ¬'}<br>
        <strong>Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©:</strong> ${document.getElementById('default-part-number').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø§Ù„Ù…Ø§Ø±ÙƒØ©:</strong> ${document.getElementById('default-brand').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ:</strong> ${document.getElementById('default-commercial-name').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£:</strong> ${document.getElementById('default-origin').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ø§Ù„ÙˆØ­Ø¯Ø©:</strong> ${document.getElementById('default-unit').value || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
        <strong>Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù†:</strong> ${document.getElementById('default-warranty').value} Ø´Ù‡Ø±<br>
        <strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${document.getElementById('default-price').value} Ø´ÙŠÙƒÙ„<br>
        <strong>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</strong> ${document.getElementById('default-quantity').value} ${document.getElementById('default-unit').value || 'Ù‚Ø·Ø¹Ø©'}
    `;
    
    // Ø¥Ø¸Ù‡Ø§Ø± Modal
    const modal = document.getElementById('productFiltersModal');
    $(modal).modal('show');
}

// ØªØ£ÙƒÙŠØ¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬
function setupConfirmButton() {
    const confirmBtn = document.getElementById('confirm-update-product');
    if (confirmBtn) {
        confirmBtn.addEventListener('click', function() {
            if (!currentProductData || !currentBarcode) return;
    
    // Ø¬Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«
    const fieldsToUpdate = {};
    if (document.getElementById('update-name').checked) {
        fieldsToUpdate.name = document.getElementById('default-brand').value + ' ' + (document.getElementById('default-commercial-name').value || 'Ù…Ù†ØªØ¬');
    }
    if (document.getElementById('update-part-number').checked) {
        fieldsToUpdate.part_number = document.getElementById('default-part-number').value;
    }
    if (document.getElementById('update-brand').checked) {
        fieldsToUpdate.brand = document.getElementById('default-brand').value;
    }
    if (document.getElementById('update-commercial-name').checked) {
        fieldsToUpdate.commercial_name = document.getElementById('default-commercial-name').value;
    }
    if (document.getElementById('update-origin').checked) {
        fieldsToUpdate.origin_country = document.getElementById('default-origin').value;
    }
    if (document.getElementById('update-unit').checked) {
        fieldsToUpdate.unit = document.getElementById('default-unit').value;
    }
    if (document.getElementById('update-warranty').checked) {
        fieldsToUpdate.warranty_period = parseInt(document.getElementById('default-warranty').value);
    }
    if (document.getElementById('update-price').checked) {
        fieldsToUpdate.price = parseFloat(document.getElementById('default-price').value);
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    const updatedProduct = {
        ...currentProductData,
        ...fieldsToUpdate,
        barcode: currentBarcode,
        quantity: parseInt(document.getElementById('modal-quantity').value),
        status: 'Ù…Ø­Ø¯Ø«',
        isNew: false,
        update_fields: fieldsToUpdate  // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ«
    };
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
    scannedProducts.push(updatedProduct);
    updateProductsTable();
    updateStats();
    
    // Ø¥Ø®ÙØ§Ø¡ Modal
    const modal = document.getElementById('productFiltersModal');
    $(modal).modal('hide');
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    currentProductData = null;
    currentBarcode = null;
        });
    }
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© processBarcode Ù„ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø£ÙˆÙ„Ø§Ù‹
async function processBarcode(barcode) {
    if (!isScanning) return;
    
    // ÙØ­Øµ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ Ø£ÙˆÙ„Ø§Ù‹
    const exists = await checkProductExists(barcode);
    if (exists) {
        return; // Ø³ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ ÙÙŠ Modal
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
    const product = {
        barcode: barcode,
        name: document.getElementById('default-brand').value + ' ' + (document.getElementById('default-commercial-name').value || 'Ù…Ù†ØªØ¬'),
        part_number: document.getElementById('default-part-number').value || '',
        brand: document.getElementById('default-brand').value || '',
        commercial_name: document.getElementById('default-commercial-name').value || '',
        origin_country: document.getElementById('default-origin').value || '',
        unit: document.getElementById('default-unit').value || 'Ù‚Ø·Ø¹Ø©',
        warranty_period: parseInt(document.getElementById('default-warranty').value) || 12,
        price: parseFloat(document.getElementById('default-price').value) || 0,
        quantity: parseInt(document.getElementById('default-quantity').value) || 1,
        status: 'Ø¬Ø¯ÙŠØ¯',
        isNew: true
    };
    
    scannedProducts.push(product);
    updateProductsTable();
    updateStats();
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    setupConfirmButton();
    loadWarehouses();
    loadPartners();
    loadSuppliers();
});

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
async function loadWarehouses() {
    try {
        const response = await fetch('/barcode/warehouses');
        const data = await response.json();
        
        if (data.success) {
            const select = document.getElementById('warehouse-select');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹...</option>';
            
            data.warehouses.forEach(warehouse => {
                const option = document.createElement('option');
                option.value = warehouse.id;
                option.textContent = `${warehouse.name} (${warehouse.type})`;
                option.dataset.type = warehouse.type;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª:', error);
    }
}

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ù…Ø¹ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©
async function loadPartners() {
    try {
        const response = await fetch('/api/partners');
        const data = await response.json();
        
        if (data.success && data.partners) {
            const select = document.getElementById('partner-select');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙŠÙƒ...</option>';
            
            console.log(`âœ… [Partners] ØªÙ… Ø¬Ù„Ø¨ ${data.count} Ø´Ø±ÙŠÙƒ`);
            
            data.partners.forEach(partner => {
                const shareText = partner.share_percentage ? ` (Ù†Ø³Ø¨Ø©: ${partner.share_percentage}%)` : '';
                const option = document.createElement('option');
                option.value = partner.id;
                option.textContent = `${partner.name}${shareText}`;
                option.dataset.share = partner.share_percentage || 0;
                option.dataset.phone = partner.phone || '';
                option.dataset.email = partner.email || '';
                option.dataset.balance = partner.balance || 0;
                select.appendChild(option);
            });
        } else {
            console.warn('âš ï¸ [Partners] Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ø±ÙƒØ§Ø¡');
        }
    } catch (error) {
        console.error('âŒ [Partners] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
function updatePartnerInfo() {
    const select = document.getElementById('partner-select');
    const selectedOption = select.options[select.selectedIndex];
    
    if (selectedOption && selectedOption.value) {
        const share = selectedOption.dataset.share || 0;
        const phone = selectedOption.dataset.phone || '';
        const email = selectedOption.dataset.email || '';
        const balance = selectedOption.dataset.balance || 0;
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©
        document.getElementById('partner-share').value = share;
        
        // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ
        const partnerDetails = document.getElementById('partner-details');
        partnerDetails.innerHTML = `
            <div>
                <strong>Ø§Ù„Ø´Ø±ÙŠÙƒ:</strong> ${selectedOption.text}<br>
                ${phone ? `<strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone}<br>` : ''}
                ${email ? `<strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${email}<br>` : ''}
                <strong>Ø§Ù„Ø±ØµÙŠØ¯:</strong> ${balance} Ø´ÙŠÙƒÙ„
            </div>
        `;
        document.getElementById('partner-info-display').style.display = 'block';
        
        console.log(`âœ… [Partner Info] Ø§Ù„Ø´Ø±ÙŠÙƒ: ${selectedOption.text}, Ù†Ø³Ø¨Ø©: ${share}%`);
    } else {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        document.getElementById('partner-share').value = 0;
        document.getElementById('partner-info-display').style.display = 'none';
    }
}

// ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
async function loadSuppliers() {
    try {
        const response = await fetch('/api/suppliers');
        const data = await response.json();
        
        if (data.success && data.suppliers) {
            const select = document.getElementById('supplier-select');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯...</option>';
            
            console.log(`âœ… [Suppliers] ØªÙ… Ø¬Ù„Ø¨ ${data.count} Ù…ÙˆØ±Ø¯`);
            
            data.suppliers.forEach(supplier => {
                const option = document.createElement('option');
                option.value = supplier.id;
                option.textContent = supplier.name;
                option.dataset.phone = supplier.phone || '';
                option.dataset.email = supplier.email || '';
                select.appendChild(option);
            });
        } else {
            console.warn('âš ï¸ [Suppliers] Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ±Ø¯ÙŠÙ†');
        }
    } catch (error) {
        console.error('âŒ [Suppliers] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†:', error);
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
async function loadWarehouseFields() {
    const warehouseId = document.getElementById('warehouse-select').value;
    
    if (!warehouseId) {
        document.getElementById('warehouse-info').style.display = 'none';
        return;
    }
    
    try {
        const response = await fetch(`/barcode/warehouse-fields?warehouse_id=${warehouseId}`);
        const data = await response.json();
        
        if (data.success) {
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
            const warehouseInfo = document.getElementById('warehouse-info');
            const warehouseTypeInfo = document.getElementById('warehouse-type-info');
            
            const typeNames = {
                'MAIN': 'Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                'PARTNER': 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡',
                'INVENTORY': 'Ù…Ø³ØªÙˆØ¯Ø¹ Ù…Ù„ÙƒÙŠØªÙŠ (Ø§Ù„Ø´Ø±ÙƒØ©)',
                'EXCHANGE': 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„ØªØ¨Ø§Ø¯Ù„ (Ø§Ù„ØªØ¬Ø§Ø±)',
                'ONLINE': 'Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'general': 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø¹Ø§Ù…'
            };
            
            let infoText = `Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹: ${typeNames[data.warehouse_type] || data.warehouse_type}`;
            if (data.note) {
                infoText += ` - ${data.note}`;
            }
            warehouseTypeInfo.textContent = infoText;
            warehouseInfo.style.display = 'block';
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
            document.getElementById('partner-fields').style.display = data.show_partner_fields ? 'block' : 'none';
            document.getElementById('supplier-fields').style.display = data.show_exchange_fields ? 'block' : 'none';
            document.getElementById('online-fields').style.display = data.show_online_fields ? 'block' : 'none';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            updateFieldRequirements(data.required_fields, data.recommended_fields, data.optional_fields);
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            applyDefaultValues(data.default_values);
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„
function updateFieldRequirements(requiredFields, recommendedFields, optionalFields) {
    const allFields = {
        'name': { label: 'Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬', element: null },
        'price': { label: 'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', element: document.getElementById('default-price') },
        'quantity': { label: 'Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', element: document.getElementById('default-quantity') },
        'brand': { label: 'Ø§Ù„Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', element: document.getElementById('default-brand') },
        'part_number': { label: 'Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', element: document.getElementById('default-part-number') },
        'commercial_name': { label: 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', element: document.getElementById('default-commercial-name') },
        'origin_country': { label: 'Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', element: document.getElementById('default-origin') },
        'unit': { label: 'Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', element: document.getElementById('default-unit') },
        'warranty_period': { label: 'Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', element: document.getElementById('default-warranty') }
    };
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„
    Object.values(allFields).forEach(field => {
        if (field.element) {
            const parent = field.element.closest('.form-group');
            if (parent) {
                const label = parent.querySelector('label');
                if (label) {
                    label.style.color = '#6c757d';
                    label.style.fontWeight = 'normal';
                    // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
                    label.innerHTML = label.innerHTML.replace(/ <span style="color: red;">.*?<\/span>/g, '');
                    label.innerHTML = label.innerHTML.replace(/ <span style="color: orange;">.*?<\/span>/g, '');
                }
                parent.style.opacity = '0.5';
                parent.style.border = 'none';
            }
        }
    });
    
    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø£Ø­Ù…Ø±)
    requiredFields.forEach(fieldName => {
        const field = allFields[fieldName];
        if (field && field.element) {
            const parent = field.element.closest('.form-group');
            if (parent) {
                const label = parent.querySelector('label');
                if (label) {
                    label.style.color = '#dc3545';
                    label.style.fontWeight = 'bold';
                    if (!label.innerHTML.includes('*')) {
                        label.innerHTML += ' <span style="color: red;">*</span>';
                    }
                }
                parent.style.opacity = '1';
                parent.style.border = '2px solid #dc3545';
                parent.style.borderRadius = '6px';
                parent.style.padding = '10px';
                parent.style.backgroundColor = '#fff5f5';
            }
        }
    });
    
    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡Ø§ (Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)
    recommendedFields.forEach(fieldName => {
        const field = allFields[fieldName];
        if (field && field.element) {
            const parent = field.element.closest('.form-group');
            if (parent) {
                const label = parent.querySelector('label');
                if (label) {
                    label.style.color = '#fd7e14';
                    label.style.fontWeight = 'bold';
                    if (!label.innerHTML.includes('â˜…')) {
                        label.innerHTML += ' <span style="color: orange;">â˜…</span>';
                    }
                }
                parent.style.opacity = '1';
                parent.style.border = '2px solid #fd7e14';
                parent.style.borderRadius = '6px';
                parent.style.padding = '10px';
                parent.style.backgroundColor = '#fff8f0';
            }
        }
    });
    
    // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Ø£Ø®Ø¶Ø±)
    optionalFields.forEach(fieldName => {
        const field = allFields[fieldName];
        if (field && field.element) {
            const parent = field.element.closest('.form-group');
            if (parent) {
                const label = parent.querySelector('label');
                if (label) {
                    label.style.color = '#28a745';
                    label.style.fontWeight = '600';
                }
                parent.style.opacity = '1';
                parent.style.border = '1px solid #d4edda';
                parent.style.borderRadius = '6px';
                parent.style.padding = '10px';
                parent.style.backgroundColor = '#f1f9f4';
            }
        }
    });
}

// ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
function applyDefaultValues(defaultValues) {
    Object.keys(defaultValues).forEach(fieldName => {
        const element = document.getElementById(`default-${fieldName.replace('_', '-')}`);
        if (element) {
            element.value = defaultValues[fieldName];
        }
    });
}
</script>

<!-- Modal Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø°ÙƒÙŠØ© -->
<div class="modal fade" id="productFiltersModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-filter"></i> ÙÙ„Ø§ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
        </h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <i class="fas fa-info-circle"></i>
          ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯. Ø§Ø®ØªØ± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ«Ù‡Ø§:
        </div>
        
        <div class="row">
          <div class="col-md-6">
            <h6><i class="fas fa-info-circle"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h6>
            <div id="current-product-info" class="border p-3 mb-3 bg-light">
              <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
          </div>
          <div class="col-md-6">
            <h6><i class="fas fa-edit"></i> Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</h6>
            <div id="new-product-info" class="border p-3 mb-3">
              <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ù€ JavaScript -->
            </div>
          </div>
        </div>
        
        <h6><i class="fas fa-check-square"></i> Ø§Ø®ØªØ± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­Ø¯ÙŠØ«Ù‡Ø§:</h6>
        <div class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-name" checked>
            <label class="form-check-label" for="update-name">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-part-number">
            <label class="form-check-label" for="update-part-number">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-brand">
            <label class="form-check-label" for="update-brand">Ø§Ù„Ù…Ø§Ø±ÙƒØ©</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-commercial-name">
            <label class="form-check-label" for="update-commercial-name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-origin">
            <label class="form-check-label" for="update-origin">Ø¨Ù„Ø¯ Ø§Ù„Ù…Ù†Ø´Ø£</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-unit">
            <label class="form-check-label" for="update-unit">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-warranty">
            <label class="form-check-label" for="update-warranty">Ù…Ø¯Ø© Ø§Ù„Ø¶Ù…Ø§Ù†</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="update-price" checked>
            <label class="form-check-label" for="update-price">Ø§Ù„Ø³Ø¹Ø±</label>
          </div>
        </div>
        
        <div class="form-group">
          <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§:</label>
          <input type="number" class="form-control" id="modal-quantity" value="1" min="1">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
        <button type="button" class="btn btn-primary" id="confirm-update-product">
          <i class="fas fa-save"></i> ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
        </button>
      </div>
    </div>
  </div>
{% endblock %}
