{% extends "base.html" %}

{% block title %}Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„{% endblock %}

{% block extra_head %}
<style>
/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… */
.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    font-size: 2.5rem;
    opacity: 0.8;
}

.card-modern {
    border: none;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.card-modern:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
}

.card-header-modern {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 15px 15px 0 0 !important;
    border: none;
    padding: 20px;
}

.card-header-modern h3 {
    margin: 0;
    font-weight: 600;
}

.btn-modern {
    border-radius: 10px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
}

.btn-modern:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.form-control-modern {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 12px 16px;
    transition: all 0.3s ease;
}

.form-control-modern:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.warehouse-type-badge {
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 12px;
    font-weight: 600;
}

.partner-fields, .supplier-fields {
    background: #f8f9fa;
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    padding: 15px;
    margin-top: 10px;
}

.stock-info {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
}

.warning-info {
    background: linear-gradient(135deg, #ff9a56 0%, #ff6b6b 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
}

.alert-modern {
    border: none;
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
}

.product-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin: 10px 0;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    border-left: 5px solid #667eea;
}

.barcode-preview {
    text-align: center;
    background: white;
    border-radius: 15px;
    padding: 20px;
    margin: 15px 0;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
.table-modern {
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.table-modern th {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    font-weight: 600;
    padding: 15px;
}

.table-modern td {
    padding: 12px 15px;
    border-color: #f1f3f4;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø²Ø±Ø§Ø± */
.btn-primary-modern {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
}

.btn-success-modern {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    border: none;
    color: white;
}

.btn-warning-modern {
    background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);
    border: none;
    color: white;
}

.btn-danger-modern {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    border: none;
    color: white;
}

.btn-info-modern {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    border: none;
    color: white;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ loading */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ notifications */
.notification-success {
    background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    border: none;
}

.notification-error {
    background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    border: none;
}

.notification-warning {
    background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);
    color: white;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    border: none;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ responsive */
@media (max-width: 768px) {
    .stat-card {
        margin-bottom: 15px;
    }
    
    .card-modern {
        margin-bottom: 20px;
    }
    
    .btn-modern {
        width: 100%;
        margin: 5px 0;
    }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ animations */
.fade-in {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.slide-in {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { transform: translateX(-100%); }
    to { transform: translateX(0); }
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ focus states */
.form-control-modern:focus,
.select2-container--default .select2-selection--single:focus,
.select2-container--default .select2-selection--multiple:focus {
    outline: none;
    border-color: #667eea !important;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù€ select2 */
.select2-container--default .select2-selection--single,
.select2-container--default .select2-selection--multiple {
    border: 2px solid #e9ecef !important;
    border-radius: 10px !important;
    padding: 8px 12px !important;
    min-height: 45px !important;
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    line-height: 30px !important;
    padding-left: 0 !important;
}

.select2-container--default .select2-selection--single .select2-selection__arrow {
    height: 30px !important;
    right: 8px !important;
}
</style>
{% endblock %}

{% block content %}
    <!-- Content Header -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li class="breadcrumb-item active">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</li>
                    </ol>
                    <div class="float-sm-right mt-2">
                        <a href="{{ url_for('barcode_scanner.bulk_scan_page') }}" class="btn btn-success btn-sm">
                            <i class="fas fa-layer-group"></i> Ù…Ø³Ø­ Ø¬Ù…Ø§Ø¹ÙŠ
                        </a>
                        <a href="{{ url_for('barcode_scanner.barcode_stats') }}" class="btn btn-info btn-sm">
                            <i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù…Ø­Ø³Ù†Ø© -->
            <div class="row">
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="total-products">
                                    <span class="loading-spinner"></span>
                                </h2>
                                <p class="mb-0" style="opacity: 0.9;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in" style="background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="products-with-barcode">
                                    <span class="loading-spinner"></span>
                                </h2>
                                <p class="mb-0" style="opacity: 0.9;">Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø¨Ø§Ø±ÙƒÙˆØ¯</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-barcode"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in" style="background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="products-without-barcode">
                                    <span class="loading-spinner"></span>
                                </h2>
                                <p class="mb-0" style="opacity: 0.9;">Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-light btn-sm btn-modern" id="auto-assign-btn" style="width: 100%;">
                                <i class="fas fa-magic ml-1"></i> Ø¥Ø¹Ø·Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12 mb-4">
                    <div class="stat-card fade-in" style="background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h2 class="mb-1" id="barcode-percentage">
                                    <span class="loading-spinner"></span>%
                                </h2>
                                <p class="mb-0" style="opacity: 0.9;">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºØ·ÙŠØ©</p>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ø­Ø³Ù†Ø© -->
            <div class="row">
                <!-- Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
                <div class="col-lg-6 col-md-12 mb-4">
                    <div class="card card-modern">
                        <div class="card-header-modern">
                            <h3>
                                <i class="fas fa-qrcode ml-2"></i>
                                Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø°ÙƒÙŠ
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <div class="form-group mb-4">
                                <label for="barcode-input" class="form-label fw-bold">
                                    <i class="fas fa-barcode ml-1 text-primary"></i>
                                    Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ù…Ø³Ø­Ù‡:
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control form-control-modern" id="barcode-input" 
                                           placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ SKU Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©" autocomplete="off">
                                    <button class="btn btn-primary-modern btn-modern" type="button" id="scan-btn">
                                        <i class="fas fa-search ml-1"></i> Ù…Ø³Ø­
                                    </button>
                                </div>
                                <small class="form-text text-muted mt-2">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ SKU Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø© Ù„Ù„Ø¨Ø­Ø«
                                </small>
                            </div>
                            
                            <!-- Loading state -->
                            <div id="scan-loading" class="text-center py-4" style="display: none;">
                                <div class="loading-spinner mx-auto mb-2"></div>
                                <p class="text-muted">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬...</p>
                            </div>
                            
                            <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø³Ø­ -->
                            <div id="scan-results" class="fade-in" style="display: none;">
                                <div class="alert-modern notification-success">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-check-circle fa-2x ml-3"></i>
                                        <div>
                                            <h5 class="mb-1">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬</h5>
                                            <p class="mb-0 opacity-75">ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­</p>
                                        </div>
                                    </div>
                                    <div id="product-info"></div>
                                </div>
                            </div>
                            
                            <!-- Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø³Ø­ -->
                            <div id="scan-error" class="fade-in" style="display: none;">
                                <div class="alert-modern notification-error">
                                    <div class="d-flex align-items-center mb-3">
                                        <i class="fas fa-times-circle fa-2x ml-3"></i>
                                        <div>
                                            <h5 class="mb-1">Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</h5>
                                            <p class="mb-0 opacity-75">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬</p>
                                        </div>
                                    </div>
                                    <div id="error-message"></div>
                                    <div class="mt-3">
                                        <button class="btn btn-light btn-modern btn-sm" id="create-product-btn">
                                            <i class="fas fa-plus ml-1"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
                <div class="col-lg-6 col-md-12 mb-4">
                    <div class="card card-modern">
                        <div class="card-header-modern" style="background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);">
                            <h3>
                                <i class="fas fa-print ml-2"></i>
                                ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <div class="form-group mb-4">
                                <label for="product-search" class="form-label fw-bold">
                                    <i class="fas fa-search ml-1 text-success"></i>
                                    Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬:
                                </label>
                                <input type="text" class="form-control form-control-modern" id="product-search" 
                                       placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ SKU Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©" autocomplete="off">
                                <small class="form-text text-muted mt-2">
                                    <i class="fas fa-info-circle ml-1"></i>
                                    Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                </small>
                                <div id="search-results" class="mt-3"></div>
                            </div>
                            
                            <div class="form-group mb-4">
                                <label for="barcode-type" class="form-label fw-bold">
                                    <i class="fas fa-cog ml-1 text-success"></i>
                                    Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:
                                </label>
                                <select class="form-control form-control-modern" id="barcode-type">
                                    <option value="CODE128">Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø®Ø·ÙŠ (CODE128)</option>
                                    <option value="QR">QR Code</option>
                                </select>
                                <div class="alert alert-info mt-3" style="font-size: 0.85rem;">
                                    <h6 class="mb-2"><i class="fas fa-info-circle ml-1"></i><strong>ØªÙˆØ¶ÙŠØ­ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</strong></h6>
                                    <ul class="mb-0" style="line-height: 1.8;">
                                        <li><strong>Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø®Ø·ÙŠ (CODE128):</strong> Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªÙ‚Ù„ÙŠØ¯ÙŠ ÙŠÙ…ÙƒÙ† Ù…Ø³Ø­Ù‡ Ø¨Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø§Ø¯ÙŠØŒ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… ÙˆØ­Ø±ÙˆÙ</li>
                                        <li><strong>QR Code:</strong> Ø±Ù…Ø² Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø³Ø±ÙŠØ¹ Ø«Ù†Ø§Ø¦ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ØŒ ÙŠÙ…ÙƒÙ† Ù…Ø³Ø­Ù‡ Ø¨Ø§Ù„Ù‡Ø§ØªÙØŒ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ«Ø±</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-success-modern btn-modern" id="generate-btn" disabled>
                                    <i class="fas fa-barcode ml-1"></i> ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                                </button>
                            </div>
                            
                            <!-- Loading state -->
                            <div id="generate-loading" class="text-center py-4" style="display: none;">
                                <div class="loading-spinner mx-auto mb-2"></div>
                                <p class="text-muted">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...</p>
                            </div>
                            
                            <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
                            <div id="barcode-preview" class="fade-in" style="display: none;">
                                <div class="barcode-preview">
                                    <h5 class="mb-3">
                                        <i class="fas fa-eye ml-2"></i>
                                        Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                                    </h5>
                                    <img id="barcode-image" class="img-fluid mb-3" style="max-width: 300px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                    <div class="d-flex gap-2 justify-content-center">
                                        <button class="btn btn-info-modern btn-modern btn-sm" id="print-btn">
                                            <i class="fas fa-print ml-1"></i> Ø·Ø¨Ø§Ø¹Ø©
                                        </button>
                                        <button class="btn btn-secondary btn-modern btn-sm" id="download-btn">
                                            <i class="fas fa-download ml-1"></i> ØªØ­Ù…ÙŠÙ„
                                        </button>
                                        <button class="btn btn-warning-modern btn-modern btn-sm" id="copy-btn">
                                            <i class="fas fa-copy ml-1"></i> Ù†Ø³Ø®
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card card-modern">
                        <div class="card-header-modern" style="background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);">
                            <h3>
                                <i class="fas fa-warehouse ml-2"></i>
                                ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <!-- ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
                            <div class="alert alert-info mb-4" style="border-right: 4px solid #4facfe;">
                                <h6 class="mb-2"><i class="fas fa-info-circle ml-2"></i><strong>ØªÙˆØ¶ÙŠØ­ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</strong></h6>
                                <ul class="mb-0" style="font-size: 0.9rem; line-height: 1.8;">
                                    <li><strong>ØªØ¹Ø¯ÙŠÙ„:</strong> ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ (ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)</li>
                                    <li><strong>Ø¥Ø¶Ø§ÙØ©:</strong> Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</li>
                                    <li><strong>Ø·Ø±Ø­:</strong> Ø·Ø±Ø­ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</li>
                                </ul>
                            </div>
                            
                            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ -->
                            <div id="current-stock-info" class="stock-info" style="display: none;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-info-circle fa-2x ml-3"></i>
                                    <div>
                                        <h6 class="mb-1">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</h6>
                                        <p class="mb-0" id="current-stock-text"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ØªØ­Ø°ÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ© -->
                            <div id="quantity-warning" class="warning-info" style="display: none;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-exclamation-triangle fa-2x ml-3"></i>
                                    <div>
                                        <h6 class="mb-1">ØªØ­Ø°ÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©</h6>
                                        <p class="mb-0" id="warning-text"></p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="form-group">
                                        <label for="inventory-barcode" class="form-label fw-bold">
                                            <i class="fas fa-barcode ml-1 text-warning"></i>
                                            Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬:
                                        </label>
                                        <input type="text" class="form-control form-control-modern" id="inventory-barcode" 
                                               placeholder="Ø§Ù…Ø³Ø­ Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯" autocomplete="off">
                                        <small class="form-text text-muted mt-1">
                                            <i class="fas fa-info-circle ml-1"></i>
                                            Ø§Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø£Ø¯Ø®Ù„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="form-group">
                                        <label for="warehouse-select" class="form-label fw-bold">
                                            <i class="fas fa-warehouse ml-1 text-warning"></i>
                                            Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹:
                                        </label>
                                        <select class="form-control form-control-modern" id="warehouse-select">
                                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</option>
                                        </select>
                                        <small class="form-text text-muted mt-1">
                                            <i class="fas fa-info-circle ml-1"></i>
                                            Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                                        </small>
                                    </div>
                                </div>
                                
                                <div class="col-lg-2 col-md-4 mb-3">
                                    <div class="form-group">
                                        <label for="quantity-change" class="form-label fw-bold">
                                            <i class="fas fa-calculator ml-1 text-warning"></i>
                                            Ø§Ù„ÙƒÙ…ÙŠØ©:
                                        </label>
                                        <input type="number" class="form-control form-control-modern" id="quantity-change" 
                                               value="0" min="-9999" max="9999" step="1">
                                    </div>
                                </div>
                                
                                <div class="col-lg-2 col-md-4 mb-3">
                                    <div class="form-group">
                                        <label for="operation-type" class="form-label fw-bold">
                                            <i class="fas fa-cog ml-1 text-warning"></i>
                                            Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:
                                        </label>
                                        <select class="form-control form-control-modern" id="operation-type">
                                            <option value="adjust">ØªØ¹Ø¯ÙŠÙ„</option>
                                            <option value="add">Ø¥Ø¶Ø§ÙØ©</option>
                                            <option value="subtract">Ø·Ø±Ø­</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="col-lg-2 col-md-4 mb-3">
                                    <div class="form-group">
                                        <label class="form-label fw-bold">
                                            <i class="fas fa-tools ml-1 text-warning"></i>
                                            Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:
                                        </label>
                                        <div class="d-grid">
                                            <button class="btn btn-warning-modern btn-modern" id="update-inventory-btn" disabled>
                                                <i class="fas fa-sync ml-1"></i> ØªØ­Ø¯ÙŠØ«
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ø­Ù‚ÙˆÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ -->
                            <div id="dynamic-fields-container" style="display: none;">
                                <hr class="my-4">
                                <h5 class="mb-3">
                                    <i class="fas fa-cogs ml-2"></i>
                                    Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
                                </h5>
                                
                                <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø´Ø±ÙŠÙƒ -->
                                <div id="partner-fields" class="partner-fields" style="display: none;">
                                    <h6 class="mb-3">
                                        <i class="fas fa-handshake ml-2"></i>
                                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="partner-select" class="form-label fw-bold">
                                                    Ø§Ù„Ø´Ø±ÙŠÙƒ <span class="text-danger">*</span>:
                                                </label>
                                                <select class="form-control form-control-modern" id="partner-select" onchange="updatePartnerInfoIndex()">
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙŠÙƒ</option>
                                                </select>
                                                <small class="form-text text-muted mt-2">
                                                    <i class="fas fa-info-circle ml-1"></i>
                                                    Ø³ÙŠØªÙ… Ø±Ø¨Ø· Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´Ø±ÙŠÙƒ
                                                </small>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label fw-bold">
                                                    Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©:
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control form-control-modern" id="partner-share-index" 
                                                           value="0" min="0" max="100" step="0.01" readonly 
                                                           style="background-color: #f8f9fa;">
                                                    <div class="input-group-append">
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </div>
                                                <small class="form-text text-muted mt-2">
                                                    <i class="fas fa-percentage ml-1"></i>
                                                    Ù†Ø³Ø¨Ø© Ù…Ø³Ø§Ù‡Ù…Ø© Ø§Ù„Ø´Ø±ÙŠÙƒ
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
                                    <div id="partner-info-index" class="alert alert-info mt-3" style="display: none;">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-info-circle fa-2x ml-3"></i>
                                            <div id="partner-details-index"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ -->
                                <div id="supplier-fields" class="supplier-fields" style="display: none;">
                                    <h6 class="mb-3">
                                        <i class="fas fa-truck ml-2"></i>
                                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„ØªØ§Ø¬Ø±
                                    </h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label for="supplier-select" class="form-label fw-bold">
                                                    Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„ØªØ§Ø¬Ø± <span class="text-danger">*</span>:
                                                </label>
                                                <select class="form-control form-control-modern" id="supplier-select">
                                                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© -->
            <div class="row">
                <div class="col-12 mb-4">
                    <div class="card card-modern">
                        <div class="card-header-modern" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <h3>
                                <i class="fas fa-layer-group ml-2"></i>
                                ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
                            </h3>
                        </div>
                        <div class="card-body p-4">
                            <div class="row">
                                <div class="col-lg-8 col-md-12 mb-4">
                                    <div class="form-group">
                                        <label class="form-label fw-bold mb-3">
                                            <i class="fas fa-list ml-1 text-info"></i>
                                            Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:
                                        </label>
                                        <div id="bulk-products-list" class="border rounded p-3" style="max-height: 300px; overflow-y: auto; background: #f8f9fa;">
                                            <div class="text-center text-muted py-4">
                                                <i class="fas fa-plus-circle fa-3x mb-3 opacity-50"></i>
                                                <p class="mb-0">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                                                <small>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ SKU Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‚Ø·Ø¹Ø©</small>
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle ml-1"></i>
                                                Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©: <span id="selected-count">0</span>
                                            </small>
                                            <button class="btn btn-outline-danger btn-sm" id="clear-selection-btn" disabled>
                                                <i class="fas fa-trash ml-1"></i> Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-4 col-md-12">
                                    <div class="form-group mb-4">
                                        <label for="bulk-barcode-type" class="form-label fw-bold">
                                            <i class="fas fa-cog ml-1 text-info"></i>
                                            Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:
                                        </label>
                                        <select class="form-control form-control-modern" id="bulk-barcode-type">
                                            <option value="CODE128">Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø®Ø·ÙŠ (CODE128)</option>
                                            <option value="QR">QR Code</option>
                                        </select>
                                        <small class="form-text text-muted mt-2">
                                            <i class="fas fa-info-circle ml-1"></i>
                                            CODE128: Ù„Ù„Ù…Ø§Ø³Ø­Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© | QR: Ù„Ù„Ù‡ÙˆØ§ØªÙ ÙˆØ§Ù„Ù…Ø§Ø³Ø­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
                                        </small>
                                    </div>
                                    
                                    <div class="form-group mb-4">
                                        <label class="form-label fw-bold">
                                            <i class="fas fa-download ml-1 text-info"></i>
                                            Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„:
                                        </label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="download-individual" checked>
                                            <label class="form-check-label" for="download-individual">
                                                ØªØ­Ù…ÙŠÙ„ Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ Ø¨Ø§Ø±ÙƒÙˆØ¯
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="download-zip">
                                            <label class="form-check-label" for="download-zip">
                                                ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ù…Ø¶ØºÙˆØ· (ZIP)
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-info-modern btn-modern" id="bulk-generate-btn" disabled>
                                            <i class="fas fa-barcode ml-1"></i> ØªÙˆÙ„ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª
                                        </button>
                                        <button class="btn btn-secondary btn-modern" id="preview-bulk-btn" disabled>
                                            <i class="fas fa-eye ml-1"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                                        </button>
                                    </div>
                                    
                                    <!-- Loading state -->
                                    <div id="bulk-loading" class="text-center py-4" style="display: none;">
                                        <div class="loading-spinner mx-auto mb-2"></div>
                                        <p class="text-muted">Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª...</p>
                                        <small class="text-muted">Ù…Ù† <span id="current-index">0</span> Ø¥Ù„Ù‰ <span id="total-count">0</span></small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯ -->
                            <div id="bulk-results" class="fade-in" style="display: none;">
                                <hr class="my-4">
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <h5 class="mb-0">
                                        <i class="fas fa-check-circle text-success ml-2"></i>
                                        Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ø§Ù„Ù…ÙÙˆÙ„Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­
                                    </h5>
                                    <div>
                                        <button class="btn btn-success btn-modern btn-sm ml-2" id="download-all-btn">
                                            <i class="fas fa-download ml-1"></i> ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„
                                        </button>
                                        <button class="btn btn-info btn-modern btn-sm" id="print-all-btn">
                                            <i class="fas fa-print ml-1"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒÙ„
                                        </button>
                                    </div>
                                </div>
                                <div id="bulk-barcodes-grid" class="row"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Modal Ù„Ù„ØªÙØ§ØµÙŠÙ„ -->
<div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body" id="product-modal-body">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                <button type="button" class="btn btn-primary" id="modal-generate-btn">
                    <i class="fas fa-barcode"></i> ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    let selectedProduct = null;
    let bulkProducts = [];
    let currentWarehouseType = null;
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    loadStats();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
    loadWarehouses();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
    loadPartners();
    loadSuppliers();
    
    // Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    $('#scan-btn').click(function() {
        const barcode = $('#barcode-input').val().trim();
        if (barcode) {
            scanBarcode(barcode);
        }
    });
    
    $('#barcode-input').keypress(function(e) {
        if (e.which === 13) {
            $('#scan-btn').click();
        }
    });
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    let searchTimeout;
    $('#product-search').on('input', function() {
        clearTimeout(searchTimeout);
        const query = $(this).val().trim();
        
        if (query.length >= 2) {
            searchTimeout = setTimeout(() => {
                searchProducts(query);
            }, 300);
        } else {
            $('#search-results').empty();
        }
    });
    
    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    $('#generate-btn').click(function() {
        if (selectedProduct) {
            generateBarcode(selectedProduct.id, $('#barcode-type').val());
        }
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
    $('#update-inventory-btn').click(function() {
        updateInventory();
    });
    
    // ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ - ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
    $('#warehouse-select').on('change', function() {
        const warehouseId = $(this).val();
        const warehouseType = $(this).find('option:selected').data('type');
        
        console.log(`ğŸ­ [Warehouse Change] Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹: ${warehouseId}, Ø§Ù„Ù†ÙˆØ¹: ${warehouseType}`);
        
        if (warehouseId && warehouseType) {
            currentWarehouseType = warehouseType;
            showDynamicFields(warehouseType);
            checkProductStock();
        } else {
            hideDynamicFields();
        }
    });
    
    // ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ - ÙØ­Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    $('#inventory-barcode').on('input', function() {
        checkProductStock();
    });
    
    // ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ© - ÙØ­Øµ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
    $('#quantity-change, #operation-type').on('input change', function() {
        checkQuantityWarning();
    });
    
    // ØªÙˆÙ„ÙŠØ¯ Ù…ØªØ¹Ø¯Ø¯
    $('#bulk-generate-btn').click(function() {
        bulkGenerateBarcodes();
    });
    
    // Ù…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
    $('#clear-selection-btn').click(function() {
        clearBulkSelection();
    });
    
    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    $('#print-btn').click(function() {
        if (selectedProduct) {
            const barcodeType = $('#barcode-type').val();
            window.open(`/barcode/print/${selectedProduct.id}?type=${barcodeType}`, '_blank');
        }
    });
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
    $('#download-btn').click(function() {
        const img = document.getElementById('barcode-image');
        const link = document.createElement('a');
        link.download = `barcode_${selectedProduct.sku}.png`;
        link.href = img.src;
        link.click();
    });
    
    // Ø¯ÙˆØ§Ù„ JavaScript
    function loadStats() {
        fetch('/barcode/stats?format=json')
            .then(response => response.json())
            .then(data => {
                console.log('Stats data received:', data);
                $('#total-products').text(data.total_products || 0);
                $('#products-with-barcode').text(data.products_with_barcode || 0);
                $('#products-without-barcode').text(data.products_without_barcode || 0);
                $('#barcode-percentage').text((data.barcode_percentage || 0) + '%');
            })
            .catch(error => {
                console.error('Error loading stats:', error);
                // ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£
                $('#total-products').text('0');
                $('#products-with-barcode').text('0');
                $('#products-without-barcode').text('0');
                $('#barcode-percentage').text('0%');
            });
    }
    
    function loadWarehouses() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ù…Ù† API
        fetch('/barcode/warehouses')
            .then(response => response.json())
            .then(data => {
                const select = $('#warehouse-select');
                select.empty().append('<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</option>');
                if (data.success && data.warehouses && Array.isArray(data.warehouses)) {
                    console.log(`âœ… [Warehouses] ØªÙ… Ø¬Ù„Ø¨ ${data.warehouses.length} Ù…Ø³ØªÙˆØ¯Ø¹`);
                    data.warehouses.forEach(warehouse => {
                        const typeName = getWarehouseTypeName(warehouse.type);
                        select.append(`<option value="${warehouse.id}" data-type="${warehouse.type}">${warehouse.name} (${typeName})</option>`);
                    });
                } else {
                    console.warn('âš ï¸ [Warehouses] Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª');
                }
            })
            .catch(error => {
                console.error('âŒ [Warehouses] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª:', error);
            });
    }
    
    function loadPartners() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ù…Ø¹ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©
        fetch('/api/partners')
            .then(response => response.json())
            .then(data => {
                const select = $('#partner-select');
                select.empty().append('<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙŠÙƒ</option>');
                if (data.success && data.partners) {
                    console.log(`âœ… [Partners] ØªÙ… Ø¬Ù„Ø¨ ${data.count} Ø´Ø±ÙŠÙƒ`);
                    data.partners.forEach(partner => {
                        const shareText = partner.share_percentage ? ` (Ù†Ø³Ø¨Ø©: ${partner.share_percentage}%)` : '';
                        select.append(`<option value="${partner.id}" data-share="${partner.share_percentage}">${partner.name}${shareText}</option>`);
                    });
                } else {
                    console.warn('âš ï¸ [Partners] Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ø±ÙƒØ§Ø¡');
                }
            })
            .catch(error => {
                console.error('âŒ [Partners] Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡:', error);
            });
    }
    
    function loadSuppliers() {
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
        fetch('/api/suppliers')
            .then(response => response.json())
            .then(data => {
                const select = $('#supplier-select');
                select.empty().append('<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</option>');
                if (data.success && data.suppliers) {
                    data.suppliers.forEach(supplier => {
                        select.append(`<option value="${supplier.id}">${supplier.name}</option>`);
                    });
                }
            })
            .catch(error => console.error('Error loading suppliers:', error));
    }
    
    function getWarehouseTypeName(type) {
        const typeNames = {
            'MAIN': 'Ø±Ø¦ÙŠØ³ÙŠ',
            'PARTNER': 'Ø´Ø±ÙŠÙƒ',
            'EXCHANGE': 'ØªØ¨Ø§Ø¯Ù„',
            'ONLINE': 'Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†',
            'INVENTORY': 'Ù…Ù„ÙƒÙŠØ© ÙƒØ§Ù…Ù„Ø©'
        };
        return typeNames[type] || type;
    }
    
    function showDynamicFields(warehouseType) {
        const container = $('#dynamic-fields-container');
        const partnerFields = $('#partner-fields');
        const supplierFields = $('#supplier-fields');
        
        // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
        partnerFields.hide();
        supplierFields.hide();
        $('#partner-select').prop('required', false);
        $('#supplier-select').prop('required', false);
        
        console.log(`ğŸ” [Dynamic Fields] Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹: ${warehouseType}`);
        
        if (warehouseType === 'PARTNER') {
            partnerFields.show();
            $('#partner-select').prop('required', true);
            container.show();
            console.log('âœ… [Dynamic Fields] Ù…Ø³ØªÙˆØ¯Ø¹ Ø´Ø±ÙŠÙƒ - Ø­Ù‚Ù„ Ø§Ù„Ø´Ø±ÙŠÙƒ Ù…ÙØ¹Ù‘Ù„');
        } else if (warehouseType === 'EXCHANGE') {
            supplierFields.show();
            $('#supplier-select').prop('required', true);
            container.show();
            console.log('âœ… [Dynamic Fields] Ù…Ø³ØªÙˆØ¯Ø¹ ØªØ¨Ø§Ø¯Ù„ - Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ Ù…ÙØ¹Ù‘Ù„');
        } else {
            container.hide();
            console.log('â„¹ï¸ [Dynamic Fields] Ù…Ø³ØªÙˆØ¯Ø¹ Ø¹Ø§Ø¯ÙŠ - Ù„Ø§ Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ©');
        }
    }
    
    function hideDynamicFields() {
        $('#dynamic-fields-container').hide();
        $('#partner-fields').hide();
        $('#supplier-fields').hide();
        $('#partner-select').prop('required', false);
        $('#supplier-select').prop('required', false);
        currentWarehouseType = null;
    }
    
    function checkProductStock() {
        const barcode = $('#inventory-barcode').val().trim();
        const warehouseId = $('#warehouse-select').val();
        
        if (barcode && warehouseId) {
            fetch(`/barcode/check-product?barcode=${encodeURIComponent(barcode)}&warehouse_id=${warehouseId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.exists) {
                        showCurrentStock(data.product);
                    } else {
                        hideCurrentStock();
                    }
                })
                .catch(error => {
                    console.error('Error checking product stock:', error);
                    hideCurrentStock();
                });
        } else {
            hideCurrentStock();
        }
    }
    
    function showCurrentStock(product) {
        const stockInfo = $('#current-stock-info');
        const stockText = $('#current-stock-text');
        
        stockText.html(`
            <strong>${product.name}</strong><br>
            <small>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span class="badge bg-light text-dark">${product.current_quantity}</span></small>
        `);
        
        stockInfo.show();
        $('#update-inventory-btn').prop('disabled', false);
    }
    
    function hideCurrentStock() {
        $('#current-stock-info').hide();
        $('#update-inventory-btn').prop('disabled', true);
    }
    
    function checkQuantityWarning() {
        const quantity = parseInt($('#quantity-change').val()) || 0;
        const operation = $('#operation-type').val();
        const currentStock = parseInt($('#current-stock-text .badge').text()) || 0;
        
        const warningDiv = $('#quantity-warning');
        const warningText = $('#warning-text');
        
        if (operation === 'subtract' && quantity > currentStock) {
            warningText.html(`ØªØ­Ø°ÙŠØ±: Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${quantity}) Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ØªØ§Ø­ (${currentStock})! Ø³ÙŠØ¤Ø¯ÙŠ Ù„Ø±ØµÙŠØ¯ Ø³Ø§Ù„Ø¨!`);
            warningDiv.show();
        } else if (operation === 'adjust' && quantity > currentStock + 100) {
            warningText.html(`Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ØªØ³ÙˆÙŠØ© Ø³ØªØ¶ÙŠÙ ${quantity - currentStock} Ù‚Ø·Ø¹Ø© Ù„Ù„Ù…Ø®Ø²ÙˆÙ†`);
            warningDiv.show();
        } else {
            warningDiv.hide();
        }
    }
    
    function scanBarcode(barcode) {
        fetch('/barcode/scan', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ barcode: barcode })
        })
        .then(response => response.json())
        .then(data => {
            if (data.found) {
                showProductInfo(data.product);
            } else {
                showScanError(data.message);
            }
        })
        .catch(error => {
            showScanError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø³Ø­');
            console.error('Error:', error);
        });
    }
    
    function showProductInfo(product) {
        const productInfo = `
            <div class="row">
                <div class="col-md-3">
                    <img src="${product.image || '/static/products/default.png'}" 
                         class="img-fluid" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">
                </div>
                <div class="col-md-9">
                    <h6><strong>${product.name}</strong></h6>
                    <p><strong>SKU:</strong> ${product.sku}</p>
                    <p><strong>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</strong> ${product.barcode || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    <p><strong>Ø§Ù„Ù…Ø§Ø±ÙƒØ©:</strong> ${product.brand || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    <p><strong>Ø§Ù„ÙØ¦Ø©:</strong> ${product.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    <p><strong>Ø§Ù„Ø³Ø¹Ø±:</strong> ${product.selling_price} Ø´ÙŠÙƒÙ„</p>
                    <p><strong>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${product.total_stock}</p>
                </div>
            </div>
        `;
        
        $('#product-info').html(productInfo);
        $('#scan-results').show();
        $('#scan-error').hide();
    }
    
    function showScanError(message) {
        $('#error-message').text(message);
        $('#scan-error').show();
        $('#scan-results').hide();
    }
    
    function searchProducts(query) {
        fetch(`/barcode/search?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                const results = $('#search-results');
                results.empty();
                
                if (data.products.length === 0) {
                    results.html('<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>');
                    return;
                }
                
                data.products.forEach(product => {
                    const productItem = $(`
                        <div class="search-result-item border-bottom p-2 cursor-pointer" 
                             data-product='${JSON.stringify(product)}'>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>${product.name}</strong><br>
                                    <small class="text-muted">SKU: ${product.sku} | Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${product.total_stock}</small>
                                </div>
                                <div>
                                    <span class="badge ${product.has_barcode ? 'badge-success' : 'badge-warning'}">
                                        ${product.has_barcode ? 'Ù„Ù‡ Ø¨Ø§Ø±ÙƒÙˆØ¯' : 'Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø±ÙƒÙˆØ¯'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    `);
                    
                    productItem.click(function() {
                        selectedProduct = product;
                        $('#product-search').val(product.name);
                        $('#generate-btn').prop('disabled', false);
                        results.empty();
                        updateBulkProductsList();
                    });
                    
                    results.append(productItem);
                });
            })
            .catch(error => console.error('Error searching products:', error));
    }
    
    function generateBarcode(productId, barcodeType) {
        fetch('/barcode/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ 
                product_id: productId, 
                type: barcodeType 
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                $('#barcode-image').attr('src', data.image);
                $('#barcode-preview').show();
            } else {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: ' + data.error);
            }
        })
        .catch(error => {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯');
            console.error('Error:', error);
        });
    }
    
    function updateInventory() {
        const barcode = $('#inventory-barcode').val().trim();
        const warehouseId = $('#warehouse-select').val();
        const quantityChange = parseInt($('#quantity-change').val());
        const operation = $('#operation-type').val();
        
        if (!barcode || !warehouseId) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹', 'error');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        if (currentWarehouseType === 'PARTNER') {
            const partnerId = $('#partner-select').val();
            if (!partnerId) {
                showNotification('Ù…Ø³ØªÙˆØ¯Ø¹ Ø´Ø±ÙŠÙƒ: ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø±ÙŠÙƒ!', 'error');
                $('#partner-select').focus();
                return;
            }
        } else if (currentWarehouseType === 'EXCHANGE') {
            const supplierId = $('#supplier-select').val();
            if (!supplierId) {
                showNotification('Ù…Ø³ØªÙˆØ¯Ø¹ ØªØ¨Ø§Ø¯Ù„: ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ±Ø¯/Ø§Ù„ØªØ§Ø¬Ø±!', 'error');
                $('#supplier-select').focus();
                return;
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const requestData = {
            barcode: barcode,
            warehouse_id: warehouseId,
            quantity_change: quantityChange,
            operation: operation
        };
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ©
        if (currentWarehouseType === 'PARTNER') {
            requestData.partner_id = $('#partner-select').val();
        } else if (currentWarehouseType === 'EXCHANGE') {
            requestData.supplier_id = $('#supplier-select').val();
        }
        
        console.log('ğŸ“¦ [Inventory Update] Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©:', requestData);
        
        // Ø¥Ø¸Ù‡Ø§Ø± loading
        $('#update-inventory-btn').prop('disabled', true).html('<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...');
        
        fetch('/barcode/inventory/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­. Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: ${data.new_quantity}`, 'success');
                $('#inventory-barcode').val('');
                $('#quantity-change').val(0);
                $('#current-stock-info').hide();
                $('#quantity-warning').hide();
            } else {
                showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ' + data.error, 'error');
            }
        })
        .catch(error => {
            showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†', 'error');
            console.error('Error:', error);
        })
        .finally(() => {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø²Ø±
            $('#update-inventory-btn').prop('disabled', false).html('<i class="fas fa-sync ml-1"></i> ØªØ­Ø¯ÙŠØ«');
        });
    }
    
    function showNotification(message, type = 'info') {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… SweetAlert Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
        if (typeof Swal !== 'undefined') {
            const icon = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            Swal.fire({
                icon: icon,
                title: type === 'success' ? 'Ù†Ø¬Ø­' : type === 'error' ? 'Ø®Ø·Ø£' : 'ØªÙ†Ø¨ÙŠÙ‡',
                text: message,
                timer: 3000,
                showConfirmButton: false
            });
        } else {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… alert ÙƒØ¨Ø¯ÙŠÙ„
            alert(message);
        }
    }
    
    function clearBulkSelection() {
        bulkProducts = [];
        updateBulkProductsList();
        $('#clear-selection-btn').prop('disabled', true);
        $('#bulk-generate-btn').prop('disabled', true);
        $('#preview-bulk-btn').prop('disabled', true);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
    function updatePartnerInfoIndex() {
        const select = document.getElementById('partner-select');
        const selectedOption = select.options[select.selectedIndex];
        
        if (selectedOption && selectedOption.value) {
            const share = selectedOption.dataset.share || 0;
            const phone = selectedOption.dataset.phone || '';
            const email = selectedOption.dataset.email || '';
            const balance = selectedOption.dataset.balance || 0;
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©
            document.getElementById('partner-share-index').value = share;
            
            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ
            const partnerDetails = document.getElementById('partner-details-index');
            partnerDetails.innerHTML = `
                <div>
                    <strong>Ø§Ù„Ø´Ø±ÙŠÙƒ:</strong> ${selectedOption.text}<br>
                    ${phone ? `<strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone}<br>` : ''}
                    ${email ? `<strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${email}<br>` : ''}
                    <strong>Ø§Ù„Ø±ØµÙŠØ¯:</strong> ${balance} Ø´ÙŠÙƒÙ„
                </div>
            `;
            document.getElementById('partner-info-index').style.display = 'block';
            
            console.log(`âœ… [Partner Info] Ø§Ù„Ø´Ø±ÙŠÙƒ: ${selectedOption.text}, Ù†Ø³Ø¨Ø©: ${share}%`);
        } else {
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            document.getElementById('partner-share-index').value = 0;
            document.getElementById('partner-info-index').style.display = 'none';
        }
    }
    
    function updateBulkProductsList() {
        const list = $('#bulk-products-list');
        list.empty();
        
        if (bulkProducts.length === 0) {
            list.html('<p class="text-muted">Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>');
            $('#bulk-generate-btn').prop('disabled', true);
            return;
        }
        
        bulkProducts.forEach((product, index) => {
            const item = $(`
                <div class="d-flex justify-content-between align-items-center border-bottom p-2">
                    <div>
                        <strong>${product.name}</strong><br>
                        <small class="text-muted">SKU: ${product.sku}</small>
                    </div>
                    <button class="btn btn-sm btn-danger" onclick="removeBulkProduct(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `);
            list.append(item);
        });
        
        $('#bulk-generate-btn').prop('disabled', false);
    }
    
    function removeBulkProduct(index) {
        bulkProducts.splice(index, 1);
        updateBulkProductsList();
    }
    
    function bulkGenerateBarcodes() {
        if (bulkProducts.length === 0) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const productIds = bulkProducts.map(p => p.id);
        const barcodeType = $('#bulk-barcode-type').val();
        
        fetch('/barcode/bulk-generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                product_ids: productIds,
                type: barcodeType
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showBulkResults(data.barcodes);
            } else {
                alert('Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª: ' + data.error);
            }
        })
        .catch(error => {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª');
            console.error('Error:', error);
        });
    }
    
    function showBulkResults(barcodes) {
        const grid = $('#bulk-barcodes-grid');
        grid.empty();
        
        barcodes.forEach(barcode => {
            const item = $(`
                <div class="col-md-3 mb-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <img src="${barcode.image}" class="img-fluid mb-2" style="max-height: 100px;">
                            <h6>${barcode.product_name}</h6>
                            <small class="text-muted">${barcode.sku}</small>
                        </div>
                    </div>
                </div>
            `);
            grid.append(item);
        });
        
        $('#bulk-results').show();
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
    window.addToBulkList = function(product) {
        if (!bulkProducts.find(p => p.id === product.id)) {
            bulkProducts.push(product);
            updateBulkProductsList();
        }
    };
    
    // Ø¥Ø²Ø§Ù„Ø© Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
    window.removeBulkProduct = removeBulkProduct;
    
    // Ø²Ø± Ø¥Ø¹Ø·Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ
    $('#auto-assign-btn').click(function(e) {
        e.preventDefault();
        
        if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø·Ø§Ø¡ Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙØ±ÙŠØ¯ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨Ø§Ø±ÙƒÙˆØ¯ØŸ')) {
            const btn = $(this);
            const originalText = btn.html();
            btn.html('<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...');
            btn.prop('disabled', true);
            
            fetch('/barcode/auto-assign', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    loadStats(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                } else {
                    alert('Ø®Ø·Ø£: ' + data.error);
                }
            })
            .catch(error => {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª');
                console.error('Error:', error);
            })
            .finally(() => {
                btn.html(originalText);
                btn.prop('disabled', false);
            });
        }
    });
    
    // âš¡ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙŠØªÙŠÙ…Ø©
    
    // 1. Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
    $('#create-product-btn').click(function() {
        const barcode = $('#scan-input').val() || '';
        if (barcode) {
            window.open(`/products/new?barcode=${encodeURIComponent(barcode)}`, '_blank');
        } else {
            window.open('/products/new', '_blank');
        }
    });
    
    // 2. Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„
    $('#download-all-btn').click(function() {
        const barcodes = document.querySelectorAll('#bulk-barcodes-grid img');
        if (barcodes.length === 0) {
            alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù„ØªØ­Ù…ÙŠÙ„Ù‡Ø§');
            return;
        }
        
        barcodes.forEach((img, index) => {
            const link = document.createElement('a');
            link.href = img.src;
            link.download = `barcode_${index + 1}.png`;
            link.click();
        });
        
        alert(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${barcodes.length} Ø¨Ø§Ø±ÙƒÙˆØ¯`);
    });
    
    // 3. Ø²Ø± Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙƒÙ„
    $('#print-all-btn').click(function() {
        const bulkResults = document.getElementById('bulk-results');
        if (!bulkResults || bulkResults.style.display === 'none') {
            alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©');
            return;
        }
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø© Ù„Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
        const printWindow = window.open('', '', 'width=800,height=600');
        const bulkGrid = document.getElementById('bulk-barcodes-grid').cloneNode(true);
        
        printWindow.document.write(`
            <html dir="rtl">
            <head>
                <title>Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯Ø§Øª</title>
                <style>
                    body { font-family: Arial; padding: 20px; }
                    .row { display: flex; flex-wrap: wrap; }
                    .col-md-3 { width: 25%; padding: 10px; }
                    .card { border: 1px solid #ddd; text-align: center; }
                    img { max-width: 100%; }
                    @media print { 
                        .no-print { display: none; }
                        .col-md-3 { page-break-inside: avoid; }
                    }
                </style>
            </head>
            <body>
                ${bulkGrid.outerHTML}
                <button class="no-print" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button>
            </body>
            </html>
        `);
        
        printWindow.document.close();
        setTimeout(() => printWindow.print(), 500);
    });
    
    // 4. Ø²Ø± ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ø±ÙƒÙˆØ¯ (ÙÙŠ modal)
    $(document).on('click', '#modal-generate-btn', function() {
        generateMultipleBarcodes();
    });
});
</script>
{% endblock %}