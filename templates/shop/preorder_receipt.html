{% extends 'shop/base.html' %}
{% block title %}وصل الطلب #{{ preorder.order_number }}{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/shop.css') }}">
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0">وصل الطلب</h5>
        <span class="badge bg-{{ 'success' if preorder.status=='FULFILLED' else 'warning' if preorder.status=='CONFIRMED' else 'info' if preorder.status=='PENDING' else 'danger' }}">
          {{ 'مكتمل' if preorder.status=='FULFILLED' else 'مؤكد' if preorder.status=='CONFIRMED' else 'قيد الانتظار' if preorder.status=='PENDING' else 'ملغي' }}
        </span>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- تفاصيل الطلب -->
          <div class="col-md-6 mb-3">
            <h6>تفاصيل الطلب</h6>
            <ul class="list-unstyled">
              <li><strong>رقم الطلب:</strong> {{ preorder.order_number }}</li>
              <li><strong>التاريخ:</strong> {{ preorder.created_at.strftime('%Y-%m-%d %H:%M') if preorder.created_at else '' }}</li>
              <li><strong>الحالة:</strong>
                {{ 'مكتمل' if preorder.status=='FULFILLED'
                   else 'مؤكد' if preorder.status=='CONFIRMED'
                   else 'قيد الانتظار' if preorder.status=='PENDING'
                   else 'ملغي' }}
              </li>
            </ul>
          </div>

          <!-- تفاصيل الزبون -->
          <div class="col-md-6 mb-3">
            <h6>تفاصيل الزبون</h6>
            <ul class="list-unstyled">
              <li><strong>الاسم:</strong> {{ preorder.customer.name if preorder.customer else '' }}</li>
              <li><strong>الهاتف:</strong> {{ preorder.customer.phone if preorder.customer else '' }}</li>
              <li><strong>البريد:</strong> {{ preorder.customer.email if preorder.customer else '' }}</li>
            </ul>
          </div>
        </div>

        <hr>

        <!-- المنتجات -->
        <h6 class="mb-3">المنتجات</h6>
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead><tr><th>المنتج</th><th class="text-center">الكمية</th><th class="text-end">السعر</th><th class="text-end">الإجمالي</th></tr></thead>
            <tbody>
              {% for item in preorder.items %}
              <tr>
                <td>{{ item.product.name }}</td>
                <td class="text-center">{{ item.quantity }}</td>
                <td class="text-end">{{ '%.2f'|format(item.price or 0) }}</td>
                <td class="text-end">{{ '%.2f'|format((item.quantity or 0) * (item.price or 0)) }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="row mt-3">
          <div class="col-md-6">
            <div class="alert alert-info">
              <div class="d-flex justify-content-between">
                <span>المبلغ المطلوب كعربون:</span>
                <span class="fw-bold">{{ '%.2f'|format(preorder.prepaid_amount or 0) }} شيكل</span>
              </div>
              <small class="d-block text-muted mt-1">(لا يقل عن 20% من إجمالي قيمة الطلب)</small>
            </div>
          </div>
          <div class="col-md-6 text-end">
            <p><strong>المجموع الكلي: </strong> {{ '%.2f'|format(preorder.total_amount or 0) }} شيكل</p>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-between">
      <a href="{{ url_for('shop.preorder_list') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-right me-2"></i> الرجوع لقائمة الطلبات
      </a>
      <button onclick="window.print()" class="btn btn-primary">
        <i class="fas fa-print me-2"></i> طباعة الوصل
      </button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
{% endblock %}
