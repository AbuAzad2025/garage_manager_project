{% extends 'auth/auth_base.html' %}

{% block title %}طلب إعادة تعيين كلمة المرور - Azad{% endblock %}
{% block title_text %}طلب إعادة تعيين كلمة المرور{% endblock %}

{% block content %}
  {% set messages = get_unique_flashes() %}
  {% if messages %}
    <div class="mb-3">
      {% for category, msg in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ msg }}
          <button type="button" class="close" data-dismiss="alert" aria-label="إغلاق">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <form class="auth-form" method="post" action="{{ url_for('auth.customer_password_reset_request') }}" novalidate>
    {{ form.hidden_tag() }}

    <div class="mb-3">
      {{ form.email.label(class="form-label") }}
      {{ form.email(class="form-control", type="email", placeholder="أدخل بريدك الإلكتروني", autocomplete="email", required=True) }}
      {% for error in form.email.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
    </div>

    {{ form.submit(class="btn btn-primary w-100") }}
  </form>

  <div class="mt-3 text-center">
    <a href="{{ url_for('auth.login') }}" class="btn btn-outline-secondary btn-sm">
      <i class="fas fa-arrow-left"></i> العودة لتسجيل الدخول
    </a>
  </div>
{% endblock %}

{% block scripts %}
<script>
(function() {
  const emailInput = document.querySelector('input[type="email"]');
  if (emailInput) {
    emailInput.addEventListener('blur', function() {
      const email = this.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      var existingFeedback = this.parentElement.querySelector('.email-validation-feedback');
      if (existingFeedback) {
        existingFeedback.remove();
      }
      
      if (email && !emailRegex.test(email)) {
        var feedback = document.createElement('small');
        feedback.className = 'email-validation-feedback text-danger d-block mt-1';
        feedback.textContent = 'البريد الإلكتروني غير صحيح';
        this.parentElement.appendChild(feedback);
      }
    });
  }
})();
</script>
{% endblock %}
