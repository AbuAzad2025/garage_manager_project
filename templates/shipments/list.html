{% extends 'warehouses/base.html' %}
{% block title %}شحنات {{ warehouse.name }}{% endblock %}

{% block warehouses_content %}
  <div class="mb-3 d-flex justify-content-between align-items-center">
    <h3 class="mb-0">الشحنات في {{ warehouse.name }}</h3>
    <a id="addShipmentBtn"
       href="{{ url_for('warehouses.create_warehouse_shipment', warehouse_id=warehouse.id) }}"
       class="btn btn-success btn-sm">
      <i class="fa fa-plus"></i> إضافة شحنة
    </a>
  </div>

  <table id="shipmentTable" class="table table-striped table-hover">
    <thead class="table-light">
      <tr>
        <th>#</th><th>رقم الشحنة</th><th>تاريخ</th><th>الحالة</th><th>إجراءات</th>
      </tr>
    </thead>
    <tbody>
      {% for sh in shipments %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ sh.shipment_number }}</td>
          <td>{{ sh.shipment_date and sh.shipment_date.strftime('%Y-%m-%d') }}</td>
          <td>{{ sh.status }}</td>
          <td>
            <a href="{{ url_for('warehouses.view_warehouse_shipment', shipment_id=sh.id) }}"
               class="btn btn-sm btn-outline-info"><i class="fa fa-eye"></i></a>
            <a href="{{ url_for('warehouses.edit_warehouse_shipment', shipment_id=sh.id) }}"
               class="btn btn-sm btn-outline-secondary editShipmentBtn">
              <i class="fa fa-pencil-alt"></i>
            </a>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="5" class="text-center text-muted">لا توجد شحنات</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Modal -->
  <div class="modal fade" id="shipmentModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg"><div class="modal-content"></div></div>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    $(function(){
      $('#shipmentTable').DataTable({
        responsive: true,
        language:{url:'//cdn.datatables.net/plug-ins/1.10.25/i18n/Arabic.json'}
      });
      $('#addShipmentBtn').on('click', function(e){
        e.preventDefault();
        $('#shipmentModal .modal-content').load(this.href, ()=>$('#shipmentModal').modal('show'));
      });
      $('#shipmentTable').on('click','.editShipmentBtn',function(e){
        e.preventDefault();
        $('#shipmentModal .modal-content').load(this.href, ()=>$('#shipmentModal').modal('show'));
      });
    });
  </script>
{% endblock %}
