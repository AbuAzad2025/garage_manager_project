{% extends 'base.html' %}
{% block title %}تفاصيل الشحنة{% endblock %}
{% block page_header %}تفاصيل الشحنة{% endblock %}
{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('shipments.list_shipments') }}">الشحنات</a></li>
<li class="breadcrumb-item active">{{ shipment.shipment_number }}</li>
{% endblock %}

{% block content %}
<div class="card">
  <div class="card-body">
    <dl class="row">
      <dt class="col-sm-3">رقم الشحنة</dt><dd class="col-sm-9">{{ shipment.shipment_number }}</dd>
      <dt class="col-sm-3">من</dt><dd class="col-sm-9">{{ shipment.origin }}</dd>
      <dt class="col-sm-3">إلى</dt><dd class="col-sm-9">{{ shipment.destination }}</dd>
      <dt class="col-sm-3">الحالة</dt><dd class="col-sm-9">{{ shipment.status }}</dd>
      <dt class="col-sm-3">تاريخ الشحن</dt><dd class="col-sm-9">{{ shipment.shipment_date }}</dd>
      <dt class="col-sm-3">متوقع وصوله</dt><dd class="col-sm-9">{{ shipment.expected_arrival }}</dd>
      <dt class="col-sm-3">الوصول الفعلي</dt><dd class="col-sm-9">{{ shipment.actual_arrival or '-' }}</dd>
      <dt class="col-sm-3">قيمة البضائع</dt><dd class="col-sm-9">{{ format_currency(shipment.value_before) }}</dd>
      <dt class="col-sm-3">تكلفة الشحن</dt><dd class="col-sm-9">{{ format_currency(shipment.shipping_cost) }}</dd>
      <dt class="col-sm-3">جمارك</dt><dd class="col-sm-9">{{ format_currency(shipment.customs) }}</dd>
      <dt class="col-sm-3">VAT</dt><dd class="col-sm-9">{{ format_currency(shipment.vat) }}</dd>
      <dt class="col-sm-3">تأمين</dt><dd class="col-sm-9">{{ format_currency(shipment.insurance) }}</dd>
      <dt class="col-sm-3">الإجمالي</dt><dd class="col-sm-9">{{ format_currency(shipment.total_value) }}</dd>
      <dt class="col-sm-3">الملاحظات</dt><dd class="col-sm-9">{{ shipment.notes or '-' }}</dd>
    </dl>

    <hr>
    <h5>العناصر</h5>
    <table class="table table-sm">
      <thead>
        <tr><th>المنتج</th><th>المستودع</th><th>الكمية</th><th>التكلفة</th></tr>
      </thead>
      <tbody>
        {% for i in shipment.items %}
        <tr>
          <td>{{ i.product.name }}</td>
          <td>{{ i.warehouse.name }}</td>
          <td>{{ i.quantity }}</td>
          <td>{{ format_currency(i.unit_cost) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <h5>الشركاء</h5>
    <ul>
      {% for p in shipment.partner_links %}
      <li>{{ p.partner.name }} – {{ p.share_percentage }}% = {{ format_currency(p.share_amount) }}</li>
      {% endfor %}
    </ul>

    <hr>
    <a href="{{ url_for('shipments.shipment_payments', id=shipment.id) }}" class="btn btn-outline-success">
      عرض الدفعات ({{ format_currency(total_paid) }})
    </a>
    <a href="{{ url_for('shipments.pay_customs', id=shipment.id) }}" class="btn btn-outline-primary">دفع جمارك</a>
  </div>
</div>
{% endblock %}
