{% extends "base.html" %}

{% block title %}Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="card shadow-sm mb-4">
        <div class="card-body bg-gradient-primary text-white">
            <div class="row align-items-center">
                <div class="col-auto">
                    <i class="fas fa-book fa-3x opacity-75"></i>
                </div>
                <div class="col">
                    <h2 class="mb-1">ğŸ“š Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©</h2>
                    <p class="mb-0 opacity-90">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… - Ø´Ø±Ø­ Ù…Ø¨Ø³Ø·</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø´Ø±Ø­ Ù…Ø¨Ø³Ø· Ù…Ø¹ Ø£Ù…Ø«Ù„Ø© -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-primary border-0 shadow-sm">
                <h5 class="mb-3"><i class="fas fa-graduation-cap"></i> Ø´Ø±Ø­ Ù…Ø¨Ø³Ø· - Ø¯Ù„ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:</h5>
                <p class="mb-3"><strong>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©</strong> Ù‡ÙŠ Ù…Ø«Ù„ "Ø£Ø¯Ø±Ø§Ø¬" ÙÙŠ Ø®Ø²Ø§Ù†Ø© Ù„ØªÙ†Ø¸ÙŠÙ… Ø£Ù…ÙˆØ§Ù„Ùƒ. ÙƒÙ„ "Ø¯Ø±Ø¬" Ù„Ù‡ Ø§Ø³Ù… ÙˆØ±Ù‚Ù…:</p>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <h6 class="text-primary"><i class="fas fa-wallet"></i> ğŸ’° Ø§Ù„Ø£ØµÙˆÙ„ (Ù…Ø§ ØªÙ…Ù„ÙƒÙ‡)</h6>
                                <p class="small mb-2">ÙƒÙ„ Ø´ÙŠØ¡ Ø¹Ù†Ø¯Ùƒ Ù„Ù‡ Ù‚ÙŠÙ…Ø©:</p>
                                <ul class="small mb-0">
                                    <li>Ø§Ù„Ù†Ù‚Ø¯ÙŠØ© ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ ÙˆØ§Ù„Ø¨Ù†Ùƒ</li>
                                    <li>Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù† (Ù‚Ø·Ø¹ ØºÙŠØ§Ø±ØŒ Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª)</li>
                                    <li>Ø§Ù„Ø´ÙŠÙƒØ§Øª Ø§Ù„Ù„ÙŠ Ø¨ØªØ­ØµÙ„Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</li>
                                    <li>Ø§Ù„Ù…Ø¹Ø¯Ø§Øª ÙˆØ§Ù„Ø£Ø«Ø§Ø«</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100 border-danger">
                            <div class="card-body">
                                <h6 class="text-danger"><i class="fas fa-file-invoice-dollar"></i> ğŸ“Š Ø§Ù„Ø®ØµÙˆÙ… (Ù…Ø§ Ø¹Ù„ÙŠÙƒ)</h6>
                                <p class="small mb-2">ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ùƒ:</p>
                                <ul class="small mb-0">
                                    <li>Ø§Ù„Ø¯ÙŠÙˆÙ† Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Ø¨Ø¶Ø§Ø¹Ø© Ø§Ø´ØªØ±ÙŠØªÙ‡Ø§ Ø¨Ø§Ù„Ø¢Ø¬Ù„)</li>
                                    <li>Ø§Ù„Ø´ÙŠÙƒØ§Øª Ø§Ù„Ù„ÙŠ Ø£Ø¹Ø·ÙŠØªÙ‡Ø§ Ù„Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</li>
                                    <li>Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</li>
                                    <li>Ø§Ù„Ù‚Ø±ÙˆØ¶</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-secondary">
                            <div class="card-body">
                                <h6 class="text-secondary"><i class="fas fa-landmark"></i> ğŸ¦ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</h6>
                                <p class="small mb-2">Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„:</p>
                                <ul class="small mb-0">
                                    <li>Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù„ÙŠ Ø¨Ø¯ÙŠØª ÙÙŠÙ‡</li>
                                    <li>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø­ØªØ¬Ø²Ø©</li>
                                    <li>Ø­ØµØµ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <h6 class="text-success"><i class="fas fa-arrow-circle-down"></i> ğŸ“ˆ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (Ù…Ø§ ÙŠØ¯Ø®Ù„)</h6>
                                <p class="small mb-2">Ø§Ù„Ø¯Ø®Ù„:</p>
                                <ul class="small mb-0">
                                    <li>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©</li>
                                    <li>Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</li>
                                    <li>Ø£Ø±Ø¨Ø§Ø­ Ø£Ø®Ø±Ù‰</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <h6 class="text-warning"><i class="fas fa-arrow-circle-up"></i> ğŸ“‰ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ (Ù…Ø§ ÙŠØ®Ø±Ø¬)</h6>
                                <p class="small mb-2">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ:</p>
                                <ul class="small mb-0">
                                    <li>Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</li>
                                    <li>Ø¥ÙŠØ¬Ø§Ø±ØŒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ Ù…Ø§Ø¡</li>
                                    <li>Ø¨Ù†Ø²ÙŠÙ†ØŒ ØµÙŠØ§Ù†Ø©</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-light mt-3 mb-0">
                    <strong><i class="fas fa-lightbulb text-warning"></i> Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÙŠ:</strong>
                    Ø¹Ù†Ø¯Ù…Ø§ ØªØ¨ÙŠØ¹ Ø¨Ø¶Ø§Ø¹Ø© Ø¨Ù€ 1000 â‚ª:
                    <ul class="mb-0 mt-2">
                        <li>âœ… <strong>Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ (Ø£ØµÙ„)</strong> ÙŠØ²ÙŠØ¯ +1000 â‚ª</li>
                        <li>âœ… <strong>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø¥ÙŠØ±Ø§Ø¯)</strong> ØªØ³Ø¬Ù„ +1000 â‚ª</li>
                        <li>âœ… <strong>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ø£ØµÙ„)</strong> ÙŠÙ†Ù‚Øµ -600 â‚ª (Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©)</li>
                        <li>âœ… <strong>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© (Ù…ØµØ±ÙˆÙ)</strong> ØªØ³Ø¬Ù„ +600 â‚ª</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="row mb-4">
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <h3 class="text-primary mb-0" id="asset-count">0</h3>
                    <small class="text-muted">Ø§Ù„Ø£ØµÙˆÙ„</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-danger">
                <div class="card-body text-center">
                    <h3 class="text-danger mb-0" id="liability-count">0</h3>
                    <small class="text-muted">Ø§Ù„Ø®ØµÙˆÙ…</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-secondary">
                <div class="card-body text-center">
                    <h3 class="text-secondary mb-0" id="equity-count">0</h3>
                    <small class="text-muted">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <h3 class="text-success mb-0" id="revenue-count">0</h3>
                    <small class="text-muted">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <h3 class="text-warning mb-0" id="expense-count">0</h3>
                    <small class="text-muted">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <h3 class="text-info mb-0" id="total-count">0</h3>
                    <small class="text-muted">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¨Ø­Ø« -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­Ø³Ø§Ø¨...">
            </div>
        </div>
        <div class="col-md-6">
            <select class="form-select" id="filterType">
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                <option value="ASSET">Ø§Ù„Ø£ØµÙˆÙ„ ÙÙ‚Ø·</option>
                <option value="LIABILITY">Ø§Ù„Ø®ØµÙˆÙ… ÙÙ‚Ø·</option>
                <option value="EQUITY">Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© ÙÙ‚Ø·</option>
                <option value="REVENUE">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ÙÙ‚Ø·</option>
                <option value="EXPENSE">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ ÙÙ‚Ø·</option>
            </select>
        </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="btn-group" role="group">
                <button class="btn btn-outline-primary" onclick="toggleView('grouped')">
                    <i class="fas fa-layer-group"></i> Ø¹Ø±Ø¶ Ù…Ø¬Ù…Ù‘Ø¹
                </button>
                <button class="btn btn-outline-primary" onclick="toggleView('table')">
                    <i class="fas fa-table"></i> Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„
                </button>
                <button class="btn btn-outline-success" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                </button>
                <button class="btn btn-outline-info" onclick="printAccounts()">
                    <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
                </button>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
    <div class="card shadow-sm">
        <div class="card-body">
            <div id="accountsContainer">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    </div>
                    <p class="mt-2 text-muted">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .account-group {
        margin-bottom: 2rem;
    }
    
    .account-group-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .account-group-header h4 {
        margin: 0;
        font-weight: 600;
    }
    
    .account-group-header .badge {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
    }
    
    .account-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 1rem 1.5rem;
        margin-bottom: 0.75rem;
        transition: all 0.3s ease;
        background: white;
    }
    
    .account-item:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        transform: translateX(-3px);
    }
    
    .account-code {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        font-size: 0.95rem;
        color: #667eea;
        min-width: 180px;
        display: inline-block;
    }
    
    .account-name {
        font-weight: 500;
        color: #2d3748;
        font-size: 1rem;
    }
    
    .account-badge {
        font-size: 0.75rem;
        padding: 0.3rem 0.7rem;
        border-radius: 12px;
    }
    
    .badge-ASSET { background: #e3f2fd; color: #1976d2; }
    .badge-LIABILITY { background: #ffebee; color: #c62828; }
    .badge-EQUITY { background: #f3e5f5; color: #7b1fa2; }
    .badge-REVENUE { background: #e8f5e9; color: #388e3c; }
    .badge-EXPENSE { background: #fff3e0; color: #f57c00; }
    
    .account-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        margin-right: 1rem;
    }
    
    .icon-ASSET { background: #e3f2fd; color: #1976d2; }
    .icon-LIABILITY { background: #ffebee; color: #c62828; }
    .icon-EQUITY { background: #f3e5f5; color: #7b1fa2; }
    .icon-REVENUE { background: #e8f5e9; color: #388e3c; }
    .icon-EXPENSE { background: #fff3e0; color: #f57c00; }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #9e9e9e;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
</style>

<script>
let allAccounts = [];

// Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
const typeIcons = {
    'ASSET': 'ğŸ’°',
    'LIABILITY': 'ğŸ“Š',
    'EQUITY': 'ğŸ¦',
    'REVENUE': 'ğŸ“ˆ',
    'EXPENSE': 'ğŸ“‰'
};

// Ø´Ø±Ø­ Ù…Ø¨Ø³Ø· Ù„ÙƒÙ„ Ù†ÙˆØ¹
const typeDescriptions = {
    'ASSET': 'Ø§Ù„Ø£ØµÙˆÙ„ - Ù…Ø§ ØªÙ…Ù„ÙƒÙ‡ (Ù†Ù‚Ø¯ÙŠØ©ØŒ Ø¨Ø¶Ø§Ø¹Ø©ØŒ Ù…Ø¹Ø¯Ø§Øª)',
    'LIABILITY': 'Ø§Ù„Ø®ØµÙˆÙ… - Ù…Ø§ Ø¹Ù„ÙŠÙƒ (Ø¯ÙŠÙˆÙ†ØŒ Ø´ÙŠÙƒØ§Øª ØµØ§Ø¯Ø±Ø©)',
    'EQUITY': 'Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© - Ø±Ø£Ø³ Ø§Ù„Ù…Ø§Ù„ ÙˆØ§Ù„Ø£Ø±Ø¨Ø§Ø­',
    'REVENUE': 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - Ù…Ø§ ÙŠØ¯Ø®Ù„ Ù…Ù† Ù…Ø¨ÙŠØ¹Ø§Øª',
    'EXPENSE': 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ - Ù…Ø§ ÙŠØ®Ø±Ø¬ (Ø±ÙˆØ§ØªØ¨ØŒ Ø¥ÙŠØ¬Ø§Ø±ØŒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡)'
};

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
async function loadAccounts() {
    try {
        const response = await fetch('/ledger/accounts');
        const data = await response.json();
        
        allAccounts = data.accounts || [];
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        updateStats();
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        displayAccounts(allAccounts);
        
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:', error);
        document.getElementById('accountsContainer').innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.
            </div>
        `;
    }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function updateStats() {
    const counts = {
        ASSET: 0,
        LIABILITY: 0,
        EQUITY: 0,
        REVENUE: 0,
        EXPENSE: 0
    };
    
    allAccounts.forEach(acc => {
        if (counts.hasOwnProperty(acc.type)) {
            counts[acc.type]++;
        }
    });
    
    document.getElementById('asset-count').textContent = counts.ASSET;
    document.getElementById('liability-count').textContent = counts.LIABILITY;
    document.getElementById('equity-count').textContent = counts.EQUITY;
    document.getElementById('revenue-count').textContent = counts.REVENUE;
    document.getElementById('expense-count').textContent = counts.EXPENSE;
    document.getElementById('total-count').textContent = allAccounts.length;
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
function displayAccounts(accounts) {
    const container = document.getElementById('accountsContainer');
    
    if (accounts.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>
            </div>
        `;
        return;
    }
    
    // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    const grouped = {};
    accounts.forEach(acc => {
        if (!grouped[acc.type]) {
            grouped[acc.type] = [];
        }
        grouped[acc.type].push(acc);
    });
    
    // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹
    const typeOrder = ['ASSET', 'LIABILITY', 'EQUITY', 'REVENUE', 'EXPENSE'];
    
    let html = '';
    
    typeOrder.forEach(type => {
        if (grouped[type] && grouped[type].length > 0) {
            html += `
                <div class="account-group" data-type="${type}">
                    <div class="account-group-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4>
                                <span class="me-2">${typeIcons[type]}</span>
                                ${typeDescriptions[type]}
                            </h4>
                            <span class="badge bg-white text-dark">${grouped[type].length} Ø­Ø³Ø§Ø¨</span>
                        </div>
                    </div>
                    <div class="account-list">
            `;
            
            grouped[type].forEach(acc => {
                html += `
                    <div class="account-item" data-code="${acc.code}" data-name="${acc.name}">
                        <div class="d-flex align-items-center">
                            <div class="account-icon icon-${acc.type}">
                                ${typeIcons[acc.type]}
                            </div>
                            <div class="flex-grow-1">
                                <div>
                                    <span class="account-code">${acc.code}</span>
                                    <span class="account-name">${acc.name}</span>
                                </div>
                            </div>
                            <span class="account-badge badge-${acc.type}">${acc.type}</span>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
        }
    });
    
    container.innerHTML = html;
}

// Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©
function filterAccounts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filterType = document.getElementById('filterType').value;
    
    let filtered = allAccounts;
    
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    if (filterType !== 'all') {
        filtered = filtered.filter(acc => acc.type === filterType);
    }
    
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø«
    if (searchTerm) {
        filtered = filtered.filter(acc => 
            acc.code.toLowerCase().includes(searchTerm) ||
            acc.name.toLowerCase().includes(searchTerm)
        );
    }
    
    displayAccounts(filtered);
}

// ØªØ¨Ø¯ÙŠÙ„ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¹Ø±Ø¶
let currentView = 'grouped';
function toggleView(viewType) {
    currentView = viewType;
    displayAccounts(allAccounts);
}

// ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
function exportToExcel() {
    let csv = 'Ø§Ù„Ø±Ù…Ø²,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù†ÙˆØ¹\n';
    allAccounts.forEach(acc => {
        csv += `${acc.code},"${acc.name}",${acc.type}\n`;
    });
    
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `Ø¯Ù„ÙŠÙ„_Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
}

// Ø·Ø¨Ø§Ø¹Ø©
function printAccounts() {
    window.print();
}

// Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
document.addEventListener('DOMContentLoaded', function() {
    loadAccounts();
    
    document.getElementById('searchInput').addEventListener('input', filterAccounts);
    document.getElementById('filterType').addEventListener('change', filterAccounts);
});
</script>
{% endblock %}

