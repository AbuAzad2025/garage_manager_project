{% extends "base.html" %}

{% block title %}ุฏููู ุงูุญุณุงุจุงุช{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- ุงูุนููุงู ุงูุฑุฆูุณู -->
    <div class="card shadow-sm mb-4">
        <div class="card-body bg-gradient-primary text-white">
            <div class="row align-items-center">
                <div class="col-auto">
                    <i class="fas fa-book fa-3x opacity-75"></i>
                </div>
                <div class="col">
                    <h2 class="mb-1">๐ ุฏููู ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ</h2>
                    <p class="mb-0 opacity-90">ุฌููุน ุงูุญุณุงุจุงุช ุงููุงููุฉ ูู ุงููุธุงู - ุดุฑุญ ูุจุณุท</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ุดุฑุญ ูุจุณุท ูุน ุฃูุซูุฉ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-primary border-0 shadow-sm">
                <h5 class="mb-3"><i class="fas fa-graduation-cap"></i> ุดุฑุญ ูุจุณุท - ุฏููู ุงูุญุณุงุจุงุช:</h5>
                <p class="mb-3"><strong>ุงูุญุณุงุจุงุช ุงููุญุงุณุจูุฉ</strong> ูู ูุซู "ุฃุฏุฑุงุฌ" ูู ุฎุฒุงูุฉ ูุชูุธูู ุฃููุงูู. ูู "ุฏุฑุฌ" ูู ุงุณู ูุฑูู:</p>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100 border-primary">
                            <div class="card-body">
                                <h6 class="text-primary"><i class="fas fa-wallet"></i> ๐ฐ ุงูุฃุตูู (ูุง ุชูููู)</h6>
                                <p class="small mb-2">ูู ุดูุก ุนูุฏู ูู ูููุฉ:</p>
                                <ul class="small mb-0">
                                    <li>ุงูููุฏูุฉ ูู ุงูุตูุฏูู ูุงูุจูู</li>
                                    <li>ุงูุจุถุงุนุฉ ูู ุงููุฎุฒู (ูุทุน ุบูุงุฑุ ุฅูุณุณูุงุฑุงุช)</li>
                                    <li>ุงูุดููุงุช ุงููู ุจุชุญุตููุง ูู ุงูุนููุงุก</li>
                                    <li>ุงููุนุฏุงุช ูุงูุฃุซุงุซ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100 border-danger">
                            <div class="card-body">
                                <h6 class="text-danger"><i class="fas fa-file-invoice-dollar"></i> ๐ ุงูุฎุตูู (ูุง ุนููู)</h6>
                                <p class="small mb-2">ูู ุดูุก ูุทููุจ ููู:</p>
                                <ul class="small mb-0">
                                    <li>ุงูุฏููู ููููุฑุฏูู (ุจุถุงุนุฉ ุงุดุชุฑูุชูุง ุจุงูุขุฌู)</li>
                                    <li>ุงูุดููุงุช ุงููู ุฃุนุทูุชูุง ููููุฑุฏูู</li>
                                    <li>ุงูุถุฑุงุฆุจ ุงููุณุชุญูุฉ</li>
                                    <li>ุงููุฑูุถ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-secondary">
                            <div class="card-body">
                                <h6 class="text-secondary"><i class="fas fa-landmark"></i> ๐ฆ ุญููู ุงูููููุฉ</h6>
                                <p class="small mb-2">ุฑุฃุณ ุงููุงู:</p>
                                <ul class="small mb-0">
                                    <li>ุฑุฃุณ ุงููุงู ุงููู ุจุฏูุช ููู</li>
                                    <li>ุงูุฃุฑุจุงุญ ุงููุญุชุฌุฒุฉ</li>
                                    <li>ุญุตุต ุงูุดุฑูุงุก</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-success">
                            <div class="card-body">
                                <h6 class="text-success"><i class="fas fa-arrow-circle-down"></i> ๐ ุงูุฅูุฑุงุฏุงุช (ูุง ูุฏุฎู)</h6>
                                <p class="small mb-2">ุงูุฏุฎู:</p>
                                <ul class="small mb-0">
                                    <li>ูุจูุนุงุช ุงูุจุถุงุนุฉ</li>
                                    <li>ุฎุฏูุงุช ุงูุตูุงูุฉ</li>
                                    <li>ุฃุฑุจุงุญ ุฃุฎุฑู</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card h-100 border-warning">
                            <div class="card-body">
                                <h6 class="text-warning"><i class="fas fa-arrow-circle-up"></i> ๐ ุงููุตุงุฑูู (ูุง ูุฎุฑุฌ)</h6>
                                <p class="small mb-2">ุงููุตุงุฑูู:</p>
                                <ul class="small mb-0">
                                    <li>ุฑูุงุชุจ ุงูููุธููู</li>
                                    <li>ุฅูุฌุงุฑุ ููุฑุจุงุกุ ูุงุก</li>
                                    <li>ุจูุฒููุ ุตูุงูุฉ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-light mt-3 mb-0">
                    <strong><i class="fas fa-lightbulb text-warning"></i> ูุซุงู ุนููู:</strong>
                    ุนูุฏูุง ุชุจูุน ุจุถุงุนุฉ ุจู 1000 โช:
                    <ul class="mb-0 mt-2">
                        <li>โ <strong>ุงูุตูุฏูู (ุฃุตู)</strong> ูุฒูุฏ +1000 โช</li>
                        <li>โ <strong>ุงููุจูุนุงุช (ุฅูุฑุงุฏ)</strong> ุชุณุฌู +1000 โช</li>
                        <li>โ <strong>ุงููุฎุฒูู (ุฃุตู)</strong> ูููุต -600 โช (ูููุฉ ุงูุจุถุงุนุฉ)</li>
                        <li>โ <strong>ุชูููุฉ ุงูุจุถุงุนุฉ (ูุตุฑูู)</strong> ุชุณุฌู +600 โช</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ -->
    <div class="row mb-4">
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <h3 class="text-primary mb-0" id="asset-count">0</h3>
                    <small class="text-muted">ุงูุฃุตูู</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-danger">
                <div class="card-body text-center">
                    <h3 class="text-danger mb-0" id="liability-count">0</h3>
                    <small class="text-muted">ุงูุฎุตูู</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-secondary">
                <div class="card-body text-center">
                    <h3 class="text-secondary mb-0" id="equity-count">0</h3>
                    <small class="text-muted">ุญููู ุงูููููุฉ</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-success">
                <div class="card-body text-center">
                    <h3 class="text-success mb-0" id="revenue-count">0</h3>
                    <small class="text-muted">ุงูุฅูุฑุงุฏุงุช</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <h3 class="text-warning mb-0" id="expense-count">0</h3>
                    <small class="text-muted">ุงููุตุงุฑูู</small>
                </div>
            </div>
        </div>
        <div class="col-md-2 col-sm-4 col-6 mb-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <h3 class="text-info mb-0" id="total-count">0</h3>
                    <small class="text-muted">ุงููุฌููุน</small>
                </div>
            </div>
        </div>
    </div>

    <!-- ุจุญุซ -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" class="form-control" id="searchInput" placeholder="ุงุจุญุซ ุนู ุญุณุงุจ...">
            </div>
        </div>
        <div class="col-md-6">
            <select class="form-select" id="filterType">
                <option value="all">ุฌููุน ุงูุฃููุงุน</option>
                <option value="ASSET">ุงูุฃุตูู ููุท</option>
                <option value="LIABILITY">ุงูุฎุตูู ููุท</option>
                <option value="EQUITY">ุญููู ุงูููููุฉ ููุท</option>
                <option value="REVENUE">ุงูุฅูุฑุงุฏุงุช ููุท</option>
                <option value="EXPENSE">ุงููุตุงุฑูู ููุท</option>
            </select>
        </div>
    </div>

    <!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="btn-group" role="group">
                <button class="btn btn-outline-primary" onclick="toggleView('grouped')">
                    <i class="fas fa-layer-group"></i> ุนุฑุถ ูุฌููุน
                </button>
                <button class="btn btn-outline-primary" onclick="toggleView('table')">
                    <i class="fas fa-table"></i> ุนุฑุถ ุฌุฏูู
                </button>
                <button class="btn btn-outline-success" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> ุชุตุฏูุฑ Excel
                </button>
                <button class="btn btn-outline-info" onclick="printAccounts()">
                    <i class="fas fa-print"></i> ุทุจุงุนุฉ
                </button>
            </div>
        </div>
    </div>

    <!-- ูุงุฆูุฉ ุงูุญุณุงุจุงุช -->
    <div class="card shadow-sm">
        <div class="card-body">
            <div id="accountsContainer">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
                    </div>
                    <p class="mt-2 text-muted">ุฌุงุฑู ุชุญููู ุงูุญุณุงุจุงุช...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .account-group {
        margin-bottom: 2rem;
    }
    
    .account-group-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        margin-bottom: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .account-group-header h4 {
        margin: 0;
        font-weight: 600;
    }
    
    .account-group-header .badge {
        font-size: 0.9rem;
        padding: 0.4rem 0.8rem;
    }
    
    .account-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 1rem 1.5rem;
        margin-bottom: 0.75rem;
        transition: all 0.3s ease;
        background: white;
    }
    
    .account-item:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        transform: translateX(-3px);
    }
    
    .account-code {
        font-family: 'Courier New', monospace;
        font-weight: bold;
        font-size: 0.95rem;
        color: #667eea;
        min-width: 180px;
        display: inline-block;
    }
    
    .account-name {
        font-weight: 500;
        color: #2d3748;
        font-size: 1rem;
    }
    
    .account-badge {
        font-size: 0.75rem;
        padding: 0.3rem 0.7rem;
        border-radius: 12px;
    }
    
    .badge-ASSET { background: #e3f2fd; color: #1976d2; }
    .badge-LIABILITY { background: #ffebee; color: #c62828; }
    .badge-EQUITY { background: #f3e5f5; color: #7b1fa2; }
    .badge-REVENUE { background: #e8f5e9; color: #388e3c; }
    .badge-EXPENSE { background: #fff3e0; color: #f57c00; }
    
    .account-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        margin-right: 1rem;
    }
    
    .icon-ASSET { background: #e3f2fd; color: #1976d2; }
    .icon-LIABILITY { background: #ffebee; color: #c62828; }
    .icon-EQUITY { background: #f3e5f5; color: #7b1fa2; }
    .icon-REVENUE { background: #e8f5e9; color: #388e3c; }
    .icon-EXPENSE { background: #fff3e0; color: #f57c00; }
    
    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #9e9e9e;
    }
    
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
</style>

<script>
let allAccounts = [];

// ุฃููููุงุช ุญุณุจ ุงูููุน
const typeIcons = {
    'ASSET': '๐ฐ',
    'LIABILITY': '๐',
    'EQUITY': '๐ฆ',
    'REVENUE': '๐',
    'EXPENSE': '๐'
};

// ุดุฑุญ ูุจุณุท ููู ููุน
const typeDescriptions = {
    'ASSET': 'ุงูุฃุตูู - ูุง ุชูููู (ููุฏูุฉุ ุจุถุงุนุฉุ ูุนุฏุงุช)',
    'LIABILITY': 'ุงูุฎุตูู - ูุง ุนููู (ุฏูููุ ุดููุงุช ุตุงุฏุฑุฉ)',
    'EQUITY': 'ุญููู ุงูููููุฉ - ุฑุฃุณ ุงููุงู ูุงูุฃุฑุจุงุญ',
    'REVENUE': 'ุงูุฅูุฑุงุฏุงุช - ูุง ูุฏุฎู ูู ูุจูุนุงุช',
    'EXPENSE': 'ุงููุตุงุฑูู - ูุง ูุฎุฑุฌ (ุฑูุงุชุจุ ุฅูุฌุงุฑุ ููุฑุจุงุก)'
};

// ุชุญููู ุงูุญุณุงุจุงุช
async function loadAccounts() {
    try {
        const response = await fetch('/ledger/accounts');
        const data = await response.json();
        
        allAccounts = data.accounts || [];
        
        // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
        updateStats();
        
        // ุนุฑุถ ุงูุญุณุงุจุงุช
        displayAccounts(allAccounts);
        
    } catch (error) {
        console.error('ุฎุทุฃ ูู ุชุญููู ุงูุญุณุงุจุงุช:', error);
        document.getElementById('accountsContainer').innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle"></i>
                ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงูุญุณุงุจุงุช. ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู.
            </div>
        `;
    }
}

// ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
function updateStats() {
    const counts = {
        ASSET: 0,
        LIABILITY: 0,
        EQUITY: 0,
        REVENUE: 0,
        EXPENSE: 0
    };
    
    allAccounts.forEach(acc => {
        if (counts.hasOwnProperty(acc.type)) {
            counts[acc.type]++;
        }
    });
    
    document.getElementById('asset-count').textContent = counts.ASSET;
    document.getElementById('liability-count').textContent = counts.LIABILITY;
    document.getElementById('equity-count').textContent = counts.EQUITY;
    document.getElementById('revenue-count').textContent = counts.REVENUE;
    document.getElementById('expense-count').textContent = counts.EXPENSE;
    document.getElementById('total-count').textContent = allAccounts.length;
}

// ุนุฑุถ ุงูุญุณุงุจุงุช
function displayAccounts(accounts) {
    const container = document.getElementById('accountsContainer');
    
    if (accounts.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-inbox fa-3x mb-3"></i>
                <p>ูุง ุชูุฌุฏ ุญุณุงุจุงุช ูุนุฑุถูุง</p>
            </div>
        `;
        return;
    }
    
    // ุชุฌููุน ุญุณุจ ุงูููุน
    const grouped = {};
    accounts.forEach(acc => {
        if (!grouped[acc.type]) {
            grouped[acc.type] = [];
        }
        grouped[acc.type].push(acc);
    });
    
    // ุชุฑุชูุจ ุงูุฃููุงุน
    const typeOrder = ['ASSET', 'LIABILITY', 'EQUITY', 'REVENUE', 'EXPENSE'];
    
    let html = '';
    
    typeOrder.forEach(type => {
        if (grouped[type] && grouped[type].length > 0) {
            html += `
                <div class="account-group" data-type="${type}">
                    <div class="account-group-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4>
                                <span class="me-2">${typeIcons[type]}</span>
                                ${typeDescriptions[type]}
                            </h4>
                            <span class="badge bg-white text-dark">${grouped[type].length} ุญุณุงุจ</span>
                        </div>
                    </div>
                    <div class="account-list">
            `;
            
            grouped[type].forEach(acc => {
                html += `
                    <div class="account-item" data-code="${acc.code}" data-name="${acc.name}">
                        <div class="d-flex align-items-center">
                            <div class="account-icon icon-${acc.type}">
                                ${typeIcons[acc.type]}
                            </div>
                            <div class="flex-grow-1">
                                <div>
                                    <span class="account-code">${acc.code}</span>
                                    <span class="account-name">${acc.name}</span>
                                </div>
                            </div>
                            <span class="account-badge badge-${acc.type}">${acc.type}</span>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
        }
    });
    
    container.innerHTML = html;
}

// ุงูุจุญุซ ูุงูููุชุฑุฉ
function filterAccounts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filterType = document.getElementById('filterType').value;
    
    let filtered = allAccounts;
    
    // ููุชุฑุฉ ุญุณุจ ุงูููุน
    if (filterType !== 'all') {
        filtered = filtered.filter(acc => acc.type === filterType);
    }
    
    // ููุชุฑุฉ ุญุณุจ ุงูุจุญุซ
    if (searchTerm) {
        filtered = filtered.filter(acc => 
            acc.code.toLowerCase().includes(searchTerm) ||
            acc.name.toLowerCase().includes(searchTerm)
        );
    }
    
    displayAccounts(filtered);
}

// ุชุจุฏูู ุทุฑููุฉ ุงูุนุฑุถ
let currentView = 'grouped';
function toggleView(viewType) {
    currentView = viewType;
    displayAccounts(allAccounts);
}

// ุชุตุฏูุฑ ุฅูู Excel
function exportToExcel() {
    let csv = 'ุงูุฑูุฒ,ุงูุงุณู,ุงูููุน\n';
    allAccounts.forEach(acc => {
        csv += `${acc.code},"${acc.name}",${acc.type}\n`;
    });
    
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `ุฏููู_ุงูุญุณุงุจุงุช_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
}

// ุทุจุงุนุฉ
function printAccounts() {
    window.print();
}

// ุงูุฃุญุฏุงุซ
document.addEventListener('DOMContentLoaded', function() {
    loadAccounts();
    
    document.getElementById('searchInput').addEventListener('input', filterAccounts);
    document.getElementById('filterType').addEventListener('change', filterAccounts);
});
</script>
{% endblock %}

