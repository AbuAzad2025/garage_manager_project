{% extends 'base.html' %}
{% block title %}ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ±Ø¹ - {{ branch.name }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4" dir="rtl">
  
  <!-- Ø±Ø£Ø³ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
  <div class="print-header d-none d-print-block">
    <h2>Ù†Ø¸Ø§Ù… Ø£Ø²Ø§Ø¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø¬</h2>
    <div class="company-info">
      Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ - ÙÙ„Ø³Ø·ÙŠÙ† ğŸ‡µğŸ‡¸ | ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: {{ "now"|format_datetime("%Y-%m-%d") }}
    </div>
    <h3 class="mt-3">ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ±Ø¹: {{ branch.name }}</h3>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-3 no-print">
    <h3 class="mb-0">
      <i class="fas fa-chart-line me-2 text-primary"></i>
      ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙØ±Ø¹: {{ branch.name }}
    </h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('branches_bp.list_branches') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-right me-1"></i> Ø±Ø¬ÙˆØ¹
      </a>
      <button class="btn btn-primary" onclick="window.print()">
        <i class="fas fa-print me-1"></i> Ø·Ø¨Ø§Ø¹Ø©
      </button>
    </div>
  </div>

  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="fas fa-users fa-2x text-info mb-2"></i>
          <h5>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h5>
          <h3 class="text-primary">{{ stats.employees_count }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="fas fa-map-marker-alt fa-2x text-secondary mb-2"></i>
          <h5>Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</h5>
          <h3 class="text-primary">{{ stats.sites_count }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="fas fa-warehouse fa-2x text-warning mb-2"></i>
          <h5>Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª</h5>
          <h3 class="text-primary">{{ stats.warehouses_count }}</h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <i class="fas fa-receipt fa-2x text-success mb-2"></i>
          <h5>Ø§Ù„Ù†ÙÙ‚Ø§Øª</h5>
          <h3 class="text-primary">{{ stats.expenses_count }}</h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ÙÙ‚Ø§Øª -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-danger text-white">
      <i class="fas fa-money-bill-wave me-1"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ÙÙ‚Ø§Øª
    </div>
    <div class="card-body text-center">
      <h2 class="text-danger">{{ "%.2f"|format(stats.expenses_total) }} â‚ª</h2>
    </div>
  </div>

  <!-- Ø£Ø¹Ù„Ù‰ 5 Ù†ÙÙ‚Ø§Øª -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-warning text-white">
      <i class="fas fa-trophy me-1"></i> Ø£Ø¹Ù„Ù‰ 5 Ù†ÙÙ‚Ø§Øª
    </div>
    <div class="card-body p-0">
      {% if top_expenses %}
      <table class="table table-sm mb-0">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
          </tr>
        </thead>
        <tbody>
          {% for exp in top_expenses %}
          <tr>
            <td>{{ exp.date.strftime('%Y-%m-%d') if exp.date else 'â€”' }}</td>
            <td>{{ exp.type.name if exp.type else 'â€”' }}</td>
            <td class="fw-bold">{{ "%.2f"|format(exp.amount) }} {{ exp.currency }}</td>
            <td>{{ exp.description or 'â€”' }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center text-muted py-3 mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙÙ‚Ø§Øª</p>
      {% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ù†ÙÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ -->
  <div class="card shadow-sm">
    <div class="card-header bg-info text-white">
      <i class="fas fa-chart-pie me-1"></i> Ø§Ù„Ù†ÙÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    </div>
    <div class="card-body p-0">
      {% if expense_by_type %}
      <table class="table table-sm mb-0">
        <thead>
          <tr>
            <th>Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙ</th>
            <th class="text-center">Ø§Ù„Ø¹Ø¯Ø¯</th>
            <th class="text-end">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          </tr>
        </thead>
        <tbody>
          {% for row in expense_by_type %}
          <tr>
            <td>{{ row[0] }}</td>
            <td class="text-center"><span class="badge bg-primary">{{ row[1] }}</span></td>
            <td class="text-end fw-bold">{{ "%.2f"|format(row[2] or 0) }} â‚ª</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <p class="text-center text-muted py-3 mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙÙ‚Ø§Øª</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}

