<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>فاتورة رقم {{ invoice.id }}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');

    body {
      font-family: 'Cairo', Tahoma, sans-serif;
      margin: 0;
      background-color: #f5f7fa;
      color: #212529;
      direction: rtl;
      padding: 20px;
    }

    .invoice-box {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      color: #222;
    }

    h1 {
      font-weight: 700;
      color: #0d6efd;
      text-align: center;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .header, .footer {
      text-align: center;
      font-size: 0.9rem;
      color: #777;
      margin-top: 30px;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }

    .details {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 30px;
      gap: 15px;
    }

    .details > div {
      flex: 1 1 45%;
      min-width: 250px;
    }

    .details h3 {
      margin-bottom: 8px;
      color: #0d6efd;
      font-weight: 600;
      border-bottom: 2px solid #0d6efd;
      padding-bottom: 5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 25px;
    }

    th, td {
      border: 1px solid #dee2e6;
      padding: 12px 15px;
      text-align: center;
      font-size: 1rem;
    }

    th {
      background-color: #0d6efd;
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    tbody tr:hover {
      background-color: #e9ecef;
    }

    .total-row td {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .status-badge {
      padding: 6px 14px;
      border-radius: 25px;
      font-weight: 700;
      font-size: 0.9rem;
      display: inline-block;
      min-width: 110px;
      text-align: center;
      color: white;
    }

    .status-paid {
      background-color: #198754;
    }

    .status-partial {
      background-color: #0dcaf0;
      color: #000;
    }

    .status-unpaid {
      background-color: #ffc107;
      color: #000;
    }

    .status-cancelled {
      background-color: #6c757d;
    }

    @media print {
      body {
        background: white;
        padding: 0;
      }
      .invoice-box {
        box-shadow: none;
        border-radius: 0;
        margin: 0;
        padding: 0;
      }
      .footer {
        display: none;
      }
      button.print-btn {
        display: none;
      }
    }

    button.print-btn {
      margin: 20px auto;
      display: block;
      padding: 12px 25px;
      background-color: #0d6efd;
      color: white;
      font-size: 1.1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button.print-btn:hover {
      background-color: #0b5ed7;
    }
  </style>
</head>
<body>
  <div class="invoice-box">
    <h1>فاتورة رقم {{ invoice.id }}</h1>

    <div class="details">
      <div>
        <h3>معلومات العميل</h3>
        <p><strong>الاسم:</strong> {{ invoice.customer.name }}</p>
      </div>
      <div>
        <h3>تفاصيل الفاتورة</h3>
        <p><strong>التاريخ:</strong> {{ invoice.date.strftime('%Y-%m-%d') }}</p>
        <p><strong>تاريخ الاستحقاق:</strong> {{ invoice.due_date or '-' }}</p>
        <p>
          <strong>الحالة:</strong> 
          {% if invoice.status == 'PAID' %}
            <span class="status-badge status-paid">مدفوعة</span>
          {% elif invoice.status == 'PARTIALLY_PAID' %}
            <span class="status-badge status-partial">مدفوعة جزئياً</span>
          {% elif invoice.status == 'UNPAID' %}
            <span class="status-badge status-unpaid">غير مدفوعة</span>
          {% else %}
            <span class="status-badge status-cancelled">ملغاة</span>
          {% endif %}
        </p>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th>التاريخ</th>
          <th>المبلغ</th>
          <th>طريقة الدفع</th>
          <th>ملاحظة</th>
        </tr>
      </thead>
      <tbody>
        {% for p in payments %}
        <tr>
          <td>{{ p.created_at.strftime('%Y-%m-%d') }}</td>
          <td>{{ "%.2f"|format(p.amount) }}</td>
          <td>{{ p.method|capitalize }}</td>
          <td>{{ p.note or '-' }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="text-center text-muted">لا توجد دفعات مسجلة</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <p class="total-row" style="text-align:right; font-weight:bold; font-size:1.2rem;">
      المبلغ الإجمالي: {{ "%.2f"|format(invoice.total_amount) }} {{ invoice.currency or '' }}
    </p>

    <button class="print-btn" onclick="window.print()">طباعة الفاتورة 🖨️</button>
  </div>

  <footer class="footer">
    <p>© {{ now().year }} شركة آزاد للأنظمة الذكية. جميع الحقوق محفوظة.</p>
  </footer>
</body>
</html>
