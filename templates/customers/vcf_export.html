{% extends 'base.html' %}
{% block title %}تصدير جهات الاتصال{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-white px-3 py-2 rounded mb-4">
    <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">الرئيسية</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('customers_bp.list_customers') }}">العملاء</a></li>
    <li class="breadcrumb-item active">تصدير جهات الاتصال</li>
  </ol>
</nav>
{% endblock %}

{% block content %}
<div class="card shadow-sm">
  <div class="card-header bg-info text-white">
    <h3 class="card-title"><i class="fas fa-address-book me-2"></i>تصدير جهات الاتصال</h3>
  </div>
  <div class="card-body">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat,msg in messages %}
          <div class="alert alert-{{ cat }} mb-3">{{ msg|safe }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form id="export-contacts-form" method="post" action="{{ url_for('customers_bp.export_contacts') }}">
      {{ form.hidden_tag() }}

      <div class="row g-3">
        <!-- اختيار العملاء -->
        <div class="col-md-6">
          <label class="form-label fw-bold">{{ form.customer_ids.label.text if form.customer_ids.label else 'العملاء' }}</label>
          {{ form.customer_ids(class="form-select", multiple=True, size=12) }}
          {% for e in form.customer_ids.errors %}<small class="text-danger d-block">{{ e }}</small>{% endfor %}
          <small class="text-muted">اضغط Ctrl/⌘ للاختيار المتعدد.</small>
        </div>

        <!-- الحقول المطلوبة -->
        <div class="col-md-3">
          <label class="form-label fw-bold">{{ form.fields.label.text if form.fields.label else 'الحقول' }}</label>
          {{ form.fields(class="form-select", multiple=True, size=12) }}
          {% for e in form.fields.errors %}<small class="text-danger d-block">{{ e }}</small>{% endfor %}
          <small class="text-muted">مثال: الاسم، الهاتف، البريد..</small>
        </div>

        <!-- التنسيق -->
        <div class="col-md-3">
          <label class="form-label fw-bold">{{ form.format.label.text if form.format.label else 'التنسيق' }}</label>
          {{ form.format(class="form-select") }}
          {% for e in form.format.errors %}<small class="text-danger d-block">{{ e }}</small>{% endfor %}

          <div class="alert alert-light border mt-3">
            <ul class="mb-0 small">
              <li><b>VCF</b>: بطاقات اتصال (للهواتف).</li>
              <li><b>CSV</b>: ملف نصّي مفصول بفواصل.</li>
              <li><b>Excel</b>: ملف XLSX منسّق.</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="mt-4 d-flex gap-2">
        <button type="submit" class="btn btn-primary"><i class="fas fa-download me-1"></i> تصدير</button>
        <a href="{{ url_for('customers_bp.list_customers') }}" class="btn btn-secondary">رجوع</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/customers.js') }}"></script>
{% endblock %}
