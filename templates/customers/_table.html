<div class="table-responsive">
  <table id="customersTable" class="table table-hover table-bordered table-striped align-middle mb-0 text-center">
    <thead class="table-primary">
      <tr>
        <th>#</th>
        <th>الاسم</th>
        <th>الجوال</th>
        <th>البريد</th>
        <th>التصنيف</th>
        <th>الرصيد</th>
        <th>الحالة</th>
        <th>تاريخ الإنشاء</th>
        <th>العمليات</th>
      </tr>
    </thead>
    <tbody>
      {% for customer in customers %}
      <tr class="{% if not customer.is_active %}table-secondary{% endif %}">
        <td>{{ loop.index + (pagination.page - 1) * pagination.per_page }}</td>
        <td class="text-start">
          <a href="{{ url_for('customers_bp.customer_detail', customer_id=customer.id) }}" class="fw-bold text-primary">
            {{ customer.name }}
          </a>
        </td>
        <td>{{ customer.phone or '-' }}</td>
        <td>{{ customer.email or '-' }}</td>
        <td>{{ customer.category or '-' }}</td>
        <td class="fw-bold {% if customer.balance_in_ils > 0 %}text-danger{% else %}text-success{% endif %}">
          {{ customer.balance_in_ils|format_currency }} ₪
        </td>
        <td>{{ customer.is_active|yes_no }}</td>
        <td>{{ customer.created_at|format_date }}</td>
        <td class="text-nowrap">
          <div class="btn-group btn-group-sm" role="group">
            <a href="{{ url_for('customers_bp.customer_detail', customer_id=customer.id) }}"
               class="btn btn-info" title="تفاصيل"><i class="fas fa-eye"></i></a>
            <a href="{{ url_for('customers_bp.edit_customer', customer_id=customer.id) }}"
               class="btn btn-warning" title="تعديل"><i class="fas fa-edit"></i></a>
            <button type="button" class="btn btn-danger delete-btn"
                    data-id="{{ customer.id }}"
                    data-delete-url="{{ url_for('customers_bp.delete_customer', id=customer.id) }}"
                    title="حذف عادي">
              <i class="fas fa-trash"></i>
            </button>
            <a href="{{ url_for('hard_delete_bp.delete_customer', customer_id=customer.id) }}"
               class="btn btn-outline-danger" title="حذف قوي"
               onclick="return confirm('حذف قوي - سيتم حذف جميع البيانات المرتبطة!')">
              <i class="fas fa-bomb"></i>
            </a>
            {% if customer.balance and customer.balance > 0 %}
            <a href="{{ url_for('payments.create_payment', 
                               entity_type='CUSTOMER', 
                               entity_id=customer.id,
                               amount=customer.balance,
                               currency=customer.currency if customer.currency else 'ILS',
                               reference='دفع من عميل: ' ~ customer.name,
                               notes='دفعة من العميل: ' ~ customer.name ~ ((' - هاتف: ' ~ customer.phone) if customer.phone else ''),
                               customer_id=customer.id) }}"
               class="btn btn-success" title="دفع ({{ '%.2f'|format(customer.balance) }} ₪)"><i class="fas fa-coins"></i></a>
            {% endif %}
            <a href="{{ url_for('customers_bp.account_statement', customer_id=customer.id) }}"
               class="btn btn-outline-primary" title="كشف حساب"><i class="fas fa-file-invoice"></i></a>
            <a href="{{ url_for('reports_bp.customer_detail_report', customer_id=customer.id) }}"
               class="btn btn-outline-info" title="كشف مفصل"><i class="fas fa-chart-line"></i></a>
            <a href="{{ url_for('customers_bp.customer_whatsapp', customer_id=customer.id) }}"
               class="btn btn-success" title="واتساب"><i class="fab fa-whatsapp"></i></a>
            <a href="{{ url_for('customers_bp.export_customer_vcf', customer_id=customer.id) }}"
               class="btn btn-outline-success" title="VCF"><i class="fas fa-download"></i></a>
          </div>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="9" class="text-muted text-center">لا توجد نتائج.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
