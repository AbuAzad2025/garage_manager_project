<div class="table-responsive">
  <table id="customersTable" class="table table-hover table-bordered table-striped align-middle mb-0 text-center table-mobile-friendly" data-dt-skip="true">
    <thead class="table-primary">
      <tr>
        <th class="hide-mobile">#</th>
        <th>الاسم</th>
        <th>الجوال</th>
        <th class="hide-mobile">البريد</th>
        <th class="hide-mobile">التصنيف</th>
        <th>الرصيد</th>
        <th class="hide-mobile">الحالة</th>
        <th class="hide-mobile">تاريخ الإنشاء</th>
        <th>العمليات</th>
      </tr>
    </thead>
    <tbody>
      {% for customer in customers %}
      <tr class="{% if not customer.is_active %}table-secondary{% endif %}">
        <td class="hide-mobile">{{ loop.index + (pagination.page - 1) * pagination.per_page }}</td>
        <td class="text-start">
          <a href="{{ url_for('customers_bp.customer_detail', customer_id=customer.id) }}" class="fw-bold text-primary">
            {{ customer.name }}
          </a>
          {% if customer.supplier_link %}
            <span class="badge bg-purple text-white ms-2" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" title="مرتبط بالمورد: {{ customer.supplier_link[0].name }}">
              <i class="fas fa-truck ml-1"></i>مورد
            </span>
          {% elif customer.partner_link %}
            <span class="badge bg-pink text-white ms-2" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" title="مرتبط بالشريك: {{ customer.partner_link[0].name }}">
              <i class="fas fa-handshake ml-1"></i>شريك
            </span>
          {% endif %}
        </td>
        <td>{{ customer.phone or '-' }}</td>
        <td class="hide-mobile">{{ customer.email or '-' }}</td>
        <td class="hide-mobile">{{ customer.category or '-' }}</td>
        <td class="fw-bold {% if customer.balance < 0 %}text-danger{% else %}text-success{% endif %}">
          {{ customer.balance|format_currency }}
        </td>
        <td class="hide-mobile">
          {% if customer.is_archived %}
            <span class="badge bg-secondary">مؤرشف</span>
          {% elif customer.is_active %}
            <span class="badge bg-success">نشط</span>
          {% else %}
            <span class="badge bg-warning">غير نشط</span>
          {% endif %}
        </td>
        <td class="hide-mobile">{{ customer.created_at|format_date }}</td>
        <td class="text-nowrap">
          <div class="table-actions">
            <a href="{{ url_for('customers_bp.customer_detail', customer_id=customer.id) }}" class="btn btn-action-view btn-action-sm" title="عرض">
              <i class="fas fa-eye"></i>
            </a>
            <a href="{{ url_for('customers_bp.edit_customer', customer_id=customer.id) }}" class="btn btn-action-edit btn-action-sm" title="تعديل">
              <i class="fas fa-edit"></i>
            </a>
            <a href="{{ url_for('payments.create_payment') }}?entity_type=CUSTOMER&entity_id={{ customer.id }}&entity_name={{ customer.name|urlencode }}" 
               class="btn btn-action-primary btn-action-sm" title="إضافة دفعة">
              <i class="fas fa-money-bill-wave"></i>
            </a>
            <a href="{{ url_for('customers_bp.account_statement', customer_id=customer.id) }}" class="btn btn-action-report btn-action-sm" title="كشف">
              <i class="fas fa-file-invoice"></i>
            </a>
            <a href="{{ url_for('customers_bp.customer_whatsapp', customer_id=customer.id) }}" class="btn btn-success btn-action-sm" title="واتساب">
              <i class="fab fa-whatsapp"></i>
            </a>
            {% if customer.is_archived %}
            <button type="button" class="btn btn-action-restore btn-action-sm restore-btn"
                    data-id="{{ customer.id }}"
                    data-restore-url="{{ url_for('customers_bp.restore_customer', customer_id=customer.id) }}" title="استعادة">
              <i class="fas fa-undo"></i>
            </button>
            {% else %}
            <button type="button" class="btn btn-action-archive btn-action-sm archive-btn"
                    data-id="{{ customer.id }}"
                    data-archive-url="{{ url_for('customers_bp.archive_customer', customer_id=customer.id) }}" title="أرشفة">
              <i class="fas fa-archive"></i>
            </button>
            {% endif %}
            <button type="button" class="btn btn-warning btn-action-sm delete-btn"
                    data-id="{{ customer.id }}" 
                    data-url="{{ url_for('customers_bp.delete_customer', id=customer.id) }}"
                    title="حذف عادي">
              <i class="fas fa-trash"></i>
            </button>
            <a href="{{ url_for('hard_delete_bp.delete_customer', customer_id=customer.id) }}" 
               class="btn btn-danger btn-action-sm" 
               title="حذف قوي (مع العمليات العكسية)">
              <i class="fas fa-bomb"></i>
            </a>
          </div>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="9" class="text-muted text-center">لا توجد نتائج.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
