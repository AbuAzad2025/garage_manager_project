{% extends 'base.html' %}
{% block title %}إضافة عميل جديد{% endblock %}
{% block breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb bg-white px-3 py-2 rounded mb-4">
    <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">الرئيسية</a></li>
    <li class="breadcrumb-item"><a href="{{ url_for('customers_bp.list_customers') }}">العملاء</a></li>
    <li class="breadcrumb-item active">إضافة جديد</li>
  </ol>
</nav>
{% endblock %}
{% block content %}
<div class="content-wrapper">
  <div class="card shadow-sm rounded">
    <div class="card-header bg-primary text-white">
      <h3 class="card-title"><i class="fas fa-user-plus ml-1"></i> إضافة عميل جديد</h3>
    </div>
    <div class="card-body">
      <div class="d-flex justify-content-end mb-3 gap-3">
        <div class="custom-control custom-switch">
          {{ form.is_online(class="custom-control-input") }}
          <label class="custom-control-label" for="{{ form.is_online.id }}"><i class="fas fa-globe text-info"></i> عميل أونلاين</label>
        </div>
        <div class="custom-control custom-switch">
          {{ form.is_active(class="custom-control-input") }}
          <label class="custom-control-label" for="{{ form.is_active.id }}"><i class="fas fa-toggle-on text-success"></i> نشط</label>
        </div>
      </div>
      {% if form.errors %}
        <div class="alert alert-danger">يرجى تصحيح الحقول المظللة أدناه.</div>
      {% endif %}
      <form id="customer-create-form" method="post" action="{{ url_for('customers_bp.create_customer') }}" novalidate data-ajax="0">
        {{ form.hidden_tag() }}
        <input type="hidden" name="return_to" value="{{ return_to or request.args.get('return_to','') }}">
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="{{ form.name.id }}"><i class="fas fa-user"></i> اسم العميل <span class="text-danger">*</span></label>
            {{ form.name(class="form-control form-control-sm" + (' is-invalid' if form.name.errors else ''), placeholder="أدخل اسم العميل", required=True) }}
            {% for e in form.name.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
          <div class="form-group col-md-6">
            <label for="{{ form.phone.id }}"><i class="fas fa-phone"></i> رقم الهاتف <span class="text-danger">*</span></label>
            {{ form.phone(class="form-control form-control-sm" + (' is-invalid' if form.phone.errors else ''), placeholder="05XXXXXXXX", inputmode="tel") }}
            {% for e in form.phone.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="{{ form.email.id }}"><i class="fas fa-envelope"></i> البريد الإلكتروني <span class="text-danger">*</span></label>
            {{ form.email(class="form-control form-control-sm" + (' is-invalid' if form.email.errors else ''), type="email", inputmode="email", dir="ltr", placeholder="name@example.com", pattern="^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$", required=True) }}
            {% for e in form.email.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
          <div class="form-group col-md-6">
            <label for="{{ form.whatsapp.id }}"><i class="fab fa-whatsapp"></i> رقم الواتساب</label>
            {{ form.whatsapp(class="form-control form-control-sm" + (' is-invalid' if form.whatsapp.errors else ''), placeholder="رقم الواتساب", inputmode="tel") }}
            {% for e in form.whatsapp.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
        </div>
        <div class="form-group">
          <label for="{{ form.address.id }}"><i class="fas fa-map-marker-alt"></i> العنوان</label>
          {{ form.address(class="form-control form-control-sm" + (' is-invalid' if form.address.errors else ''), placeholder="العنوان كامل") }}
          {% for e in form.address.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="{{ form.category.id }}"><i class="fas fa-layer-group"></i> تصنيف العميل</label>
            {{ form.category(class="form-control form-control-sm" + (' is-invalid' if form.category.errors else '')) }}
            {% for e in form.category.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
          <div class="form-group col-md-6">
            <label for="{{ form.currency.id }}"><i class="fas fa-coins"></i> العملة <span class="text-danger">*</span></label>
            {{ form.currency(class="form-control form-control-sm" + (' is-invalid' if form.currency.errors else '')) }}
            {% for e in form.currency.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="{{ form.discount_rate.id }}"><i class="fas fa-percent"></i> معدل الخصم (%)</label>
            {{ form.discount_rate(class="form-control form-control-sm" + (' is-invalid' if form.discount_rate.errors else ''), placeholder="0 - 100", step="0.01", min="0", max="100") }}
            {% for e in form.discount_rate.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
          <div class="form-group col-md-6">
            <label for="{{ form.credit_limit.id }}"><i class="fas fa-credit-card"></i> حد الائتمان</label>
            {{ form.credit_limit(class="form-control form-control-sm" + (' is-invalid' if form.credit_limit.errors else ''), placeholder="0.00", step="0.01", min="0") }}
            {% for e in form.credit_limit.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
            <label for="{{ form.password.id }}"><i class="fas fa-lock"></i> كلمة المرور <span class="text-danger">*</span></label>
            {{ form.password(class="form-control form-control-sm" + (' is-invalid' if form.password.errors else ''), placeholder="******", autocomplete="new-password") }}
            {% for e in form.password.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
          <div class="form-group col-md-6">
            <label for="{{ form.confirm.id }}"><i class="fas fa-lock"></i> تأكيد كلمة المرور</label>
            {{ form.confirm(class="form-control form-control-sm" + (' is-invalid' if form.confirm.errors else ''), placeholder="******", autocomplete="new-password") }}
            {% for e in form.confirm.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
          </div>
        </div>
        <div class="form-group">
          <label for="{{ form.notes.id }}"><i class="fas fa-sticky-note"></i> ملاحظات</label>
          {{ form.notes(class="form-control form-control-sm" + (' is-invalid' if form.notes.errors else ''), rows="2", placeholder="ملاحظات إضافية") }}
          {% for e in form.notes.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
        </div>
        <div class="mt-4 d-flex">
          <button type="submit" class="btn btn-success"><i class="fas fa-save ml-1"></i> حفظ</button>
          <a href="{{ url_for('customers_bp.list_customers') }}" class="btn btn-secondary ml-2">إلغاء</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/customers.js') }}"></script>
{% endblock %}
