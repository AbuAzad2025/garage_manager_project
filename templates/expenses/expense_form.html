{% extends "base.html" %}
{% block title %}{{ is_edit and 'ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ±ÙˆÙ' or 'Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ' }}{% endblock %}

{% block content %}
<div class="container mt-4" dir="rtl">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="mb-0">{{ is_edit and 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ±ÙˆÙ' or 'â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ' }}</h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('expenses_bp.list_expenses') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹
      </a>
      <a href="{{ url_for('expenses_bp.quick_add') }}" class="btn btn-primary">
        <i class="fas fa-bolt"></i> Ù…ØµØ±ÙˆÙ Ø³Ø±ÙŠØ¹
      </a>
    </div>
  </div>

  <form method="POST" id="expenseForm" class="needs-validation" novalidate>
    {{ form.hidden_tag() }}
    <div class="row g-3">
      <div class="col-lg-6">
        <div class="card card-outline card-primary">
          <div class="card-header"><h5 class="card-title mb-0">ğŸ“ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h5></div>
          <div class="card-body">
            <div class="mb-3">
              {{ form.date.label(class="form-label") }}
              {{ form.date(type="date", class="form-control", id="date") }}
              {% for e in form.date.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.amount.label(class="form-label") }}
              {{ form.amount(class="form-control", step="0.01", id="amount") }}
              <small id="amountHelp" class="text-muted d-none">Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø¨Ù„Øº ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.</small>
              {% for e in form.amount.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.currency.label(class="form-label") }}
              {{ form.currency(class="form-select", id="currency") }}
              {% for e in form.currency.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.type_id.label(class="form-label") }}
              {{ form.type_id(class="form-select", id="type_id") }}
              {% for e in form.type_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.beneficiary_name.label(class="form-label") }}
              {{ form.beneficiary_name(class="form-control", id="beneficiary_name", placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©") }}
              {% for e in form.beneficiary_name.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              <small class="text-muted">ÙŠÙØ³ØªØ®Ø¯Ù… Ù„Ù„Ù…ØªÙØ±Ù‚Ø§Øª ÙˆØ§Ù„Ø¬Ù…Ø§Ø±Ùƒ Ø¥Ù† Ù„Ù… ØªÙƒÙ† Ø±ÙˆØ§ØªØ¨/Ù…Ø±Ø§ÙÙ‚.</small>
            </div>

            <div class="mb-3">
              {{ form.paid_to.label(class="form-label") }}
              {{ form.paid_to(class="form-control", id="paid_to", placeholder="Ø³ÙŠÙØ­Ø¯Ù‘ÙØ« ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹") }}
              {% for e in form.paid_to.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.payment_method.label(class="form-label") }}
              {{ form.payment_method(class="form-select", id="payment_method") }}
              {% for e in form.payment_method.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div id="methodDetails" class="row gy-2" style="display:none;">
              <div class="col-md-4" data-field="check_number">
                {{ form.check_number.label(class="form-label") }}
                {{ form.check_number(class="form-control", placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ") }}
                {% for e in form.check_number.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-4" data-field="check_bank">
                {{ form.check_bank.label(class="form-label") }}
                {{ form.check_bank(class="form-control", placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ") }}
                {% for e in form.check_bank.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-4" data-field="check_due_date">
                {{ form.check_due_date.label(class="form-label") }}
                {{ form.check_due_date(type="date", class="form-control") }}
                {% for e in form.check_due_date.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>

              <div class="col-md-6" data-field="bank_transfer_ref">
                {{ form.bank_transfer_ref.label(class="form-label") }}
                {{ form.bank_transfer_ref(class="form-control", placeholder="Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø­ÙˆØ§Ù„Ø©") }}
                {% for e in form.bank_transfer_ref.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>

              <div class="col-md-4" data-field="card_number">
                {{ form.card_number.label(class="form-label") }}
                {{ form.card_number(class="form-control", placeholder="**** **** **** ****") }}
                {% for e in form.card_number.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-4" data-field="card_holder">
                {{ form.card_holder.label(class="form-label") }}
                {{ form.card_holder(class="form-control", placeholder="Ø§Ø³Ù… Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©") }}
                {% for e in form.card_holder.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-4" data-field="card_expiry">
                {{ form.card_expiry.label(class="form-label") }}
                {{ form.card_expiry(class="form-control", placeholder="MM/YY") }}
                {% for e in form.card_expiry.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>

              <div class="col-md-4" data-field="online_gateway">
                {{ form.online_gateway.label(class="form-label") }}
                {{ form.online_gateway(class="form-control", placeholder="Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©") }}
                {% for e in form.online_gateway.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-4" data-field="online_ref">
                {{ form.online_ref.label(class="form-label") }}
                {{ form.online_ref(class="form-control", placeholder="Ù…Ø±Ø¬Ø¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©") }}
                {% for e in form.online_ref.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
            </div>

            <div class="mb-3">
              {{ form.payment_details.label(class="form-label") }}
              {{ form.payment_details(class="form-control") }}
              {% for e in form.payment_details.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-outline card-secondary">
          <div class="card-header"><h5 class="card-title mb-0">ğŸ”— Ø­Ù‚ÙˆÙ„ Ø¥Ø¶Ø§ÙÙŠØ© ÙˆØ±Ø¨Ø·</h5></div>
          <div class="card-body">
            <div id="employee-field" class="mb-3" style="display:none;">
              {{ form.employee_id.label(class="form-label") }}
              {{ form.employee_id(class="form-control ajax-select", id="employee_id", **{
                   "data-endpoint": url_for('api.search_employees'),
                   "data-placeholder": "Ø§Ø®ØªØ± Ù…ÙˆØ¸ÙÙ‹Ø§",
                   "data-minlen": "1"
                 }) }}
              {% for e in form.employee_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              <div class="row">
                <div class="col-md-6 mt-2">
                  {{ form.period_start.label(class="form-label") }}
                  {{ form.period_start(type="date", class="form-control", id="period_start") }}
                </div>
                <div class="col-md-6 mt-2">
                  {{ form.period_end.label(class="form-label") }}
                  {{ form.period_end(type="date", class="form-control", id="period_end") }}
                </div>
              </div>
            </div>

            <div class="mb-3">
              {{ form.shipment_id.label(class="form-label") }}
              {{ form.shipment_id(class="form-control ajax-select", id="shipment_id", **{
                   "data-endpoint": url_for('api.shipments'),
                   "data-placeholder": "Ø§Ø®ØªØ± Ø´Ø­Ù†Ø©",
                   "data-minlen": "1"
                 }) }}
              {% for e in form.shipment_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.utility_account_id.label(class="form-label") }}
              {{ form.utility_account_id(class="form-control ajax-select", id="utility_account_id", **{
                   "data-endpoint": url_for('api.search_utility_accounts'),
                   "data-placeholder": "Ø§Ø®ØªØ± Ø­Ø³Ø§Ø¨ Ù…Ø±Ø§ÙÙ‚",
                   "data-minlen": "1"
                 }) }}
              {% for e in form.utility_account_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                {{ form.warehouse_id.label(class="form-label") }}
                {{ form.warehouse_id(class="form-control ajax-select", id="warehouse_id", **{
                     "data-endpoint": url_for('api.search_warehouses'),
                     "data-placeholder": "Ø§Ø®ØªØ± Ù…Ø³ØªÙˆØ¯Ø¹Ù‹Ø§",
                     "data-minlen": "1"
                   }) }}
                {% for e in form.warehouse_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
              <div class="col-md-6 mb-3">
                {{ form.partner_id.label(class="form-label") }}
                {{ form.partner_id(class="form-control ajax-select", id="partner_id", **{
                     "data-endpoint": url_for('api.search_partners'),
                     "data-placeholder": "Ø§Ø®ØªØ± Ø´Ø±ÙŠÙƒÙ‹Ø§",
                     "data-minlen": "1"
                   }) }}
                {% for e in form.partner_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
              </div>
            </div>

            <div class="mb-3">
              {{ form.stock_adjustment_id.label(class="form-label") }}
              {{ form.stock_adjustment_id(class="form-control ajax-select", id="stock_adjustment_id", **{
                   "data-endpoint": url_for('api.search_stock_adjustments'),
                   "data-placeholder": "Ø§Ø®ØªØ± ØªØ³ÙˆÙŠØ© Ù…Ø®Ø²ÙˆÙ†",
                   "data-minlen": "1",
                   "data-url-template": "/api/stock_adjustments/{id}/total"
                 }) }}
              <small class="text-muted d-block mt-1">Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¨Ø· Ø¨ØªØ³ÙˆÙŠØ© Ù…Ø®Ø²ÙˆÙ† Ø³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</small>
              {% for e in form.stock_adjustment_id.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.tax_invoice_number.label(class="form-label") }}
              {{ form.tax_invoice_number(class="form-control") }}
              {% for e in form.tax_invoice_number.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.description.label(class="form-label") }}
              {{ form.description(class="form-control") }}
              {% for e in form.description.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>

            <div class="mb-3">
              {{ form.notes.label(class="form-label") }}
              {{ form.notes(class="form-control") }}
              {% for e in form.notes.errors %}<div class="invalid-feedback d-block">{{ e }}</div>{% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2 mt-3">
      <button type="submit" class="btn btn-success">{{ is_edit and 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' or 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ' }}</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('expenses_bp.list_expenses') }}">Ø¥Ù„ØºØ§Ø¡</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/expenses.js') }}"></script>
{% endblock %}
