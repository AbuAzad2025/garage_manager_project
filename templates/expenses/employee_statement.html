{% extends 'base.html' %}
{% block title %}ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù - {{ employee.name }}{% endblock %}

{% block content %}
<div class="container mt-4" dir="rtl">
  
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Ù…Ø®ÙÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
  <div class="d-flex justify-content-between align-items-center mb-3 no-print">
    <h3 class="mb-0">
      <i class="fas fa-file-invoice me-2"></i>
      ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù: {{ employee.name }}
    </h3>
    <div class="d-flex gap-2">
      <a href="{{ url_for('expenses_bp.employees_list') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-right me-1"></i> Ø±Ø¬ÙˆØ¹
      </a>
      <button class="btn btn-primary btn-print" onclick="window.print()">
        <i class="fas fa-print me-1"></i> Ø·Ø¨Ø§Ø¹Ø©
      </button>
    </div>
  </div>

  <!-- Ø±Ø£Ø³ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
  <div class="print-header d-none d-print-block">
    <h2>Ù†Ø¸Ø§Ù… Ø£Ø²Ø§Ø¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø¬</h2>
    <div class="company-info">
      Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ - ÙÙ„Ø³Ø·ÙŠÙ† ğŸ‡µğŸ‡¸ | {{ "now"|format_datetime("%Y-%m-%d %H:%M") }}
    </div>
    <h3 class="mt-3">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ¸Ù</h3>
  </div>

  <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <i class="fas fa-user me-1"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
    </div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-3">
          <strong>Ø§Ù„Ø§Ø³Ù…:</strong> {{ employee.name }}
        </div>
        <div class="col-md-3">
          <strong>Ø§Ù„Ù…Ø³Ù…Ù‰:</strong> {{ employee.position or 'â€”' }}
        </div>
        <div class="col-md-3">
          <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</strong> {{ employee.hire_date.strftime('%Y-%m-%d') if employee.hire_date else 'â€”' }}
        </div>
        <div class="col-md-3">
          <strong>Ø§Ù„ÙØ±Ø¹:</strong> {{ employee.branch.name if employee.branch else 'â€”' }}
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</h6>
          <h4 class="text-primary">{{ "%.2f"|format(employee.salary or 0) }} â‚ª</h4>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ù„Ù</h6>
          <h4 class="text-warning">{{ "%.2f"|format(employee.total_advances) }} â‚ª</h4>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h6>
          <h4 class="text-danger">{{ "%.2f"|format(employee.total_deductions) }} â‚ª</h4>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card text-center shadow-sm">
        <div class="card-body">
          <h6 class="text-muted">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„ØµØ§ÙÙŠ</h6>
          <h4 class="text-success">{{ "%.2f"|format(employee.net_salary) }} â‚ª</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø³Ù„Ù -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-warning text-white">
      <i class="fas fa-hand-holding-usd me-1"></i> Ø§Ù„Ø³Ù„Ù Ø§Ù„Ù…Ø³Ø­ÙˆØ¨Ø©
    </div>
    <div class="card-body">
      {% if advances %}
      <div class="table-responsive">
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„ÙˆØµÙ</th>
              <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯</th>
            </tr>
          </thead>
          <tbody>
            {% for adv in advances %}
            <tr>
              <td>{{ adv.date.strftime('%Y-%m-%d') if adv.date else 'â€”' }}</td>
              <td>{{ "%.2f"|format(adv.amount) }} {{ adv.currency }}</td>
              <td>{{ adv.description or 'â€”' }}</td>
              <td>
                {% set installments = adv.installments %}
                {% if installments %}
                  {% set paid_count = installments|selectattr('paid')|list|length %}
                  {% set total_count = installments|length %}
                  <span class="badge bg-{% if paid_count == total_count %}success{% else %}warning{% endif %}">
                    {{ paid_count }}/{{ total_count }} Ø£Ù‚Ø³Ø§Ø·
                  </span>
                {% else %}
                  <span class="badge bg-secondary">Ø¨Ø¯ÙˆÙ† Ø£Ù‚Ø³Ø§Ø·</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted text-center mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ù„Ù Ù…Ø³Ø¬Ù„Ø©</p>
      {% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-danger text-white">
      <i class="fas fa-minus-circle me-1"></i> Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
    </div>
    <div class="card-body">
      {% if deductions %}
      <div class="table-responsive">
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th>Ø§Ù„Ù†ÙˆØ¹</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ù…Ù†</th>
              <th>Ø¥Ù„Ù‰</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for ded in deductions %}
            <tr>
              <td>{{ ded.deduction_type }}</td>
              <td>{{ "%.2f"|format(ded.amount) }} {{ ded.currency }}</td>
              <td>{{ ded.start_date.strftime('%Y-%m-%d') if ded.start_date else 'â€”' }}</td>
              <td>{{ ded.end_date.strftime('%Y-%m-%d') if ded.end_date else 'Ù…Ø³ØªÙ…Ø±' }}</td>
              <td>
                <span class="badge bg-{% if ded.is_active %}success{% else %}secondary{% endif %}">
                  {{ 'Ù†Ø´Ø·' if ded.is_active else 'Ù…ÙˆÙ‚ÙˆÙ' }}
                </span>
              </td>
              <td>{{ ded.notes or 'â€”' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted text-center mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ØµÙˆÙ…Ø§Øª Ø´Ù‡Ø±ÙŠØ©</p>
      {% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white">
      <i class="fas fa-money-bill-wave me-1"></i> Ø§Ù„Ø±ÙˆØ§ØªØ¨ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
    </div>
    <div class="card-body">
      {% if salaries %}
      <div class="table-responsive">
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„Ø´Ù‡Ø±</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th>
              <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for sal in salaries %}
            <tr>
              <td>{{ sal.date.strftime('%Y-%m-%d') if sal.date else 'â€”' }}</td>
              <td>
                {% if sal.period_start %}
                  {{ sal.period_start.strftime('%Y-%m') }}
                {% else %}
                  â€”
                {% endif %}
              </td>
              <td>{{ "%.2f"|format(sal.amount) }} {{ sal.currency }}</td>
              <td>{{ sal.payment_method|upper }}</td>
              <td>{{ sal.description or 'â€”' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-muted text-center mb-0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§ØªØ¨ Ù…Ø¯ÙÙˆØ¹Ø©</p>
      {% endif %}
    </div>
  </div>

  <!-- Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ -->
  <div class="card shadow-lg">
    <div class="card-body text-center">
      <h5>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</h5>
      {% set balance = employee.balance %}
      <h2 class="{% if balance < 0 %}text-danger{% elif balance > 0 %}text-success{% else %}text-secondary{% endif %}">
        {{ "%.2f"|format(balance|abs) }} â‚ª
        {% if balance < 0 %}
          <small class="text-muted d-block mt-2">Ù„Ù‡ Ø¹Ù†Ø¯Ù†Ø§ (ÙŠØ³ØªØ­Ù‚ Ø¯ÙØ¹)</small>
        {% elif balance > 0 %}
          <small class="text-muted d-block mt-2">Ø¹Ù„ÙŠÙ‡ Ù„Ù†Ø§ (Ù…Ø¯ÙŠÙ†)</small>
        {% else %}
          <small class="text-muted d-block mt-2">Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ§Ø²Ù†</small>
        {% endif %}
      </h2>
    </div>
  </div>

  <!-- Ø°ÙŠÙ„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
  <div class="print-footer d-none d-print-block">
    ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©: {{ current_user.username }} | Ø§Ù„ØªØ§Ø±ÙŠØ®: {{ "now"|format_datetime("%Y-%m-%d %H:%M") }}
    <br>
    <small>Ù†Ø¸Ø§Ù… Ø£Ø²Ø§Ø¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ±Ø§Ø¬ - v5.0.0 Enterprise</small>
  </div>

</div>
{% endblock %}

