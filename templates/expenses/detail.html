{% extends 'base.html' %}
{% block title %}تفاصيل المصروف #{{ expense.id }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="card card-outline card-primary">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3 class="card-title mb-0"><i class="fas fa-file-invoice-dollar me-2"></i>تفاصيل المصروف</h3>
      <div class="d-flex gap-2">
        <a href="{{ url_for('expenses_bp.list_expenses') }}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-right"></i> رجوع
        </a>
        {% if has_perm('manage_payments') %}
        <a href="{{ url_for('expenses_bp.pay', exp_id=expense.id) }}" class="btn btn-success">
          <i class="fas fa-money-bill-wave me-1"></i> دفع
        </a>
        {% endif %}
        {% if has_perm('manage_expenses') %}
        <a href="{{ url_for('expenses_bp.edit', exp_id=expense.id) }}" class="btn btn-warning">
          <i class="fas fa-edit me-1"></i> تعديل
        </a>
        <form method="post" action="{{ url_for('expenses_bp.delete', exp_id=expense.id) }}"
              style="display:inline;" onsubmit="return confirm('حذف المصروف؟');">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-danger"><i class="fas fa-trash me-1"></i> حذف</button>
        </form>
        {% endif %}
      </div>
    </div>

    <div class="card-body">
      <dl class="row mb-0">
        <dt class="col-sm-3 text-end">التاريخ</dt>
        <dd class="col-sm-9">{{ expense.date|format_datetime }}</dd>

        <dt class="col-sm-3 text-end">المبلغ</dt>
        <dd class="col-sm-9">{{ expense.amount|number_format(2) }}</dd>

        <dt class="col-sm-3 text-end">العملة</dt>
        <dd class="col-sm-9">{{ expense.currency }}</dd>

        <dt class="col-sm-3 text-end">النوع</dt>
        <dd class="col-sm-9">{{ expense.type.name if expense.type else '—' }}</dd>

        <dt class="col-sm-3 text-end">الموظف</dt>
        <dd class="col-sm-9">{{ expense.employee.name if expense.employee else '—' }}</dd>

        <dt class="col-sm-3 text-end">مدفوع إلى</dt>
        <dd class="col-sm-9">{{ expense.paid_to or '—' }}</dd>

        <dt class="col-sm-3 text-end">طريقة الدفع</dt>
        <dd class="col-sm-9">{{ expense.payment_method or '—' }}</dd>

        <dt class="col-sm-3 text-end">تفاصيل الدفع</dt>
        <dd class="col-sm-9">{{ expense.payment_details or '—' }}</dd>

        <dt class="col-sm-3 text-end">رقم فاتورة ضريبية</dt>
        <dd class="col-sm-9">{{ expense.tax_invoice_number or '—' }}</dd>

        <dt class="col-sm-3 text-end">الوصف</dt>
        <dd class="col-sm-9">{{ expense.description or '—' }}</dd>

        <dt class="col-sm-3 text-end">ملاحظات</dt>
        <dd class="col-sm-9">{{ expense.notes or '—' }}</dd>

        <dt class="col-sm-3 text-end">المدفوع حتى الآن</dt>
        <dd class="col-sm-9">{{ expense.total_paid|number_format(2) }} {{ expense.currency }}</dd>

        <dt class="col-sm-3 text-end">الرصيد المتبقي</dt>
        <dd class="col-sm-9">{{ expense.balance|number_format(2) }} {{ expense.currency }}</dd>

        <dt class="col-sm-3 text-end">مدفوع بالكامل</dt>
        <dd class="col-sm-9">{{ expense.is_paid|yes_no }}</dd>
      </dl>
    </div>
  </div>
</div>
{% endblock %}
