{% extends "base_print.html" %}
{% block title %}ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª{% endblock %}

{% block head_extra %}
  <style>
    @page { size: A4; margin: 12mm; }
    @media print { .no-print { display: none !important; } }
    body { background:#fff; font-family:'Amiri','Arial',sans-serif; font-size:14px; }
    .receipt-footer {
      position: fixed; bottom: 0; left: 0; right: 0;
      font-size: 12px; border-top: 1px solid #ccc;
      padding: 6px; background: #fff; text-align:center;
    }
    .receipt-header { display:flex; justify-content:space-between; align-items:center; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand .logo { max-height:60px; }
    .brand-name { font-size:18px; font-weight:700; }
    .brand-sub { font-size:14px; color:#555; }
    .box { border:1px solid #ddd; border-radius:6px; padding:10px; background:#fafafa; margin-bottom:12px; }
    table { width:100%; border-collapse:collapse; margin-bottom:12px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; }
    th { background:#f2f2f2; }
    .totals .rowline { display:flex; justify-content:space-between; margin:4px 0; }
    .totals .highlight { font-size:16px; color:#0d6efd; font-weight:700; }
  </style>
{% endblock %}

{% block content %}
<div id="receipt" class="container my-4">

  <!-- Ø±Ø£Ø³ Ù…Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† -->
  <div class="receipt-header">
    <div class="brand">
      <img class="logo" src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
      <div>
        <div class="brand-name">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©</div>
        <div class="brand-sub">ÙØ§ØªÙˆØ±Ø© Ù…Ø¨ÙŠØ¹Ø§Øª</div>
      </div>
    </div>
    <div class="text-muted">
      Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <strong>{{ sale.sale_number or sale.id }}</strong><br>
      Ø§Ù„ØªØ§Ø±ÙŠØ®: {{ sale.sale_date and sale.sale_date.strftime('%Y-%m-%d') or 'â€”' }}
    </div>
  </div>

  <hr>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
  <div class="box">
    <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> {{ sale.customer.name if sale.customer else '-' }}</p>
    <p><strong>Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> {{ sale.customer.phone if sale.customer else '-' }}</p>
  </div>

  <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
  <div class="box">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ø§Ù„ØµÙ†Ù</th>
          <th>Ø§Ù„Ù…Ø®Ø²Ù†</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th>Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
          <th>Ø®ØµÙ… (%)</th>
          <th>Ø¶Ø±ÙŠØ¨Ø© (%)</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        </tr>
      </thead>
      <tbody>
        {% for item in lines %}
          {% set ln = item.obj %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              {{ ln.product.name if ln.product else '-' }}
              {% if ln.note %}<div class="text-muted small">{{ ln.note }}</div>{% endif %}
            </td>
            <td>{{ ln.warehouse.name if ln.warehouse else '-' }}</td>
            <td>{{ ln.quantity }}</td>
            <td>{{ money_fmt(ln.unit_price) }} {{ sale.currency }}</td>
            <td>{{ ln.discount_rate or 0 }}</td>
            <td>{{ ln.tax_rate or 0 }}</td>
            <td>{{ money_fmt(item.line_total) }} {{ sale.currency }}</td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr><td colspan="7" class="text-end">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</td><td>{{ money_fmt(subtotal) }} {{ sale.currency }}</td></tr>
        {% if sale_discount_total and sale_discount_total != 0 %}
        <tr><td colspan="7" class="text-end">Ø®ØµÙ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</td><td>- {{ money_fmt(sale_discount_total) }} {{ sale.currency }}</td></tr>
        {% endif %}
        <tr><td colspan="7" class="text-end">Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…:</td><td>{{ money_fmt(subtotal_after_discount) }} {{ sale.currency }}</td></tr>
        {% if sale_tax_rate and sale_tax_rate != 0 %}
        <tr><td colspan="7" class="text-end">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ({{ sale_tax_rate }}%):</td><td>{{ money_fmt(invoice_tax_amount) }} {{ sale.currency }}</td></tr>
        {% endif %}
        {% if sale_shipping and sale_shipping != 0 %}
        <tr><td colspan="7" class="text-end">Ø§Ù„Ø´Ø­Ù†:</td><td>{{ money_fmt(sale_shipping) }} {{ sale.currency }}</td></tr>
        {% endif %}
        <tr><td colspan="7" class="text-end"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</strong></td><td><strong>{{ money_fmt(grand_total) }} {{ sale.currency }}</strong></td></tr>
      </tfoot>
    </table>
  </div>

  <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
  <div class="box">
    <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> {{ sale.notes or 'â€”' }}</p>
  </div>

  <!-- Ø§Ù„ØªÙˆØ§Ù‚ÙŠØ¹ -->
  <div class="row mt-4">
    <div class="col-md-6 text-center">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¨Ø§Ø¦Ø¹<br><br>{{ sale.seller.username if sale.seller else '________' }}</div>
    <div class="col-md-6 text-center">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„<br><br>__________</div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± -->
  <div class="text-center mt-4 no-print">
    <button class="btn btn-dark" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <a class="btn btn-secondary" href="{{ url_for('sales_bp.sale_detail', id=sale.id) }}">â†©ï¸ Ø±Ø¬ÙˆØ¹</a>
  </div>
</div>

<div class="receipt-footer">
  Ù…Ø¹ ØªØ­ÙŠØ§ØªÙ†Ø§ â€” Ù†ØªØ´Ø±Ù Ø¨Ø®Ø¯Ù…ØªÙƒÙ… â€” Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ - ÙÙ„Ø³Ø·ÙŠÙ† â€” Ø¬ÙˆØ§Ù„: 0592800646 â€” ÙˆØ§ØªØ³Ø§Ø¨: +970592800646
</div>
{% endblock %}
