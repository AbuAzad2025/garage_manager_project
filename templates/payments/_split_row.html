{% set m = (getattr(s.method, 'value', s.method) | string) | lower %}
{% set d = s.details if s.details is mapping else {} %}
<tr id="split-{{ s.id }}">
  <td>{{ loop.index }}. {{ '%.2f'|format(s.amount or 0) }} {{ payment.currency }}</td>
  <td>{{ m|upper }}</td>
  <td>
    {% if m in ['cheque', 'check'] %}
      رقم الشيك: {{ d.get('check_number','—') }}<br>
      البنك: {{ d.get('check_bank','—') }}<br>
      الاستحقاق: {{ d.get('check_due_date','—') }}
    {% elif m in ['bank', 'transfer'] %}
      مرجع التحويل: {{ d.get('bank_transfer_ref', d.get('reference','—')) }}
    {% elif m in ['card', 'credit'] %}
      بطاقة: {{ '****' ~ (d.get('card_last4','')|string) if d.get('card_last4') else '—' }}<br>
      حامل البطاقة: {{ d.get('card_holder','—') }}<br>
      انتهاء: {{ d.get('card_expiry','—') }}
    {% elif m in ['online', 'mobile'] %}
      البوابة: {{ d.get('online_gateway', d.get('gateway','—')) }}<br>
      المرجع: {{ d.get('online_ref', d.get('reference','—')) }}
    {% elif m == 'cash' %}
      نقداً
    {% else %}
      —
    {% endif %}
  </td>
  <td>
    <button type="button" class="btn btn-sm btn-danger remove-split" data-split-id="{{ s.id }}">حذف</button>
  </td>
</tr>
