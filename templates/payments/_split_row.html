{% set st = enum_val(payment.status) %}
{% set is_completed = st == 'COMPLETED' %}
{% set m = (enum_val(s.method) | string) | lower %}
{% set d = s.details if s.details is mapping else {} %}

<tr id="split-{{ s.id }}">
  <td>{{ loop.index }}.</td>

{% set base_currency = (s.currency or payment.currency or '') %}
{% set main_currency = payment.currency or '' %}
<td class="amount-cell" data-amount="{{ '%.2f'|format(s.converted_amount or s.amount or 0) }}">
  {{ '%.2f'|format(s.amount or 0) }} {{ base_currency }}
  {% if base_currency and main_currency and base_currency.upper() != main_currency.upper() %}
    <div class="text-muted small">â‰ˆ {{ '%.2f'|format(s.converted_amount or 0) }} {{ main_currency }}</div>
  {% endif %}
  </td>

  <td>{{ m|upper }}</td>

  <td>
    {% if m in ['cheque', 'check'] %}
      Ø±Ù‚Ù… Ø§Ù„Ø´ÙŠÙƒ: {{ d.get('check_number') or 'â€”' }}<br>
      Ø§Ù„Ø¨Ù†Ùƒ: {{ d.get('check_bank') or 'â€”' }}<br>
      Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {{ d.get('check_due_date') or d.get('due_date') or 'â€”' }}

    {% elif m in ['bank', 'transfer', 'bank_transfer'] %}
      Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„: {{ d.get('bank_transfer_ref') or d.get('reference') or 'â€”' }}

    {% elif m in ['card', 'credit'] %}
      Ø¨Ø·Ø§Ù‚Ø©: {{
        (d.get('card_last4') and ('****' ~ (d.get('card_last4')|string)))
        or (d.get('card_number') and ('****' ~ ((d.get('card_number')|string)[-4:])) )
        or 'â€”'
      }}<br>
      Ø­Ø§Ù…Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: {{ d.get('card_holder') or 'â€”' }}<br>
      Ø§Ù†ØªÙ‡Ø§Ø¡: {{ d.get('card_expiry') or 'â€”' }}

    {% elif m in ['online', 'mobile'] %}
      Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©: {{ d.get('online_gateway') or d.get('gateway') or 'â€”' }}<br>
      Ø§Ù„Ù…Ø±Ø¬Ø¹: {{ d.get('online_ref') or d.get('reference') or 'â€”' }}

    {% elif m == 'cash' %}
      Ù†Ù‚Ø¯Ø§Ù‹

    {% else %}
      â€”
    {% endif %}
  </td>

  <td>
    <button type="button"
            class="btn btn-sm btn-danger remove-split"
            data-split-id="{{ s.id }}"
            {% if is_completed %}disabled{% endif %}>
      ğŸ—‘ï¸ Ø­Ø°Ù
    </button>
  </td>
</tr>
