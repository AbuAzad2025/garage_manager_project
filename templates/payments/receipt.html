<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="utf-8">
  <title>ÙˆØµÙ„ Ø¯ÙØ¹ #{{ payment.id }}</title>
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; direction: rtl; text-align: right; }
    .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid #333; padding-bottom: 10px; }
    .company-info { margin-bottom: 30px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
    th { background: #f2f2f2; }
    .total-row { background: #f8f9fa; font-weight: bold; }
    .footer { text-align: center; font-size: 0.9em; color: #6c757d; border-top: 1px solid #ddd; padding-top: 10px; }
    .signature { margin-top: 50px; text-align: left; }
  </style>
</head>
<body>
  <div class="header">
    <h1>ÙˆØµÙ„ Ø¯ÙØ¹</h1>
    <h2>Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„: #{{ payment.id }}</h2>
  </div>

  <div class="company-info">
    <p><strong>Ø´Ø±ÙƒØ©:</strong> Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø°ÙƒÙŠ</p>
    <p><strong>Ø¹Ù†ÙˆØ§Ù†:</strong> ØºØ²Ø©ØŒ ÙÙ„Ø³Ø·ÙŠÙ†</p>
    <p><strong>Ù‡Ø§ØªÙ:</strong> 123456789</p>
    <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:</strong> {{ now.strftime('%Y-%m-%d %H:%M') }}</p>
  </div>

  {% set method_main = payment.method.value if payment.method and payment.method.value else payment.method %}
  {% set status_main = payment.status.value if payment.status and payment.status.value else payment.status %}
  {% set dir_main    = payment.direction.value if payment.direction and payment.direction.value else payment.direction %}

  <table>
    <tr><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</th><td>{{ '%.2f'|format(payment.total_amount or 0) }} {{ payment.currency }}</td></tr>
    <tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><td>{{ payment.payment_date and payment.payment_date.strftime('%Y-%m-%d') or 'â€”' }}</td></tr>
    <tr><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (Ø±Ø¦ÙŠØ³ÙŠØ©)</th><td>{{ method_main or 'â€”' }}</td></tr>
    <tr><th>Ø§Ù„Ø¬Ù‡Ø©</th><td>{{ payment.entity_label() or (payment.entity_type|capitalize) }}</td></tr>
    <tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><td>{{ status_main }}</td></tr>
    <tr><th>Ø§Ù„Ø§ØªØ¬Ø§Ù‡</th><td>{{ 'ÙˆØ§Ø±Ø¯' if dir_main in ['IN','INCOMING'] else 'ØµØ§Ø¯Ø±' }}</td></tr>
    <tr><th>Ø§Ù„Ù…Ø±Ø¬Ø¹</th><td>{{ payment.reference or 'â€”' }}</td></tr>
    <tr><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><td>{{ payment.notes or 'â€”' }}</td></tr>
  </table>

  <h3>ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©:</h3>
  <table>
    <thead>
      <tr><th>#</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø·Ø±ÙŠÙ‚Ø©</th><th>ØªÙØ§ØµÙŠÙ„</th></tr>
    </thead>
    <tbody>
      {% for split in payment.splits %}
      {% set m = split.method.value if split.method and split.method.value else split.method %}
      {% set d = split.details or {} %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ '%.2f'|format(split.amount or 0) }} {{ payment.currency }}</td>
        <td>{{ (m or 'â€”')|upper }}</td>
        <td>
          {% if m == 'cheque' %}
            Ø±Ù‚Ù… Ø´ÙŠÙƒ: {{ d.get('check_number','â€”') }}<br>
            Ø¨Ù†Ùƒ: {{ d.get('check_bank','â€”') }}<br>
            Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {{ d.get('check_due_date') or d.get('due_date') or 'â€”' }}
          {% elif m == 'bank' %}
            ØªØ­ÙˆÙŠÙ„: {{ d.get('bank_transfer_ref','â€”') }}
          {% elif m == 'card' %}
            Ø¨Ø·Ø§Ù‚Ø©: ****{{ (d.get('card_number','')|string)[-4:] }}<br>
            Ø­Ø§Ù…Ù„: {{ d.get('card_holder','â€”') }}<br>
            Ø§Ù†ØªÙ‡Ø§Ø¡: {{ d.get('card_expiry','â€”') }}
          {% elif m == 'online' %}
            Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ({{ d.get('gateway','â€”') }})
          {% else %}
            â€”
          {% endif %}
        </td>
      </tr>
      {% endfor %}
      <tr class="total-row">
        <td colspan="3">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</td>
        <td>{{ '%.2f'|format(payment.total_amount or 0) }} {{ payment.currency }}</td>
      </tr>
    </tbody>
  </table>

  <div class="signature">
    <p>ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…: ____________</p>
    <p>Ø§Ù„Ø§Ø³Ù…: ____________</p>
    <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ____________</p>
  </div>

  <div class="footer">
    <p>Â© {{ now.year }} Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª - Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø°ÙƒÙŠ</p>
  </div>
</body>
</html>
