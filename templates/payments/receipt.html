{% extends "base_print.html" %}
{% block title %}ÙˆØµÙ„ Ø¯ÙØ¹{% endblock %}

{% block head_extra %}
  <style>
    @page { size: A4 portrait; margin: 12mm; }  /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
    @media print { .no-print { display: none !important; } }

    {% if request.args.get('o') == 'landscape' %}
    @page { size: 297mm 210mm; margin: 12mm; }  /* A4 landscape */
    #receipt { width: 273mm !important; }
    {% endif %}

    body { background:#fff; font-family:'Amiri','Arial',sans-serif; font-size:14px; }
    .receipt-footer {
      position: fixed; bottom: 0; left: 0; right: 0;
      font-size: 12px; border-top: 1px solid #ccc;
      padding: 6px; background: #fff; text-align:center;
    }
    .receipt-header { display:flex; justify-content:space-between; align-items:center; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand .logo { max-height:60px; }
    .brand-name { font-size:18px; font-weight:700; }
    .brand-sub { font-size:14px; color:#555; }
    .box { border:1px solid #ddd; border-radius:6px; padding:10px; background:#fafafa; margin-bottom:12px; }
    table { width:100%; border-collapse:collapse; margin-bottom:12px; font-size:13px; }
    th, td { border:1px solid #ddd; padding:6px 8px; text-align:right; }
    th { background:#f2f2f2; }
    .totals .rowline { display:flex; justify-content:space-between; margin:4px 0; }
    .totals .highlight { font-size:16px; color:#d63384; font-weight:700; }
  </style>
{% endblock %}

{% block content %}
<div id="receipt" class="container my-4">

  <!-- Ø±Ø£Ø³ Ù…Ø¹ Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù† -->
  <div class="receipt-header">
    <div class="brand">
      <img class="logo" src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
      <div>
        <div class="brand-name">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠ Ù„Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ø«Ù‚ÙŠÙ„Ø©</div>
        <div class="brand-sub">ÙˆØµÙ„ Ø¯ÙØ¹</div>
      </div>
    </div>
    <div class="text-muted">
      Ø±Ù‚Ù… Ø§Ù„ÙˆØµÙ„: <strong>{{ payment.id }}</strong><br>
      Ø§Ù„ØªØ§Ø±ÙŠØ®: {{ payment.payment_date and payment.payment_date.strftime('%Y-%m-%d') or 'â€”' }}
    </div>
  </div>

  <hr>

  <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹ -->
  <div class="box">
    <table>
      <tr><th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ</th><td>{{ '%.2f'|format(payment.total_amount or 0) }} {{ payment.currency }}</td></tr>
      <tr><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th><td>{{ payment.method.value if payment.method else 'â€”' }}</td></tr>
      <tr><th>Ø§Ù„Ø§ØªØ¬Ø§Ù‡</th><td>{{ 'ÙˆØ§Ø±Ø¯' if payment.direction in ['IN','INCOMING'] else 'ØµØ§Ø¯Ø±' }}</td></tr>
      <tr><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><td>{{ payment.status.value if payment.status else 'â€”' }}</td></tr>
      <tr><th>Ø§Ù„Ø¬Ù‡Ø©</th><td>{{ payment.entity_label() or payment.entity_type }}</td></tr>
      <tr><th>Ø§Ù„Ù…Ø±Ø¬Ø¹</th><td>{{ payment.reference or 'â€”' }}</td></tr>
      <tr><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><td>{{ payment.notes or 'â€”' }}</td></tr>
    </table>
  </div>

  <!-- Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© -->
  {% if payment.splits %}
  <div class="box">
    <h5>ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©</h5>
    <table>
      <thead>
        <tr>
          <th>#</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</th><th>ØªÙØ§ØµÙŠÙ„</th>
        </tr>
      </thead>
      <tbody>
        {% for split in payment.splits %}
        {% set m = split.method.value if split.method else split.method %}
        {% set d = split.details or {} %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ '%.2f'|format(split.amount or 0) }} {{ payment.currency }}</td>
          <td>{{ (m or 'â€”')|upper }}</td>
          <td>
            {% if m == 'cheque' %}
              Ø´ÙŠÙƒ: {{ d.get('check_number','â€”') }}, Ø¨Ù†Ùƒ: {{ d.get('check_bank','â€”') }}, Ø§Ø³ØªØ­Ù‚Ø§Ù‚: {{ d.get('check_due_date') or d.get('due_date') or 'â€”' }}
            {% elif m == 'bank' %}
              ØªØ­ÙˆÙŠÙ„: {{ d.get('bank_transfer_ref','â€”') }}
            {% elif m == 'card' %}
              Ø¨Ø·Ø§Ù‚Ø©: ****{{ (d.get('card_number','')|string)[-4:] }}, Ø­Ø§Ù…Ù„: {{ d.get('card_holder','â€”') }}, Ø§Ù†ØªÙ‡Ø§Ø¡: {{ d.get('card_expiry','â€”') }}
            {% elif m == 'online' %}
              Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ({{ d.get('gateway','â€”') }})
            {% else %} â€” {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- ØªÙˆÙ‚ÙŠØ¹ -->
  <div class="row mt-4">
    <div class="col-md-6 text-center">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ„Ù…<br><br>__________</div>
    <div class="col-md-6 text-center">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„<br><br>__________</div>
  </div>

  <!-- Ø£Ø²Ø±Ø§Ø± -->
  <div class="text-center mt-4 no-print">
    <button class="btn btn-dark" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
    <a class="btn btn-secondary" href="{{ url_for('payments.view_payment', payment_id=payment.id) }}">â†©ï¸ Ø±Ø¬ÙˆØ¹</a>
  </div>
</div>

<div class="receipt-footer">
  Ù…Ø¹ ØªØ­ÙŠØ§ØªÙ†Ø§ â€” Ù†ØªØ´Ø±Ù Ø¨Ø®Ø¯Ù…ØªÙƒÙ… â€” Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ - ÙÙ„Ø³Ø·ÙŠÙ† â€” Ø¬ÙˆØ§Ù„: 0592800646 â€” ÙˆØ§ØªØ³Ø§Ø¨: +970592800646
</div>
{% endblock %}
