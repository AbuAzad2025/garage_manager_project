{% extends "base.html" %}
{% block title %}ØªØ³ÙˆÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø© - {{ settlement.code }}{% endblock %}

{% block content %}
<div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1 class="m-0">
                        <i class="fas fa-file-invoice"></i> ØªØ³ÙˆÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø©
                    </h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                        <li class="breadcrumb-item"><a href="{{ url_for('supplier_settlements_bp.approved_settlements_list') }}">Ø§Ù„ØªØ³ÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</a></li>
                        <li class="breadcrumb-item active">{{ settlement.code }}</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <section class="content">
        <div class="container-fluid">
            
            <div class="alert alert-success mb-3">
                <small><strong>â„¹ï¸</strong> Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ØªØ³ÙˆÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ø¹ Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„</small>
            </div>
            
            <div class="card">
                <div class="card-header bg-success text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="mb-0"><i class="fas fa-check-circle"></i> {{ settlement.code }}</h3>
                        <span class="badge bg-light text-dark fs-6">
                            <i class="fas fa-calendar"></i> {{ settlement.approved_at.strftime('%Y-%m-%d') if settlement.approved_at else '-' }}
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5><i class="fas fa-truck"></i> {{ supplier.name }}</h5>
                            <p class="mb-1">
                                <strong>Ø§Ù„ÙØªØ±Ø©:</strong> 
                                {{ settlement.from_date.strftime('%Y-%m-%d') }} 
                                <i class="fas fa-arrow-left"></i> 
                                {{ settlement.to_date.strftime('%Y-%m-%d') }}
                            </p>
                            <p class="mb-0">
                                <small class="text-muted">
                                    <i class="fas fa-user"></i> Ø§Ù„Ù…Ø¹ØªÙ…Ø¯: {{ settlement.approved_by_user.username if settlement.approved_by_user else '-' }}
                                </small>
                            </p>
                        </div>
                        <div class="col-md-6 text-end">
                            {% if gl_batch %}
                            <div class="alert alert-success mb-0">
                                <h6><i class="fas fa-book"></i> Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ</h6>
                                <code class="fs-6">{{ gl_batch.code }}</code>
                                <br><small>Ù…Ø³Ø¬Ù„ ÙÙŠ Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø°</small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <div class="card border-secondary">
                                <div class="card-body text-center">
                                    <h6 class="text-muted">Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ</h6>
                                    <h3 class="{% if settlement.opening_balance > 0 %}text-success{% elif settlement.opening_balance < 0 %}text-danger{% else %}text-secondary{% endif %}">
                                        {{ "%.2f"|format(settlement.opening_balance|abs) }}
                                    </h3>
                                    <small class="badge {% if settlement.opening_balance > 0 %}bg-success{% elif settlement.opening_balance < 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                                        {{ "Ù„Ù‡" if settlement.opening_balance > 0 else "Ø¹Ù„ÙŠÙ‡" if settlement.opening_balance < 0 else "0" }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-success">
                                <div class="card-body text-center bg-light">
                                    <h6 class="text-success">ğŸŸ¢ Ø§Ù„Ø­Ù‚ÙˆÙ‚</h6>
                                    <h3 class="text-success">{{ "%.2f"|format(settlement.rights_total) }}</h3>
                                    <small class="text-muted">{{ "%.0f"|format(settlement.rights_exchange) }} Ù‚Ø·Ø¹Ø©</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-danger">
                                <div class="card-body text-center bg-light">
                                    <h6 class="text-danger">ğŸ”´ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h6>
                                    <h3 class="text-danger">{{ "%.2f"|format(settlement.obligations_total) }}</h3>
                                    <small class="text-muted">
                                        ğŸ›’ {{ "%.0f"|format(settlement.obligations_sales) }} | 
                                        ğŸ”§ {{ "%.0f"|format(settlement.obligations_services) }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-primary shadow">
                                <div class="card-body text-center" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                                    <h6 class="text-primary">ğŸ¯ Ø§Ù„Ø®ØªØ§Ù…ÙŠ</h6>
                                    <h2 class="{% if settlement.closing_balance > 0 %}text-success{% elif settlement.closing_balance < 0 %}text-danger{% else %}text-secondary{% endif %}">
                                        {{ "%.2f"|format(settlement.closing_balance|abs) }}
                                    </h2>
                                    <span class="badge {% if settlement.closing_balance > 0 %}bg-success{% elif settlement.closing_balance < 0 %}bg-danger{% else %}bg-secondary{% endif %}">
                                        {{ "Ù„Ù‡ Ø¹Ù„ÙŠÙ†Ø§" if settlement.closing_balance > 0 else "Ø¹Ù„ÙŠÙ‡ Ù„Ù†Ø§" if settlement.closing_balance < 0 else "Ù…ØªÙˆØ§Ø²Ù†" }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-3">
                        <div class="card-header bg-white">
                            <h5 class="mb-0"><i class="fas fa-calculator"></i> Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠØ©</h5>
                        </div>
                        <div class="card-body bg-light">
                            <div class="text-center" style="font-size: 1.1rem;">
                                <span class="badge bg-secondary">{{ "%.2f"|format(settlement.opening_balance) }}</span>
                                <span class="mx-2">+</span>
                                <span class="badge bg-success">{{ "%.2f"|format(settlement.rights_total) }}</span>
                                <span class="mx-2">-</span>
                                <span class="badge bg-danger">{{ "%.2f"|format(settlement.obligations_total) }}</span>
                                <span class="mx-2">-</span>
                                <span class="badge bg-warning">{{ "%.2f"|format(settlement.payments_out) }}</span>
                                <span class="mx-2">+</span>
                                <span class="badge bg-info">{{ "%.2f"|format(settlement.payments_in) }}</span>
                                <span class="mx-2">-</span>
                                <span class="badge bg-warning">{{ "%.2f"|format(settlement.payments_returns) }}</span>
                                {% if settlement.obligations_expenses > 0 %}
                                <span class="mx-2">-</span>
                                <span class="badge bg-danger">{{ "%.2f"|format(settlement.obligations_expenses) }}</span>
                                {% endif %}
                                <span class="mx-2">=</span>
                                <span class="badge bg-primary fs-5">{{ "%.2f"|format(settlement.closing_balance) }} â‚ª</span>
                            </div>
                            <div class="text-center mt-2">
                                <small class="text-muted">Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ + Ø§Ù„Ø­Ù‚ÙˆÙ‚ - Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª - Ø¯ÙØ¹Ù†Ø§ Ù„Ù‡ + Ø¯ÙØ¹ Ù„Ù†Ø§ - Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª {% if settlement.obligations_expenses > 0 %}- Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ{% endif %} = Ø§Ù„Ø®ØªØ§Ù…ÙŠ</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0"><i class="fas fa-hand-holding-usd"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm mb-0">
                                        <tr>
                                            <td>Ù‚Ø·Ø¹ Ø§Ù„ØªØ¨Ø§Ø¯Ù„</td>
                                            <td class="text-end"><strong>{{ "%.2f"|format(settlement.rights_exchange) }} â‚ª</strong></td>
                                        </tr>
                                        <tr class="table-success fw-bold">
                                            <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                                            <td class="text-end">{{ "%.2f"|format(settlement.rights_total) }} â‚ª</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-danger text-white">
                                    <h6 class="mb-0"><i class="fas fa-file-invoice"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…Ø§Øª</h6>
                                </div>
                                <div class="card-body">
                                    <table class="table table-sm mb-0">
                                        <tr>
                                            <td>Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù‡</td>
                                            <td class="text-end"><strong>{{ "%.2f"|format(settlement.obligations_sales) }} â‚ª</strong></td>
                                        </tr>
                                        <tr>
                                            <td>ØµÙŠØ§Ù†Ø© Ù„Ù‡</td>
                                            <td class="text-end"><strong>{{ "%.2f"|format(settlement.obligations_services) }} â‚ª</strong></td>
                                        </tr>
                                        {% if settlement.obligations_preorders > 0 %}
                                        <tr>
                                            <td>Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø³Ø¨Ù‚Ø©</td>
                                            <td class="text-end"><strong>{{ "%.2f"|format(settlement.obligations_preorders) }} â‚ª</strong></td>
                                        </tr>
                                        {% endif %}
                                        <tr class="table-danger fw-bold">
                                            <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</td>
                                            <td class="text-end">{{ "%.2f"|format(settlement.obligations_total) }} â‚ª</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-3 mt-3">
                        <div class="card-header bg-warning">
                            <h6 class="mb-0"><i class="fas fa-money-bill-wave"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <h6 class="text-danger">ğŸ’¸ Ø¯ÙØ¹Ù†Ø§ Ù„Ù‡ (OUT)</h6>
                                    <h4 class="text-danger">{{ "%.2f"|format(settlement.payments_out) }} â‚ª</h4>
                                </div>
                                <div class="col-md-3">
                                    <h6 class="text-success">ğŸ’µ Ø¯ÙØ¹ Ù„Ù†Ø§ (IN)</h6>
                                    <h4 class="text-success">{{ "%.2f"|format(settlement.payments_in) }} â‚ª</h4>
                                </div>
                                <div class="col-md-3">
                                    <h6 class="text-warning">ğŸ”„ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª</h6>
                                    <h4 class="text-warning">{{ "%.2f"|format(settlement.payments_returns) }} â‚ª</h4>
                                </div>
                                {% if settlement.obligations_expenses > 0 %}
                                <div class="col-md-3">
                                    <h6 class="text-danger">ğŸ’° Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h6>
                                    <h4 class="text-danger">{{ "%.2f"|format(settlement.obligations_expenses) }} â‚ª</h4>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 no-print">
                        <a href="{{ url_for('supplier_settlements_bp.approved_settlements_list') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                        </a>
                        <a href="{{ url_for('supplier_settlements_bp.supplier_settlement', supplier_id=supplier.id) }}" class="btn btn-primary">
                            <i class="fas fa-calculator"></i> ØªØ³ÙˆÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                        </a>
                        <button class="btn btn-success" onclick="window.print()">
                            <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                    
                </div>
            </div>
            
        </div>
    </section>
{% endblock %}



