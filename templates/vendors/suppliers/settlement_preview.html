{% extends "layout.html" %}
{% block title %}تسوية مورد {{ ss.supplier.name }} ({{ ss.code }}){% endblock %}
{% block content %}
<div class="container" dir="rtl">
  <h3>تسوية مورد: {{ ss.supplier.name }} <small class="text-muted">({{ ss.code }})</small></h3>
  <div class="mb-2 text-muted">الفترة: {{ ss.from_date.strftime("%Y-%m-%d") }} → {{ ss.to_date.strftime("%Y-%m-%d") }} | الحالة: <span class="badge bg-info">{{ ss.status }}</span></div>
  <table class="table table-sm table-striped align-middle">
    <thead>
      <tr>
        <th>#</th><th>المصدر</th><th>الوصف</th><th>المنتج</th>
        <th class="text-end">الكمية</th><th class="text-end">سعر</th><th class="text-end">القيمة</th>
      </tr>
    </thead>
    <tbody>
      {% for i, l in enumerate(ss.lines, start=1) %}
      <tr>
        <td>{{ i }}</td>
        <td>{{ l.source_type }}#{{ l.source_id }}</td>
        <td>{{ l.description or "—" }}</td>
        <td>{{ l.product.name if l.product else l.product_id }}</td>
        <td class="text-end">{{ "%.3f"|format(l.quantity or 0) if l.quantity is not none else "—" }}</td>
        <td class="text-end">{{ "%.2f"|format(l.unit_price or 0) if l.unit_price is not none else "—" }}</td>
        <td class="text-end fw-bold">{{ "%.2f"|format(l.gross_amount or 0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="row g-3">
    <div class="col-md-4"><div class="card"><div class="card-body"><div class="small text-muted">الإجمالي</div><div class="fs-5">{{ "%.2f"|format(ss.total_gross or 0) }} {{ ss.currency }}</div></div></div></div>
    <div class="col-md-4"><div class="card"><div class="card-body"><div class="small text-muted">المدفوع</div><div class="fs-5">{{ "%.2f"|format(ss.total_paid or 0) }} {{ ss.currency }}</div></div></div></div>
    <div class="col-md-4"><div class="card"><div class="card-body"><div class="small text-muted">المتبقّي</div><div class="fs-5">{{ "%.2f"|format(ss.remaining or 0) }} {{ ss.currency }}</div></div></div></div>
  </div>
  {% if ss.status == "DRAFT" %}
  <form method="post" action="{{ url_for('supplier_settlements_bp.confirm', settlement_id=ss.id) }}" class="mt-3">
    <button class="btn btn-primary">تأكيد التسوية</button>
  </form>
  {% endif %}
</div>
{% endblock %}
