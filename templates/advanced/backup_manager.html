{% extends 'base.html' %}

{% block title %}┘Е╪п┘К╪▒ ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й{% endblock %}

{% block page_title %}ЁЯТ╛ ┘Е╪п┘К╪▒ ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й ╪з┘Д┘Е╪к┘В╪п┘Е{% endblock %}

{% block content %}
<div class="container-fluid">
  
  {% include 'advanced/_navigation.html' %}
  
  <!-- ╪и╪╖╪з┘В╪з╪к ╪е╪н╪╡╪з╪ж┘К╪й ╪│╪▒┘К╪╣╪й -->
  <div class="row g-3 mb-4">
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm bg-primary text-white h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">╪е╪м┘Е╪з┘Д┘К ╪з┘Д┘Ж╪│╪о</h6>
              <h3 class="mb-0 fw-bold">{{ backups|length }}</h3>
              <small class="opacity-75">┘Ж╪│╪о╪й ╪з╪н╪к┘К╪з╪╖┘К╪й</small>
            </div>
            <i class="fas fa-database fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm bg-success text-white h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">┘Ж┘И╪╣ ╪з┘Д┘В╪з╪╣╪п╪й</h6>
              <h3 class="mb-0 fw-bold">{{ current_db_type|upper }}</h3>
              <small class="opacity-75">┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к</small>
            </div>
            <i class="fas fa-server fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm bg-info text-white h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">╪з┘Д╪м╪п┘И┘Д╪й ╪з┘Д╪к┘Д┘В╪з╪ж┘К╪й</h6>
              <h3 class="mb-0 fw-bold">{{ schedule_status|default('┘Е╪╣╪╖┘Д╪й') }}</h3>
              <small class="opacity-75">╪з┘Д╪н╪з┘Д╪й</small>
            </div>
            <i class="fas fa-clock fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm bg-warning text-white h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-white-50 mb-1">╪в╪о╪▒ ┘Ж╪│╪о╪й</h6>
              <h3 class="mb-0 fw-bold">{{ backups[0].date if backups else '┘Д╪з ┘К┘И╪м╪п' }}</h3>
              <small class="opacity-75">{{ backups[0].name if backups else '-' }}</small>
            </div>
            <i class="fas fa-history fa-2x opacity-50"></i>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="alert alert-info border-0 shadow-sm mb-4">
    <h5><i class="fas fa-database"></i> <strong>┘Е╪п┘К╪▒ ╪з┘Д┘Ж╪│╪о ╪з┘Д┘Е╪к┘В╪п┘Е</strong></h5>
    <p class="mb-0">┘Ж╪│╪о ╪з╪н╪к┘К╪з╪╖┘К + ╪к╪н┘И┘К┘Д ┘В┘И╪з╪╣╪п ╪з┘Д╪и┘К╪з┘Ж╪з╪к + ╪м╪п┘И┘Д╪й ╪к┘Д┘В╪з╪ж┘К╪й</p>
  </div>

  <!-- Tabs Navigation -->
  <ul class="nav nav-tabs mb-4" id="backupTabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" id="backups-tab" data-toggle="tab" href="#backups" role="tab">
        <i class="fas fa-save"></i> ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="schedule-tab" data-toggle="tab" href="#schedule" role="tab">
        <i class="fas fa-clock"></i> ╪з┘Д╪м╪п┘И┘Д╪й ╪з┘Д╪к┘Д┘В╪з╪ж┘К╪й
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" id="convert-tab" data-toggle="tab" href="#convert" role="tab">
        <i class="fas fa-exchange-alt"></i> ╪к╪н┘И┘К┘Д ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к
      </a>
    </li>
  </ul>

  <!-- Tabs Content -->
  <div class="tab-content" id="backupTabsContent">
    
    <!-- ============================================ -->
    <!-- TAB 1: ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й -->
    <!-- ============================================ -->
    <div class="tab-pane fade in active show" id="backups" role="tabpanel">
      <div class="row">
        <!-- ╪е┘Ж╪┤╪з╪б ┘Ж╪│╪о╪й ╪м╪п┘К╪п╪й -->
        <div class="col-md-4">
          <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="fas fa-plus"></i> ┘Ж╪│╪о╪й ╪з╪н╪к┘К╪з╪╖┘К╪й ╪м╪п┘К╪п╪й</h5>
            </div>
            <div class="card-body">
              <form method="POST" action="{{ url_for('advanced.backup_manager') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="create_backup">
                
                <div class="mb-3">
                  <label class="form-label fw-bold">╪з╪│┘Е ╪з┘Д┘Ж╪│╪о╪й (╪з╪о╪к┘К╪з╪▒┘К)</label>
                  <input type="text" name="backup_name" class="form-control" placeholder="backup_custom_name">
                  <small class="text-muted">╪е╪░╪з ╪к╪▒┘Г╪к┘З ┘Б╪з╪▒╪║╪з┘Л ╪│┘К╪к┘Е ╪з┘Д╪к╪│┘Е┘К╪й ╪к┘Д┘В╪з╪ж┘К╪з┘Л</small>
                </div>
                
                <div class="alert alert-info small">
                  <strong>┘Ж┘И╪╣ ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д╪н╪з┘Д┘К╪й:</strong><br>
                  <span class="badge bg-primary">{{ current_db_type }}</span>
                </div>
                
                <button type="submit" class="btn btn-success w-100 btn-lg">
                  <i class="fas fa-save"></i> ╪е┘Ж╪┤╪з╪б ┘Ж╪│╪о╪й ╪з┘Д╪в┘Ж
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- ┘В╪з╪ж┘Е╪й ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й -->
        <div class="col-md-8">
          <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="fas fa-history"></i> ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й ╪з┘Д┘Е╪к┘И┘Б╪▒╪й ({{ backups|length }})</h5>
            </div>
            <div class="card-body">
              {% if backups %}
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>╪з╪│┘Е ╪з┘Д┘Е┘Д┘Б</th>
                      <th>╪з┘Д╪н╪м┘Е</th>
                      <th>╪з┘Д╪к╪з╪▒┘К╪о</th>
                      <th>╪з┘Д╪е╪м╪▒╪з╪б╪з╪к</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for backup in backups %}
                    <tr>
                      <td><code>{{ backup.name }}</code></td>
                      <td><span class="badge bg-info">{{ backup.size }}</span></td>
                      <td>{{ backup.date }}</td>
                      <td>
                        <div class="btn-group btn-group-sm">
                          <!-- ╪з╪│╪к╪╣╪з╪п╪й -->
                          <form method="POST" action="{{ url_for('advanced.restore_backup', filename=backup.name) }}" style="display:inline;" onsubmit="return confirm('тЪая╕П ┘З┘Д ╪г┘Ж╪к ┘Е╪к╪г┘Г╪п ┘Е┘Ж ╪з╪│╪к╪╣╪з╪п╪й ┘З╪░┘З ╪з┘Д┘Ж╪│╪о╪й╪Я');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-success btn-sm">
                              <i class="fas fa-undo"></i> ╪з╪│╪к╪╣╪з╪п╪й
                            </button>
                          </form>
                          
                          <!-- ╪к╪н┘Е┘К┘Д -->
                          <a href="{{ url_for('advanced.download_backup', filename=backup.name) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-download"></i> ╪к╪н┘Е┘К┘Д
                          </a>
                          
                          <!-- ╪н╪░┘Б -->
                          <form method="POST" action="{{ url_for('advanced.delete_backup', filename=backup.name) }}" style="display:inline;" onsubmit="return confirm('тЪая╕П ┘З┘Д ╪г┘Ж╪к ┘Е╪к╪г┘Г╪п ┘Е┘Ж ╪н╪░┘Б ┘З╪░┘З ╪з┘Д┘Ж╪│╪о╪й╪Я');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger btn-sm">
                              <i class="fas fa-trash"></i> ╪н╪░┘Б
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% else %}
              <div class="alert alert-warning text-center">
                <i class="fas fa-exclamation-triangle"></i> ┘Д╪з ╪к┘И╪м╪п ┘Ж╪│╪о ╪з╪н╪к┘К╪з╪╖┘К╪й ╪н╪з┘Д┘К╪з┘Л
              </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- TAB 2: ╪з┘Д╪м╪п┘И┘Д╪й ╪з┘Д╪к┘Д┘В╪з╪ж┘К╪й -->
    <!-- ============================================ -->
    <div class="tab-pane fade" id="schedule" role="tabpanel">
      <div class="row">
        <div class="col-md-6 mx-auto">
          <div class="card shadow-lg">
            <div class="card-header bg-gradient-primary text-white">
              <h5 class="mb-0"><i class="fas fa-clock"></i> ╪м╪п┘И┘Д╪й ╪з┘Д┘Ж╪│╪о ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К ╪з┘Д╪к┘Д┘В╪з╪ж┘К</h5>
            </div>
            <div class="card-body">
              
              <!-- ╪н╪з┘Д╪й ╪з┘Д╪к┘Б╪╣┘К┘Д -->
              <div class="d-flex justify-content-between align-items-center mb-4 p-3 border rounded">
                <div>
                  {% if auto_backup_enabled %}
                  <div class="text-success">
                    <i class="fas fa-check-circle fa-2x"></i>
                    <h6 class="mt-2 mb-0">┘Е┘Б╪╣┘С┘Д</h6>
                    <small>╪з┘Д┘Ж┘И╪╣: {{ schedule_info.type or '┘К┘И┘Е┘К' }} - ╪з┘Д┘И┘В╪к: {{ schedule_info.time or '03:00' }}</small>
                  </div>
                  {% else %}
                  <div class="text-warning">
                    <i class="fas fa-exclamation-triangle fa-2x"></i>
                    <h6 class="mt-2 mb-0">╪║┘К╪▒ ┘Е┘Б╪╣┘С┘Д</h6>
                  </div>
                  {% endif %}
                </div>
                
                <form method="POST" action="{{ url_for('advanced.toggle_auto_backup') }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="btn btn-{% if auto_backup_enabled %}warning{% else %}success{% endif %} btn-lg">
                    <i class="fas fa-power-off"></i> {% if auto_backup_enabled %}╪к╪╣╪╖┘К┘Д{% else %}╪к┘Б╪╣┘К┘Д{% endif %}
                  </button>
                </form>
              </div>
              
              <!-- ┘Ж┘Е┘И╪░╪м ╪з┘Д╪м╪п┘И┘Д╪й -->
              <form method="POST" action="{{ url_for('advanced.backup_manager') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="schedule_backup">
                
                <div class="mb-4">
                  <label class="form-label fw-bold">┘Ж┘И╪╣ ╪з┘Д╪м╪п┘И┘Д╪й</label>
                  <select name="schedule_type" class="form-select form-select-lg" required>
                    <option value="hourly" {% if schedule_info.type == 'hourly' %}selected{% endif %}>┘Г┘Д ╪│╪з╪╣╪й</option>
                    <option value="daily" {% if schedule_info.type == 'daily' or not schedule_info.type %}selected{% endif %}>┘К┘И┘Е┘К╪з┘Л</option>
                    <option value="weekly" {% if schedule_info.type == 'weekly' %}selected{% endif %}>╪г╪│╪и┘И╪╣┘К╪з┘Л</option>
                    <option value="monthly" {% if schedule_info.type == 'monthly' %}selected{% endif %}>╪┤┘З╪▒┘К╪з┘Л</option>
                  </select>
                </div>
                
                <div class="mb-4">
                  <label class="form-label fw-bold">╪з┘Д┘И┘В╪к</label>
                  <input type="time" name="schedule_time" class="form-control form-control-lg" value="{{ schedule_info.time or '03:00' }}" required>
                  <small class="text-muted">╪з┘Д┘И┘В╪к ╪з┘Д┘Е┘Б╪╢┘Д ┘Д╪е┘Ж╪┤╪з╪б ╪з┘Д┘Ж╪│╪о╪й ╪з┘Д╪з╪н╪к┘К╪з╪╖┘К╪й</small>
                </div>
                
                <div class="alert alert-info">
                  <i class="fas fa-lightbulb"></i> <strong>┘Ж╪╡┘К╪н╪й:</strong> ┘К┘П┘Б╪╢┘Д ╪м╪п┘И┘Д╪й ╪з┘Д┘Ж╪│╪о ┘Б┘К ┘И┘В╪к ┘В┘Д┘К┘Д ╪з┘Д╪з╪│╪к╪о╪п╪з┘Е (┘Е╪л┘Д ╪з┘Д╪│╪з╪╣╪й 3 ╪╡╪и╪з╪н╪з┘Л)
                </div>
                
                <button type="submit" class="btn btn-primary w-100 btn-lg">
                  <i class="fas fa-check"></i> ╪н┘Б╪╕ ╪з┘Д╪м╪п┘И┘Д╪й
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============================================ -->
    <!-- TAB 3: ╪к╪н┘И┘К┘Д ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к -->
    <!-- ============================================ -->
    <div class="tab-pane fade" id="convert" role="tabpanel">
      
      <div class="alert alert-danger border-0 shadow-sm">
        <i class="fas fa-exclamation-triangle"></i> <strong>╪к╪н╪░┘К╪▒:</strong> ╪к╪н┘И┘К┘Д ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪╣┘Е┘Д┘К╪й ╪н╪│╪з╪│╪й! ╪│┘К╪к┘Е ╪н┘Б╪╕ ┘Ж╪│╪о╪й ╪з╪н╪к┘К╪з╪╖┘К╪й ╪к┘Д┘В╪з╪ж┘К╪з┘Л ┘В╪и┘Д ╪з┘Д╪к╪н┘И┘К┘Д.
      </div>

      <!-- ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д╪н╪з┘Д┘К╪й -->
      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card bg-light shadow-sm">
            <div class="card-body">
              <h6 class="fw-bold mb-3">┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д╪н╪з┘Д┘К╪й:</h6>
              <div class="d-flex align-items-center gap-3">
                <div class="p-3 rounded bg-success bg-opacity-10">
                  <i class="fas fa-database fa-3x text-success"></i>
                </div>
                <div>
                  <h4 class="mb-0">{{ current_db_type }}</h4>
                  <small class="text-muted">╪з┘Д┘Ж┘И╪╣ ╪з┘Д╪н╪з┘Д┘К</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ╪з╪о╪к┘К╪з╪▒ ┘Ж┘И╪╣ ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д┘Е╪│╪к┘З╪п┘Б╪й -->
      <div class="row g-3 mb-4">
        <div class="col-md-3">
          <div class="card h-100 text-center db-card" onclick="selectDB('sqlite')">
            <div class="card-body">
              <i class="fas fa-database fa-3x text-primary mb-3"></i>
              <h6>SQLite</h6>
              <small class="text-muted">┘Е┘Д┘Б ┘Е╪н┘Д┘К - ╪│╪▒┘К╪╣</small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center db-card" onclick="selectDB('postgresql')">
            <div class="card-body">
              <i class="fas fa-server fa-3x text-info mb-3"></i>
              <h6>PostgreSQL</h6>
              <small class="text-muted">┘В┘И┘К - ╪з╪н╪к╪▒╪з┘Б┘К</small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center db-card" onclick="selectDB('mysql')">
            <div class="card-body">
              <i class="fas fa-database fa-3x text-warning mb-3"></i>
              <h6>MySQL</h6>
              <small class="text-muted">╪┤╪з╪ж╪╣ - ┘Е┘И╪л┘И┘В</small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card h-100 text-center db-card" onclick="selectDB('mssql')">
            <div class="card-body">
              <i class="fas fa-server fa-3x text-danger mb-3"></i>
              <h6>SQL Server</h6>
              <small class="text-muted">Microsoft</small>
            </div>
          </div>
        </div>
      </div>

      <!-- ┘Ж┘Е┘И╪░╪м ╪з┘Д╪к╪н┘И┘К┘Д -->
      <div class="row">
        <div class="col-md-10 mx-auto">
          <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="fas fa-exchange-alt"></i> ╪к╪н┘И┘К┘Д ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к</h5>
            </div>
            <div class="card-body">
              <form method="POST" action="{{ url_for('advanced.backup_manager') }}" id="convertForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="convert_database">
                <input type="hidden" name="target_db" id="target_db" value="">
                
                <div class="mb-4">
                  <label class="form-label fw-bold">┘Ж┘И╪╣ ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д┘Е╪│╪к┘З╪п┘Б╪й</label>
                  <select class="form-select form-select-lg" id="db_type_select" onchange="updateConnectionString()" required>
                    <option value="">-- ╪з╪о╪к╪▒ ╪з┘Д┘Ж┘И╪╣ --</option>
                    <option value="sqlite">SQLite</option>
                    <option value="postgresql">PostgreSQL</option>
                    <option value="mysql">MySQL</option>
                    <option value="mssql">SQL Server</option>
                  </select>
                </div>
                
                <div class="mb-4">
                  <label class="form-label fw-bold">Connection String</label>
                  <textarea name="connection_string" id="connection_string" class="form-control" rows="3" placeholder="┘Е╪л╪з┘Д: postgresql://user:password@localhost/dbname" required></textarea>
                  <small class="text-muted" id="connection_hint"></small>
                  
                  <div class="mt-2">
                    <button type="button" class="btn btn-info" onclick="testConnection()">
                      <i class="fas fa-plug"></i> ╪з╪о╪к╪и╪з╪▒ ╪з┘Д╪з╪к╪╡╪з┘Д
                    </button>
                    <span id="connection_status" class="ms-2"></span>
                  </div>
                </div>
                
                <div id="connection_examples" class="alert alert-light" style="display:none;">
                  <strong>╪г┘Е╪л┘Д╪й:</strong>
                  <div id="example_text"></div>
                </div>
                
                <div class="alert alert-warning">
                  <strong>╪к╪г┘Г┘К╪п:</strong>
                  <ul class="mb-0 mt-2">
                    <li>╪к╪г┘Г╪п ┘Е┘Ж ╪г┘Ж ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к ╪з┘Д┘Е╪│╪к┘З╪п┘Б╪й ┘Е┘И╪м┘И╪п╪й</li>
                    <li>╪к╪г┘Г╪п ┘Е┘Ж ╪╡╪н╪й ╪и┘К╪з┘Ж╪з╪к ╪з┘Д╪з╪к╪╡╪з┘Д</li>
                    <li>╪│┘К╪к┘Е ╪н┘Б╪╕ ┘Ж╪│╪о╪й ╪з╪н╪к┘К╪з╪╖┘К╪й ╪к┘Д┘В╪з╪ж┘К╪з┘Л</li>
                    <li>┘В╪п ╪к╪│╪к╪║╪▒┘В ╪з┘Д╪╣┘Е┘Д┘К╪й ┘И┘В╪к╪з┘Л ╪╖┘И┘К┘Д╪з┘Л</li>
                  </ul>
                </div>
                
                <button type="submit" class="btn btn-danger w-100 btn-lg">
                  <i class="fas fa-exchange-alt"></i> ╪и╪п╪б ╪з┘Д╪к╪н┘И┘К┘Д ╪з┘Д╪в┘Ж
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>

</div>

<style>
/* Tab Panes - Bootstrap 4 Fix */
.tab-content > .tab-pane {
  display: none;
}
.tab-content > .active {
  display: block !important;
}
.tab-pane.fade {
  opacity: 0;
  transition: opacity 0.15s linear;
}
.tab-pane.fade.in,
.tab-pane.fade.show {
  opacity: 1;
}

/* DB Cards */
.db-card {
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}
.db-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}
.db-card.active {
  border: 3px solid #28a745;
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
}
</style>

<script>
// ╪к┘Б╪╣┘К┘Д ╪з┘Д╪к╪и┘И┘К╪и╪з╪к Bootstrap 4
$(document).ready(function() {
  // ╪к┘Б╪╣┘К┘Д tabs
  $('#backupTabs a[data-toggle="tab"]').on('click', function (e) {
    e.preventDefault();
    $(this).tab('show');
  });
  
  // ╪н┘Б╪╕ ╪з┘Д╪к╪и┘И┘К╪и ╪з┘Д┘Ж╪┤╪╖
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    localStorage.setItem('activeTab', $(e.target).attr('href'));
  });
  
  // ╪з╪│╪к╪╣╪з╪п╪й ╪з┘Д╪к╪и┘И┘К╪и ╪з┘Д┘Ж╪┤╪╖
  var activeTab = localStorage.getItem('activeTab');
  if (activeTab) {
    $('#backupTabs a[href="' + activeTab + '"]').tab('show');
  }
});

function selectDB(type) {
  document.querySelectorAll('.db-card').forEach(c => c.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('db_type_select').value = type;
  document.getElementById('target_db').value = type;
  updateConnectionString();
}

function updateConnectionString() {
  const type = document.getElementById('db_type_select').value;
  const connString = document.getElementById('connection_string');
  const hint = document.getElementById('connection_hint');
  const examples = document.getElementById('connection_examples');
  const exampleText = document.getElementById('example_text');
  
  document.getElementById('target_db').value = type;
  
  if (type === 'sqlite') {
    connString.value = 'sqlite:///instance/app_new.db';
    hint.textContent = '┘Е╪│╪з╪▒ ╪з┘Д┘Е┘Д┘Б ╪з┘Д┘Е╪н┘Д┘К';
    exampleText.innerHTML = '<code>sqlite:///instance/app_new.db</code>';
    examples.style.display = 'block';
  } else if (type === 'postgresql') {
    connString.value = 'postgresql://user:password@localhost:5432/dbname';
    hint.textContent = '╪з┘Д┘Е╪│╪к╪о╪п┘Е:┘Г┘Д┘Е╪й ╪з┘Д┘Е╪▒┘И╪▒@╪з┘Д╪│┘К╪▒┘Б╪▒:╪з┘Д┘Е┘Ж┘Б╪░/╪з╪│┘Е ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к';
    exampleText.innerHTML = '<code>postgresql://azad:123456@localhost:5432/garage_db</code>';
    examples.style.display = 'block';
  } else if (type === 'mysql') {
    connString.value = 'mysql+pymysql://user:password@localhost:3306/dbname';
    hint.textContent = '╪з┘Д┘Е╪│╪к╪о╪п┘Е:┘Г┘Д┘Е╪й ╪з┘Д┘Е╪▒┘И╪▒@╪з┘Д╪│┘К╪▒┘Б╪▒:╪з┘Д┘Е┘Ж┘Б╪░/╪з╪│┘Е ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к';
    exampleText.innerHTML = '<code>mysql+pymysql://root:123456@localhost:3306/garage_db</code>';
    examples.style.display = 'block';
  } else if (type === 'mssql') {
    connString.value = 'mssql+pyodbc://user:password@localhost/dbname?driver=ODBC+Driver+17+for+SQL+Server';
    hint.textContent = '╪з┘Д┘Е╪│╪к╪о╪п┘Е:┘Г┘Д┘Е╪й ╪з┘Д┘Е╪▒┘И╪▒@╪з┘Д╪│┘К╪▒┘Б╪▒/╪з╪│┘Е ┘В╪з╪╣╪п╪й ╪з┘Д╪и┘К╪з┘Ж╪з╪к';
    exampleText.innerHTML = '<code>mssql+pyodbc://sa:Pass123@localhost/garage_db?driver=ODBC+Driver+17+for+SQL+Server</code>';
    examples.style.display = 'block';
  } else {
    connString.value = '';
    hint.textContent = '';
    examples.style.display = 'none';
  }
}

function testConnection() {
  const connString = document.getElementById('connection_string').value;
  const statusSpan = document.getElementById('connection_status');
  
  if (!connString) {
    statusSpan.innerHTML = '<span class="badge bg-danger">╪г╪п╪о┘Д Connection String ╪г┘И┘Д╪з┘Л</span>';
    return;
  }
  
  statusSpan.innerHTML = '<span class="badge bg-warning"><i class="fas fa-spinner fa-spin"></i> ╪м╪з╪▒┘К ╪з┘Д╪з╪о╪к╪и╪з╪▒...</span>';
  
  fetch('{{ url_for("advanced.test_db_connection") }}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: 'csrf_token={{ csrf_token() }}&connection_string=' + encodeURIComponent(connString)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      statusSpan.innerHTML = '<span class="badge bg-success"><i class="fas fa-check"></i> ' + data.message + '</span>';
    } else {
      statusSpan.innerHTML = '<span class="badge bg-danger"><i class="fas fa-times"></i> ' + data.message + '</span>';
    }
  })
  .catch(error => {
    statusSpan.innerHTML = '<span class="badge bg-danger"><i class="fas fa-times"></i> ╪о╪╖╪г ┘Б┘К ╪з┘Д╪з╪к╪╡╪з┘Д</span>';
  });
}
</script>

{% endblock %}
