{% extends 'base.html' %}
{% block title %}Ù…Ø¯ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª{% endblock %}
{% block page_title %}ğŸ§© Ù…Ø¯ÙŠØ± Ø§Ù„ÙˆØ­Ø¯Ø§Øª - Module Manager{% endblock %}

{% block content %}
<div class="container-fluid">
  
  {% include 'advanced/_navigation.html' %}
  
  <div class="alert alert-info border-0 shadow-sm">
    <i class="fas fa-puzzle-piece"></i> <strong>ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ­Ø¯Ø§Øª:</strong> ÙØ¹Ù‘Ù„ Ø£Ùˆ Ø¹Ø·Ù‘Ù„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ø­ØªÙŠØ§Ø¬Ùƒ
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <span class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</span>
          <h3 class="mb-1">{{ stats.total }}</h3>
          <small class="text-muted">Ù…ÙØ¹Ù„: {{ stats.active }}</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <span class="text-muted">ÙˆØ­Ø¯Ø§Øª Ø¨Ø­Ø§Ù„Ø© Ù…Ù…ØªØ§Ø²Ø©</span>
          <h3 class="mb-1">{{ stats.total - stats.blocked }}</h3>
          <small class="text-success">Ø¨Ù„Ø§ Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ù…ÙÙ‚ÙˆØ¯Ø©</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body">
          <span class="text-muted">ÙˆØ­Ø¯Ø§Øª ØªØªØ·Ù„Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª</span>
          <h3 class="mb-1 text-warning">{{ stats.blocked }}</h3>
          <small class="text-muted">ÙØ¹Ù‘Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ø£ÙˆÙ„Ø§Ù‹</small>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    {% for module in modules %}
    <div class="col-md-4">
      <div class="card border-0 shadow-sm h-100 {% if not module.enabled %}opacity-50{% endif %}">
        <div class="card-body">
          <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="module_key" value="{{ module.key }}">
            
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="d-flex align-items-center gap-3">
                <div class="p-3 rounded bg-{{ module.color }} bg-opacity-10">
                  <i class="fas fa-{{ module.icon }} fa-2x text-{{ module.color }}"></i>
                </div>
                <div>
                  <h6 class="mb-0">{{ module.name }}</h6>
                  <small class="text-muted">{{ module.key }}</small>
                </div>
              </div>
              
              {% set disable_toggle = (not module.deps_ready and not module.enabled) %}
              <div class="form-check form-switch" title="{% if disable_toggle %}ÙØ¹Ù‘Ù„ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ø£ÙˆÙ„Ø§Ù‹{% endif %}">
                <input type="checkbox" name="enabled" class="form-check-input" 
                       style="width: 3rem; height: 1.5rem;"
                       {% if module.enabled %}checked{% endif %}
                       {% if disable_toggle %}disabled{% endif %}
                       onchange="this.form.submit()">
              </div>
            </div>
          </form>
          
          <div class="d-flex gap-2">
            {% if module.enabled %}
              <span class="badge bg-success">Ù…ÙØ¹Ù‘Ù„</span>
            {% else %}
              <span class="badge bg-secondary">Ù…Ø¹Ø·Ù‘Ù„</span>
            {% endif %}
            {% if not module.deps_ready %}
              <span class="badge bg-warning text-dark">Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ù†Ø§Ù‚ØµØ©</span>
            {% endif %}
          </div>

          <div class="mt-3">
            <small class="text-muted">Ø¢Ø®Ø± ØªØ¹Ø¯ÙŠÙ„:
              {{ module.updated_at.strftime('%Y-%m-%d %H:%M') if module.updated_at else 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„' }}
            </small>
          </div>

          {% if module.dependencies_detail %}
          <div class="mt-3">
            <strong>Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª:</strong>
            <ul class="list-unstyled small mb-0">
              {% for dep in module.dependencies_detail %}
              <li>
                <i class="fas fa-link"></i> {{ dep.name }}
                <span class="badge bg-{{ 'success' if dep.enabled else 'secondary' }}">
                  {{ 'Ù…ÙØ¹Ù„' if dep.enabled else 'Ù…Ø¹Ø·Ù„' }}
                </span>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

</div>
{% endblock %}

