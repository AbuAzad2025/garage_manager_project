{# templates/partials/navbar.html #}
<nav class="main-header navbar navbar-expand navbar-white navbar-light">

  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for('main.dashboard') }}" class="nav-link">لوحة التحكم</a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('users.index','users.list_users','users_bp.index','users.list','users_bp.list') }}" class="nav-link">
        <i class="fas fa-users"></i> المستخدمون
      </a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('shop.index','shop_bp.index') }}" class="nav-link">
        <i class="fas fa-store"></i> المتجر
      </a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('service.index','service_bp.index') }}" class="nav-link">
        <i class="fas fa-tools"></i> الصيانة
      </a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('sales.index','sales_bp.index') }}" class="nav-link">
        <i class="fas fa-shopping-cart"></i> المبيعات
      </a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('notes.index','notes_bp.index') }}" class="nav-link">
        <i class="fas fa-sticky-note"></i> الملاحظات
      </a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('warehouse_bp.list','warehouses.list','warehouses.index') }}" class="nav-link">
        <i class="fas fa-warehouse"></i> المستودعات
      </a>
    </li>

    <li class="nav-item d-none d-sm-inline-block">
      <a href="{{ url_for_any('expenses.index','expenses_bp.index') }}" class="nav-link">
        <i class="fas fa-receipt"></i> المصاريف
      </a>
    </li>
  </ul>

  <ul class="navbar-nav ml-auto">
    {# صلاحيات النسخ/الاستعادة #}
    {% set can_backup = has_perm('backup_db') or has_perm('backup_database') %}
    {% set can_restore = has_perm('restore_db') or has_perm('restore_database') %}

    {% if can_backup or can_restore %}
    <li class="nav-item dropdown">
      <a class="nav-link" data-toggle="dropdown" href="#">
        <i class="fas fa-database"></i> النسخ الاحتياطي
      </a>
      <div class="dropdown-menu dropdown-menu-right">
        {% if can_backup %}
        <a class="dropdown-item" href="{{ url_for('main.backup_db') }}">
          <i class="fas fa-download"></i> تنزيل نسخة احتياطية
        </a>
        {% endif %}

        {% if can_restore %}
        <a class="dropdown-item" href="{{ url_for('main.restore_db') }}">
          <i class="fas fa-upload"></i> استعادة قاعدة البيانات
        </a>
        {% endif %}
      </div>
    </li>
    {% endif %}

    <li class="nav-item dropdown">
      <a class="nav-link" data-toggle="dropdown" href="#">
        <i class="far fa-user"></i> {{ current_user.username if current_user.is_authenticated else 'حسابي' }}
      </a>
      <div class="dropdown-menu dropdown-menu-right">
        <a href="{{ url_for_any('users.index','users.list_users','users_bp.index','users.list','users_bp.list') }}" class="dropdown-item">
          <i class="fas fa-users-cog"></i> إدارة المستخدمين
        </a>
        <div class="dropdown-divider"></div>
        <a href="#" class="dropdown-item"
           onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
          <i class="fas fa-sign-out-alt"></i> تسجيل خروج
        </a>
        <form id="logout-form" action={{ url_for('auth.logout') }} method="POST" style="display:none;">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        </form>
      </div>
    </li>
  </ul>
</nav>
