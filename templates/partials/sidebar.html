{# templates/partials/sidebar.html #}
<aside class="main-sidebar sidebar-dark-primary elevation-4">
  <a href="{{ url_for('main.dashboard') }}" class="brand-link text-center">
    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo"
         class="brand-image img-circle elevation-3" style="opacity:.8">
    <span class="brand-text font-weight-light">نظام إدارة الكراج</span>
  </a>

  <div class="sidebar">
    <nav class="mt-2">
      <ul class="nav nav-pills nav-sidebar flex-column" role="menu">

        <li class="nav-item">
          <a href="{{ url_for('main.dashboard') }}" class="nav-link">
            <i class="nav-icon fas fa-tachometer-alt"></i><p>لوحة التحكم</p>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for_any('service.index','service_bp.index') }}" class="nav-link">
            <i class="nav-icon fas fa-tools"></i><p>طلبات الصيانة</p>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for_any('warehouse_bp.list','warehouses.list','warehouses.index') }}" class="nav-link">
            <i class="nav-icon fas fa-warehouse"></i><p>المستودعات</p>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for_any('sales.index','sales_bp.index') }}" class="nav-link">
            <i class="nav-icon fas fa-shopping-cart"></i><p>المبيعات</p>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for_any('expenses.index','expenses_bp.index') }}" class="nav-link">
            <i class="nav-icon fas fa-receipt"></i><p>المصاريف</p>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for_any('payments.index','payments_bp.index') }}" class="nav-link">
            <i class="nav-icon fas fa-money-bill-wave"></i><p>الدفعات</p>
          </a>
        </li>

        <li class="nav-item">
          <a href="{{ url_for_any('reports.ar_aging','reports_bp.ar_aging','reports.index','reports_bp.index') }}" class="nav-link">
            <i class="nav-icon fas fa-chart-bar"></i><p>التقارير</p>
          </a>
        </li>

        {# صلاحيات النسخ/الاستعادة — نعتمد aliases الموحّدة من has_perm #}
        {% set can_backup = has_perm('backup_database') %}
        {% set can_restore = has_perm('restore_database') %}

        {% if can_backup or can_restore %}
          <li class="nav-header">النسخ الاحتياطي</li>

          {% if can_backup %}
          <li class="nav-item">
            <a href="{{ url_for('main.backup_db') }}" class="nav-link">
              <i class="nav-icon fas fa-download"></i><p>تنزيل نسخة</p>
            </a>
          </li>
          {% endif %}

          {% if can_restore %}
          <li class="nav-item">
            <a href="{{ url_for('main.restore_db') }}" class="nav-link">
              <i class="nav-icon fas fa-upload"></i><p>استعادة</p>
            </a>
          </li>
          {% endif %}
        {% endif %}

        <li class="nav-item">
          <a href="{{ url_for_any('shop.index','shop_bp.index') }}" class="nav-link">
            <i class="nav-icon fas fa-store"></i><p>المتجر</p>
          </a>
        </li>

      </ul>
    </nav>
  </div>
</aside>
