{% extends 'base.html' %}
{% block title %}ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©{% endblock %}
{% block page_title %}ğŸ”’ ÙˆØ­Ø¯Ø© Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/security_responsive.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/security_dark_mode.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
  
  {% include 'security/_navigation.html' %}
  
  <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ -->
  <div class="mb-4">
    <div class="input-group input-group-lg">
      <span class="input-group-text bg-primary text-white">
        <i class="fas fa-search"></i>
      </span>
      <input type="text" id="quickSearch" class="form-control form-control-lg" 
             placeholder="ğŸ” Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹ ÙÙŠ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø³Ø±ÙŠØ©... (Ù…Ø«Ø§Ù„: ØªÙƒØ§Ù…Ù„Ø§ØªØŒ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ ØªÙ‚Ø§Ø±ÙŠØ±)"
             style="font-size: 1.1rem;">
      <button class="btn btn-outline-secondary" type="button" id="clearSearch" style="display: none;">
        <i class="fas fa-times"></i> Ù…Ø³Ø­
      </button>
    </div>
    <small class="text-muted d-block mt-1">
      <i class="fas fa-lightbulb"></i> Ù†ØµÙŠØ­Ø©: Ø§ÙƒØªØ¨ Ø£ÙŠ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª
    </small>
  </div>
  
  <div class="alert alert-danger border-0 shadow-sm">
    <i class="fas fa-crown"></i>
    <strong>ğŸ” Ø§Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·:</strong> Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø³Ø±ÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø§Ù„Ùƒ (__OWNER__) ÙÙ‚Ø·! 
    <span class="badge bg-warning text-dark ms-2">Super Admin Ù…Ù…Ù†ÙˆØ¹</span>
    <br><small>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙÙŠ Audit Trail</small>
  </div>

  <div class="alert alert-info border-0 shadow-sm">
    <div class="d-flex justify-content-between align-items-center flex-wrap">
      <div>
        <i class="fas fa-rocket"></i>
        <strong>Ø§Ù„Ù†Ø¸Ø§Ù… v5.0.0:</strong>
        <span class="badge bg-success ms-1">{{ stats.total_modules }} ÙˆØ­Ø¯Ø©</span>
        <span class="badge bg-info ms-1">{{ stats.total_apis }} API</span>
        <span class="badge bg-warning text-dark ms-1">{{ stats.total_indexes }} ÙÙ‡Ø±Ø³</span>
        <span class="badge bg-danger ms-1">{{ stats.total_relations }}+ Ø¹Ù„Ø§Ù‚Ø©</span>
        <br><small class="mt-2 d-block">
          <strong>Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©:</strong> Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ + Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª + Ø§Ù„Ø­Ø¸Ø± |
          <strong>Ù…Ø±ÙƒØ² Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ÙˆØ­Ø¯:</strong> 7 Ù…Ø±Ø§ÙƒØ² + 41 ÙˆØ¸ÙŠÙØ©
        </small>
      </div>
      <div>
        <a href="{{ url_for('security.help_page') }}" class="btn btn-sm btn-info me-1">
          <i class="fas fa-question-circle"></i> Ù…Ø³Ø§Ø¹Ø¯Ø©
        </a>
        <a href="{{ url_for('security.sitemap') }}" class="btn btn-sm btn-outline-light">
          <i class="fas fa-sitemap"></i> Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹
        </a>
      </div>
    </div>
  </div>

  <!-- Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø±Ø¦ÙŠ -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="fas fa-history"></i> Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h5>
            <span class="badge bg-white text-primary">Ø¢Ø®Ø± 10 Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</span>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="timeline" id="auditTimeline" style="max-height: 200px; overflow-y: auto;">
            {% if recent %}
              {% for audit in recent[:10] %}
              <div class="timeline-item" style="padding: 12px 20px; border-bottom: 1px solid #f0f0f0;">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="d-flex align-items-start">
                    <i class="fas fa-circle text-{% if audit.success %}success{% else %}danger{% endif %} mt-1" style="font-size: 0.5rem; margin-left: 10px;"></i>
                    <div>
                      <strong>{{ audit.event_type or 'Ù†Ø´Ø§Ø·' }}</strong>
                      <br><small class="text-muted">
                        <i class="fas fa-user"></i> {{ audit.username or 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' }}
                        {% if audit.ip_address %} | <i class="fas fa-network-wired"></i> {{ audit.ip_address }}{% endif %}
                      </small>
                    </div>
                  </div>
                  <small class="text-muted" title="{{ audit.created_at }}">
                    <i class="fas fa-clock"></i> {{ audit.created_at.strftime('%H:%M') if audit.created_at else 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' }}
                  </small>
                </div>
              </div>
              {% endfor %}
            {% else %}
              <div class="text-center p-4 text-muted">
                <i class="fas fa-inbox"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø­Ø¯ÙŠØ«Ø©
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="row g-3 mb-4">
    <div class="col-lg-3 col-md-6">
      <div class="small-box bg-info" data-total-users="{{ stats.total_users }}">
        <div class="inner">
          <h3>{{ stats.total_users }}</h3>
          <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
          <!-- Mini Chart -->
          <div style="height: 40px; margin-top: 10px;">
            <canvas id="usersTrendChart"></canvas>
          </div>
        </div>
        <div class="icon"><i class="fas fa-users"></i></div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="small-box bg-success" data-active-users="{{ stats.active_users }}">
        <div class="inner">
          <h3>{{ stats.active_users }}</h3>
          <p>Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</p>
          <!-- Mini Chart -->
          <div style="height: 40px; margin-top: 10px;">
            <canvas id="activitySparkline"></canvas>
          </div>
        </div>
        <div class="icon"><i class="fas fa-user-check"></i></div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="small-box bg-danger" data-blocked-users="{{ stats.blocked_users }}">
        <div class="inner">
          <h3>{{ stats.blocked_users }}</h3>
          <p>Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø­Ø¸ÙˆØ±ÙŠÙ†</p>
          <!-- Mini Chart -->
          <div style="height: 40px; margin-top: 10px;">
            <canvas id="systemHealthChart"></canvas>
          </div>
        </div>
        <div class="icon"><i class="fas fa-user-lock"></i></div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="small-box bg-warning">
        <div class="inner">
          <h3>{{ stats.failed_logins_24h }}</h3>
          <p>Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø© (24 Ø³Ø§Ø¹Ø©)</p>
          <!-- Mini Chart -->
          <div style="height: 40px; margin-top: 10px;">
            <canvas id="failedLoginsChart"></canvas>
          </div>
        </div>
        <div class="icon"><i class="fas fa-exclamation-triangle"></i></div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…ÙˆØ­Ø¯Ø© - 7 Ù…Ø±Ø§ÙƒØ² -->
  <div class="alert border-0 shadow-sm mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <i class="fas fa-crown"></i>
        <strong>Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù…ÙˆØ­Ø¯Ø©:</strong>
        <span class="badge bg-white text-primary ms-2">7 Ù…Ø±Ø§ÙƒØ² + 41 ÙˆØ¸ÙŠÙØ©</span>
      </div>
      <small class="opacity-75">{{ stats.total_modules }} ÙˆØ­Ø¯Ø© â€¢ {{ stats.total_apis }} API â€¢ {{ stats.total_indexes }} ÙÙ‡Ø±Ø³</small>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-database fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ—„ï¸ Database Control Center</h5>
          <p class="small opacity-75">11 Ø£Ø¯Ø§Ø© + Ø£Ø±Ø´ÙŠÙØ§Øª</p>
          <a href="{{ url_for('security.database_manager') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-terminal"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-brain fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ¤– AI Control Center</h5>
          <p class="small opacity-75">4 Ø£Ø¯ÙˆØ§Øª + Ø£Ù†Ù…Ø§Ø· + Ø®Ø±ÙŠØ·Ø©</p>
          <a href="{{ url_for('ai.hub') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-robot"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #FF512F 0%, #DD2476 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-shield-alt fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ›¡ï¸ Security & Monitoring Center</h5>
          <p class="small opacity-75">4 Ø£Ø¯ÙˆØ§Øª Ø£Ù…Ù†ÙŠØ©</p>
          <a href="{{ url_for('security.security_center') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-eye"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-users-cog fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ‘¥ Users & Permissions Center</h5>
          <p class="small opacity-75">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
          <a href="{{ url_for('security.users_center') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-user-shield"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-cogs fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">âš™ï¸ Settings & Customization Center</h5>
          <p class="small opacity-75">8 Ø£Ø¯ÙˆØ§Øª + ÙØ±ÙˆØ¹</p>
          <a href="{{ url_for('security.settings_center') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-sliders-h"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>

    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-chart-bar fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ“Š Reports & Performance Center</h5>
          <p class="small opacity-75">ØªÙ‚Ø§Ø±ÙŠØ± ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡</p>
          <a href="{{ url_for('security.reports_center') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-chart-line"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-tools fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ”§ Tools & Integration Center</h5>
          <p class="small opacity-75">Ø£Ø¯ÙˆØ§Øª ÙˆØªÙƒØ§Ù…Ù„Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</p>
          <a href="{{ url_for('security.tools_center') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-wrench"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #396afc 0%, #2948ff 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-book fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ“’ Ledger Control</h5>
          <p class="small opacity-75">Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØ§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</p>
          <a href="{{ url_for('ledger_control.index') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-chart-line"></i> ÙØªØ­ Ø§Ù„ÙˆØ­Ø¯Ø©
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-4 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-exclamation-triangle fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸš¨ Emergency Tools</h5>
          <p class="small opacity-75">Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</p>
          <a href="{{ url_for('security.emergency_tools') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-fire-extinguisher"></i> ÙØªØ­ Ø§Ù„Ø£Ø¯ÙˆØ§Øª
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¶Ø±Ø§Ø¦Ø¨ -->
  <div class="row g-3 mb-4">
    <div class="col-lg-6 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-bell fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ“§ Notifications Center</h5>
          <p class="small opacity-75">Email & SMS Automation + Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p>
          <a href="{{ url_for('security.notifications_center') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-envelope"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-6 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-file-invoice-dollar fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
          <h5 class="fw-bold">ğŸ’° Tax Reports Center</h5>
          <p class="small opacity-75">VAT Tracking + Ø¥Ù‚Ø±Ø§Ø±Ø§Øª Ø¶Ø±ÙŠØ¨ÙŠØ© + ØªÙ‚Ø§Ø±ÙŠØ±</p>
          <a href="{{ url_for('security.tax_reports') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-calculator"></i> ÙØªØ­ Ø§Ù„Ù…Ø±ÙƒØ²
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø£Ø¯ÙˆØ§Øª Ø³Ø±ÙŠØ¹Ø© Ø¥Ø¶Ø§ÙÙŠØ© -->
  <div class="row g-3 mb-4">
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-sitemap text-secondary fa-2x mb-2"></i>
          <h6 class="fw-bold">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹</h6>
          <a href="{{ url_for('security.sitemap') }}" class="btn btn-sm btn-outline-secondary">
            <i class="fas fa-map"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-code text-primary fa-2x mb-2"></i>
          <h6 class="fw-bold">API Documentation</h6>
          <a href="{{ url_for('api.docs') }}" class="btn btn-sm btn-outline-primary">
            <i class="fas fa-book"></i> ÙˆØ«Ø§Ø¦Ù‚ API
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-ban text-danger fa-2x mb-2"></i>
          <h6 class="fw-bold">Firewall ({{ stats.blocked_ips }})</h6>
          <a href="{{ url_for('security.block_ip') }}" class="btn btn-sm btn-outline-danger">
            <i class="fas fa-shield-alt"></i> Ø­Ø¸Ø± IP
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-globe text-warning fa-2x mb-2"></i>
          <h6 class="fw-bold">Ø­Ø¸Ø± Ø¯ÙˆÙ„ ({{ stats.blocked_countries }})</h6>
          <a href="{{ url_for('security.block_country') }}" class="btn btn-sm btn-outline-warning">
            <i class="fas fa-flag"></i> Ø­Ø¸Ø± Ø¯ÙˆÙ„Ø©
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <i class="fas fa-broom text-success fa-2x mb-2"></i>
          <h6 class="fw-bold">ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø¸Ø§Ù…</h6>
          <div class="d-grid gap-2">
            <a href="{{ url_for('security.system_cleanup') }}" class="btn btn-light btn-sm fw-bold">
              <i class="fas fa-trash-alt"></i> ØªÙ†Ø¸ÙŠÙ Ø¢Ù…Ù†
            </a>
            <div class="row text-center">
              <div class="col-6">
                <small class="opacity-75">Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª</small>
              </div>
              <div class="col-6">
                <small class="opacity-75">ØªØ­Ø³ÙŠÙ†</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);">
        <div class="card-body text-center text-white">
          <div class="position-relative">
            <i class="fas fa-file-alt fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success">
              6
            </span>
          </div>
          <h5 class="fw-bold">Ø§Ù„Ù„ÙˆØ¬Ø§Øª ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª</h5>
          <p class="small opacity-75">6 Ø£Ù†ÙˆØ§Ø¹ Ù„ÙˆØ¬Ø§Øª Ø´Ø§Ù…Ù„Ø©</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('security.logs_viewer') }}" class="btn btn-light btn-sm fw-bold">
              <i class="fas fa-eye"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ¬Ø§Øª
            </a>
            <div class="row text-center">
              <div class="col-4">
                <small class="opacity-75">Ø£Ø®Ø·Ø§Ø¡</small>
              </div>
              <div class="col-4">
                <small class="opacity-75">Ø£Ù…Ø§Ù†</small>
              </div>
              <div class="col-4">
                <small class="opacity-75">Ø£Ø¯Ø§Ø¡</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
        <div class="card-body text-center text-white">
          <div class="position-relative">
            <i class="fas fa-cogs fa-3x mb-3" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark">
              âš™ï¸
            </span>
          </div>
          <h5 class="fw-bold">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
          <p class="small opacity-75">ØªÙƒÙˆÙŠÙ† + Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</p>
          <div class="d-grid gap-2">
            <a href="{{ url_for('security.ultimate_control') }}" class="btn btn-light btn-sm fw-bold">
              <i class="fas fa-sliders-h"></i> Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            </a>
            <div class="row text-center">
              <div class="col-6">
                <small class="opacity-75">ØªÙƒÙˆÙŠÙ†</small>
              </div>
              <div class="col-6">
                <small class="opacity-75">Ù…ØªÙ‚Ø¯Ù…</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ø­Ø¸ÙˆØ±ÙŠÙ† -->
  <div class="row g-3">
    <div class="col-lg-6">
      <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #FF512F 0%, #DD2476 100%);">
        <div class="card-header text-white border-0" style="background: rgba(255,255,255,0.1);">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold"><i class="fas fa-ban"></i> IPs Ù…Ø­Ø¸ÙˆØ±Ø©</h5>
            <span class="badge bg-warning text-dark fs-6">{{ stats.blocked_ips }}</span>
          </div>
        </div>
        <div class="card-body text-white">
          <div class="row text-center">
            <div class="col-4">
              <h4 class="fw-bold">{{ stats.blocked_ips }}</h4>
              <small class="opacity-75">IPs Ù…Ø­Ø¸ÙˆØ±Ø©</small>
            </div>
            <div class="col-4">
              <h4 class="fw-bold">{{ stats.failed_logins_24h }}</h4>
              <small class="opacity-75">Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©</small>
            </div>
            <div class="col-4">
              <h4 class="fw-bold">{{ stats.suspicious_activities }}</h4>
              <small class="opacity-75">Ø£Ù†Ø´Ø·Ø© Ù…Ø´Ø¨ÙˆÙ‡Ø©</small>
            </div>
          </div>
          <div class="d-grid gap-2 mt-3">
            <a href="{{ url_for('security.blocked_ips') }}" class="btn btn-light btn-sm fw-bold">
              <i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            </a>
            <a href="{{ url_for('security.block_ip') }}" class="btn btn-outline-light btn-sm">
              <i class="fas fa-plus"></i> Ø­Ø¸Ø± IP Ø¬Ø¯ÙŠØ¯
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-6">
      <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #f12711 0%, #f5af19 100%);">
        <div class="card-header text-white border-0" style="background: rgba(255,255,255,0.1);">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold"><i class="fas fa-globe"></i> Ø¯ÙˆÙ„ Ù…Ø­Ø¸ÙˆØ±Ø©</h5>
            <span class="badge bg-danger fs-6">{{ stats.blocked_countries }}</span>
          </div>
        </div>
        <div class="card-body text-white">
          <div class="row text-center">
            <div class="col-4">
              <h4 class="fw-bold">{{ stats.blocked_countries }}</h4>
              <small class="opacity-75">Ø¯ÙˆÙ„ Ù…Ø­Ø¸ÙˆØ±Ø©</small>
            </div>
            <div class="col-4">
              <h4 class="fw-bold">{{ stats.total_users }}</h4>
              <small class="opacity-75">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</small>
            </div>
            <div class="col-4">
              <h4 class="fw-bold">{{ stats.active_users }}</h4>
              <small class="opacity-75">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</small>
            </div>
          </div>
          <div class="d-grid gap-2 mt-3">
            <a href="{{ url_for('security.blocked_countries') }}" class="btn btn-light btn-sm fw-bold">
              <i class="fas fa-list"></i> Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            </a>
            <a href="{{ url_for('security.block_country') }}" class="btn btn-outline-light btn-sm">
              <i class="fas fa-plus"></i> Ø­Ø¸Ø± Ø¯ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </a>
          </div>
        </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6">
      <div class="card border-0 shadow-lg h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
        <div class="card-body text-center text-white">
          <i class="fas fa-database fa-3x mb-3"></i>
          <h5 class="fw-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙ‡Ø§Ø±Ø³</h5>
          <p class="small opacity-75">ØªØ³Ø±ÙŠØ¹ 10x</p>
          <a href="{{ url_for('security.indexes_manager') }}" class="btn btn-light btn-sm fw-bold">
            <i class="fas fa-bolt"></i> ÙÙ‡Ø§Ø±Ø³
          </a>
        </div>
      </div>
    </div>
    
  </div>
{% endblock %}

{% block scripts %}
<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ - Quick Search
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  const searchInput = document.getElementById('quickSearch');
  const clearBtn = document.getElementById('clearSearch');
  
  if (!searchInput) return;
  
  // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ
  searchInput.addEventListener('input', function() {
    const query = this.value.trim().toLowerCase();
    
    // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…Ø³Ø­
    clearBtn.style.display = query ? 'block' : 'none';
    
    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    const cards = document.querySelectorAll('.card, .small-box');
    let visibleCount = 0;
    
    cards.forEach(card => {
      const text = card.textContent.toLowerCase();
      const shouldShow = !query || text.includes(query);
      
      // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
      const parent = card.closest('.col-lg-3, .col-lg-4, .col-md-6');
      if (parent) {
        parent.style.display = shouldShow ? '' : 'none';
        if (shouldShow) visibleCount++;
      }
    });
    
    // Ø±Ø³Ø§Ù„Ø© "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬"
    let noResults = document.getElementById('noSearchResults');
    if (visibleCount === 0 && query) {
      if (!noResults) {
        noResults = document.createElement('div');
        noResults.id = 'noSearchResults';
        noResults.className = 'alert alert-warning text-center';
        noResults.innerHTML = `
          <i class="fas fa-search"></i> 
          <strong>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù€ "${query}"</strong>
          <br><small>Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ø«Ù„: ØªÙƒØ§Ù…Ù„Ø§ØªØŒ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ ØªÙ‚Ø§Ø±ÙŠØ±</small>
        `;
        searchInput.closest('.container-fluid').appendChild(noResults);
      }
    } else if (noResults) {
      noResults.remove();
    }
    
    // Ø¥Ø¶Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚
    if (query) {
      cards.forEach(card => {
        const parent = card.closest('.col-lg-3, .col-lg-4, .col-md-6');
        if (parent && parent.style.display !== 'none') {
          card.classList.add('border-primary', 'border-2');
        } else {
          card.classList.remove('border-primary', 'border-2');
        }
      });
    } else {
      cards.forEach(card => {
        card.classList.remove('border-primary', 'border-2');
      });
    }
  });
  
  // Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
  clearBtn.addEventListener('click', function() {
    searchInput.value = '';
    searchInput.dispatchEvent(new Event('input'));
    searchInput.focus();
  });
  
  // Shortcut: Ctrl+K Ù„Ù„Ø¨Ø­Ø«
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 'k') {
      e.preventDefault();
      searchInput.focus();
      searchInput.select();
    }
  });
  
  console.log('âœ… Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¬Ø§Ù‡Ø² (Ctrl+K)');
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ Animations Ø³Ù„Ø³Ø© - Smooth Animations
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  const style = document.createElement('style');
  style.textContent = `
    /* Hover Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .card, .small-box {
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px) scale(1.02);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2) !important;
      z-index: 10;
    }
    
    .small-box:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
    }
    
    /* Tooltips */
    [data-toggle="tooltip"] {
      cursor: help;
    }
    
    /* Border Ù„Ù„Ø¨Ø­Ø« */
    .border-2 {
      border-width: 2px !important;
    }
    
    /* Animation Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .card, .small-box {
      animation: fadeInUp 0.5s ease;
    }
  `;
  document.head.appendChild(style);
  
  console.log('âœ… Animations Ø¬Ø§Ù‡Ø²Ø©');
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’¡ Tooltips ØªÙˆØ¶ÙŠØ­ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  // Ø¥Ø¶Ø§ÙØ© tooltips Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
  const tooltips = {
    'Database Control Center': 'Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ØªØµÙØ­ØŒ ØªØ­Ø±ÙŠØ±ØŒ SQLØŒ PythonØŒ ÙÙ‡Ø§Ø±Ø³ØŒ ØµÙŠØ§Ù†Ø©ØŒ ÙˆØ£ÙƒØ«Ø±',
    'AI Control Center': 'Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠØŒ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙƒØ´Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø·ØŒ ØªÙ†Ø¨Ø¤Ø§ØªØŒ ÙˆØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬',
    'Security & Monitoring Center': 'Ù…Ø±Ø§Ù‚Ø¨Ø© ÙÙˆØ±ÙŠØ©ØŒ Ø¬Ø¯Ø§Ø± Ø­Ù…Ø§ÙŠØ©ØŒ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø£Ù…Ù†ÙŠØ©ØŒ ÙˆØ³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·Ø§Øª',
    'Users & Permissions Center': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§ØªØŒ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±ØŒ ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„',
    'Settings & Customization Center': 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…ØŒ Ø§Ù„Ø«ÙŠÙ…Ø§ØªØŒ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§ØªØŒ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©ØŒ ÙˆØ§Ù„ØªØ®ØµÙŠØµ',
    'Reports & Performance Center': 'ØªÙ‚Ø§Ø±ÙŠØ± Ø¥Ø¯Ø§Ø±ÙŠØ©ØŒ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ GrafanaØŒ ÙˆÙ„ÙˆØ­Ø§Øª Ø§Ù„ØªØ­ÙƒÙ…',
    'Tools & Integration Center': 'Ø§Ù„ØªÙƒØ§Ù…Ù„Ø§ØªØŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ØŒ Ø§Ù„ÙÙˆØ§ØªÙŠØ±ØŒ Ø§Ù„ÙƒØ±ÙˆØªØŒ ÙˆØ£Ø¯ÙˆØ§Øª Ù…ØªÙ†ÙˆØ¹Ø©',
    'Ledger Control': 'Ø¯ÙØªØ± Ø§Ù„Ø£Ø³ØªØ§Ø° Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ: Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ø§Ù„Ù‚ÙŠÙˆØ¯ØŒ Ø§Ù„Ø£Ø±ØµØ¯Ø©ØŒ ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©'
  };
  
  document.querySelectorAll('.card h5').forEach(h5 => {
    const text = h5.textContent.trim();
    for (const [key, value] of Object.entries(tooltips)) {
      if (text.includes(key)) {
        const card = h5.closest('.card');
        if (card) {
          card.setAttribute('data-toggle', 'tooltip');
          card.setAttribute('data-placement', 'top');
          card.setAttribute('title', value);
        }
      }
    }
  });
  
  // ØªÙØ¹ÙŠÙ„ Bootstrap tooltips
  $('[data-toggle="tooltip"]').tooltip();
  
  console.log('âœ… Tooltips Ø¬Ø§Ù‡Ø²Ø©');
})();
</script>

<!-- ØªØ­Ù…ÙŠÙ„ Charts Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<script src="{{ url_for('static', filename='js/security_charts.js') }}"></script>
{% endblock %}

