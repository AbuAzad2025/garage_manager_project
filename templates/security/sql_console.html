{% extends 'base.html' %}
{% block title %}SQL Console{% endblock %}
{% block page_title %}💻 SQL Console{% endblock %}

{% block content %}
<div class="container-fluid">
  
  <div class="alert alert-danger border-0 shadow-sm">
    <div class="d-flex align-items-center">
      <div class="flex-grow-1">
        <h5 class="mb-0"><i class="fas fa-skull-crossbones"></i> <strong>خطر شديد!</strong></h5>
        <p class="mb-0 mt-2">تنفيذ SQL مباشر - يمكن أن يدمر قاعدة البيانات! استخدم بحذر شديد.</p>
      </div>
      <span class="badge badge-danger" style="font-size:16px;">DANGEROUS</span>
    </div>
  </div>
  
  <div class="alert alert-info">
    <strong>💡 نصيحة:</strong> استخدم <code>SELECT</code> للقراءة فقط. تجنب <code>DROP</code> و <code>DELETE</code> بدون WHERE.
  </div>

  <div class="card">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0">SQL Query Editor</h5>
    </div>
    <div class="card-body">
      <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="mb-3">
          <textarea name="sql_query" class="form-control" rows="10" style="font-family:monospace; background:#1e1e1e; color:#d4d4d4;" placeholder="SELECT * FROM user LIMIT 10;" required></textarea>
        </div>
        
        <button type="submit" class="btn btn-danger">
          <i class="fas fa-play"></i> تنفيذ
        </button>
        
        <div class="btn-group ms-2">
          <button type="button" class="btn btn-sm btn-secondary" onclick="insertQuery('SELECT * FROM user LIMIT 10;')">Users</button>
          <button type="button" class="btn btn-sm btn-secondary" onclick="insertQuery('SELECT * FROM service LIMIT 10;')">Services</button>
          <button type="button" class="btn btn-sm btn-secondary" onclick="insertQuery('SELECT * FROM sale LIMIT 10;')">Sales</button>
        </div>
      </form>
      
      {% if error %}
      <div class="alert alert-danger mt-3">
        <strong>خطأ:</strong><br>
        <pre>{{ error }}</pre>
      </div>
      {% endif %}
      
      {% if result %}
      <hr>
      <h6 class="mt-4">النتيجة:</h6>
      
      {% if result.message %}
      <div class="alert alert-success">{{ result.message }}</div>
      {% else %}
      <p><strong>عدد الصفوف:</strong> {{ result.count }}</p>
      <div class="table-responsive" style="max-height:500px; overflow:auto;">
        <table class="table table-sm table-bordered table-striped">
          <thead class="table-dark sticky-top">
            <tr>
              {% for col in result.columns %}
              <th>{{ col }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in result.rows %}
            <tr>
              {% for cell in row %}
              <td><small>{{ cell }}</small></td>
              {% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}
      {% endif %}
    </div>
  </div>

</div>

<script>
function insertQuery(query) {
  document.querySelector('textarea[name="sql_query"]').value = query;
}
</script>
{% endblock %}

