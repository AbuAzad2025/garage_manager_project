{% extends 'base.html' %}
{% block title %}مدير الجداول{% endblock %}
{% block page_title %}🗃️ مدير الجداول - Database Tables{% endblock %}

{% block content %}
<div class="container-fluid">
  
  {% include 'security/_navigation.html' %}

  <div class="row">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0"><i class="fas fa-database"></i> الجداول ({{ tables|length }})</h5>
        </div>
        <div class="list-group list-group-flush" style="max-height: 600px; overflow-y: auto;">
          {% for table in tables %}
            <a href="{{ url_for('security.table_manager', table=table) }}" 
               class="list-group-item list-group-item-action {% if table == selected_table %}active{% endif %}">
              <i class="fas fa-table"></i> {{ table }}
            </a>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="col-md-9">
      {% if selected_table %}
      <div class="card border-0 shadow-sm mb-3">
        <div class="card-header bg-gradient-dark text-white">
          <h5 class="mb-0"><i class="fas fa-columns"></i> أعمدة: {{ selected_table }}</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm table-bordered">
              <thead class="table-light">
                <tr>
                  <th>الاسم</th>
                  <th>النوع</th>
                  <th>Nullable</th>
                  <th>Default</th>
                </tr>
              </thead>
              <tbody>
                {% for col in columns %}
                <tr>
                  <td><code>{{ col.name }}</code></td>
                  <td><span class="badge bg-info">{{ col.type }}</span></td>
                  <td>
                    {% if col.nullable %}
                      <span class="badge bg-success">نعم</span>
                    {% else %}
                      <span class="badge bg-danger">لا</span>
                    {% endif %}
                  </td>
                  <td><small>{{ col.default or '-' }}</small></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card border-0 shadow-sm">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0"><i class="fas fa-eye"></i> عينة البيانات (10 صفوف)</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm table-hover">
              <thead class="table-dark">
                <tr>
                  {% if sample_data %}
                    {% for key in sample_data[0].keys() %}
                      <th>{{ key }}</th>
                    {% endfor %}
                  {% endif %}
                </tr>
              </thead>
              <tbody>
                {% for row in sample_data %}
                <tr>
                  {% for value in row.values() %}
                    <td>{{ value if value is not none else '-' }}</td>
                  {% endfor %}
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% else %}
      <div class="alert alert-info">
        <i class="fas fa-arrow-right"></i> اختر جدولاً من القائمة
      </div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}

