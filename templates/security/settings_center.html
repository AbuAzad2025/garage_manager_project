{% extends 'security/base_security.html' %}

{% block tour_name %}settings_center{% endblock %}

{% block security_title %}Settings & Customization Center{% endblock %}
{% block security_icon %}<i class="fas fa-cogs"></i>{% endblock %}
{% block security_description %}إعدادات شاملة • ثيمات • مظهر • علامة تجارية • فروع{% endblock %}

{% block security_breadcrumb %}
<li class="breadcrumb-item active">Settings Center</li>
{% if active_tab %}
<li class="breadcrumb-item active">{{ active_tab|title }}</li>
{% endif %}
{% endblock %}

{% block security_actions %}
<span class="badge bg-warning text-dark fs-6">8 أدوات</span>
{% endblock %}

{% block security_content %}

  <div class="card shadow-lg border-0">
    <div class="card-body p-0">
      
      <ul class="nav nav-tabs nav-fill">
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'system' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='system') }}"
             title="الإعدادات العامة للنظام">
            إعدادات النظام
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'constants' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='constants') }}"
             title="الثوابت والقيم الافتراضية">
            الثوابت
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'config' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='config') }}"
             title="تكوين النظام المتقدم">
            <i class="fas fa-sliders-h"></i> تكوين متقدم
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'branding' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='branding') }}">
            <i class="fas fa-tag"></i> العلامة التجارية
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'theme' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='theme') }}">
            <i class="fas fa-palette"></i> المظهر والثيمات
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'logos' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='logos') }}">
            <i class="fas fa-image"></i> الشعارات
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'darkmode' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='darkmode') }}">
            <i class="fas fa-moon"></i> الوضع الليلي
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link {% if active_tab == 'branches' %}active{% endif %}" 
             href="{{ url_for('security.settings_center', tab='branches') }}">
            <i class="fas fa-code-branch"></i> الفروع
          </a>
        </li>
      </ul>

      <div class="tab-content p-4">
        
        <!-- تاب 1: إعدادات النظام -->
        <div class="tab-pane fade {% if active_tab == 'system' %}show active{% endif %}" 
             id="system" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col-lg-4">
              <div class="card border-0 shadow-sm bg-primary text-white">
                <div class="card-body">
                  <h6 class="text-white-50 mb-1">إجمالي الإعدادات</h6>
                  <h3 class="mb-0 fw-bold">{{ settings_stats.total if settings_stats else 0 }}</h3>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card border-0 shadow-sm bg-success text-white">
                <div class="card-body">
                  <h6 class="text-white-50 mb-1">عامة</h6>
                  <h3 class="mb-0 fw-bold">{{ settings_stats.public if settings_stats else 0 }}</h3>
                </div>
              </div>
            </div>
            <div class="col-lg-4">
              <div class="card border-0 shadow-sm bg-warning text-white">
                <div class="card-body">
                  <h6 class="text-white-50 mb-1">خاصة</h6>
                  <h3 class="mb-0 fw-bold">{{ settings_stats.private if settings_stats else 0 }}</h3>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-primary text-white">
              <h5 class="mb-0"><i class="fas fa-list"></i> قائمة الإعدادات</h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive" style="max-height: 500px;">
                <table class="table table-hover table-sm mb-0">
                  <thead class="table-light sticky-top">
                    <tr>
                      <th>المفتاح</th>
                      <th>القيمة</th>
                      <th>الوصف</th>
                      <th>النوع</th>
                      <th>إجراءات</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% if settings_list %}
                      {% for setting in settings_list %}
                      <tr>
                        <td><code class="text-primary">{{ setting.key }}</code></td>
                        <td>
                          <span class="text-truncate d-inline-block" style="max-width: 200px;" title="{{ setting.value }}">
                            {{ setting.value[:50] if setting.value else '-' }}
                          </span>
                        </td>
                        <td><small class="text-muted">{{ setting.description or '-' }}</small></td>
                        <td><span class="badge bg-secondary">{{ setting.data_type }}</span></td>
                        <td>
                          <a href="{{ url_for('security.system_settings', key=setting.key) }}" 
                             class="btn btn-sm btn-outline-primary" 
                             title="تعديل">
                            <i class="fas fa-edit"></i>
                          </a>
                        </td>
                      </tr>
                      {% endfor %}
                    {% else %}
                      <tr>
                        <td colspan="5" class="text-center text-muted">لا توجد إعدادات</td>
                      </tr>
                    {% endif %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <div class="mt-3">
            <a href="{{ url_for('security.system_settings') }}" class="btn btn-primary">
              <i class="fas fa-cog"></i> إدارة الإعدادات الكاملة
            </a>
          </div>
        </div>
        </div>
        
        <!-- تاب 2: الثوابت -->
        <div class="tab-pane fade {% if active_tab == 'constants' %}show active{% endif %}" 
             id="constants" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-info text-white">
              <h5 class="mb-0"><i class="fas fa-database"></i> ثوابت النظام</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="card border-primary">
                    <div class="card-body">
                      <h6 class="text-primary"><i class="fas fa-coins"></i> الثوابت المالية</h6>
                      <ul class="list-unstyled small">
                        <li><i class="fas fa-check text-success"></i> العملة الافتراضية: ILS</li>
                        <li><i class="fas fa-check text-success"></i> رمز العملة: ₪</li>
                        <li><i class="fas fa-check text-success"></i> الأرقام العشرية: 2</li>
                        <li><i class="fas fa-check text-success"></i> ضريبة VAT: 17%</li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-success">
                    <div class="card-body">
                      <h6 class="text-success"><i class="fas fa-cogs"></i> ثوابت التطبيق</h6>
                      <ul class="list-unstyled small">
                        <li><i class="fas fa-check text-success"></i> المنطقة الزمنية: UTC+3</li>
                        <li><i class="fas fa-check text-success"></i> اللغة: العربية</li>
                        <li><i class="fas fa-check text-success"></i> التاريخ الهجري: مفعّل</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <a href="{{ url_for('security.system_settings', tab='business') }}" class="btn btn-info">
                  <i class="fas fa-database"></i> عرض جميع الثوابت
                </a>
              </div>
            </div>
          </div>
        </div>
        </div>
        
        <!-- تاب 3: تكوين متقدم -->
        <div class="tab-pane fade {% if active_tab == 'config' %}show active{% endif %}" 
             id="config" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-warning text-white">
              <h5 class="mb-0"><i class="fas fa-sliders-h"></i> التكوين المتقدم</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="card border-info">
                    <div class="card-body text-center">
                      <i class="fas fa-database fa-2x text-info mb-2"></i>
                      <h6>قاعدة البيانات</h6>
                      <p class="small text-muted mb-0">SQLite / PostgreSQL</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card border-success">
                    <div class="card-body text-center">
                      <i class="fas fa-server fa-2x text-success mb-2"></i>
                      <h6>السيرفر</h6>
                      <p class="small text-muted mb-0">Flask + SocketIO</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card border-warning">
                    <div class="card-body text-center">
                      <i class="fas fa-shield-alt fa-2x text-warning mb-2"></i>
                      <h6>الأمان</h6>
                      <p class="small text-muted mb-0">CSRF + Rate Limiting</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <a href="{{ url_for('security.system_settings', tab='advanced') }}" class="btn btn-warning">
                  <i class="fas fa-sliders-h"></i> تكوين متقدم
                </a>
              </div>
            </div>
          </div>
        </div>
        </div>
        
        <!-- تاب 4: العلامة التجارية -->
        <div class="tab-pane fade {% if active_tab == 'branding' %}show active{% endif %}" 
             id="branding" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-danger text-white">
              <h5 class="mb-0"><i class="fas fa-tag"></i> العلامة التجارية - تعديل سريع</h5>
            </div>
            <div class="card-body">
              <form method="POST" action="{{ url_for('security.settings_center', tab='branding') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="action" value="update_branding">
                
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="card border-primary">
                      <div class="card-body">
                        <h6 class="text-primary"><i class="fas fa-building"></i> معلومات الشركة</h6>
                        <div class="mb-3">
                          <label class="form-label">اسم الشركة:</label>
                          <input type="text" class="form-control" name="company_name" 
                                 value="{{ branding_settings.company_name if branding_settings else 'Azad Garage' }}">
                        </div>
                        <div class="mb-3">
                          <label class="form-label">اللون الأساسي:</label>
                          <input type="color" class="form-control form-control-color" name="primary_color" 
                                 value="{{ branding_settings.primary_color if branding_settings else '#007bff' }}">
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card border-success">
                      <div class="card-body">
                        <h6 class="text-success"><i class="fas fa-image"></i> الشعارات</h6>
                        <div class="text-center mb-3">
                          {% if branding_settings and branding_settings.company_logo %}
                            <img src="{{ branding_settings.company_logo }}" alt="Logo" class="img-thumbnail mb-2" style="max-height: 100px;">
                          {% else %}
                            <div class="text-muted"><i class="fas fa-image fa-3x"></i></div>
                            <p class="small">لم يتم رفع شعار</p>
                          {% endif %}
                        </div>
                        <a href="{{ url_for('security.logo_manager') }}" class="btn btn-sm btn-outline-success w-100">
                          <i class="fas fa-upload"></i> رفع شعار
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="mt-4">
                  <button type="submit" class="btn btn-danger">
                    <i class="fas fa-save"></i> حفظ التعديلات السريعة
                  </button>
                  <a href="{{ url_for('security.system_branding') }}" class="btn btn-outline-danger">
                    <i class="fas fa-cog"></i> إعدادات متقدمة كاملة
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>
        </div>
        
        <!-- تاب 5: المظهر والثيمات -->
        <div class="tab-pane fade {% if active_tab == 'theme' %}show active{% endif %}" 
             id="theme" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-success text-white">
              <h5 class="mb-0"><i class="fas fa-palette"></i> محرر الثيمات</h5>
            </div>
            <div class="card-body">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>محرر CSS/HTML/JS المباشر:</strong> عدّل الثيمات والألوان والأنماط مباشرة
              </div>
              <div class="row">
                <div class="col-md-4">
                  <div class="card border-primary">
                    <div class="card-body text-center">
                      <i class="fab fa-css3-alt fa-3x text-primary mb-3"></i>
                      <h6>CSS Themes</h6>
                      <p class="small text-muted">تعديل الأنماط</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card border-warning">
                    <div class="card-body text-center">
                      <i class="fab fa-html5 fa-3x text-warning mb-3"></i>
                      <h6>HTML Templates</h6>
                      <p class="small text-muted">تعديل القوالب</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card border-success">
                    <div class="card-body text-center">
                      <i class="fab fa-js fa-3x text-success mb-3"></i>
                      <h6>JavaScript</h6>
                      <p class="small text-muted">تعديل السكريبتات</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <a href="{{ url_for('security.theme_editor') }}" class="btn btn-success">
                  <i class="fas fa-code"></i> فتح محرر الثيمات
                </a>
              </div>
            </div>
          </div>
        </div>
        </div>
        
        <!-- تاب 6: الشعارات -->
        <div class="tab-pane fade {% if active_tab == 'logos' %}show active{% endif %}" 
             id="logos" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-secondary text-white">
              <h5 class="mb-0"><i class="fas fa-image"></i> إدارة الشعارات</h5>
            </div>
            <div class="card-body">
              <div class="row g-4">
                <div class="col-md-6">
                  <div class="card border-primary">
                    <div class="card-header bg-primary text-white">
                      <h6 class="mb-0"><i class="fas fa-image"></i> شعار الشركة الرئيسي</h6>
                    </div>
                    <div class="card-body text-center">
                      {% if branding_settings and branding_settings.company_logo %}
                        <img src="{{ branding_settings.company_logo }}" alt="Company Logo" class="img-thumbnail mb-2" style="max-height: 150px;">
                      {% else %}
                        <i class="fas fa-image fa-4x text-muted mb-3"></i>
                        <p class="text-muted">لم يتم رفع الشعار</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-info">
                    <div class="card-header bg-info text-white">
                      <h6 class="mb-0"><i class="fas fa-star"></i> Favicon</h6>
                    </div>
                    <div class="card-body text-center">
                      {% if branding_settings and branding_settings.custom_favicon %}
                        <img src="{{ branding_settings.custom_favicon }}" alt="Favicon" class="img-thumbnail mb-2" style="max-height: 64px;">
                      {% else %}
                        <i class="fas fa-star fa-4x text-muted mb-3"></i>
                        <p class="text-muted">لم يتم رفع Favicon</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <a href="{{ url_for('security.logo_manager') }}" class="btn btn-secondary">
                  <i class="fas fa-upload"></i> رفع وإدارة الشعارات
                </a>
              </div>
            </div>
          </div>
        </div>
        </div>
        
        <!-- تاب 7: الوضع الليلي -->
        <div class="tab-pane fade {% if active_tab == 'darkmode' %}show active{% endif %}" 
             id="darkmode" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
              <h5 class="mb-0"><i class="fas fa-moon"></i> الوضع الليلي</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <div class="card border-dark">
                    <div class="card-body">
                      <h6><i class="fas fa-moon text-dark"></i> إعدادات Dark Mode</h6>
                      <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="darkModeToggle">
                        <label class="form-check-label" for="darkModeToggle">تفعيل الوضع الليلي</label>
                      </div>
                      <p class="small text-muted">يمكن للمستخدمين التبديل بين الوضع العادي والليلي</p>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card border-secondary">
                    <div class="card-body">
                      <h6><i class="fas fa-palette text-secondary"></i> الألوان</h6>
                      <ul class="list-unstyled small">
                        <li><i class="fas fa-circle text-dark"></i> خلفية: #1a1a1a</li>
                        <li><i class="fas fa-circle text-secondary"></i> نص: #f8f9fa</li>
                        <li><i class="fas fa-circle" style="color: #444;"></i> ثانوي: #444</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <a href="{{ url_for('security.dark_mode_settings') }}" class="btn btn-dark">
                  <i class="fas fa-moon"></i> إعدادات متقدمة
                </a>
              </div>
            </div>
          </div>
        </div>
        </div>
        
        <!-- تاب 8: الفروع -->
        <div class="tab-pane fade {% if active_tab == 'branches' %}show active{% endif %}" 
             id="branches" 
             role="tabpanel">
        <div class="container-fluid">
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card border-0 shadow-sm bg-info text-white">
                <div class="card-body">
                  <h6 class="text-white-50 mb-1">إجمالي الفروع</h6>
                  <h3 class="mb-0 fw-bold">{{ branches_data.total if branches_data else 0 }}</h3>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card border-0 shadow-sm bg-success text-white">
                <div class="card-body">
                  <h6 class="text-white-50 mb-1">فروع نشطة</h6>
                  <h3 class="mb-0 fw-bold">{{ branches_data.active if branches_data else 0 }}</h3>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card shadow-sm">
            <div class="card-header bg-gradient-info text-white">
              <h5 class="mb-0"><i class="fas fa-code-branch"></i> قائمة الفروع</h5>
            </div>
            <div class="card-body">
              {% if branches_list %}
                <div class="row g-3">
                  {% for branch in branches_list %}
                  <div class="col-md-6">
                    <div class="card border-primary">
                      <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                          <div>
                            <h6 class="text-primary mb-1">
                              <i class="fas fa-map-marker-alt"></i> {{ branch.name }}
                            </h6>
                            <p class="small text-muted mb-1">{{ branch.address or 'لا يوجد عنوان' }}</p>
                            {% if branch.phone %}
                              <p class="small mb-0"><i class="fas fa-phone"></i> {{ branch.phone }}</p>
                            {% endif %}
                          </div>
                          <div>
                            {% if branch.is_active %}
                              <span class="badge bg-success">نشط</span>
                            {% else %}
                              <span class="badge bg-secondary">غير نشط</span>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="alert alert-warning">
                  <i class="fas fa-info-circle"></i> لا توجد فروع مسجلة
                </div>
              {% endif %}
              <div class="mt-3">
                <a href="{{ url_for('branches_bp.list_branches') }}" class="btn btn-info">
                  <i class="fas fa-code-branch"></i> إدارة الفروع
                </a>
                <a href="{{ url_for('branches_bp.create_branch') }}" class="btn btn-success">
                  <i class="fas fa-plus"></i> إضافة فرع جديد
                </a>
              </div>
            </div>
          </div>
        </div>
        </div>
        
      </div>
    </div>
  </div>
</div>
{% endblock %}

