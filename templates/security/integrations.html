{% extends 'base.html' %}
{% block title %}🔌 مركز التكامل - Integration Center{% endblock %}
{% block page_title %}🔌 مركز التكامل مع الأجهزة والأنظمة الخارجية{% endblock %}

{% block head_extra %}
<style>
.integration-card {
    border-radius: 15px;
    border: none;
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.integration-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.integration-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 15px 15px 0 0;
}

.integration-header.stripe {
    background: linear-gradient(135deg, #635BFF 0%, #0A2540 100%);
}

.integration-header.paypal {
    background: linear-gradient(135deg, #0070BA 0%, #003087 100%);
}

.integration-header.sms {
    background: linear-gradient(135deg, #F22F46 0%, #8B1A1F 100%);
}

.integration-header.printer {
    background: linear-gradient(135deg, #FF6B6B 0%, #C44569 100%);
}

.integration-header.storage {
    background: linear-gradient(135deg, #FF9A00 0%, #FF6200 100%);
}

.integration-header.webhooks {
    background: linear-gradient(135deg, #00D2FF 0%, #3A7BD5 100%);
}

.integration-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.form-section {
    padding: 25px;
    background: #f8f9fa;
    border-radius: 10px;
    margin-bottom: 15px;
}

.test-btn {
    margin-top: 15px;
}

.status-badge {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.status-enabled {
    background: #28a745;
    color: white;
}

.status-disabled {
    background: #dc3545;
    color: white;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body bg-gradient-info text-white" style="border-radius: 15px;">
                    <h3><i class="fas fa-plug"></i> مركز التكامل الشامل</h3>
                    <p class="mb-0">إعداد وإدارة جميع التكاملات مع الأجهزة الطرفية والأنظمة الخارجية</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Stripe Integration -->
    <div class="row">
        <div class="col-md-6">
            <div class="integration-card card">
                <div class="integration-header stripe">
                    <div class="integration-icon"><i class="fab fa-stripe-s"></i></div>
                    <h4 class="mb-0">Stripe</h4>
                    <small>بوابة دفع عالمية</small>
                    {% if integrations.stripe.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_stripe">
                        
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="stripe_enabled" name="stripe_enabled" 
                                    {% if integrations.stripe.enabled %}checked{% endif %}>
                                <label class="custom-control-label" for="stripe_enabled">
                                    <strong>تفعيل Stripe</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-group">
                                <label><i class="fas fa-key"></i> Public Key</label>
                                <input type="text" class="form-control" name="stripe_public_key" 
                                    value="{{ integrations.stripe.public_key }}" 
                                    placeholder="pk_live_...">
                                <small class="text-muted">المفتاح العام (Frontend)</small>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-lock"></i> Secret Key</label>
                                <input type="password" class="form-control" name="stripe_secret_key" 
                                    value="{{ integrations.stripe.secret_key }}" 
                                    placeholder="sk_live_...">
                                <small class="text-muted">المفتاح السري (Backend)</small>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-link"></i> Webhook Secret</label>
                                <input type="password" class="form-control" name="stripe_webhook_secret" 
                                    value="{{ integrations.stripe.webhook_secret }}" 
                                    placeholder="whsec_...">
                                <small class="text-muted">للتحقق من Webhooks</small>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات Stripe
                        </button>
                    </form>

                    <form method="POST" class="test-btn">
                        <input type="hidden" name="action" value="test_stripe">
                        <button type="submit" class="btn btn-outline-info btn-block">
                            <i class="fas fa-vial"></i> اختبار الاتصال
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- PayPal Integration -->
        <div class="col-md-6">
            <div class="integration-card card">
                <div class="integration-header paypal">
                    <div class="integration-icon"><i class="fab fa-paypal"></i></div>
                    <h4 class="mb-0">PayPal</h4>
                    <small>بوابة دفع عالمية</small>
                    {% if integrations.paypal.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_paypal">
                        
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="paypal_enabled" name="paypal_enabled" 
                                    {% if integrations.paypal.enabled %}checked{% endif %}>
                                <label class="custom-control-label" for="paypal_enabled">
                                    <strong>تفعيل PayPal</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-group">
                                <label><i class="fas fa-cog"></i> Mode</label>
                                <select class="form-control" name="paypal_mode">
                                    <option value="sandbox" {% if integrations.paypal.mode == 'sandbox' %}selected{% endif %}>Sandbox (Test)</option>
                                    <option value="live" {% if integrations.paypal.mode == 'live' %}selected{% endif %}>Live (Production)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-id-card"></i> Client ID</label>
                                <input type="text" class="form-control" name="paypal_client_id" 
                                    value="{{ integrations.paypal.client_id }}" 
                                    placeholder="AeA1v...">
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-lock"></i> Secret</label>
                                <input type="password" class="form-control" name="paypal_secret" 
                                    value="{{ integrations.paypal.secret }}" 
                                    placeholder="ELw3...">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات PayPal
                        </button>
                    </form>

                    <form method="POST" class="test-btn">
                        <input type="hidden" name="action" value="test_paypal">
                        <button type="submit" class="btn btn-outline-info btn-block">
                            <i class="fas fa-vial"></i> اختبار الاتصال
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- SMS/WhatsApp Integration -->
    <div class="row">
        <div class="col-md-12">
            <div class="integration-card card">
                <div class="integration-header sms">
                    <div class="integration-icon"><i class="fas fa-sms"></i></div>
                    <h4 class="mb-0">SMS & WhatsApp (Twilio)</h4>
                    <small>رسائل نصية وواتساب تلقائية</small>
                    {% if integrations.sms.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_sms">
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="sms_enabled" name="sms_enabled" 
                                        {% if integrations.sms.enabled %}checked{% endif %}>
                                    <label class="custom-control-label" for="sms_enabled">
                                        <strong>تفعيل SMS/WhatsApp</strong>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-user"></i> Account SID</label>
                                        <input type="text" class="form-control" name="twilio_account_sid" 
                                            value="{{ integrations.sms.twilio_account_sid }}" 
                                            placeholder="ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-key"></i> Auth Token</label>
                                        <input type="password" class="form-control" name="twilio_auth_token" 
                                            value="{{ integrations.sms.twilio_auth_token }}" 
                                            placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-phone"></i> رقم الهاتف (SMS)</label>
                                        <input type="text" class="form-control" name="twilio_phone_number" 
                                            value="{{ integrations.sms.twilio_phone_number }}" 
                                            placeholder="+970599123456">
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fab fa-whatsapp"></i> رقم WhatsApp</label>
                                        <input type="text" class="form-control" name="twilio_whatsapp_number" 
                                            value="{{ integrations.sms.twilio_whatsapp_number }}" 
                                            placeholder="whatsapp:+970599123456">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات SMS/WhatsApp
                        </button>
                    </form>

                    <form method="POST" class="test-btn">
                        <input type="hidden" name="action" value="test_sms">
                        <div class="input-group">
                            <input type="text" class="form-control" name="test_phone_number" 
                                placeholder="أدخل رقم هاتف للاختبار (مثال: +970599123456)">
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-outline-success">
                                    <i class="fas fa-paper-plane"></i> إرسال رسالة اختبار
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Thermal Printer Integration -->
    <div class="row">
        <div class="col-md-12">
            <div class="integration-card card">
                <div class="integration-header printer">
                    <div class="integration-icon"><i class="fas fa-print"></i></div>
                    <h4 class="mb-0">طابعة حرارية (Thermal Printer)</h4>
                    <small>طباعة فواتير احترافية 80mm</small>
                    {% if integrations.thermal_printer.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_thermal_printer">
                        
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="thermal_printer_enabled" name="thermal_printer_enabled" 
                                    {% if integrations.thermal_printer.enabled %}checked{% endif %}>
                                <label class="custom-control-label" for="thermal_printer_enabled">
                                    <strong>تفعيل الطابعة الحرارية</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label><i class="fas fa-cog"></i> نوع الاتصال</label>
                                    <select class="form-control" name="thermal_printer_type" id="printer_type_select">
                                        <option value="network" {% if integrations.thermal_printer.type == 'network' %}selected{% endif %}>Network (IP)</option>
                                        <option value="usb" {% if integrations.thermal_printer.type == 'usb' %}selected{% endif %}>USB</option>
                                    </select>
                                </div>

                                <!-- Network Settings -->
                                <div class="col-md-6 network-settings">
                                    <div class="form-group">
                                        <label><i class="fas fa-network-wired"></i> IP Address</label>
                                        <input type="text" class="form-control" name="thermal_printer_ip" 
                                            value="{{ integrations.thermal_printer.ip }}" 
                                            placeholder="192.168.1.100">
                                    </div>
                                </div>

                                <div class="col-md-6 network-settings">
                                    <div class="form-group">
                                        <label><i class="fas fa-plug"></i> Port</label>
                                        <input type="number" class="form-control" name="thermal_printer_port" 
                                            value="{{ integrations.thermal_printer.port }}" 
                                            placeholder="9100">
                                    </div>
                                </div>

                                <!-- USB Settings -->
                                <div class="col-md-6 usb-settings" style="display:none;">
                                    <div class="form-group">
                                        <label><i class="fas fa-hashtag"></i> USB Vendor ID</label>
                                        <input type="text" class="form-control" name="thermal_printer_usb_vendor" 
                                            value="{{ integrations.thermal_printer.usb_vendor }}" 
                                            placeholder="0x04b8 (مثال: Epson)">
                                    </div>
                                </div>

                                <div class="col-md-6 usb-settings" style="display:none;">
                                    <div class="form-group">
                                        <label><i class="fas fa-hashtag"></i> USB Product ID</label>
                                        <input type="text" class="form-control" name="thermal_printer_usb_product" 
                                            value="{{ integrations.thermal_printer.usb_product }}" 
                                            placeholder="0x0e15">
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label><i class="fas fa-ruler-horizontal"></i> عرض الورقة</label>
                                        <select class="form-control" name="thermal_printer_width">
                                            <option value="58" {% if integrations.thermal_printer.width == '58' %}selected{% endif %}>58mm</option>
                                            <option value="80" {% if integrations.thermal_printer.width == '80' %}selected{% endif %}>80mm</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات الطابعة
                        </button>
                    </form>

                    <form method="POST" class="test-btn">
                        <input type="hidden" name="action" value="test_thermal_printer">
                        <button type="submit" class="btn btn-outline-success btn-block">
                            <i class="fas fa-print"></i> طباعة صفحة اختبار
                        </button>
                    </form>

                    <div class="alert alert-info mt-3">
                        <strong>📦 التثبيت:</strong>
                        <code>pip install python-escpos</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Barcode Scanner Integration -->
    <div class="row">
        <div class="col-md-6">
            <div class="integration-card card">
                <div class="integration-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                    <div class="integration-icon"><i class="fas fa-barcode"></i></div>
                    <h4 class="mb-0">ماسح الباركود</h4>
                    <small>USB/Web Barcode Scanner</small>
                    {% if integrations.barcode_scanner.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_barcode_scanner">
                        
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="barcode_scanner_enabled" name="barcode_scanner_enabled" 
                                    {% if integrations.barcode_scanner.enabled %}checked{% endif %}>
                                <label class="custom-control-label" for="barcode_scanner_enabled">
                                    <strong>تفعيل ماسح الباركود</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-group">
                                <label><i class="fas fa-cog"></i> نوع الماسح</label>
                                <select class="form-control" name="barcode_scanner_type">
                                    <option value="web" {% if integrations.barcode_scanner.type == 'web' %}selected{% endif %}>Web-based (Camera)</option>
                                    <option value="usb" {% if integrations.barcode_scanner.type == 'usb' %}selected{% endif %}>USB HID Scanner</option>
                                    <option value="bluetooth" {% if integrations.barcode_scanner.type == 'bluetooth' %}selected{% endif %}>Bluetooth</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-link"></i> USB Device Path</label>
                                <input type="text" class="form-control" name="barcode_scanner_device" 
                                    value="{{ integrations.barcode_scanner.device }}" 
                                    placeholder="/dev/input/event0 (Linux) أو COM3 (Windows)">
                                <small class="text-muted">فقط للـ USB/Bluetooth</small>
                            </div>

                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="barcode_auto_focus" name="barcode_auto_focus" 
                                        {% if integrations.barcode_scanner.auto_focus %}checked{% endif %}>
                                    <label class="custom-control-label" for="barcode_auto_focus">
                                        Auto-focus على حقل البحث
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="barcode_beep_sound" name="barcode_beep_sound" 
                                        {% if integrations.barcode_scanner.beep_sound %}checked{% endif %}>
                                    <label class="custom-control-label" for="barcode_beep_sound">
                                        صوت تنبيه عند المسح الناجح
                                    </label>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات ماسح الباركود
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Cloud Storage Integration -->
        <div class="col-md-6">
            <div class="integration-card card">
                <div class="integration-header storage">
                    <div class="integration-icon"><i class="fab fa-aws"></i></div>
                    <h4 class="mb-0">التخزين السحابي (AWS S3)</h4>
                    <small>تخزين الملفات والصور</small>
                    {% if integrations.cloud_storage.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_cloud_storage">
                        
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="cloud_storage_enabled" name="cloud_storage_enabled" 
                                    {% if integrations.cloud_storage.enabled %}checked{% endif %}>
                                <label class="custom-control-label" for="cloud_storage_enabled">
                                    <strong>تفعيل التخزين السحابي</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="form-group">
                                <label><i class="fas fa-key"></i> AWS Access Key</label>
                                <input type="text" class="form-control" name="aws_access_key" 
                                    value="{{ integrations.cloud_storage.aws_access_key }}" 
                                    placeholder="AKIAIOSFODNN7EXAMPLE">
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-lock"></i> AWS Secret Key</label>
                                <input type="password" class="form-control" name="aws_secret_key" 
                                    value="{{ integrations.cloud_storage.aws_secret_key }}" 
                                    placeholder="wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY">
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-globe"></i> Region</label>
                                <select class="form-control" name="aws_region">
                                    <option value="eu-west-1" {% if integrations.cloud_storage.aws_region == 'eu-west-1' %}selected{% endif %}>EU West (Ireland)</option>
                                    <option value="us-east-1" {% if integrations.cloud_storage.aws_region == 'us-east-1' %}selected{% endif %}>US East (N. Virginia)</option>
                                    <option value="me-south-1" {% if integrations.cloud_storage.aws_region == 'me-south-1' %}selected{% endif %}>Middle East (Bahrain)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label><i class="fas fa-database"></i> Bucket Name</label>
                                <input type="text" class="form-control" name="aws_bucket" 
                                    value="{{ integrations.cloud_storage.aws_bucket }}" 
                                    placeholder="garage-manager-files">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات التخزين السحابي
                        </button>
                    </form>

                    <div class="alert alert-info mt-3">
                        <strong>📦 التثبيت:</strong>
                        <code>pip install boto3</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Webhooks Integration -->
    <div class="row">
        <div class="col-md-12">
            <div class="integration-card card">
                <div class="integration-header webhooks">
                    <div class="integration-icon"><i class="fas fa-link"></i></div>
                    <h4 class="mb-0">Webhooks</h4>
                    <small>تكامل مع الأنظمة الخارجية (Zapier, Make, n8n)</small>
                    {% if integrations.webhooks.enabled %}
                    <span class="status-badge status-enabled float-left">مفعّل ✅</span>
                    {% else %}
                    <span class="status-badge status-disabled float-left">معطّل ❌</span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_webhooks">
                        
                        <div class="form-group">
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="webhooks_enabled" name="webhooks_enabled" 
                                    {% if integrations.webhooks.enabled %}checked{% endif %}>
                                <label class="custom-control-label" for="webhooks_enabled">
                                    <strong>تفعيل Webhooks</strong>
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label><i class="fas fa-key"></i> Webhook Secret</label>
                                        <input type="text" class="form-control" name="webhook_secret" 
                                            value="{{ integrations.webhooks.secret }}" 
                                            placeholder="secret_key_for_signature_verification">
                                        <small class="text-muted">للتحقق من Signature</small>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label><i class="fas fa-redo"></i> Retry Count</label>
                                        <input type="number" class="form-control" name="webhook_retry_count" 
                                            value="{{ integrations.webhooks.retry_count }}" 
                                            placeholder="3" min="0" max="10">
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label><i class="fas fa-clock"></i> Timeout (s)</label>
                                        <input type="number" class="form-control" name="webhook_timeout" 
                                            value="{{ integrations.webhooks.timeout }}" 
                                            placeholder="10" min="5" max="60">
                                    </div>
                                </div>
                            </div>

                            <div class="alert alert-warning">
                                <strong>⚡ الأحداث المدعومة:</strong>
                                <ul class="mb-0">
                                    <li>sale.created - عند إنشاء فاتورة</li>
                                    <li>payment.completed - عند اكتمال دفعة</li>
                                    <li>service.completed - عند اكتمال صيانة</li>
                                    <li>stock.low - عند انخفاض المخزون</li>
                                    <li>customer.created - عند إضافة عميل</li>
                                </ul>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات Webhooks
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Local Payment Gateways -->
    <div class="row">
        <div class="col-md-12">
            <div class="integration-card card">
                <div class="integration-header" style="background: linear-gradient(135deg, #7F00FF 0%, #E100FF 100%);">
                    <div class="integration-icon"><i class="fas fa-credit-card"></i></div>
                    <h4 class="mb-0">بوابات الدفع المحلية</h4>
                    <small>Moyasar (سعودية) • Tap Payments (خليجي) • Paytabs (عربي)</small>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="action" value="save_local_gateways">
                        
                        <div class="form-section">
                            <h5><i class="fas fa-building"></i> Moyasar (السعودية)</h5>
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="moyasar_enabled" name="moyasar_enabled" 
                                        {% if integrations.local_gateways.moyasar_enabled %}checked{% endif %}>
                                    <label class="custom-control-label" for="moyasar_enabled">تفعيل Moyasar</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>API Key</label>
                                <input type="password" class="form-control" name="moyasar_api_key" 
                                    value="{{ integrations.local_gateways.moyasar_api_key }}" 
                                    placeholder="pk_live_...">
                            </div>
                        </div>

                        <div class="form-section">
                            <h5><i class="fas fa-building"></i> Tap Payments (الخليج)</h5>
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="tap_enabled" name="tap_enabled" 
                                        {% if integrations.local_gateways.tap_enabled %}checked{% endif %}>
                                    <label class="custom-control-label" for="tap_enabled">تفعيل Tap</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>API Key</label>
                                <input type="password" class="form-control" name="tap_api_key" 
                                    value="{{ integrations.local_gateways.tap_api_key }}" 
                                    placeholder="sk_live_...">
                            </div>
                        </div>

                        <div class="form-section">
                            <h5><i class="fas fa-building"></i> Paytabs (عربي)</h5>
                            <div class="form-group">
                                <div class="custom-control custom-switch">
                                    <input type="checkbox" class="custom-control-input" id="paytabs_enabled" name="paytabs_enabled" 
                                        {% if integrations.local_gateways.paytabs_enabled %}checked{% endif %}>
                                    <label class="custom-control-label" for="paytabs_enabled">تفعيل Paytabs</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Profile ID</label>
                                <input type="text" class="form-control" name="paytabs_profile_id" 
                                    value="{{ integrations.local_gateways.paytabs_profile_id }}" 
                                    placeholder="12345">
                            </div>
                            <div class="form-group">
                                <label>Server Key</label>
                                <input type="password" class="form-control" name="paytabs_server_key" 
                                    value="{{ integrations.local_gateways.paytabs_server_key }}" 
                                    placeholder="S...">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fas fa-save"></i> حفظ إعدادات بوابات الدفع
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <div class="row">
        <div class="col-12">
            <a href="{{ url_for('security.dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-right"></i> العودة للوحة السرية
            </a>
        </div>
    </div>

</div>

<script>
// Toggle USB/Network settings
document.getElementById('printer_type_select')?.addEventListener('change', function() {
    const networkSettings = document.querySelectorAll('.network-settings');
    const usbSettings = document.querySelectorAll('.usb-settings');
    
    if (this.value === 'network') {
        networkSettings.forEach(el => el.style.display = 'block');
        usbSettings.forEach(el => el.style.display = 'none');
    } else {
        networkSettings.forEach(el => el.style.display = 'none');
        usbSettings.forEach(el => el.style.display = 'block');
    }
});

// تفعيل عند التحميل
document.addEventListener('DOMContentLoaded', function() {
    const printerType = document.getElementById('printer_type_select');
    if (printerType) {
        printerType.dispatchEvent(new Event('change'));
    }
});
</script>
{% endblock %}
