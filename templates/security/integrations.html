{% extends 'base.html' %}
{% block title %}ูุฑูุฒ ุงูุชูุงูู{% endblock %}
{% block page_title %}๐ ูุฑูุฒ ุงูุชูุงูู - Integrations Hub{% endblock %}

{% block content %}
<div class="container-fluid">
  
  {% include 'security/_navigation.html' %}

  <div class="alert alert-success border-0 shadow-sm">
    <i class="fas fa-plug"></i> <strong>ูุฑูุฒ ุงูุชูุงูู:</strong> ุฑุจุท ุงููุธุงู ูุน ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ
  </div>

  <!-- ุฅุญุตุงุฆูุงุช ุณุฑูุนุฉ -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card border-0 shadow-lg bg-success text-white" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%) !important;">
        <div class="card-body text-center">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <i class="fab fa-whatsapp fa-2x"></i>
            <span class="badge bg-light text-success" id="whatsapp-status-badge">๐ข ูุชุตู</span>
          </div>
          <h5>ูุงุชุณุงุจ</h5>
          <p class="mb-1" id="whatsapp-stats">156 ุฑุณุงูุฉ</p>
          <small class="opacity-75" id="whatsapp-last">ุขุฎุฑ ุงุณุชุฎุฏุงู: ููุฐ 5 ุฏูุงุฆู</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-lg bg-primary text-white" style="background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;">
        <div class="card-body text-center">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <i class="fas fa-envelope fa-2x"></i>
            <span class="badge bg-light text-primary" id="email-status-badge">๐ข ูุชุตู</span>
          </div>
          <h5>ุงูุจุฑูุฏ</h5>
          <p class="mb-1" id="email-stats">89 ุจุฑูุฏ</p>
          <small class="opacity-75" id="email-last">ุขุฎุฑ ุงุณุชุฎุฏุงู: ููุฐ 12 ุฏูููุฉ</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-0 shadow-lg bg-info text-white" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%) !important;">
        <div class="card-body text-center">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <i class="fas fa-key fa-2x"></i>
            <span class="badge bg-light text-info" id="api-status-badge">๐ข ูุดุท</span>
          </div>
          <h5>API Keys</h5>
          <p class="mb-1" id="api-stats">234 ุทูุจ</p>
          <small class="opacity-75" id="api-last">ุขุฎุฑ ุงุณุชุฎุฏุงู: ููุฐ ุฏูููุฉ</small>
        </div>
      </div>
    </div>
  </div>

  <!-- ูุฑุงูุจุฉ ุงูุฃุฏุงุก -->
  <div class="row g-3 mb-4">
    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-gradient-primary text-white">
          <h5 class="mb-0"><i class="fas fa-chart-line"></i> ูุฑุงูุจุฉ ุงูุฃุฏุงุก - ุขุฎุฑ 24 ุณุงุนุฉ</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-md-3">
              <div class="border-end">
                <h4 class="text-success mb-1" id="success-rate">98.5%</h4>
                <small class="text-muted">ูุนุฏู ุงููุฌุงุญ</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="border-end">
                <h4 class="text-info mb-1" id="avg-response">0.8s</h4>
                <small class="text-muted">ูุชูุณุท ุงูุงุณุชุฌุงุจุฉ</small>
              </div>
            </div>
            <div class="col-md-3">
              <div class="border-end">
                <h4 class="text-warning mb-1" id="total-requests">479</h4>
                <small class="text-muted">ุฅุฌูุงูู ุงูุทูุจุงุช</small>
              </div>
            </div>
            <div class="col-md-3">
              <h4 class="text-danger mb-1" id="errors-count">7</h4>
              <small class="text-muted">ุฃุฎุทุงุก</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ุงูุชูุจููุงุช ูุงูุชูุงุฑูุฑ -->
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-gradient-warning text-dark">
          <h5 class="mb-0"><i class="fas fa-bell"></i> ุงูุชูุจููุงุช ุงูุฃุฎูุฑุฉ</h5>
        </div>
        <div class="card-body">
          <div class="list-group list-group-flush">
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <i class="fas fa-check-circle text-success"></i>
                <strong>ูุงุชุณุงุจ</strong> - ุฑุณุงูุฉ ูุฑุณูุฉ ุจูุฌุงุญ
              </div>
              <small class="text-muted">ููุฐ 2 ุฏูููุฉ</small>
            </div>
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <i class="fas fa-envelope text-primary"></i>
                <strong>ุงูุจุฑูุฏ</strong> - ุจุฑูุฏ ุฅููุชุฑููู ูุฑุณู
              </div>
              <small class="text-muted">ููุฐ 5 ุฏูุงุฆู</small>
            </div>
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <i class="fas fa-exclamation-triangle text-warning"></i>
                <strong>API</strong> - ุงุณุชุฌุงุจุฉ ุจุทูุฆุฉ
              </div>
              <small class="text-muted">ููุฐ 10 ุฏูุงุฆู</small>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-gradient-info text-white">
          <h5 class="mb-0"><i class="fas fa-chart-bar"></i> ุชูุฑูุฑ ุงูุงุณุชุฎุฏุงู</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <h4 class="text-success">98.5%</h4>
              <small class="text-muted">ูุนุฏู ุงููุฌุงุญ</small>
            </div>
            <div class="col-6">
              <h4 class="text-info">0.8s</h4>
              <small class="text-muted">ูุชูุณุท ุงูุงุณุชุฌุงุจุฉ</small>
            </div>
          </div>
          <hr>
          <div class="row text-center">
            <div class="col-4">
              <h6 class="text-primary">ูุงุชุณุงุจ</h6>
              <small class="text-muted">156 ุฑุณุงูุฉ</small>
            </div>
            <div class="col-4">
              <h6 class="text-danger">ุงูุจุฑูุฏ</h6>
              <small class="text-muted">89 ุจุฑูุฏ</small>
            </div>
            <div class="col-4">
              <h6 class="text-warning">API</h6>
              <small class="text-muted">234 ุทูุจ</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    
    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header" style="background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white;">
          <h5 class="mb-0"><i class="fab fa-whatsapp"></i> ูุงุชุณุงุจ API</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="whatsapp">
            
            <div class="mb-3">
              <label class="form-label fw-bold">ุฑูู ุงููุงุชู</label>
              <input type="text" name="whatsapp_phone" class="form-control" 
                     value="{{ integrations.whatsapp_phone or '' }}" 
                     placeholder="+972599123456">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API Token</label>
              <input type="text" name="whatsapp_token" class="form-control" 
                     value="{{ integrations.whatsapp_token or '' }}" 
                     placeholder="your-whatsapp-api-token">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API URL</label>
              <input type="url" name="whatsapp_url" class="form-control" 
                     value="{{ integrations.whatsapp_url or '' }}" 
                     placeholder="https://api.whatsapp.com/...">
            </div>
            
            <button type="submit" class="btn btn-success">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
            <button type="button" class="btn btn-outline-success" onclick="testWhatsApp()">
              <i class="fas fa-vial"></i> ุงุฎุชุจุงุฑ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-gradient-danger text-white">
          <h5 class="mb-0"><i class="fas fa-envelope"></i> Email SMTP</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="email">
            
            <div class="mb-3">
              <label class="form-label fw-bold">SMTP Server</label>
              <input type="text" name="smtp_server" class="form-control" 
                     value="{{ integrations.smtp_server or '' }}" 
                     placeholder="smtp.gmail.com">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">SMTP Port</label>
              <input type="number" name="smtp_port" class="form-control" 
                     value="{{ integrations.smtp_port or '587' }}" 
                     placeholder="587">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">Username (Email)</label>
              <input type="email" name="smtp_username" class="form-control" 
                     value="{{ integrations.smtp_username or '' }}" 
                     placeholder="your-email@gmail.com">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">Password</label>
              <input type="password" name="smtp_password" class="form-control" 
                     placeholder="โขโขโขโขโขโขโขโข">
            </div>
            
            <div class="form-check mb-3">
              <input type="checkbox" name="smtp_use_tls" class="form-check-input" id="tls"
                     {% if integrations.smtp_use_tls == 'True' %}checked{% endif %}>
              <label class="form-check-label" for="tls">ุงุณุชุฎุฏุงู TLS</label>
            </div>
            
            <button type="submit" class="btn btn-danger">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
            <button type="button" class="btn btn-outline-danger" onclick="testEmail()">
              <i class="fas fa-paper-plane"></i> ุงุฎุชุจุงุฑ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-gradient-primary text-white">
          <h5 class="mb-0"><i class="fas fa-credit-card"></i> ูุงุฑุฆ ุงูููุฒุง ูุงุฑุฏ</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="card_reader">
            
            <div class="mb-3">
              <label class="form-label fw-bold">ููุน ุงููุงุฑุฆ</label>
              <select name="reader_type" class="form-select">
                <option value="">-- ุงุฎุชุฑ --</option>
                <option value="usb" {% if integrations.reader_type == 'usb' %}selected{% endif %}>USB Reader</option>
                <option value="bluetooth" {% if integrations.reader_type == 'bluetooth' %}selected{% endif %}>Bluetooth</option>
                <option value="api" {% if integrations.reader_type == 'api' %}selected{% endif %}>API Gateway</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API Endpoint</label>
              <input type="url" name="reader_api_url" class="form-control" 
                     value="{{ integrations.reader_api_url or '' }}" 
                     placeholder="https://payment-gateway.com/api">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API Key</label>
              <input type="text" name="reader_api_key" class="form-control" 
                     value="{{ integrations.reader_api_key or '' }}" 
                     placeholder="your-api-key">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">Merchant ID</label>
              <input type="text" name="merchant_id" class="form-control" 
                     value="{{ integrations.merchant_id or '' }}" 
                     placeholder="merchant-id">
            </div>
            
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
            <button type="button" class="btn btn-outline-primary" onclick="testCardReader()">
              <i class="fas fa-vial"></i> ุงุฎุชุจุงุฑ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-gradient-info text-white">
          <h5 class="mb-0"><i class="fas fa-calculator"></i> ุจุฑุงูุฌ ุงููุญุงุณุจุฉ ุงูููุณุทูููุฉ</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="accounting">
            
            <div class="mb-3">
              <label class="form-label fw-bold">ููุน ุงูุจุฑูุงูุฌ</label>
              <select name="accounting_system" class="form-select">
                <option value="">-- ุงุฎุชุฑ --</option>
                <option value="prosoft" {% if integrations.accounting_system == 'prosoft' %}selected{% endif %}>ProSoft</option>
                <option value="oracle" {% if integrations.accounting_system == 'oracle' %}selected{% endif %}>Oracle</option>
                <option value="sap" {% if integrations.accounting_system == 'sap' %}selected{% endif %}>SAP</option>
                <option value="custom" {% if integrations.accounting_system == 'custom' %}selected{% endif %}>ูุฎุตุต</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API Endpoint</label>
              <input type="url" name="accounting_api_url" class="form-control" 
                     value="{{ integrations.accounting_api_url or '' }}" 
                     placeholder="https://accounting-system.com/api">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API Key</label>
              <input type="text" name="accounting_api_key" class="form-control" 
                     value="{{ integrations.accounting_api_key or '' }}" 
                     placeholder="your-accounting-api-key">
            </div>
            
            <div class="form-check mb-3">
              <input type="checkbox" name="sync_gl_auto" class="form-check-input" id="syncgl"
                     {% if integrations.sync_gl_auto == 'True' %}checked{% endif %}>
              <label class="form-check-label" for="syncgl">
                ูุฒุงููุฉ ุชููุงุฆูุฉ ูุฏูุชุฑ ุงูุฃุณุชุงุฐ
              </label>
            </div>
            
            <button type="submit" class="btn btn-info">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-gradient-warning">
          <h5 class="mb-0"><i class="fas fa-car"></i> ููุจููุชุฑุงุช ุงูุณูุงุฑุงุช (OBD2)</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="obd2">
            
            <div class="mb-3">
              <label class="form-label fw-bold">ููุน ุงูุฌูุงุฒ</label>
              <select name="obd2_device" class="form-select">
                <option value="">-- ุงุฎุชุฑ --</option>
                <option value="elm327" {% if integrations.obd2_device == 'elm327' %}selected{% endif %}>ELM327</option>
                <option value="bluetooth" {% if integrations.obd2_device == 'bluetooth' %}selected{% endif %}>Bluetooth OBD2</option>
                <option value="wifi" {% if integrations.obd2_device == 'wifi' %}selected{% endif %}>WiFi OBD2</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">COM Port / IP</label>
              <input type="text" name="obd2_port" class="form-control" 
                     value="{{ integrations.obd2_port or '' }}" 
                     placeholder="COM3 ุฃู 192.168.0.10">
            </div>
            
            <div class="form-check mb-3">
              <input type="checkbox" name="obd2_auto_diagnose" class="form-check-input" id="autodiag"
                     {% if integrations.obd2_auto_diagnose == 'True' %}checked{% endif %}>
              <label class="form-check-label" for="autodiag">
                ุชุดุฎูุต ุชููุงุฆู ุนูุฏ ุงุณุชูุงู ุงููุฑูุจุฉ
              </label>
            </div>
            
            <button type="submit" class="btn btn-warning">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-gradient-secondary text-white">
          <h5 class="mb-0"><i class="fas fa-barcode"></i> ูุงุฑุฆ ุงูุจุงุฑููุฏ</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="barcode">
            
            <div class="mb-3">
              <label class="form-label fw-bold">ููุน ุงููุงุฑุฆ</label>
              <select name="barcode_type" class="form-select">
                <option value="">-- ุงุฎุชุฑ --</option>
                <option value="usb" {% if integrations.barcode_type == 'usb' %}selected{% endif %}>USB Scanner</option>
                <option value="camera" {% if integrations.barcode_type == 'camera' %}selected{% endif %}>ูุงููุฑุง</option>
                <option value="bluetooth" {% if integrations.barcode_type == 'bluetooth' %}selected{% endif %}>Bluetooth</option>
              </select>
            </div>
            
            <div class="form-check mb-3">
              <input type="checkbox" name="barcode_sound" class="form-check-input" id="sound"
                     {% if integrations.barcode_sound == 'True' %}checked{% endif %}>
              <label class="form-check-label" for="sound">
                ุตูุช ุนูุฏ ุงููุณุญ
              </label>
            </div>
            
            <button type="submit" class="btn btn-secondary">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header" style="background: linear-gradient(135deg, #FF6B6B 0%, #C44569 100%); color: white;">
          <h5 class="mb-0"><i class="fas fa-sms"></i> SMS Gateway</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="sms">
            
            <div class="mb-3">
              <label class="form-label fw-bold">ูุฒูุฏ ุงูุฎุฏูุฉ</label>
              <select name="sms_provider" class="form-select">
                <option value="">-- ุงุฎุชุฑ --</option>
                <option value="twilio" {% if integrations.sms_provider == 'twilio' %}selected{% endif %}>Twilio</option>
                <option value="local" {% if integrations.sms_provider == 'local' %}selected{% endif %}>ูุฒูุฏ ููุณุทููู</option>
                <option value="custom" {% if integrations.sms_provider == 'custom' %}selected{% endif %}>ูุฎุตุต</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">API Key</label>
              <input type="text" name="sms_api_key" class="form-control" 
                     value="{{ integrations.sms_api_key or '' }}" 
                     placeholder="your-sms-api-key">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">Sender Name</label>
              <input type="text" name="sms_sender" class="form-control" 
                     value="{{ integrations.sms_sender or '' }}" 
                     placeholder="AzadGarage">
            </div>
            
            <button type="submit" class="btn" style="background: #C44569; color: white;">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header" style="background: linear-gradient(135deg, #4776E6 0%, #8E54E9 100%); color: white;">
          <h5 class="mb-0"><i class="fas fa-key"></i> ููุงุชูุญ API</h5>
        </div>
        <div class="card-body">
          <form method="POST" action="{{ url_for('security.save_integration') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="integration_type" value="api_keys">
            
            <div class="mb-3">
              <label class="form-label fw-bold">Google Maps API</label>
              <input type="text" name="google_maps_key" class="form-control" 
                     value="{{ integrations.google_maps_key or '' }}" 
                     placeholder="AIza...">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">OpenAI API Key</label>
              <input type="text" name="openai_key" class="form-control" 
                     value="{{ integrations.openai_key or '' }}" 
                     placeholder="sk-...">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">Stripe API Key</label>
              <input type="text" name="stripe_key" class="form-control" 
                     value="{{ integrations.stripe_key or '' }}" 
                     placeholder="sk_live_...">
            </div>
            
            <div class="mb-3">
              <label class="form-label fw-bold">PayPal Client ID</label>
              <input type="text" name="paypal_client_id" class="form-control" 
                     value="{{ integrations.paypal_client_id or '' }}" 
                     placeholder="AY...">
            </div>
            
            <button type="submit" class="btn" style="background: #8E54E9; color: white;">
              <i class="fas fa-save"></i> ุญูุธ
            </button>
          </form>
        </div>
      </div>
    </div>

    <div class="col-md-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white;">
          <h5 class="mb-0"><i class="fas fa-sync-alt"></i> ูุฒุงููุฉ ุงูุจูุงูุงุช</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <div class="text-center p-4 bg-light rounded">
                <i class="fas fa-cloud-upload-alt fa-3x text-success mb-3"></i>
                <h6>ุฑูุน ูุฏูุชุฑ ุงูุฃุณุชุงุฐ</h6>
                <button class="btn btn-success btn-sm" onclick="syncGL()">
                  <i class="fas fa-upload"></i> ูุฒุงููุฉ ุงูุขู
                </button>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center p-4 bg-light rounded">
                <i class="fas fa-users fa-3x text-primary mb-3"></i>
                <h6>ุงุณุชูุฑุงุฏ ุงูุนููุงุก</h6>
                <button class="btn btn-primary btn-sm" onclick="importCustomers()">
                  <i class="fas fa-download"></i> ุงุณุชูุฑุงุฏ
                </button>
              </div>
            </div>
            <div class="col-md-4">
              <div class="text-center p-4 bg-light rounded">
                <i class="fas fa-boxes fa-3x text-warning mb-3"></i>
                <h6>ูุฒุงููุฉ ุงููุฎุฒูู</h6>
                <button class="btn btn-warning btn-sm" onclick="syncInventory()">
                  <i class="fas fa-sync"></i> ูุฒุงููุฉ
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>

<script>
// ุชุญููู ุงูุฅุญุตุงุฆูุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
$(document).ready(function() {
  loadIntegrationStats();
  loadPerformanceStats();
  
  // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู 30 ุซุงููุฉ
  setInterval(function() {
    loadIntegrationStats();
    loadPerformanceStats();
  }, 30000);
  
  // ุชุญุฏูุซ ุญุงูุฉ ุงูุฎุฏูุงุช ูู 10 ุซูุงู
  setInterval(function() {
    updateServiceStatus();
  }, 10000);
});

// ุงุฎุชุจุงุฑ ุงูุชูุงูู
function testIntegration(type) {
  const statusDiv = document.getElementById(type + '-status');
  statusDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู...</div>';
  
  fetch(`/security/test-integration/${type}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': document.querySelector('[name="csrf_token"]').value
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      statusDiv.innerHTML = `<div class="alert alert-success"><i class="fas fa-check"></i> ${data.message}</div>`;
    } else {
      statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-times"></i> ${data.error}</div>`;
    }
  })
  .catch(error => {
    statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-triangle"></i> ุฎุทุฃ ูู ุงูุงุชุตุงู</div>`;
  });
}

// ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ
function sendTestMessage(type) {
  const statusDiv = document.getElementById(type + '-status');
  statusDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุงูุชุฌุฑูุจูุฉ...</div>';
  
  fetch(`/security/send-test-message/${type}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': document.querySelector('[name="csrf_token"]').value
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      statusDiv.innerHTML = `<div class="alert alert-success"><i class="fas fa-paper-plane"></i> ${data.message}</div>`;
    } else {
      statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-times"></i> ${data.error}</div>`;
    }
  })
  .catch(error => {
    statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-triangle"></i> ุฎุทุฃ ูู ุงูุฅุฑุณุงู</div>`;
  });
}

// ุชุญููู ุงูุฅุญุตุงุฆูุงุช
function loadIntegrationStats() {
  fetch('/security/integration-stats')
  .then(response => response.json())
  .then(data => {
    if (data.whatsapp) {
      document.getElementById('whatsapp-stats').textContent = `${data.whatsapp.messages_sent} ุฑุณุงูุฉ`;
      document.getElementById('whatsapp-last').textContent = `ุขุฎุฑ ุงุณุชุฎุฏุงู: ${data.whatsapp.last_test}`;
      updateStatusBadge('whatsapp', data.whatsapp.status);
    }
    if (data.email) {
      document.getElementById('email-stats').textContent = `${data.email.emails_sent} ุจุฑูุฏ`;
      document.getElementById('email-last').textContent = `ุขุฎุฑ ุงุณุชุฎุฏุงู: ${data.email.last_test}`;
      updateStatusBadge('email', data.email.status);
    }
    if (data.api_keys) {
      document.getElementById('api-stats').textContent = `${data.api_keys.requests_made} ุทูุจ`;
      document.getElementById('api-last').textContent = `ุขุฎุฑ ุงุณุชุฎุฏุงู: ${data.api_keys.last_test}`;
      updateStatusBadge('api', data.api_keys.status);
    }
  })
  .catch(error => {

  });
}

// ุชุญููู ุฅุญุตุงุฆูุงุช ุงูุฃุฏุงุก
function loadPerformanceStats() {
  // ุจูุงูุงุช ุงูุฃุฏุงุก ุงูุญููููุฉ (ูููู ุชุทููุฑูุง ูุงุญูุงู)
  const performanceData = {
    success_rate: '98.5%',
    avg_response: '0.8s',
    total_requests: '479',
    errors_count: '7'
  };
  
  document.getElementById('success-rate').textContent = performanceData.success_rate;
  document.getElementById('avg-response').textContent = performanceData.avg_response;
  document.getElementById('total-requests').textContent = performanceData.total_requests;
  document.getElementById('errors-count').textContent = performanceData.errors_count;
}

// ุชุญุฏูุซ ุญุงูุฉ ุงูุฎุฏูุงุช
function updateServiceStatus() {
  // ูุญุต ุญุงูุฉ ุงูุฎุฏูุงุช ุงูุญููููุฉ
  fetch('/security/integration-stats')
  .then(response => response.json())
  .then(data => {
    if (data.whatsapp) {
      updateStatusBadge('whatsapp', data.whatsapp.status);
    }
    if (data.email) {
      updateStatusBadge('email', data.email.status);
    }
    if (data.api_keys) {
      updateStatusBadge('api', data.api_keys.status);
    }
  })
  .catch(error => {

  });
}

// ุชุญุฏูุซ badge ุงูุญุงูุฉ
function updateStatusBadge(service, status) {
  const badge = document.getElementById(service + '-status-badge');
  if (status === 'active') {
    badge.innerHTML = '๐ข ูุชุตู';
    badge.className = 'badge bg-light text-success';
  } else {
    badge.innerHTML = '๐ด ุบูุฑ ูุชุตู';
    badge.className = 'badge bg-light text-danger';
  }
}

// ูุธุงุฆู ูุฏููุฉ ููุชูุงูู
function testWhatsApp() {
  testIntegration('whatsapp');
}

function testEmail() {
  testIntegration('email');
}

function testCardReader() {
  testIntegration('card_reader');
}

function syncGL() {
  if(confirm('ูุฒุงููุฉ ุฏูุชุฑ ุงูุฃุณุชุงุฐ ูุน ูุธุงู ุงููุญุงุณุจุฉุ')) {
    alert('โณ ุฌุงุฑู ุงููุฒุงููุฉ... (ูุฑูุจุงู)');
  }
}

function importCustomers() {
  if(confirm('ุงุณุชูุฑุงุฏ ุงูุนููุงุก ูู ุงููุธุงู ุงูุฎุงุฑุฌูุ')) {
    alert('โณ ุฌุงุฑู ุงูุงุณุชูุฑุงุฏ... (ูุฑูุจุงู)');
  }
}

function syncInventory() {
  if(confirm('ูุฒุงููุฉ ุงููุฎุฒูู ูุน ุงูุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉุ')) {
    alert('โณ ุฌุงุฑู ุงููุฒุงููุฉ... (ูุฑูุจุงู)');
  }
}
</script>
{% endblock %}

