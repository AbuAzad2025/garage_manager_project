{% extends 'base.html' %}
{% block title %}ğŸ“ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      
      <div class="card bg-gradient-primary text-white mb-4">
        <div class="card-body">
          <h2><i class="fas fa-graduation-cap"></i> Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</h2>
          <p class="mb-0">Ù†Ø¸Ø§Ù… Ø´Ø§Ù…Ù„ Ù„Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ…Ø±ØŒ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒØªØ¨ØŒ Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚ØŒ ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</p>
        </div>
      </div>
      
      <div class="row">
        
        <div class="col-md-4 mb-4">
          <div class="card h-100 border-primary shadow-sm">
            <div class="card-header bg-primary text-white">
              <h5><i class="fas fa-sync"></i> Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ…Ø±</h5>
            </div>
            <div class="card-body">
              <p>ÙŠØ¯Ø±Ø³ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙŠÙƒØªØ´Ù Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª</p>
              
              <div class="d-grid">
                <button class="btn btn-primary mb-2" onclick="startLearningSession()">
                  <i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© ØªØ¹Ù„Ù…
                </button>
                <button class="btn btn-outline-primary" onclick="viewLearningStats()">
                  <i class="fas fa-chart-bar"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                </button>
              </div>
              
              <div id="learning-status" class="mt-3"></div>
            </div>
          </div>
        </div>
        
        <div class="col-md-4 mb-4">
          <div class="card h-100 border-success shadow-sm">
            <div class="card-header bg-success text-white">
              <h5><i class="fas fa-book"></i> Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒØªØ¨</h5>
            </div>
            <div class="card-body">
              <p>Ø±ÙØ¹ ÙˆØ­ÙØ¸ ÙƒØªØ¨ Ø¨ØµÙŠØºØ© MD Ø£Ùˆ PDF</p>
              
              <div class="mb-3">
                <label class="form-label">Ø§Ø®ØªØ± Ù…Ù„Ù:</label>
                <input type="file" class="form-control" id="bookFile" accept=".md,.pdf">
              </div>
              
              <div class="d-grid">
                <button class="btn btn-success mb-2" onclick="uploadAndReadBook()">
                  <i class="fas fa-upload"></i> Ø±ÙØ¹ ÙˆÙ‚Ø±Ø§Ø¡Ø©
                </button>
                <button class="btn btn-outline-success" onclick="viewBooks()">
                  <i class="fas fa-book-open"></i> Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                </button>
              </div>
              
              <div id="book-status" class="mt-3"></div>
            </div>
          </div>
        </div>
        
        <div class="col-md-4 mb-4">
          <div class="card h-100 border-warning shadow-sm">
            <div class="card-header bg-warning text-dark">
              <h5><i class="fas fa-brain"></i> Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h5>
            </div>
            <div class="card-body">
              <p>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© ÙˆØ§Ù„Ø­ÙØ¸</p>
              
              <div id="memory-stats" class="mb-3">
                <div class="spinner-border text-warning" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              
              <div class="d-grid">
                <button class="btn btn-warning mb-2" onclick="consolidateMemory()">
                  <i class="fas fa-compress-arrows-alt"></i> ØªØ±Ø³ÙŠØ® Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                </button>
                <button class="btn btn-outline-warning" onclick="searchMemory()">
                  <i class="fas fa-search"></i> Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                </button>
              </div>
            </div>
          </div>
        </div>
        
      </div>
      
      <div class="row">
        
        <div class="col-md-8 mb-4">
          <div class="card border-info shadow-sm">
            <div class="card-header bg-info text-white">
              <h5><i class="fas fa-lightbulb"></i> Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚</h5>
            </div>
            <div class="card-body">
              <p>Ø§Ø®ØªØ¨Ø± ÙÙ‡Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ù„Ø£ÙŠ Ù…ÙÙ‡ÙˆÙ…:</p>
              
              <div class="input-group mb-3">
                <input type="text" class="form-control" id="conceptInput" 
                       placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù…ÙŠÙ„ØŒ Ù‚ÙŠØ¯ Ù…Ø­Ø§Ø³Ø¨ÙŠØŒ VATØŒ Ø±ØµÙŠØ¯...">
                <button class="btn btn-info" onclick="explainConcept()">
                  <i class="fas fa-search"></i> Ø§Ø´Ø±Ø­ Ø¨Ø¹Ù…Ù‚
                </button>
              </div>
              
              <div id="comprehension-result" class="mt-3"></div>
            </div>
          </div>
        </div>
        
        <div class="col-md-4 mb-4">
          <div class="card border-danger shadow-sm">
            <div class="card-header bg-danger text-white">
              <h5><i class="fas fa-tachometer-alt"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
            </div>
            <div class="card-body">
              <div id="system-health">
                <div class="spinner-border text-danger" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
      </div>
      
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-dark text-white">
              <h5><i class="fas fa-history"></i> Ø³Ø¬Ù„ Ø¬Ù„Ø³Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨</h5>
            </div>
            <div class="card-body">
              <div id="training-log"></div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>

<script>
async function startLearningSession() {
  const statusDiv = document.getElementById('learning-status');
  statusDiv.innerHTML = '<div class="alert alert-info">Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„ØªØ¹Ù„Ù…...</div>';
  
  try {
    const response = await fetch('/ai/admin/command/start_learning_session', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'}
    });
    
    const data = await response.json();
    
    if (data.success && data.result.session) {
      const session = data.result.session;
      
      let html = '<div class="alert alert-success">';
      html += `<h6>Ø¬Ù„Ø³Ø© ØªØ¹Ù„Ù… Ù…ÙƒØªÙ…Ù„Ø©!</h6>`;
      html += `<p>ØªÙ… ØªØ¹Ù„Ù… ${session.total_items_learned} Ø¹Ù†ØµØ±</p>`;
      html += `<p>Ø§Ù„Ù…Ø±Ø§Ø­Ù„:</p><ul>`;
      
      for (const phase of session.phases) {
        html += `<li>${phase.name}: ${phase.items_learned} Ø¹Ù†ØµØ±</li>`;
      }
      
      html += '</ul></div>';
      statusDiv.innerHTML = html;
      
      loadSystemHealth();
    } else {
      statusDiv.innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø£: ' + (data.error || 'Unknown') + '</div>';
    }
  } catch (error) {
    statusDiv.innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø£: ' + error + '</div>';
  }
}

async function uploadAndReadBook() {
  const fileInput = document.getElementById('bookFile');
  const statusDiv = document.getElementById('book-status');
  
  if (!fileInput.files || fileInput.files.length === 0) {
    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹');
    return;
  }
  
  const file = fileInput.files[0];
  const formData = new FormData();
  formData.append('book_file', file);
  
  statusDiv.innerHTML = '<div class="alert alert-info">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù‚Ø±Ø§Ø¡Ø©...</div>';
  
  try {
    const response = await fetch('/ai/admin/upload_book', {
      method: 'POST',
      body: formData
    });
    
    const data = await response.json();
    
    if (data.success) {
      let html = '<div class="alert alert-success">';
      html += `<h6>ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙƒØªØ§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</h6>`;
      html += `<p>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${data.title}</p>`;
      
      if (data.chapters) {
        html += `<p>Ø§Ù„ÙØµÙˆÙ„: ${data.chapters}</p>`;
      }
      if (data.pages) {
        html += `<p>Ø§Ù„ØµÙØ­Ø§Øª: ${data.pages}</p>`;
      }
      
      html += '</div>';
      statusDiv.innerHTML = html;
    } else {
      statusDiv.innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø£: ' + data.error + '</div>';
    }
  } catch (error) {
    statusDiv.innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø£: ' + error + '</div>';
  }
}

async function explainConcept() {
  const concept = document.getElementById('conceptInput').value.trim();
  const resultDiv = document.getElementById('comprehension-result');
  
  if (!concept) {
    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙÙ‡ÙˆÙ…');
    return;
  }
  
  resultDiv.innerHTML = '<div class="text-center"><div class="spinner-border text-info"></div><p class="mt-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø¹Ù…ÙŠÙ‚...</p></div>';
  
  try {
    const response = await fetch('/ai/admin/command/comprehend_concept', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({concept: concept})
    });
    
    const data = await response.json();
    
    if (data.success && data.result.explanation) {
      const explanation = data.result.explanation.replace(/\n/g, '<br>');
      resultDiv.innerHTML = `<div class="alert alert-light border"><pre class="mb-0">${explanation}</pre></div>`;
    } else {
      resultDiv.innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø£: ' + (data.error || 'Unknown') + '</div>';
    }
  } catch (error) {
    resultDiv.innerHTML = '<div class="alert alert-danger">Ø®Ø·Ø£: ' + error + '</div>';
  }
}

async function consolidateMemory() {
  try {
    const response = await fetch('/ai/admin/command/consolidate_memory', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'}
    });
    
    const data = await response.json();
    
    if (data.success) {
      Swal.fire({
        icon: 'success',
        title: 'ØªÙ… ØªØ±Ø³ÙŠØ® Ø§Ù„Ø°Ø§ÙƒØ±Ø©',
        html: `<p>ØªÙ… ØªØ±Ø³ÙŠØ® ${data.result.consolidated_items} Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰</p>`
      });
      
      loadMemoryStats();
    }
  } catch (error) {
    Swal.fire('Ø®Ø·Ø£', error.toString(), 'error');
  }
}

async function loadMemoryStats() {
  const statsDiv = document.getElementById('memory-stats');
  
  try {
    const response = await fetch('/ai/admin/memory_stats');
    const data = await response.json();
    
    if (data.success && data.stats) {
      const stats = data.stats;
      
      let html = '<div class="small">';
      html += `<p class="mb-1">ğŸ“ Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰: <strong>${stats.short_term || 0}</strong></p>`;
      html += `<p class="mb-1">ğŸ’¾ Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰: <strong>${stats.long_term || 0}</strong></p>`;
      html += `<p class="mb-1">ğŸ§  Ø¯Ù„Ø§Ù„ÙŠØ©: <strong>${stats.semantic || 0}</strong></p>`;
      html += `<p class="mb-1">âš™ï¸ Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ©: <strong>${stats.procedural || 0}</strong></p>`;
      html += `<p class="mb-1">ğŸ“… Ø¹Ø±Ø¶ÙŠØ©: <strong>${stats.episodic || 0}</strong></p>`;
      html += `<hr><p class="mb-0"><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${stats.total || 0}</strong></p>`;
      html += '</div>';
      
      statsDiv.innerHTML = html;
    }
  } catch (error) {
    statsDiv.innerHTML = '<div class="text-danger">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>';
  }
}

async function loadSystemHealth() {
  const healthDiv = document.getElementById('system-health');
  
  try {
    const response = await fetch('/ai/admin/system_status');
    const data = await response.json();
    
    if (data.success && data.status) {
      const status = data.status;
      
      let html = '<div class="small">';
      html += `<p class="mb-1">Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©: <strong>${status.subsystems_count || 0}</strong></p>`;
      html += `<p class="mb-1">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©: <strong>${status.active_operations || 0}</strong></p>`;
      
      const operational = status.all_operational;
      html += `<p class="mb-0">Ø§Ù„Ø­Ø§Ù„Ø©: <span class="badge ${operational ? 'bg-success' : 'bg-warning'}">${operational ? 'ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„' : 'Ø¬Ø²Ø¦ÙŠ'}</span></p>`;
      html += '</div>';
      
      healthDiv.innerHTML = html;
    }
  } catch (error) {
    healthDiv.innerHTML = '<div class="text-danger">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</div>';
  }
}

loadMemoryStats();
loadSystemHealth();

setInterval(loadSystemHealth, 30000);
</script>

{% endblock %}

