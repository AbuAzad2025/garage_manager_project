{% extends "base.html" %}
{% block title %}ุงูุจุญุซ ูู ุงูุฃุฑุดููุงุช{% endblock %}
{% block page_header %}๐ ุงูุจุญุซ ูู ุงูุฃุฑุดููุงุช{% endblock %}

{% block content %}
<div class="container my-4">
  
  <!-- ูููุฐุฌ ุงูุจุญุซ -->
  <div class="card border-0 shadow-lg mb-4">
    <div class="card-header bg-gradient-primary text-white">
      <h5 class="mb-0"><i class="fas fa-search"></i> ูููุฐุฌ ุงูุจุญุซ ุงููุชูุฏู</h5>
    </div>
    <div class="card-body">
      <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="row g-3">
          <div class="col-md-4">
            <label for="record_type" class="form-label fw-bold">ููุน ุงูุณุฌู</label>
            <select name="record_type" id="record_type" class="form-select">
              <option value="">ุฌููุน ุงูุฃููุงุน</option>
              <option value="service_requests">ุทูุจุงุช ุงูุตูุงูุฉ</option>
              <option value="payments">ุงูุฏูุนุงุช</option>
              <option value="sales">ุงููุจูุนุงุช</option>
              <option value="expenses">ุงููููุงุช</option>
              <option value="checks">ุงูุดููุงุช</option>
            </select>
          </div>
          
          <div class="col-md-4">
            <label for="date_from" class="form-label fw-bold">ูู ุชุงุฑูุฎ</label>
            <input type="date" name="date_from" id="date_from" class="form-control">
          </div>
          
          <div class="col-md-4">
            <label for="date_to" class="form-label fw-bold">ุฅูู ุชุงุฑูุฎ</label>
            <input type="date" name="date_to" id="date_to" class="form-control">
          </div>
          
          <div class="col-md-12">
            <label for="search_term" class="form-label fw-bold">ูููุฉ ุงูุจุญุซ</label>
            <input type="text" name="search_term" id="search_term" class="form-control" placeholder="ุงุจุญุซ ูู ุงูุจูุงูุงุช ุฃู ุฃุณุจุงุจ ุงูุฃุฑุดูุฉ">
          </div>
          
          <div class="col-12">
            <button type="submit" class="btn btn-primary fw-bold">
              <i class="fas fa-search"></i> ุจุญุซ
            </button>
            <a href="{{ url_for('archive.search') }}" class="btn btn-outline-secondary">
              <i class="fas fa-undo"></i> ุฅุนุงุฏุฉ ุชุนููู
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- ูุชุงุฆุฌ ุงูุจุญุซ -->
  {% if archives %}
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-gradient-success text-white">
      <h5 class="mb-0"><i class="fas fa-list"></i> ูุชุงุฆุฌ ุงูุจุญุซ ({{ archives|length }} ูุชูุฌุฉ)</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>ููุน ุงูุณุฌู</th>
              <th>ูุนุฑู ุงูุณุฌู</th>
              <th>ุณุจุจ ุงูุฃุฑุดูุฉ</th>
              <th>ุชุงุฑูุฎ ุงูุฃุฑุดูุฉ</th>
              <th>ุฃุฑุดูุฉ ุจูุงุณุทุฉ</th>
              <th>ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            {% for archive in archives %}
            <tr>
              <td>
                {% if archive.record_type == 'service_requests' %}
                <span class="badge bg-primary"><i class="fas fa-tools"></i> ุทูุจ ุตูุงูุฉ</span>
                {% elif archive.record_type == 'payments' %}
                <span class="badge bg-success"><i class="fas fa-credit-card"></i> ุฏูุนุฉ</span>
                {% elif archive.record_type == 'sales' %}
                <span class="badge bg-info"><i class="fas fa-shopping-cart"></i> ูุจูุนุฉ</span>
                {% elif archive.record_type == 'expenses' %}
                <span class="badge bg-warning"><i class="fas fa-receipt"></i> ูููุฉ</span>
                {% elif archive.record_type == 'checks' %}
                <span class="badge bg-danger"><i class="fas fa-money-check"></i> ุดูู</span>
                {% else %}
                <span class="badge bg-secondary"><i class="fas fa-file"></i> {{ archive.record_type }}</span>
                {% endif %}
              </td>
              <td>
                <strong>#{{ archive.record_id }}</strong>
              </td>
              <td>
                {% if archive.archive_reason %}
                <span class="text-muted">{{ archive.archive_reason }}</span>
                {% else %}
                <span class="text-muted">ุจุฏูู ุณุจุจ</span>
                {% endif %}
              </td>
              <td>
                <strong>{{ archive.archived_at.strftime('%Y-%m-%d') }}</strong>
                <br>
                <small class="text-muted">{{ archive.archived_at.strftime('%H:%M') }}</small>
              </td>
              <td>
                <span class="badge bg-light text-dark">{{ archive.user.username if archive.user else 'ุบูุฑ ูุนุฑูู' }}</span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <a href="{{ url_for('archive.view_archive', archive_id=archive.id) }}" class="btn btn-outline-primary" title="ุนุฑุถ">
                    <i class="fas fa-eye"></i>
                  </a>
                  {% if current_user.is_owner %}
                  <a href="{{ url_for('archive.restore_archive', archive_id=archive.id) }}" class="btn btn-outline-success" title="ุงุณุชุนุงุฏุฉ">
                    <i class="fas fa-undo"></i>
                  </a>
                  <form method="POST" action="{{ url_for('archive.delete_archive', archive_id=archive.id) }}" class="d-inline" onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฃุฑุดูู ููุงุฆูุงูุ')">
                    <button type="submit" class="btn btn-outline-danger" title="ุญุฐู ููุงุฆู">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% elif request.method == 'POST' %}
  <div class="alert alert-info border-0 shadow-sm">
    <i class="fas fa-info-circle"></i>
    <strong>ูุง ุชูุฌุฏ ูุชุงุฆุฌ:</strong> ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุฑุดููุงุช ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ ุงููุญุฏุฏุฉ.
  </div>
  {% endif %}

</div>
{% endblock %}

