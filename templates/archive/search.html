{% extends "base.html" %}
{% block title %}Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙØ§Øª{% endblock %}
{% block page_header %}ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙØ§Øª{% endblock %}

{% block content %}
<div class="container my-4">
  
  <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
  <div class="card border-0 shadow-lg mb-4">
    <div class="card-header bg-gradient-primary text-white">
      <h5 class="mb-0"><i class="fas fa-search"></i> Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h5>
    </div>
    <div class="card-body">
      <form method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="row g-3">
          <div class="col-md-4">
            <label for="record_type" class="form-label fw-bold">Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¬Ù„</label>
            <select name="record_type" id="record_type" class="custom-select">
              <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
              <option value="service_requests">Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
              <option value="payments">Ø§Ù„Ø¯ÙØ¹Ø§Øª</option>
              <option value="sales">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
              <option value="expenses">Ø§Ù„Ù†ÙÙ‚Ø§Øª</option>
              <option value="checks">Ø§Ù„Ø´ÙŠÙƒØ§Øª</option>
            </select>
          </div>
          
          <div class="col-md-4">
            <label for="date_from" class="form-label fw-bold">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="date_from" id="date_from" class="form-control">
          </div>
          
          <div class="col-md-4">
            <label for="date_to" class="form-label fw-bold">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="date_to" id="date_to" class="form-control">
          </div>
          
          <div class="col-md-12">
            <label for="search_term" class="form-label fw-bold">ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«</label>
            <input type="text" name="search_term" id="search_term" class="form-control" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø£Ø±Ø´ÙØ©">
          </div>
          
          <div class="col-12">
            <button type="submit" class="btn btn-primary fw-bold">
              <i class="fas fa-search"></i> Ø¨Ø­Ø«
            </button>
            <a href="{{ url_for('archive.search') }}" class="btn btn-outline-secondary">
              <i class="fas fa-undo"></i> Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
            </a>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« -->
  {% if archives %}
  <div class="card border-0 shadow-sm">
    <div class="card-header bg-gradient-success text-white">
      <h5 class="mb-0"><i class="fas fa-list"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« ({{ archives|length }} Ù†ØªÙŠØ¬Ø©)</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¬Ù„</th>
              <th>Ù…Ø¹Ø±Ù Ø§Ù„Ø³Ø¬Ù„</th>
              <th>Ø³Ø¨Ø¨ Ø§Ù„Ø£Ø±Ø´ÙØ©</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø±Ø´ÙØ©</th>
              <th>Ø£Ø±Ø´ÙØ© Ø¨ÙˆØ§Ø³Ø·Ø©</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            {% for archive in archives %}
            <tr>
              <td>
                {% if archive.record_type == 'service_requests' %}
                <span class="badge bg-primary"><i class="fas fa-tools"></i> Ø·Ù„Ø¨ ØµÙŠØ§Ù†Ø©</span>
                {% elif archive.record_type == 'payments' %}
                <span class="badge bg-success"><i class="fas fa-credit-card"></i> Ø¯ÙØ¹Ø©</span>
                {% elif archive.record_type == 'sales' %}
                <span class="badge bg-info"><i class="fas fa-shopping-cart"></i> Ù…Ø¨ÙŠØ¹Ø©</span>
                {% elif archive.record_type == 'expenses' %}
                <span class="badge bg-warning"><i class="fas fa-receipt"></i> Ù†ÙÙ‚Ø©</span>
                {% elif archive.record_type == 'checks' %}
                <span class="badge bg-danger"><i class="fas fa-money-check"></i> Ø´ÙŠÙƒ</span>
                {% else %}
                <span class="badge bg-secondary"><i class="fas fa-file"></i> {{ archive.record_type }}</span>
                {% endif %}
              </td>
              <td>
                <strong>#{{ archive.record_id }}</strong>
              </td>
              <td>
                {% if archive.archive_reason %}
                <span class="text-muted">{{ archive.archive_reason }}</span>
                {% else %}
                <span class="text-muted">Ø¨Ø¯ÙˆÙ† Ø³Ø¨Ø¨</span>
                {% endif %}
              </td>
              <td>
                <strong>{{ archive.archived_at.strftime('%Y-%m-%d') }}</strong>
                <br>
                <small class="text-muted">{{ archive.archived_at.strftime('%H:%M') }}</small>
              </td>
              <td>
                <span class="badge bg-light text-dark">{{ archive.user.username if archive.user else 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ' }}</span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <a href="{{ url_for('archive.view_archive', archive_id=archive.id) }}" class="btn btn-outline-primary" title="Ø¹Ø±Ø¶">
                    <i class="fas fa-eye"></i>
                  </a>
                  {% if current_user.is_system or (current_user.role and current_user.role.name == 'Super Admin') %}
                  <form method="POST" action="{{ url_for('archive.restore_archive', archive_id=archive.id) }}" class="d-inline" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-outline-success" title="Ø§Ø³ØªØ¹Ø§Ø¯Ø©">
                      <i class="fas fa-undo"></i>
                    </button>
                  </form>
                  {% endif %}
                  {% if current_user.is_system %}
                  <form method="POST" action="{{ url_for('archive.delete_archive', archive_id=archive.id) }}" class="d-inline" onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø£Ø±Ø´ÙŠÙ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-outline-danger" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ">
                      <i class="fas fa-trash"></i>
                    </button>
                  </form>
                  {% endif %}
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% elif request.method == 'POST' %}
  <div class="alert alert-info border-0 shadow-sm">
    <i class="fas fa-info-circle"></i>
    <strong>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬:</strong> Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ø±Ø´ÙŠÙØ§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.
  </div>
  {% endif %}

</div>
{% endblock %}

