╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║          📋 أوامر تحديث السيرفر - نسخ ولصق مباشر                 ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝


═══════════════════════════════════════════════════════════════════
 🚀 الطريقة السريعة (نسخ ولصق كامل)
═══════════════════════════════════════════════════════════════════

cd ~/garage_manager_project && \
cp instance/app.db instance/app_backup_$(date +%Y%m%d_%H%M%S).db && \
git pull origin main && \
python3.10 -m flask db upgrade && \
touch /var/www/palkaraj_pythonanywhere_com_wsgi.py && \
echo "" && \
echo "╔═══════════════════════════════════════════════════╗" && \
echo "║                                                   ║" && \
echo "║   ✅ تم التحديث بنجاح!                           ║" && \
echo "║                                                   ║" && \
echo "╚═══════════════════════════════════════════════════╝"


═══════════════════════════════════════════════════════════════════
 📝 الطريقة التفصيلية (خطوة بخطوة)
═══════════════════════════════════════════════════════════════════

# 1️⃣ الانتقال للمجلد
cd ~/garage_manager_project

# 2️⃣ عمل Backup
cp instance/app.db instance/app_backup_$(date +%Y%m%d_%H%M%S).db

# 3️⃣ سحب التحديثات
git pull origin main

# 4️⃣ تطبيق التهجيرات
python3.10 -m flask db upgrade

# 5️⃣ إعادة تحميل التطبيق
touch /var/www/palkaraj_pythonanywhere_com_wsgi.py

# 6️⃣ التأكد من النجاح
echo "✅ تم التحديث بنجاح!"


═══════════════════════════════════════════════════════════════════
 🔍 فحص البيانات بعد التحديث (اختياري)
═══════════════════════════════════════════════════════════════════

python3.10 << 'EOF'
from app import app
from models import Customer, Payment, Invoice, Sale, Check, GLBatch

with app.app_context():
    print("\n" + "="*60)
    print("📊 فحص البيانات")
    print("="*60)
    print(f"✅ العملاء: {Customer.query.count()}")
    print(f"✅ الدفعات: {Payment.query.count()}")
    print(f"✅ الفواتير: {Invoice.query.count()}")
    print(f"✅ المبيعات: {Sale.query.count()}")
    print(f"✅ الشيكات: {Check.query.count()}")
    print(f"✅ قيود GL: {GLBatch.query.count()}")
    print("="*60 + "\n")
EOF


═══════════════════════════════════════════════════════════════════
 🚨 في حالة الطوارئ (استعادة Backup)
═══════════════════════════════════════════════════════════════════

# استعادة آخر نسخة احتياطية
cd ~/garage_manager_project
cp instance/app_backup_*.db instance/app.db
touch /var/www/palkaraj_pythonanywhere_com_wsgi.py
echo "✅ تم استعادة النسخة الاحتياطية!"


═══════════════════════════════════════════════════════════════════
 📝 ملاحظات مهمة
═══════════════════════════════════════════════════════════════════

✅ التهجيرات آمنة 100% ولا تحذف أي بيانات
✅ يتم عمل Backup تلقائي قبل التحديث
✅ البيانات القديمة محفوظة بالكامل

⚠️  إذا وجدت أن الدفعات = 0:
   - هذا ليس بسبب التحديث
   - الدفعات كانت مفقودة قبل التحديث
   - استعد من backup قديم أو أدخل دفعات جديدة


═══════════════════════════════════════════════════════════════════
 🎯 ما الجديد؟
═══════════════════════════════════════════════════════════════════

✅ معالجة الشيكات المعلقة/المرتدة
✅ تفاصيل كاملة للدفعات في كشوف الحساب
✅ ألوان الأرصدة (أحمر للسالب، أخضر للموجب)
✅ التسويات للشركاء والموردين
✅ Invoice.status أصبح property محسوب
✅ دعم الدفعات المباشرة للشركاء/الموردين
✅ دقة محاسبية 100% (صفر فرق)


═══════════════════════════════════════════════════════════════════
 📞 الدعم
═══════════════════════════════════════════════════════════════════

logs: /var/log/palkaraj.pythonanywhere.com.error.log
github: https://github.com/AbuAzad2025/garage_manager_project


═══════════════════════════════════════════════════════════════════

