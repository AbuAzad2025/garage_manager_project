{% extends 'base.html' %}

{% block title %}
  {% block page_title %}المستودعات{% endblock %} — نظام إدارة الكراج
{% endblock %}

{% block styles %}
  {{ super() }}
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/warehouses.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='adminlte/plugins/select2/css/select2.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='adminlte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css') }}">
  {% block dt_styles %}{% endblock %}
{% endblock %}

{% set ep = request.endpoint or '' %}
{% macro is_active(prefix) -%}{% if ep.startswith(prefix) %}active{% endif %}{%- endmacro %}

{% block breadcrumb %}
  {% set DEFAULT_WID = 1 %}
  {% set wid =
    (warehouse.id if warehouse is defined else
     active_warehouse_id if active_warehouse_id is defined else
     (request.view_args.get('id') if request.view_args and request.view_args.get('id') is not none else
      (request.view_args.get('warehouse_id') if request.view_args and request.view_args.get('warehouse_id') is not none else none)))
  %}

  <li class="breadcrumb-item {{ is_active('warehouse_bp.products') }}">
    <a class="btn btn-sm btn-secondary shadow-sm" href="{{ url_for('warehouse_bp.products', id=(wid or DEFAULT_WID)) }}">
      <i class="fas fa-box-open me-1"></i> منتجاتي
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.list') }}">
    <a class="btn btn-sm btn-primary shadow-sm" href="{{ url_for('warehouse_bp.list') }}">
      <i class="fas fa-warehouse me-1"></i> قائمة المستودعات
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.create') }}">
    <a class="btn btn-sm btn-success shadow-sm" href="{{ url_for('warehouse_bp.create') }}">
      <i class="fas fa-plus me-1"></i> مستودع جديد
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.inventory_summary') }}">
    <a class="btn btn-sm btn-dark shadow-sm" href="{{ url_for('warehouse_bp.inventory_summary') }}">
      <i class="fas fa-table me-1"></i> كشف المخزون
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.preorders_list') }}">
    <a class="btn btn-sm btn-info text-white shadow-sm" href="{{ url_for('warehouse_bp.preorders_list') }}">
      <i class="fas fa-clipboard-list me-1"></i> الحجوزات
    </a>
  </li>

  <li class="breadcrumb-item {{ is_active('warehouse_bp.preorder_create') }}">
    <a class="btn btn-sm btn-outline-info shadow-sm" href="{{ url_for('warehouse_bp.preorder_create') }}">
      <i class="fas fa-file-signature me-1"></i> إنشاء حجز
    </a>
  </li>
{% endblock %}

{% block content %}
  <div id="notification-container"></div>
  {% block w_content %}{% endblock %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='adminlte/plugins/select2/js/select2.full.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/warehouses.js') }}"></script>
  {% block dt_scripts %}{% endblock %}
{% endblock %}
